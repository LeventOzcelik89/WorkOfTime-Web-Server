“
hD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\AgentStart.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
{ 
public 

class 

AgentStart 
: 
ServiceBase )
{ 
List 
< 
Task 
> 
Tasks 
= 
new 
List #
<# $
Task$ (
>( )
() *
)* +
;+ ,
public 

AgentStart 
( 
) 
{ 	
} 	
public 
void 
Run 
( 
) 
{ 	
Log 
. 
Error 
( 
$str 
) 
; 
var &
taskProcessLogoEntegration *
=+ ,
new- 0
Task1 5
(5 6
(6 7
)7 8
=>9 ;
{ 
new "
ProcessLogoEntegration *
(* +
)+ ,
., -
Run- 0
(0 1
)1 2
;2 3
} 
) 
; 
Tasks   
.   
Add   
(   &
taskProcessLogoEntegration   0
)  0 1
;  1 2
var"" '
taskProcessTitanEntegration"" +
="", -
new"". 1
Task""2 6
(""6 7
(""7 8
)""8 9
=>"": <
{## 
new$$ #
ProcessTitanEntegration$$ +
($$+ ,
)$$, -
.$$- .
Run$$. 1
($$1 2
)$$2 3
;$$3 4
}%% 
)%% 
;%% 
Tasks&& 
.&& 
Add&& 
(&& '
taskProcessTitanEntegration&& 1
)&&1 2
;&&2 3
var(( )
taskProcessFtpDistEntegration(( -
=((. /
new((0 3
Task((4 8
(((8 9
(((9 :
)((: ;
=>((< >
{)) 
new** !
ProcessFtpEntegration** )
(**) *
)*** +
.**+ ,
Run**, /
(**/ 0
)**0 1
;**1 2
}++ 
)++ 
;++ 
Tasks,, 
.,, 
Add,, 
(,, )
taskProcessFtpDistEntegration,, 3
),,3 4
;,,4 5)
taskProcessFtpDistEntegration// )
.//) *
Start//* /
(/// 0
)//0 1
;//1 2
}22 	
	protected44 
override44 
void44 
OnStart44  '
(44' (
string44( .
[44. /
]44/ 0
args441 5
)445 6
{55 	
RunII 
(II 
)II 
;II 
}KK 	
	protectedMM 
overrideMM 
voidMM 
OnStopMM  &
(MM& '
)MM' (
{NN 	
LogOO 
.OO 
SuccessOO 
(OO 
$strOO -
)OO- .
;OO. /
ifPP 
(PP 
TasksPP 
!=PP 
nullPP 
&&PP  
TasksPP! &
.PP& '
CountPP' ,
>PP- .
$numPP/ 0
)PP0 1
{QQ 
foreachRR 
(RR 
varRR 
taskRR !
inRR" $
TasksRR% *
)RR* +
{SS 
taskTT 
.TT 
DisposeTT  
(TT  !
)TT! "
;TT" #
}UU 
TasksVV 
=VV 
newVV 
ListVV  
<VV  !
TaskVV! %
>VV% &
(VV& '
)VV' (
;VV( )
}WW 
}XX 	
}YY 
}ZZ ÷§
D:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\FtpGenpa.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
public 

class 
FtpGenpa 
: &
IFtpDistributorEntegration 6
{ 
public 
FtpConfiguration 
ftpConfiguration  0
{1 2
get3 6
;6 7
private8 ?
set@ C
;C D
}E F
private 
string 
Token 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
DistributorName %
{& '
get( +
{, -
return. 4
$str5 <
;< =
}> ?
}@ A
public 
Guid 
DistributorId !
{" #
get$ '
{( )
return* 0
new1 4
Guid5 9
(9 :
$str: `
)` a
;a b
}c d
}e f
private 
string 
DirUrl 
{ 
get  #
;# $
set% (
;( )
}* +
private 
string 
LoginUrl 
{  !
get" %
;% &
set' *
;* +
}, -
public 
FtpGenpa 
( 
) 
{ 	
Log 
. 
Warning 
( 
$str 1
)1 2
;2 3
SetFtpConfiguration 
(  
)  !
;! "
Login 
( 
) 
; 
GetFilesInFtp 
( 
DateTime "
." #
Now# &
)& '
;' (
} 	
public   
WorkOfTimeDatabase   !
GetDbConnection  " 1
(  1 2
)  2 3
{!! 	
var"" 

tenantCode"" 
=""  
ConfigurationManager"" 1
.""1 2
AppSettings""2 =
[""= >
$str""> M
]""M N
.""N O
ToString""O W
(""W X
)""X Y
;""Y Z
var## 
tenant## 
=## 
TenantConfig## %
.##% &

GetTenants##& 0
(##0 1
)##1 2
.##2 3
Where##3 8
(##8 9
a##9 :
=>##; =
a##> ?
.##? @

TenantCode##@ J
==##K M
Convert##N U
.##U V
ToInt32##V ]
(##] ^

tenantCode##^ h
)##h i
)##i j
.##j k
FirstOrDefault##k y
(##y z
)##z {
;##{ |
return$$ 
tenant$$ 
.$$ 
GetDatabase$$ %
($$% &
)$$& '
;$$' (
}%% 	
public&& 
ResultStatus&& !
ExportFilesToDatabase&& 1
(&&1 2
)&&2 3
{'' 	
var(( 
processDate(( 
=(( 
DateTime(( &
.((& '
Now((' *
.((* +
AddDays((+ 2
(((2 3
-((3 4
$num((4 6
)((6 7
;((7 8
var)) 
entegrationFileList)) #
=))$ %
GetFilesInFtp))& 3
())3 4
processDate))4 ?
)))? @
;))@ A
var** 
result** 
=** 
new** 
ResultStatus** )
(**) *
)*** +
;**+ ,
foreach++ 
(++ 
var++ 
entegrationFile++ (
in++) +
entegrationFileList++, ?
)++? @
{,, 
Log-- 
.-- 
Warning-- 
(-- 
$str-- A
,--A B
this--C G
.--G H
ftpConfiguration--H X
.--X Y
Url--Y \
,--\ ]
this--^ b
.--b c
DistributorName--c r
,--r s
entegrationFile	--t É
.
--É Ñ
FileName
--Ñ å
)
--å ç
;
--ç é
var.. 
db.. 
=.. 
GetDbConnection.. (
(..( )
)..) *
;..* +
result// 
=// 
db// 
.// &
InsertPRD_EntegrationFiles// 6
(//6 7
entegrationFile//7 F
)//F G
;//G H
if00 
(00 
!00 
result00 
.00 
result00 "
)00" #
{11 
Log22 
.22 
Error22 
(22 
$str22 M
,22M N
result22O U
.22U V
message22V ]
)22] ^
;22^ _
continue33 
;33 
}44 
if55 
(55 
entegrationFile55 #
.55# $
FileTypeName55$ 0
==551 3
$str554 =
)55= >
{66 
var77 
sellThr77 
=77  !
GetSellInFilesInFtp77" 5
(775 6
entegrationFile776 E
.77E F
FileName77F N
,77N O
entegrationFile77P _
.77_ `
id77` b
)77b c
;77c d
if88 
(88 
sellThr88 
!=88  "
null88# '
&&88( *
sellThr88+ 2
.882 3
Count883 8
(888 9
)889 :
>88; <
$num88= >
)88> ?
{99 
var:: 
bultInsertResult:: ,
=::- .
db::/ 1
.::1 2+
BulkInsertPRD_EntegrationAction::2 Q
(::Q R
sellThr::R Y
)::Y Z
;::Z [
if;; 
(;; 
!;; 
bultInsertResult;; -
.;;- .
result;;. 4
);;4 5
Log<< 
.<<  
Error<<  %
(<<% &
$str<<& ^
,<<^ _
this<<` d
.<<d e
ftpConfiguration<<e u
.<<u v
Url<<v y
,<<y z
this<<{ 
.	<< Ä
DistributorName
<<Ä è
,
<<è ê
bultInsertResult
<<ë °
.
<<° ¢
message
<<¢ ©
)
<<© ™
;
<<™ ´
}== 
}>> 
Log?? 
.?? 
Success?? 
(?? 
$str?? C
,??C D
this??E I
.??I J
ftpConfiguration??J Z
.??Z [
Url??[ ^
,??^ _
this??` d
.??d e
DistributorName??e t
,??t u
entegrationFile	??v Ö
.
??Ö Ü
FileName
??Ü é
)
??é è
;
??è ê
}@@ 
returnAA 
resultAA 
;AA 
}BB 	
publicCC 
stringCC 
FileTypeNameCC "
(CC" #
stringCC# )
fileNameCC* 2
)CC2 3
{DD 	
ifEE 
(EE 
fileNameEE 
.EE 
ContainsEE !
(EE! "
$strEE" *
)EE* +
)EE+ ,
returnFF 
$strFF 
;FF  
elseGG 
ifGG 
(GG 
fileNameGG 
.GG 
ContainsGG &
(GG& '
$strGG' 0
)GG0 1
)GG1 2
returnHH 
$strHH  
;HH  !
elseII 
ifII 
(II 
fileNameII 
.II 
ContainsII &
(II& '
$strII' -
)II- .
)II. /
returnJJ 
$strJJ  
;JJ  !
elseKK 
returnLL 
nullLL 
;LL 
}MM 	
publicNN  
PRD_EntegrationFilesNN #
[NN# $
]NN$ %
GetFilesInFtpNN& 3
(NN3 4
DateTimeNN4 <
processDateNN= H
)NNH I
{OO 	
LogPP 
.PP 
InfoPP 
(PP 
$strPP F
)PPF G
;PPG H
varQQ 
directoryItemsQQ 
=QQ  
newQQ! $
ListQQ% )
<QQ) *
DirectoryItemQQ* 7
>QQ7 8
(QQ8 9
)QQ9 :
;QQ: ;
tryRR 
{SS 
varTT 

webRequestTT 
=TT  

WebRequestTT! +
.TT+ ,
CreateTT, 2
(TT2 3
DirUrlTT3 9
)TT9 :
;TT: ;

webRequestUU 
.UU 
HeadersUU "
.UU" #
AddUU# &
(UU& '
$strUU' /
,UU/ 0
$strUU1 l
+UUm n
TokenUUo t
+UUu v
$strUUw z
)UUz {
;UU{ |

webRequestVV 
.VV 
MethodVV !
=VV" #
$strVV$ *
;VV* +
XmlDocumentWW 
documentWW $
=WW% &
newWW' *
XmlDocumentWW+ 6
(WW6 7
)WW7 8
;WW8 9
usingXX 
(XX 
varXX 
responseXX #
=XX$ %

webRequestXX& 0
.XX0 1
GetResponseXX1 <
(XX< =
)XX= >
)XX> ?
usingYY 
(YY 
varYY 
contentYY "
=YY# $
responseYY% -
.YY- .
GetResponseStreamYY. ?
(YY? @
)YY@ A
)YYA B
usingZZ 
(ZZ 
	XmlReaderZZ  
readerZZ! '
=ZZ( )
	XmlReaderZZ* 3
.ZZ3 4
CreateZZ4 :
(ZZ: ;
contentZZ; B
)ZZB C
)ZZC D
{[[ 
document\\ 
.\\ 
Load\\ !
(\\! "
reader\\" (
)\\( )
;\\) *
var]] 
tagName]] 
=]]  !
document]]" *
.]]* +
DocumentElement]]+ :
.]]: ; 
GetElementsByTagName]]; O
(]]O P
$str]]P V
)]]V W
;]]W X
var^^ 
dates^^ 
=^^ 
document^^  (
.^^( )
DocumentElement^^) 8
.^^8 9 
GetElementsByTagName^^9 M
(^^M N
$str^^N T
)^^T U
;^^U V
for__ 
(__ 
int__ 
i__ 
=__  
$num__! "
;__" #
i__$ %
<__& '
tagName__( /
.__/ 0
Count__0 5
;__5 6
i__7 8
++__8 :
)__: ;
{`` 
varaa 
fileNameaa $
=aa% &
tagNameaa' .
[aa. /
iaa/ 0
]aa0 1
.aa1 2
	InnerTextaa2 ;
;aa; <
varbb 
datebb  
=bb! "
DateTimebb# +
.bb+ ,
Parsebb, 1
(bb1 2
datesbb2 7
[bb7 8
ibb8 9
]bb9 :
.bb: ;
	InnerTextbb; D
)bbD E
;bbE F
ifcc 
(cc 
(cc 
fileNamecc %
.cc% &
Containscc& .
(cc. /
$strcc/ 7
)cc7 8
||cc9 ;
fileNamecc< D
.ccD E
ContainsccE M
(ccM N
$strccN W
)ccW X
)ccX Y
)ccY Z
{dd 
directoryItemsee *
.ee* +
Addee+ .
(ee. /
newee/ 2
DirectoryItemee3 @
{eeA B
NameeeC G
=eeH I
fileNameeeJ R
,eeR S
DateFileCreatedeeT c
=eed e
dateeef j
}eek l
)eel m
;eem n
}ff 
}gg 
}hh 
Logii 
.ii 
Infoii 
(ii 
$strii '
+ii( )
directoryItemsii* 8
.ii8 9
Countii9 >
)ii> ?
;ii? @
}jj 
catchkk 
(kk 
	Exceptionkk 
ekk 
)kk 
{ll 
Logmm 
.mm 
Errormm 
(mm 
$strmm $
+mm% &
emm' (
.mm( )
ToStringmm) 1
(mm1 2
)mm2 3
)mm3 4
;mm4 5
}nn 
;nn 
varoo 
dboo 
=oo 
GetDbConnectionoo $
(oo$ %
)oo% &
;oo& '
varpp  
entegrationFilesInDbpp $
=pp% &
dbpp' )
.pp) *0
$GetPRD_EntegrationFilesByCreatedDatepp* N
(ppN O
processDateppO Z
,ppZ [
DistributorNamepp\ k
)ppk l
;ppl m
varqq 
entegrationFileListqq #
=qq$ %
newqq& )
Listqq* .
<qq. / 
PRD_EntegrationFilesqq/ C
>qqC D
(qqD E
)qqE F
;qqF G
foreachrr 
(rr 
varrr 
filerr 
inrr  
directoryItemsrr! /
)rr/ 0
{ss 
iftt 
(tt  
entegrationFilesInDbtt (
.tt( )
Anytt) ,
(tt, -
xtt- .
=>tt/ 1
xtt2 3
.tt3 4
FileNamett4 <
.tt< =
Containstt= E
(ttE F
filettF J
.ttJ K
NamettK O
)ttO P
)ttP Q
)ttQ R
continueuu 
;uu 
entegrationFileListvv #
.vv# $
Addvv$ '
(vv' (
newvv( + 
PRD_EntegrationFilesvv, @
{ww 
idxx 
=xx 
Guidxx 
.xx 
NewGuidxx %
(xx% &
)xx& '
,xx' (
createdyy 
=yy 
DateTimeyy &
.yy& '
Nowyy' *
,yy* +
	createdbyzz 
=zz 
Guidzz  $
.zz$ %
Emptyzz% *
,zz* +
CreateDateInFtp{{ #
={{$ %
file{{& *
.{{* +
DateFileCreated{{+ :
,{{: ;
DistributorName|| #
=||$ %
DistributorName||& 5
,||5 6
DistributorId}} !
=}}" #
DistributorId}}$ 1
,}}1 2
FileName~~ 
=~~ 
file~~ #
.~~# $
Name~~$ (
,~~( )
FileNameDate  
=! "
Tools# (
.( )'
GetDateFromFileNameForGenpa) D
(D E
fileE I
.I J
NameJ N
,N O
$strP Z
)Z [
,[ \
ProcessTime
ÄÄ 
=
ÄÄ  !
DateTime
ÄÄ" *
.
ÄÄ* +
Now
ÄÄ+ .
,
ÄÄ. /
FileTypeName
ÅÅ  
=
ÅÅ! "
FileTypeName
ÅÅ# /
(
ÅÅ/ 0
file
ÅÅ0 4
.
ÅÅ4 5
Name
ÅÅ5 9
)
ÅÅ9 :
}
ÇÇ 
)
ÇÇ 
;
ÇÇ 
}
ÉÉ 
return
ÑÑ !
entegrationFileList
ÑÑ &
.
ÑÑ& '
ToArray
ÑÑ' .
(
ÑÑ. /
)
ÑÑ/ 0
;
ÑÑ0 1
}
ÖÖ 	
public
ÜÜ #
PRD_EntegrationAction
ÜÜ $
[
ÜÜ$ %
]
ÜÜ% &!
GetSellInFilesInFtp
ÜÜ' :
(
ÜÜ: ;
string
ÜÜ; A
fileName
ÜÜB J
,
ÜÜJ K
Guid
ÜÜL P 
entegrationFilesId
ÜÜQ c
)
ÜÜc d
{
áá 	
var
àà 
sellThrs
àà 
=
àà 
new
àà 
List
àà #
<
àà# $#
PRD_EntegrationAction
àà$ 9
>
àà9 :
(
àà: ;
)
àà; <
;
àà< =
var
ââ 
datetimeNow
ââ 
=
ââ 
DateTime
ââ &
.
ââ& '
Now
ââ' *
;
ââ* +
try
ää 
{
ãã 
List
åå 
<
åå 
PropertyIndex
åå "
>
åå" #
Index
åå$ )
=
åå* +
new
åå, /
List
åå0 4
<
åå4 5
PropertyIndex
åå5 B
>
ååB C
(
ååC D
)
ååD E
;
ååE F
var
çç 

getRawFile
çç 
=
çç  

GetRawFile
çç! +
(
çç+ ,
fileName
çç, 4
)
çç4 5
.
çç5 6
ToList
çç6 <
(
çç< =
)
çç= >
;
çç> ?
var
éé 

getHeaders
éé 
=
éé  

getRawFile
éé! +
[
éé+ ,
$num
éé, -
]
éé- .
;
éé. /

getRawFile
èè 
.
èè 
RemoveAt
èè #
(
èè# $
$num
èè$ %
)
èè% &
;
èè& '
for
êê 
(
êê 
int
êê 
i
êê 
=
êê 
$num
êê 
;
êê 
i
êê  !
<
êê" #

getHeaders
êê$ .
.
êê. /
Length
êê/ 5
;
êê5 6
i
êê7 8
++
êê8 :
)
êê: ;
{
ëë 
Index
íí 
.
íí 
Add
íí 
(
íí 
new
íí !
PropertyIndex
íí" /
{
íí0 1
Index
íí2 7
=
íí8 9
i
íí: ;
,
íí; <
Name
íí= A
=
ííB C

getHeaders
ííD N
[
ííN O
i
ííO P
]
ííP Q
}
ííR S
)
ííS T
;
ííT U
}
ìì 
foreach
îî 
(
îî 
var
îî 
rawFile
îî $
in
îî% '

getRawFile
îî( 2
)
îî2 3
{
ïï 
try
ññ 
{
óó 
var
òò 
item
òò  
=
òò! "
new
òò# &#
PRD_EntegrationAction
òò' <
(
òò< =
)
òò= >
;
òò> ?
for
ôô 
(
ôô 
int
ôô  
i
ôô! "
=
ôô# $
$num
ôô% &
;
ôô& '
i
ôô( )
<
ôô* +
rawFile
ôô, 3
.
ôô3 4
Length
ôô4 :
;
ôô: ;
i
ôô< =
++
ôô= ?
)
ôô? @
{
öö 
try
õõ 
{
úú 
var
ùù  #
	indexName
ùù$ -
=
ùù. /
Index
ùù0 5
.
ùù5 6
Where
ùù6 ;
(
ùù; <
x
ùù< =
=>
ùù> @
x
ùùA B
.
ùùB C
Index
ùùC H
==
ùùI K
i
ùùL M
)
ùùM N
.
ùùN O
Select
ùùO U
(
ùùU V
x
ùùV W
=>
ùùX Z
x
ùù[ \
.
ùù\ ]
Name
ùù] a
)
ùùa b
.
ùùb c
FirstOrDefault
ùùc q
(
ùùq r
)
ùùr s
;
ùùs t
if
ûû  "
(
ûû# $
	indexName
ûû$ -
!=
ûû. 0
null
ûû1 5
)
ûû5 6
{
üü  !
var
††$ ' 
rawFileCheckedData
††( :
=
††; <
rawFile
††= D
[
††D E
i
††E F
]
††F G
.
††G H
Replace
††H O
(
††O P
$str
††P T
,
††T U
$str
††V X
)
††X Y
.
††Y Z
Replace
††Z a
(
††a b
$str
††b f
,
††f g
$str
††h j
)
††j k
;
††k l
if
°°$ &
(
°°' (
!
°°( )
string
°°) /
.
°°/ 0
IsNullOrEmpty
°°0 =
(
°°= > 
rawFileCheckedData
°°> P
)
°°P Q
)
°°Q R
{
¢¢$ %
	indexName
££( 1
=
££2 3
	indexName
££4 =
.
££= >
ToLower
££> E
(
££E F
new
££F I
CultureInfo
££J U
(
££U V
$str
££V ]
,
££] ^
false
££_ d
)
££d e
)
££e f
.
££f g
Replace
££g n
(
££n o
$str
££o r
,
££r s
$str
££t v
)
££v w
.
££w x
Replace
££x 
(££ Ä
$str££Ä É
,££É Ñ
$str££Ö á
)££á à
;££à â
if
§§( *
(
§§+ ,
	indexName
§§, 5
==
§§6 8
$str
§§9 H
)
§§H I
item
••, 0
.
••0 1
InvoiceNumber
••1 >
=
••? @ 
rawFileCheckedData
••A S
;
••S T
if
¶¶( *
(
¶¶+ ,
	indexName
¶¶, 5
==
¶¶6 8
$str
¶¶9 ?
)
¶¶? @
item
ßß, 0
.
ßß0 1
DistributorName
ßß1 @
=
ßßA B 
rawFileCheckedData
ßßC U
;
ßßU V
if
®®( *
(
®®+ ,
	indexName
®®, 5
==
®®6 8
$str
®®9 O
)
®®O P
item
©©, 0
.
©©0 1"
CustomerOperatorCode
©©1 E
=
©©F G 
rawFileCheckedData
©©H Z
;
©©Z [
if
™™( *
(
™™+ ,
	indexName
™™, 5
==
™™6 8
$str
™™9 L
||
™™M O
	indexName
™™P Y
==
™™Z \
$str
™™] n
||
™™o q
	indexName
™™r {
==
™™| ~
$str™™ î
)™™î ï
item
´´, 0
.
´´0 1"
CustomerOperatorCode
´´1 E
=
´´F G 
rawFileCheckedData
´´H Z
;
´´Z [
if
¨¨( *
(
¨¨+ ,
	indexName
¨¨, 5
==
¨¨6 8
$str
¨¨9 G
)
¨¨G H
item
≠≠, 0
.
≠≠0 1"
CustomerOperatorName
≠≠1 E
=
≠≠F G 
rawFileCheckedData
≠≠H Z
;
≠≠Z [
if
ÆÆ( *
(
ÆÆ+ ,
	indexName
ÆÆ, 5
==
ÆÆ6 8
$str
ÆÆ9 E
)
ÆÆE F
item
ØØ, 0
.
ØØ0 1

BranchCode
ØØ1 ;
=
ØØ< = 
rawFileCheckedData
ØØ> P
;
ØØP Q
if
∞∞( *
(
∞∞+ ,
	indexName
∞∞, 5
==
∞∞6 8
$str
∞∞9 E
)
∞∞E F
item
±±, 0
.
±±0 1

BranchName
±±1 ;
=
±±< = 
rawFileCheckedData
±±> P
;
±±P Q
if
≤≤( *
(
≤≤+ ,
	indexName
≤≤, 5
==
≤≤6 8
$str
≤≤9 D
)
≤≤D E
item
≥≥, 0
.
≥≥0 1
	TaxNumber
≥≥1 :
=
≥≥; < 
rawFileCheckedData
≥≥= O
;
≥≥O P
if
¥¥( *
(
¥¥+ ,
	indexName
¥¥, 5
==
¥¥6 8
$str
¥¥9 L
)
¥¥L M
item
µµ, 0
.
µµ0 1
ConsolidationCode
µµ1 B
=
µµC D 
rawFileCheckedData
µµE W
;
µµW X
if
∂∂( *
(
∂∂+ ,
	indexName
∂∂, 5
==
∂∂6 8
$str
∂∂9 L
)
∂∂L M
item
∑∑, 0
.
∑∑0 1
ConsolidationName
∑∑1 B
=
∑∑C D 
rawFileCheckedData
∑∑E W
;
∑∑W X
if
∏∏( *
(
∏∏+ ,
	indexName
∏∏, 5
==
∏∏6 8
$str
∏∏9 ?
)
∏∏? @
item
ππ, 0
.
ππ0 1
Imei
ππ1 5
=
ππ6 7 
rawFileCheckedData
ππ8 J
;
ππJ K
if
∫∫( *
(
∫∫+ ,
	indexName
∫∫, 5
==
∫∫6 8
$str
∫∫9 A
)
∫∫A B
item
ªª, 0
.
ªª0 1
SerialNo
ªª1 9
=
ªª: ; 
rawFileCheckedData
ªª< N
;
ªªN O
if
ºº( *
(
ºº+ ,
	indexName
ºº, 5
==
ºº6 8
$str
ºº9 C
)
ººC D
item
ΩΩ, 0
.
ΩΩ0 1
Quantity
ΩΩ1 9
=
ΩΩ: ;
Convert
ΩΩ< C
.
ΩΩC D
ToInt32
ΩΩD K
(
ΩΩK L 
rawFileCheckedData
ΩΩL ^
)
ΩΩ^ _
;
ΩΩ_ `
if
ææ( *
(
ææ+ ,
	indexName
ææ, 5
==
ææ6 8
$str
ææ9 ?
)
ææ? @
item
øø, 0
.
øø0 1)
CustomerOperatorStorageCity
øø1 L
=
øøM N 
rawFileCheckedData
øøO a
;
øøa b
if
¿¿( *
(
¿¿+ ,
	indexName
¿¿, 5
==
¿¿6 8
$str
¿¿9 ?
)
¿¿? @
item
¡¡, 0
.
¡¡0 1)
CustomerOperatorStorageTown
¡¡1 L
=
¡¡M N 
rawFileCheckedData
¡¡O a
;
¡¡a b
}
¬¬$ %
}
√√  !
else
ƒƒ  $
{
≈≈  !
Log
∆∆$ '
.
∆∆' (
Error
∆∆( -
(
∆∆- .
$str
∆∆. M
)
∆∆M N
;
∆∆N O
}
««  !
}
»» 
catch
…… !
(
……" #
	Exception
……# ,
e
……- .
)
……. /
{
   
Log
ÀÀ  #
.
ÀÀ# $
Error
ÀÀ$ )
(
ÀÀ) *
$str
ÀÀ* X
,
ÀÀX Y
e
ÀÀZ [
.
ÀÀ[ \
ToString
ÀÀ\ d
(
ÀÀd e
)
ÀÀe f
)
ÀÀf g
;
ÀÀg h
}
ÃÃ 
}
ÕÕ 
item
ŒŒ 
.
ŒŒ 
DistributorId
ŒŒ *
=
ŒŒ+ ,
DistributorId
ŒŒ- :
;
ŒŒ: ;
item
œœ 
.
œœ 
DistributorName
œœ ,
=
œœ- .
this
œœ/ 3
.
œœ3 4
DistributorName
œœ4 C
;
œœC D
item
–– 
.
–– 
EntegrationFileId
–– .
=
––/ 0 
entegrationFilesId
––1 C
;
––C D
var
—— 
message
—— #
=
——$ %
$str
——& (
;
——( )
var
““ 
	inventory
““ %
=
““& '
Finder
““( .
.
““. /
FindInventory
““/ <
(
““< =
item
““= A
.
““A B
SerialNo
““B J
,
““J K
item
““L P
.
““P Q
Imei
““Q U
)
““U V
;
““V W
if
”” 
(
”” 
	inventory
”” %
==
””& (
null
””) -
)
””- .
{
‘‘ 
message
’’ #
=
’’$ %
$str
’’& J
;
’’J K
}
÷÷ 
var
◊◊ 
company
◊◊ #
=
◊◊$ %
Finder
◊◊& ,
.
◊◊, -
FindCompany
◊◊- 8
(
◊◊8 9
item
◊◊9 =
)
◊◊= >
;
◊◊> ?
if
ÿÿ 
(
ÿÿ 
!
ÿÿ 
company
ÿÿ $
.
ÿÿ$ %
HasValue
ÿÿ% -
)
ÿÿ- .
{
ŸŸ 
message
⁄⁄ #
=
⁄⁄$ %
$str
⁄⁄& L
;
⁄⁄L M
}
€€ 
item
‹‹ 
.
‹‹ 
	ProductId
‹‹ &
=
‹‹' (
	inventory
‹‹) 2
?
‹‹2 3
.
‹‹3 4
	productId
‹‹4 =
;
‹‹= >
item
›› 
.
›› 
InventoryId
›› (
=
››) *
	inventory
››+ 4
?
››4 5
.
››5 6
id
››6 8
;
››8 9
item
ﬁﬁ 
.
ﬁﬁ  
CustomerOperatorId
ﬁﬁ /
=
ﬁﬁ0 1
company
ﬁﬁ2 9
;
ﬁﬁ9 :
sellThrs
ﬂﬂ  
.
ﬂﬂ  !
Add
ﬂﬂ! $
(
ﬂﬂ$ %
item
ﬂﬂ% )
)
ﬂﬂ) *
;
ﬂﬂ* +
if
‡‡ 
(
‡‡ 
!
‡‡ 
string
‡‡ #
.
‡‡# $
IsNullOrEmpty
‡‡$ 1
(
‡‡1 2
message
‡‡2 9
)
‡‡9 :
)
‡‡: ;
{
··  
NotificationLogger
‚‚ .
.
‚‚. /
	SaveError
‚‚/ 8
(
‚‚8 9
DateTime
‚‚9 A
.
‚‚A B
Now
‚‚B E
,
‚‚E F
message
‚‚G N
,
‚‚N O
item
‚‚P T
)
‚‚T U
;
‚‚U V
}
„„ 
}
‰‰ 
catch
ÂÂ 
(
ÂÂ 
	Exception
ÂÂ $
e
ÂÂ% &
)
ÂÂ& '
{
ÊÊ 
Log
ÁÁ 
.
ÁÁ 
Error
ÁÁ !
(
ÁÁ! "
$str
ÁÁ" P
,
ÁÁP Q
e
ÁÁR S
.
ÁÁS T
ToString
ÁÁT \
(
ÁÁ\ ]
)
ÁÁ] ^
)
ÁÁ^ _
;
ÁÁ_ `
}
ËË 
}
ÈÈ 
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ 
e
ÎÎ 
)
ÎÎ 
{
ÏÏ 
Log
ÌÌ 
.
ÌÌ 
Error
ÌÌ 
(
ÌÌ 
e
ÌÌ 
.
ÌÌ 
ToString
ÌÌ $
(
ÌÌ$ %
)
ÌÌ% &
)
ÌÌ& '
;
ÌÌ' (
}
ÓÓ 
return
ÔÔ 
sellThrs
ÔÔ 
.
ÔÔ 
ToArray
ÔÔ #
(
ÔÔ# $
)
ÔÔ$ %
;
ÔÔ% &
}
 	
private
ÒÒ 
IEnumerable
ÒÒ 
<
ÒÒ 
string
ÒÒ "
[
ÒÒ" #
]
ÒÒ# $
>
ÒÒ$ %

GetRawFile
ÒÒ& 0
(
ÒÒ0 1
string
ÒÒ1 7
FileName
ÒÒ8 @
)
ÒÒ@ A
{
ÚÚ 	
var
ÛÛ 
liststringArray
ÛÛ 
=
ÛÛ  !
new
ÛÛ" %
List
ÛÛ& *
<
ÛÛ* +
string
ÛÛ+ 1
[
ÛÛ1 2
]
ÛÛ2 3
>
ÛÛ3 4
(
ÛÛ4 5
)
ÛÛ5 6
;
ÛÛ6 7
var
ÙÙ 
downloadUrl
ÙÙ 
=
ÙÙ 
$str
ÙÙ L
+
ÙÙM N
FileName
ÙÙO W
+
ÙÙX Y
$str
ÙÙZ ]
+
ÙÙ^ _
Token
ÙÙ` e
+
ÙÙf g
$str
ÙÙh 
;ÙÙ Ä
var
ıı 

webRequest
ıı 
=
ıı 

WebRequest
ıı '
.
ıı' (
Create
ıı( .
(
ıı. /
downloadUrl
ıı/ :
)
ıı: ;
;
ıı; <
using
ˆˆ 
(
ˆˆ 
var
ˆˆ 
response
ˆˆ 
=
ˆˆ  !

webRequest
ˆˆ" ,
.
ˆˆ, -
GetResponse
ˆˆ- 8
(
ˆˆ8 9
)
ˆˆ9 :
)
ˆˆ: ;
using
˜˜ 
(
˜˜ 
var
˜˜ 
content
˜˜ 
=
˜˜  
response
˜˜! )
.
˜˜) *
GetResponseStream
˜˜* ;
(
˜˜; <
)
˜˜< =
)
˜˜= >
using
¯¯ 
(
¯¯ 
var
¯¯ 
reader
¯¯ 
=
¯¯ 
new
¯¯  #
StreamReader
¯¯$ 0
(
¯¯0 1
content
¯¯1 8
)
¯¯8 9
)
¯¯9 :
{
˘˘ 
string
˙˙ 
line
˙˙ 
;
˙˙ 
try
˚˚ 
{
¸¸ 
while
˝˝ 
(
˝˝ 
(
˝˝ 
line
˝˝  
=
˝˝! "
reader
˝˝# )
.
˝˝) *
ReadLine
˝˝* 2
(
˝˝2 3
)
˝˝3 4
)
˝˝4 5
!=
˝˝6 8
null
˝˝9 =
)
˝˝= >
{
˛˛ 
List
ˇˇ 
<
ˇˇ 
string
ˇˇ #
>
ˇˇ# $
splitedLines
ˇˇ% 1
=
ˇˇ2 3
line
ˇˇ4 8
.
ˇˇ8 9
Split
ˇˇ9 >
(
ˇˇ> ?
$char
ˇˇ? C
)
ˇˇC D
.
ˇˇD E
ToList
ˇˇE K
(
ˇˇK L
)
ˇˇL M
;
ˇˇM N
liststringArray
ÄÄ '
.
ÄÄ' (
Add
ÄÄ( +
(
ÄÄ+ ,
splitedLines
ÄÄ, 8
.
ÄÄ8 9
ToArray
ÄÄ9 @
(
ÄÄ@ A
)
ÄÄA B
)
ÄÄB C
;
ÄÄC D
}
ÅÅ 
response
ÇÇ 
.
ÇÇ 
Close
ÇÇ "
(
ÇÇ" #
)
ÇÇ# $
;
ÇÇ$ %
reader
ÉÉ 
.
ÉÉ 
Close
ÉÉ  
(
ÉÉ  !
)
ÉÉ! "
;
ÉÉ" #
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ 
	Exception
ÖÖ  
e
ÖÖ! "
)
ÖÖ" #
{
ÜÜ 
Log
áá 
.
áá 
Error
áá 
(
áá 
e
áá 
.
áá  
Message
áá  '
)
áá' (
;
áá( )
}
àà 
}
ââ 
return
ää 
liststringArray
ää "
;
ää" #
}
ãã 	
public
åå 
void
åå !
SetFtpConfiguration
åå '
(
åå' (
)
åå( )
{
çç 	
var
éé 
userName
éé 
=
éé "
ConfigurationManager
éé /
.
éé/ 0
AppSettings
éé0 ;
[
éé; <
$str
éé< K
]
ééK L
.
ééL M
ToString
ééM U
(
ééU V
)
ééV W
;
ééW X
var
èè 
password
èè 
=
èè "
ConfigurationManager
èè /
.
èè/ 0
AppSettings
èè0 ;
[
èè; <
$str
èè< K
]
èèK L
.
èèL M
ToString
èèM U
(
èèU V
)
èèV W
;
èèW X
var
êê 
dirUrl
êê 
=
êê "
ConfigurationManager
êê -
.
êê- .
AppSettings
êê. 9
[
êê9 :
$str
êê: G
]
êêG H
.
êêH I
ToString
êêI Q
(
êêQ R
)
êêR S
;
êêS T
if
ëë 
(
ëë 
dirUrl
ëë 
==
ëë 
null
ëë 
)
ëë 
{
íí 
Log
ìì 
.
ìì 
Error
ìì 
(
ìì 
$str
ìì 3
)
ìì3 4
;
ìì4 5
}
îî 
else
ïï 
{
ññ 
this
óó 
.
óó 
DirUrl
óó 
=
óó 
dirUrl
óó $
;
óó$ %
}
òò 
var
ôô 
loginUrl
ôô 
=
ôô "
ConfigurationManager
ôô /
.
ôô/ 0
AppSettings
ôô0 ;
[
ôô; <
$str
ôô< K
]
ôôK L
.
ôôL M
ToString
ôôM U
(
ôôU V
)
ôôV W
;
ôôW X
if
öö 
(
öö 
loginUrl
öö 
==
öö 
null
öö  
)
öö  !
{
õõ 
Log
úú 
.
úú 
Error
úú 
(
úú 
$str
úú /
)
úú/ 0
;
úú0 1
}
ùù 
else
ûû 
{
üü 
this
†† 
.
†† 
LoginUrl
†† 
=
†† 
loginUrl
††  (
;
††( )
}
°° 
this
¢¢ 
.
¢¢ 
ftpConfiguration
¢¢ !
=
¢¢" #
new
¢¢$ '
FtpConfiguration
¢¢( 8
{
££ 
Password
§§ 
=
§§ 
password
§§ #
,
§§# $
UserName
•• 
=
•• 
userName
•• #
,
••# $
}
¶¶ 
;
¶¶ 
}
ßß 	
private
®® 
void
®® 
Login
®® 
(
®® 
)
®® 
{
©© 	
Log
™™ 
.
™™ 
Info
™™ 
(
™™ 
$str
™™ 7
)
™™7 8
;
™™8 9
try
´´ 
{
¨¨ !
ServicePointManager
≠≠ #
.
≠≠# $1
#ServerCertificateValidationCallback
≠≠$ G
=
≠≠H I
delegate
≠≠J R
{
≠≠S T
return
≠≠U [
true
≠≠\ `
;
≠≠` a
}
≠≠b c
;
≠≠c d
var
ÆÆ 
httpRequest
ÆÆ 
=
ÆÆ  !
(
ÆÆ" #
HttpWebRequest
ÆÆ# 1
)
ÆÆ1 2

WebRequest
ÆÆ2 <
.
ÆÆ< =
Create
ÆÆ= C
(
ÆÆC D
LoginUrl
ÆÆD L
)
ÆÆL M
;
ÆÆM N
httpRequest
ØØ 
.
ØØ 
Method
ØØ "
=
ØØ# $
$str
ØØ% +
;
ØØ+ ,
httpRequest
∞∞ 
.
∞∞ 
ContentType
∞∞ '
=
∞∞( )
$str
∞∞* ?
;
∞∞? @
var
±± 
formData
±± 
=
±± 
$str
±± *
+
±±+ ,
this
±±- 1
.
±±1 2
ftpConfiguration
±±2 B
.
±±B C
UserName
±±C K
+
±±L M
$str
±±N Z
+
±±[ \
ftpConfiguration
±±] m
.
±±m n
Password
±±n v
+
±±w x
$str±±y â
+±±ä ã 
ftpConfiguration±±å ú
.±±ú ù
UserName±±ù •
+±±¶ ß
$str±±® ∏
+±±π ∫ 
ftpConfiguration±±ª À
.±±À Ã
Password±±Ã ‘
+±±’ ÷
$str±±◊ ı
;±±ı ˆ
using
≤≤ 
(
≤≤ 
var
≤≤ 
streamWriter
≤≤ '
=
≤≤( )
new
≤≤* -
StreamWriter
≤≤. :
(
≤≤: ;
httpRequest
≤≤; F
.
≤≤F G
GetRequestStream
≤≤G W
(
≤≤W X
)
≤≤X Y
)
≤≤Y Z
)
≤≤Z [
{
≥≥ 
streamWriter
¥¥  
.
¥¥  !
Write
¥¥! &
(
¥¥& '
formData
¥¥' /
)
¥¥/ 0
;
¥¥0 1
}
µµ 
var
∂∂ 
httpResponse
∂∂  
=
∂∂! "
(
∂∂# $
HttpWebResponse
∂∂$ 3
)
∂∂3 4
httpRequest
∂∂4 ?
.
∂∂? @
GetResponse
∂∂@ K
(
∂∂K L
)
∂∂L M
;
∂∂M N
using
∑∑ 
(
∑∑ 
var
∑∑ 
streamReader
∑∑ '
=
∑∑( )
new
∑∑* -
StreamReader
∑∑. :
(
∑∑: ;
httpResponse
∑∑; G
.
∑∑G H
GetResponseStream
∑∑H Y
(
∑∑Y Z
)
∑∑Z [
)
∑∑[ \
)
∑∑\ ]
{
∏∏ 
var
ππ 
cookie
ππ 
=
ππ  
httpResponse
ππ! -
.
ππ- .
Headers
ππ. 5
[
ππ5 6
$str
ππ6 B
]
ππB C
;
ππC D
int
∫∫ 
indexofComma
∫∫ $
=
∫∫% &
cookie
∫∫' -
.
∫∫- .
IndexOf
∫∫. 5
(
∫∫5 6
$char
∫∫6 9
)
∫∫9 :
;
∫∫: ;
Token
ªª 
=
ªª 
cookie
ªª "
.
ªª" #
	Substring
ªª# ,
(
ªª, -
$num
ªª- .
,
ªª. /
indexofComma
ªª0 <
)
ªª< =
;
ªª= >
}
ºº 
}
ΩΩ 
catch
ææ 
(
ææ 
	Exception
ææ 
e
ææ 
)
ææ 
{
øø 
Log
¿¿ 
.
¿¿ 
Error
¿¿ 
(
¿¿ 
$str
¿¿ $
+
¿¿% &
e
¿¿' (
.
¿¿( )
ToString
¿¿) 1
(
¿¿1 2
)
¿¿2 3
)
¿¿3 4
;
¿¿4 5
}
¡¡ 
}
¬¬ 	
}
√√ 
}ƒƒ ©ï
}D:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\FtpKvk.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
public 

class 
FtpKvk 
: &
IFtpDistributorEntegration 4
{ 
public 
FtpConfiguration 
ftpConfiguration  0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
string 
DistributorName %
=>& (
$str) .
;. /
public 
Guid 
DistributorId !
=>" $
new% (
Guid) -
(- .
$str. T
)T U
;U V
public 
FtpKvk 
( 
) 
{ 	
Log 
. 
Warning 
( 
$str /
)/ 0
;0 1
SetFtpConfiguration 
(  
)  !
;! "
} 	
public 
ResultStatus !
ExportFilesToDatabase 1
(1 2
)2 3
{ 	
var 
processDate 
= 
DateTime &
.& '
Now' *
.* +
AddDays+ 2
(2 3
-3 4
$num4 8
)8 9
;9 :
var 
entegrationFileList #
=$ %
GetFilesInFtp& 3
(3 4
processDate4 ?
)? @
;@ A
var 
result 
= 
new 
ResultStatus )
() *
)* +
;+ ,
foreach 
( 
var 
entegrationFile (
in) +
entegrationFileList, ?
)? @
{   
Log!! 
.!! 
Warning!! 
(!! 
$str!! A
,!!A B
this!!C G
.!!G H
ftpConfiguration!!H X
.!!X Y
Url!!Y \
,!!\ ]
this!!^ b
.!!b c
DistributorName!!c r
,!!r s
entegrationFile	!!t É
.
!!É Ñ
FileName
!!Ñ å
)
!!å ç
;
!!ç é
var"" 
db"" 
="" 
GetDbConnection"" (
(""( )
)"") *
;""* +
result## 
=## 
db## 
.## &
InsertPRD_EntegrationFiles## 6
(##6 7
entegrationFile##7 F
)##F G
;##G H
if$$ 
($$ 
!$$ 
result$$ 
.$$ 
result$$ "
)$$" #
{%% 
Log&& 
.&& 
Error&& 
(&& 
$str&& M
,&&M N
result&&O U
.&&U V
message&&V ]
)&&] ^
;&&^ _
continue'' 
;'' 
}(( 
if)) 
()) 
entegrationFile)) #
.))# $
FileTypeName))$ 0
==))1 3
$str))4 =
)))= >
{** 
var++ 
sellThr++ 
=++  !
GetSellInFilesInFtp++" 5
(++5 6
entegrationFile++6 E
.++E F
FileName++F N
,++N O
entegrationFile++P _
.++_ `
id++` b
)++b c
;++c d
if,, 
(,, 
sellThr,, 
!=,,  "
null,,# '
&&,,( *
sellThr,,+ 2
.,,2 3
Count,,3 8
(,,8 9
),,9 :
>,,; <
$num,,= >
),,> ?
{-- 
var.. 
bultInsertResult.. ,
=..- .
db../ 1
...1 2+
BulkInsertPRD_EntegrationAction..2 Q
(..Q R
sellThr..R Y
)..Y Z
;..Z [
if// 
(// 
!// 
bultInsertResult// -
.//- .
result//. 4
)//4 5
Log00 
.00  
Info00  $
(00$ %
$str00% ^
,00^ _
this00` d
.00d e
ftpConfiguration00e u
.00u v
Url00v y
,00y z
this00{ 
.	00 Ä
DistributorName
00Ä è
,
00è ê
bultInsertResult
00ë °
.
00° ¢
message
00¢ ©
)
00© ™
;
00™ ´
}11 
}22 
Log33 
.33 
Success33 
(33 
$str33 C
,33C D
this33E I
.33I J
ftpConfiguration33J Z
.33Z [
Url33[ ^
,33^ _
this33` d
.33d e
DistributorName33e t
,33t u
entegrationFile	33v Ö
.
33Ö Ü
FileName
33Ü é
)
33é è
;
33è ê
}44 
Log55 
.55 
Success55 
(55 
$"55 
$str55 6
{556 7
DistributorName557 F
}55F G
$str55G K
"55K L
)55L M
;55M N
return66 
result66 
;66 
}77 	
public88 
WorkOfTimeDatabase88 !
GetDbConnection88" 1
(881 2
)882 3
{99 	
var:: 

tenantCode:: 
=::  
ConfigurationManager:: 1
.::1 2
AppSettings::2 =
[::= >
$str::> M
]::M N
.::N O
ToString::O W
(::W X
)::X Y
;::Y Z
var;; 
tenant;; 
=;; 
TenantConfig;; %
.;;% &

GetTenants;;& 0
(;;0 1
);;1 2
.;;2 3
Where;;3 8
(;;8 9
a;;9 :
=>;;; =
a;;> ?
.;;? @

TenantCode;;@ J
==;;K M
Convert;;N U
.;;U V
ToInt32;;V ]
(;;] ^

tenantCode;;^ h
);;h i
);;i j
.;;j k
FirstOrDefault;;k y
(;;y z
);;z {
;;;{ |
return<< 
tenant<< 
.<< 
GetDatabase<< %
(<<% &
)<<& '
;<<' (
}== 	
public>> 
string>> 
FileTypeName>> "
(>>" #
string>># )
fileName>>* 2
)>>2 3
{?? 	
if@@ 
(@@ 
fileName@@ 
.@@ 
Contains@@ !
(@@! "
$str@@" *
)@@* +
)@@+ ,
returnAA 
$strAA 
;AA  
elseBB 
ifBB 
(BB 
fileNameBB 
.BB 
ContainsBB &
(BB& '
$strBB' 0
)BB0 1
)BB1 2
returnCC 
$strCC  
;CC  !
elseDD 
ifDD 
(DD 
fileNameDD 
.DD 
ContainsDD &
(DD& '
$strDD' -
)DD- .
)DD. /
returnEE 
$strEE  
;EE  !
elseFF 
returnGG 
nullGG 
;GG 
}HH 	
publicII  
PRD_EntegrationFilesII #
[II# $
]II$ %
GetFilesInFtpII& 3
(II3 4
DateTimeII4 <
processDateII= H
)IIH I
{JJ 	
LogKK 
.KK 
InfoKK 
(KK 
stringKK 
.KK 
FormatKK "
(KK" #
$strKK# O
,KKO P
ftpConfigurationKKQ a
.KKa b
UrlKKb e
)KKe f
)KKf g
;KKg h
varLL 
fileListLL 
=LL 
newLL 
ListLL #
<LL# $
FileNameWithUrlLL$ 3
>LL3 4
(LL4 5
)LL5 6
;LL6 7
tryMM 
{NN 
FtpWebRequestOO 
requestOO %
=OO& '
(OO( )
FtpWebRequestOO) 6
)OO6 7
FtpWebRequestOO7 D
.OOD E
CreateOOE K
(OOK L
ftpConfigurationOOL \
.OO\ ]
UrlOO] `
)OO` a
;OOa b
requestPP 
.PP 
MethodPP 
=PP  
WebRequestMethodsPP! 2
.PP2 3
FtpPP3 6
.PP6 7 
ListDirectoryDetailsPP7 K
;PPK L
requestQQ 
.QQ 
CredentialsQQ #
=QQ$ %
newQQ& )
NetworkCredentialQQ* ;
(QQ; <
ftpConfigurationQQ< L
.QQL M
UserNameQQM U
,QQU V
ftpConfigurationQQW g
.QQg h
PasswordQQh p
)QQp q
;QQq r
stringRR 
[RR 
]RR 
listRR 
=RR 
nullRR  $
;RR$ %
usingSS 
(SS 
FtpWebResponseSS %
responseSS& .
=SS/ 0
(SS1 2
FtpWebResponseSS2 @
)SS@ A
requestSSA H
.SSH I
GetResponseSSI T
(SST U
)SSU V
)SSV W
usingTT 
(TT 
StreamReaderTT #
readerTT$ *
=TT+ ,
newTT- 0
StreamReaderTT1 =
(TT= >
responseTT> F
.TTF G
GetResponseStreamTTG X
(TTX Y
)TTY Z
)TTZ [
)TT[ \
{UU 
listVV 
=VV 
readerVV !
.VV! "
	ReadToEndVV" +
(VV+ ,
)VV, -
.VV- .
SplitVV. 3
(VV3 4
newVV4 7
stringVV8 >
[VV> ?
]VV? @
{VVA B
$strVVC I
}VVJ K
,VVK L
StringSplitOptionsVVM _
.VV_ `
RemoveEmptyEntriesVV` r
)VVr s
;VVs t
}WW 
foreachXX 
(XX 
stringXX 
lineXX  $
inXX% '
listXX( ,
)XX, -
{YY 
DirectoryItemZZ !
itemZZ" &
=ZZ' (
newZZ) ,
DirectoryItemZZ- :
(ZZ: ;
)ZZ; <
;ZZ< =
string[[ 
data[[ 
=[[  !
line[[" &
;[[& '
var\\ 

dateString\\ "
=\\# $
line\\% )
.\\) *
	Substring\\* 3
(\\3 4
$num\\4 6
,\\6 7
$num\\8 :
-\\; <
$num\\= ?
)\\? @
;\\@ A
bool]] 
isDirectory]] $
=]]% &
data]]' +
[]]+ ,
$num]], -
]]]- .
.]]. /
ToString]]/ 7
(]]7 8
)]]8 9
==]]: <
$str]]= @
;]]@ A
var^^ 
name^^ 
=^^ 
data^^ #
.^^# $
	Substring^^$ -
(^^- .
$num^^. 0
)^^0 1
;^^1 2
var__ 
date__ 
=__ 
line__ #
.__# $
	Substring__$ -
(__- .
$num__. 0
,__0 1
$num__2 4
-__5 6
$num__7 9
)__9 :
;__: ;
item`` 
.`` 
Name`` 
=`` 
name``  $
;``$ %
itemaa 
.aa 
BaseUriaa  
=aa! "
ftpConfigurationaa# 3
.aa3 4
Urlaa4 7
;aa7 8
itembb 
.bb 
IsDirectorybb $
=bb% &
isDirectorybb' 2
;bb2 3
ifcc 
(cc 
namecc 
==cc 
$strcc  #
||cc$ &
namecc' +
==cc, .
$strcc/ 3
)cc3 4
{dd 
}ee 
elseff 
{gg 
ifhh 
(hh 
!hh 
isDirectoryhh (
)hh( )
{ii 
varjj 
isTransformedjj  -
=jj. /
DateTimejj0 8
.jj8 9
TryParseExactjj9 F
(jjF G
datejjG K
,jjK L
$strjjM [
,jj[ \
CultureInfojj] h
.jjh i
InvariantCulturejji y
,jjy z
DateTimeStyles	jj{ â
.
jjâ ä
None
jjä é
,
jjé è
out
jjê ì
var
jjî ó

parsedDate
jjò ¢
)
jj¢ £
;
jj£ §
ifkk 
(kk  
isTransformedkk  -
)kk- .
{ll 
itemmm  $
.mm$ %
DateFileCreatedmm% 4
=mm5 6

parsedDatemm7 A
;mmA B
}nn 
fileListoo $
.oo$ %
Addoo% (
(oo( )
newoo) ,
FileNameWithUrloo- <
{oo= >
FileNameoo? G
=ooH I
itemooJ N
.ooN O
NameooO S
,ooS T
FileCreatedDateooU d
=ooe f
itemoog k
.ook l
DateFileCreatedool {
,oo{ |
DirectoryFileName	oo} é
=
ooè ê
this
ooë ï
.
ooï ñ
ftpConfiguration
ooñ ¶
.
oo¶ ß
Url
ooß ™
+
oo´ ¨
this
oo≠ ±
.
oo± ≤
ftpConfiguration
oo≤ ¬
.
oo¬ √
	Directory
oo√ Ã
+
ooÕ Œ
$str
ooœ ”
+
oo‘ ’
item
oo÷ ⁄
.
oo⁄ €
Name
oo€ ﬂ
}
oo‡ ·
)
oo· ‚
;
oo‚ „
}pp 
}qq 
}rr 
Logss 
.ss 
Infoss 
(ss 
$strss '
+ss( )
fileListss* 2
.ss2 3
Countss3 8
)ss8 9
;ss9 :
}tt 
catchuu 
(uu 
	Exceptionuu 
euu 
)uu 
{vv 
Logww 
.ww 
Errorww 
(ww 
ftpConfigurationww *
.ww* +
Urlww+ .
+ww/ 0
$strww1 >
+ww? @
ewwA B
.wwB C
MessagewwC J
)wwJ K
;wwK L
}xx 
varyy 
dbyy 
=yy 
GetDbConnectionyy $
(yy$ %
)yy% &
;yy& '
varzz  
entegrationFilesInDbzz $
=zz% &
dbzz' )
.zz) *0
$GetPRD_EntegrationFilesByCreatedDatezz* N
(zzN O
processDatezzO Z
,zzZ [
DistributorNamezz\ k
)zzk l
;zzl m
var{{ 
entegrationFileList{{ #
={{$ %
new{{& )
List{{* .
<{{. / 
PRD_EntegrationFiles{{/ C
>{{C D
({{D E
){{E F
;{{F G
foreach|| 
(|| 
var|| 
file|| 
in||  
fileList||! )
.||) *
Where||* /
(||/ 0
x||0 1
=>||2 4
x||5 6
.||6 7
FileCreatedDate||7 F
>=||G I
processDate||J U
)||U V
)||V W
{}} 
if~~ 
(~~  
entegrationFilesInDb~~ (
.~~( )
Any~~) ,
(~~, -
x~~- .
=>~~/ 1
x~~2 3
.~~3 4
FileName~~4 <
.~~< =
Contains~~= E
(~~E F
file~~F J
.~~J K
FileName~~K S
)~~S T
&&~~U W
x~~X Y
.~~Y Z
DistributorId~~Z g
==~~h j
this~~k o
.~~o p
DistributorId~~p }
)~~} ~
)~~~ 
continue 
; !
entegrationFileList
ÄÄ #
.
ÄÄ# $
Add
ÄÄ$ '
(
ÄÄ' (
new
ÄÄ( +"
PRD_EntegrationFiles
ÄÄ, @
{
ÅÅ 
id
ÇÇ 
=
ÇÇ 
Guid
ÇÇ 
.
ÇÇ 
NewGuid
ÇÇ %
(
ÇÇ% &
)
ÇÇ& '
,
ÇÇ' (
created
ÉÉ 
=
ÉÉ 
DateTime
ÉÉ &
.
ÉÉ& '
Now
ÉÉ' *
,
ÉÉ* +
	createdby
ÑÑ 
=
ÑÑ 
Guid
ÑÑ  $
.
ÑÑ$ %
Empty
ÑÑ% *
,
ÑÑ* +
CreateDateInFtp
ÖÖ #
=
ÖÖ$ %
file
ÖÖ& *
.
ÖÖ* +
FileCreatedDate
ÖÖ+ :
,
ÖÖ: ;
DistributorName
ÜÜ #
=
ÜÜ$ %
DistributorName
ÜÜ& 5
,
ÜÜ5 6
DistributorId
áá !
=
áá" #
DistributorId
áá$ 1
,
áá1 2
FileName
àà 
=
àà 
file
àà #
.
àà# $
DirectoryFileName
àà$ 5
,
àà5 6
FileNameDate
ââ  
=
ââ! "
Tools
ââ# (
.
ââ( )!
GetDateFromFileName
ââ) <
(
ââ< =
file
ââ= A
.
ââA B
FileName
ââB J
,
ââJ K
$str
ââL V
)
ââV W
,
ââW X
ProcessTime
ää 
=
ää  !
DateTime
ää" *
.
ää* +
Now
ää+ .
,
ää. /
FileTypeName
ãã  
=
ãã! "
FileTypeName
ãã# /
(
ãã/ 0
file
ãã0 4
.
ãã4 5
FileName
ãã5 =
)
ãã= >
}
åå 
)
åå 
;
åå 
}
çç 
Log
éé 
.
éé 
Warning
éé 
(
éé 
$str
éé ;
,
éé; <!
entegrationFileList
éé= P
.
ééP Q
Count
ééQ V
(
ééV W
)
ééW X
)
ééX Y
;
ééY Z
return
èè !
entegrationFileList
èè &
.
èè& '
ToArray
èè' .
(
èè. /
)
èè/ 0
;
èè0 1
}
êê 	
public
ëë #
PRD_EntegrationAction
ëë $
[
ëë$ %
]
ëë% &!
GetSellInFilesInFtp
ëë' :
(
ëë: ;
string
ëë; A
fileName
ëëB J
,
ëëJ K
Guid
ëëL P 
entegrationFilesId
ëëQ c
)
ëëc d
{
íí 	
var
ìì 
sellThrs
ìì 
=
ìì 
new
ìì 
List
ìì #
<
ìì# $#
PRD_EntegrationAction
ìì$ 9
>
ìì9 :
(
ìì: ;
)
ìì; <
;
ìì< =
var
îî 
datetimeNow
îî 
=
îî 
DateTime
îî &
.
îî& '
Now
îî' *
;
îî* +
try
ïï 
{
ññ 
List
óó 
<
óó 
PropertyIndex
óó "
>
óó" #
Index
óó$ )
=
óó* +
new
óó, /
List
óó0 4
<
óó4 5
PropertyIndex
óó5 B
>
óóB C
(
óóC D
)
óóD E
;
óóE F
var
òò 

getRawFile
òò 
=
òò  

GetRawFile
òò! +
(
òò+ ,
fileName
òò, 4
)
òò4 5
.
òò5 6
ToList
òò6 <
(
òò< =
)
òò= >
;
òò> ?
var
ôô 

getHeaders
ôô 
=
ôô  

getRawFile
ôô! +
[
ôô+ ,
$num
ôô, -
]
ôô- .
;
ôô. /

getRawFile
öö 
.
öö 
RemoveAt
öö #
(
öö# $
$num
öö$ %
)
öö% &
;
öö& '
for
õõ 
(
õõ 
int
õõ 
i
õõ 
=
õõ 
$num
õõ 
;
õõ 
i
õõ  !
<
õõ" #

getHeaders
õõ$ .
.
õõ. /
Length
õõ/ 5
;
õõ5 6
i
õõ7 8
++
õõ8 :
)
õõ: ;
{
úú 
Index
ùù 
.
ùù 
Add
ùù 
(
ùù 
new
ùù !
PropertyIndex
ùù" /
{
ùù0 1
Index
ùù2 7
=
ùù8 9
i
ùù: ;
,
ùù; <
Name
ùù= A
=
ùùB C

getHeaders
ùùD N
[
ùùN O
i
ùùO P
]
ùùP Q
}
ùùR S
)
ùùS T
;
ùùT U
}
ûû 
foreach
üü 
(
üü 
var
üü 
rawFile
üü $
in
üü% '

getRawFile
üü( 2
)
üü2 3
{
†† 
try
°° 
{
¢¢ 
var
££ 
item
££  
=
££! "
new
££# &#
PRD_EntegrationAction
££' <
(
££< =
)
££= >
;
££> ?
for
§§ 
(
§§ 
int
§§  
i
§§! "
=
§§# $
$num
§§% &
;
§§& '
i
§§( )
<
§§* +
rawFile
§§, 3
.
§§3 4
Length
§§4 :
;
§§: ;
i
§§< =
++
§§= ?
)
§§? @
{
•• 
try
¶¶ 
{
ßß 
var
®®  #
	indexName
®®$ -
=
®®. /
Index
®®0 5
.
®®5 6
Where
®®6 ;
(
®®; <
x
®®< =
=>
®®> @
x
®®A B
.
®®B C
Index
®®C H
==
®®I K
i
®®L M
)
®®M N
.
®®N O
Select
®®O U
(
®®U V
x
®®V W
=>
®®X Z
x
®®[ \
.
®®\ ]
Name
®®] a
)
®®a b
.
®®b c
FirstOrDefault
®®c q
(
®®q r
)
®®r s
;
®®s t
if
©©  "
(
©©# $
	indexName
©©$ -
!=
©©. 0
null
©©1 5
)
©©5 6
{
™™  !
var
´´$ ' 
rawFileCheckedData
´´( :
=
´´; <
rawFile
´´= D
[
´´D E
i
´´E F
]
´´F G
.
´´G H
Replace
´´H O
(
´´O P
$str
´´P T
,
´´T U
$str
´´V X
)
´´X Y
.
´´Y Z
Replace
´´Z a
(
´´a b
$str
´´b f
,
´´f g
$str
´´h j
)
´´j k
;
´´k l
if
¨¨$ &
(
¨¨' (
!
¨¨( )
string
¨¨) /
.
¨¨/ 0
IsNullOrEmpty
¨¨0 =
(
¨¨= > 
rawFileCheckedData
¨¨> P
)
¨¨P Q
)
¨¨Q R
{
≠≠$ %
	indexName
ÆÆ( 1
=
ÆÆ2 3
	indexName
ÆÆ4 =
.
ÆÆ= >
ToLower
ÆÆ> E
(
ÆÆE F
new
ÆÆF I
CultureInfo
ÆÆJ U
(
ÆÆU V
$str
ÆÆV ]
,
ÆÆ] ^
false
ÆÆ_ d
)
ÆÆd e
)
ÆÆe f
.
ÆÆf g
Replace
ÆÆg n
(
ÆÆn o
$str
ÆÆo r
,
ÆÆr s
$str
ÆÆt v
)
ÆÆv w
.
ÆÆw x
Replace
ÆÆx 
(ÆÆ Ä
$strÆÆÄ É
,ÆÆÉ Ñ
$strÆÆÖ á
)ÆÆá à
;ÆÆà â
if
ØØ( *
(
ØØ+ ,
	indexName
ØØ, 5
==
ØØ6 8
$str
ØØ9 H
)
ØØH I
item
∞∞, 0
.
∞∞0 1
InvoiceNumber
∞∞1 >
=
∞∞? @ 
rawFileCheckedData
∞∞A S
;
∞∞S T
if
±±( *
(
±±+ ,
	indexName
±±, 5
==
±±6 8
$str
±±9 ?
)
±±? @
item
≤≤, 0
.
≤≤0 1
DistributorName
≤≤1 @
=
≤≤A B 
rawFileCheckedData
≤≤C U
;
≤≤U V
if
≥≥( *
(
≥≥+ ,
	indexName
≥≥, 5
==
≥≥6 8
$str
≥≥9 O
)
≥≥O P
item
¥¥, 0
.
¥¥0 1"
CustomerOperatorCode
¥¥1 E
=
¥¥F G 
rawFileCheckedData
¥¥H Z
;
¥¥Z [
if
µµ( *
(
µµ+ ,
	indexName
µµ, 5
==
µµ6 8
$str
µµ9 L
||
µµM O
	indexName
µµP Y
==
µµZ \
$str
µµ] n
||
µµo q
	indexName
µµr {
==
µµ| ~
$strµµ î
)µµî ï
item
∂∂, 0
.
∂∂0 1"
CustomerOperatorCode
∂∂1 E
=
∂∂F G 
rawFileCheckedData
∂∂H Z
;
∂∂Z [
if
∑∑( *
(
∑∑+ ,
	indexName
∑∑, 5
==
∑∑6 8
$str
∑∑9 G
)
∑∑G H
item
∏∏, 0
.
∏∏0 1"
CustomerOperatorName
∏∏1 E
=
∏∏F G 
rawFileCheckedData
∏∏H Z
;
∏∏Z [
if
ππ( *
(
ππ+ ,
	indexName
ππ, 5
==
ππ6 8
$str
ππ9 E
)
ππE F
item
∫∫, 0
.
∫∫0 1

BranchCode
∫∫1 ;
=
∫∫< = 
rawFileCheckedData
∫∫> P
;
∫∫P Q
if
ªª( *
(
ªª+ ,
	indexName
ªª, 5
==
ªª6 8
$str
ªª9 E
)
ªªE F
item
ºº, 0
.
ºº0 1

BranchName
ºº1 ;
=
ºº< = 
rawFileCheckedData
ºº> P
;
ººP Q
if
ΩΩ( *
(
ΩΩ+ ,
	indexName
ΩΩ, 5
==
ΩΩ6 8
$str
ΩΩ9 D
)
ΩΩD E
item
ææ, 0
.
ææ0 1
	TaxNumber
ææ1 :
=
ææ; < 
rawFileCheckedData
ææ= O
;
ææO P
if
øø( *
(
øø+ ,
	indexName
øø, 5
==
øø6 8
$str
øø9 L
)
øøL M
item
¿¿, 0
.
¿¿0 1
ConsolidationCode
¿¿1 B
=
¿¿C D 
rawFileCheckedData
¿¿E W
;
¿¿W X
if
¡¡( *
(
¡¡+ ,
	indexName
¡¡, 5
==
¡¡6 8
$str
¡¡9 L
)
¡¡L M
item
¬¬, 0
.
¬¬0 1
ConsolidationName
¬¬1 B
=
¬¬C D 
rawFileCheckedData
¬¬E W
;
¬¬W X
if
√√( *
(
√√+ ,
	indexName
√√, 5
==
√√6 8
$str
√√9 ?
)
√√? @
item
ƒƒ, 0
.
ƒƒ0 1
Imei
ƒƒ1 5
=
ƒƒ6 7 
rawFileCheckedData
ƒƒ8 J
;
ƒƒJ K
if
≈≈( *
(
≈≈+ ,
	indexName
≈≈, 5
==
≈≈6 8
$str
≈≈9 A
)
≈≈A B
item
∆∆, 0
.
∆∆0 1
SerialNo
∆∆1 9
=
∆∆: ; 
rawFileCheckedData
∆∆< N
;
∆∆N O
if
««( *
(
««+ ,
	indexName
««, 5
==
««6 8
$str
««9 C
)
««C D
item
»», 0
.
»»0 1
Quantity
»»1 9
=
»»: ;
Convert
»»< C
.
»»C D
ToInt32
»»D K
(
»»K L 
rawFileCheckedData
»»L ^
)
»»^ _
;
»»_ `
if
……( *
(
……+ ,
	indexName
……, 5
==
……6 8
$str
……9 ?
)
……? @
item
  , 0
.
  0 1)
CustomerOperatorStorageCity
  1 L
=
  M N 
rawFileCheckedData
  O a
;
  a b
if
ÀÀ( *
(
ÀÀ+ ,
	indexName
ÀÀ, 5
==
ÀÀ6 8
$str
ÀÀ9 ?
)
ÀÀ? @
item
ÃÃ, 0
.
ÃÃ0 1)
CustomerOperatorStorageTown
ÃÃ1 L
=
ÃÃM N 
rawFileCheckedData
ÃÃO a
;
ÃÃa b
}
ÕÕ$ %
}
ŒŒ  !
else
œœ  $
{
––  !
Log
——$ '
.
——' (
Error
——( -
(
——- .
$str
——. M
)
——M N
;
——N O
}
““  !
}
”” 
catch
‘‘ !
(
‘‘" #
	Exception
‘‘# ,
e
‘‘- .
)
‘‘. /
{
’’ 
Log
÷÷  #
.
÷÷# $
Error
÷÷$ )
(
÷÷) *
$str
÷÷* X
,
÷÷X Y
e
÷÷Z [
.
÷÷[ \
ToString
÷÷\ d
(
÷÷d e
)
÷÷e f
)
÷÷f g
;
÷÷g h
}
◊◊ 
}
ÿÿ 
item
ŸŸ 
.
ŸŸ 
DistributorId
ŸŸ *
=
ŸŸ+ ,
DistributorId
ŸŸ- :
;
ŸŸ: ;
item
⁄⁄ 
.
⁄⁄ 
DistributorName
⁄⁄ ,
=
⁄⁄- .
this
⁄⁄/ 3
.
⁄⁄3 4
DistributorName
⁄⁄4 C
;
⁄⁄C D
item
€€ 
.
€€ 
EntegrationFileId
€€ .
=
€€/ 0 
entegrationFilesId
€€1 C
;
€€C D
var
‹‹ 
message
‹‹ #
=
‹‹$ %
$str
‹‹& (
;
‹‹( )
var
›› 
	inventory
›› %
=
››& '
Finder
››( .
.
››. /
FindInventory
››/ <
(
››< =
item
››= A
.
››A B
SerialNo
››B J
,
››J K
item
››L P
.
››P Q
Imei
››Q U
)
››U V
;
››V W
if
ﬁﬁ 
(
ﬁﬁ 
	inventory
ﬁﬁ %
==
ﬁﬁ& (
null
ﬁﬁ) -
)
ﬁﬁ- .
{
ﬂﬂ 
message
‡‡ #
=
‡‡$ %
$str
‡‡& J
;
‡‡J K
}
·· 
var
‚‚ 
company
‚‚ #
=
‚‚$ %
Finder
‚‚& ,
.
‚‚, -
FindCompany
‚‚- 8
(
‚‚8 9
item
‚‚9 =
)
‚‚= >
;
‚‚> ?
if
„„ 
(
„„ 
!
„„ 
company
„„ $
.
„„$ %
HasValue
„„% -
)
„„- .
{
‰‰ 
message
ÂÂ #
=
ÂÂ$ %
$str
ÂÂ& L
;
ÂÂL M
}
ÊÊ 
item
ÁÁ 
.
ÁÁ 
	ProductId
ÁÁ &
=
ÁÁ' (
	inventory
ÁÁ) 2
?
ÁÁ2 3
.
ÁÁ3 4
	productId
ÁÁ4 =
;
ÁÁ= >
item
ËË 
.
ËË 
InventoryId
ËË (
=
ËË) *
	inventory
ËË+ 4
?
ËË4 5
.
ËË5 6
id
ËË6 8
;
ËË8 9
item
ÈÈ 
.
ÈÈ  
CustomerOperatorId
ÈÈ /
=
ÈÈ0 1
company
ÈÈ2 9
;
ÈÈ9 :
sellThrs
ÍÍ  
.
ÍÍ  !
Add
ÍÍ! $
(
ÍÍ$ %
item
ÍÍ% )
)
ÍÍ) *
;
ÍÍ* +
if
ÎÎ 
(
ÎÎ 
!
ÎÎ 
string
ÎÎ #
.
ÎÎ# $
IsNullOrEmpty
ÎÎ$ 1
(
ÎÎ1 2
message
ÎÎ2 9
)
ÎÎ9 :
)
ÎÎ: ;
{
ÏÏ  
NotificationLogger
ÌÌ .
.
ÌÌ. /
	SaveError
ÌÌ/ 8
(
ÌÌ8 9
DateTime
ÌÌ9 A
.
ÌÌA B
Now
ÌÌB E
,
ÌÌE F
message
ÌÌG N
,
ÌÌN O
item
ÌÌP T
)
ÌÌT U
;
ÌÌU V
}
ÓÓ 
}
ÔÔ 
catch
 
(
 
	Exception
 $
e
% &
)
& '
{
ÒÒ 
Log
ÚÚ 
.
ÚÚ 
Error
ÚÚ !
(
ÚÚ! "
$str
ÚÚ" P
,
ÚÚP Q
e
ÚÚR S
.
ÚÚS T
ToString
ÚÚT \
(
ÚÚ\ ]
)
ÚÚ] ^
)
ÚÚ^ _
;
ÚÚ_ `
}
ÛÛ 
}
ÙÙ 
}
ıı 
catch
ˆˆ 
(
ˆˆ 
	Exception
ˆˆ 
e
ˆˆ 
)
ˆˆ 
{
˜˜ 
Log
¯¯ 
.
¯¯ 
Error
¯¯ 
(
¯¯ 
e
¯¯ 
.
¯¯ 
ToString
¯¯ $
(
¯¯$ %
)
¯¯% &
)
¯¯& '
;
¯¯' (
}
˘˘ 
return
˙˙ 
sellThrs
˙˙ 
.
˙˙ 
ToArray
˙˙ #
(
˙˙# $
)
˙˙$ %
;
˙˙% &
}
˚˚ 	
public
¸¸ 
void
¸¸ !
SetFtpConfiguration
¸¸ '
(
¸¸' (
)
¸¸( )
{
˝˝ 	
var
˛˛ 
kvkUserName
˛˛ 
=
˛˛ "
ConfigurationManager
˛˛ 2
.
˛˛2 3
AppSettings
˛˛3 >
[
˛˛> ?
$str
˛˛? L
]
˛˛L M
.
˛˛M N
ToString
˛˛N V
(
˛˛V W
)
˛˛W X
;
˛˛X Y
var
ˇˇ 
kvkPassword
ˇˇ 
=
ˇˇ "
ConfigurationManager
ˇˇ 2
.
ˇˇ2 3
AppSettings
ˇˇ3 >
[
ˇˇ> ?
$str
ˇˇ? L
]
ˇˇL M
.
ˇˇM N
ToString
ˇˇN V
(
ˇˇV W
)
ˇˇW X
;
ˇˇX Y
var
ÄÄ 
kvkUrl
ÄÄ 
=
ÄÄ "
ConfigurationManager
ÄÄ -
.
ÄÄ- .
AppSettings
ÄÄ. 9
[
ÄÄ9 :
$str
ÄÄ: C
]
ÄÄC D
.
ÄÄD E
ToString
ÄÄE M
(
ÄÄM N
)
ÄÄN O
??
ÄÄP R
$str
ÄÄS U
;
ÄÄU V
ftpConfiguration
ÅÅ 
=
ÅÅ 
new
ÅÅ "
FtpConfiguration
ÅÅ# 3
{
ÇÇ 
Url
ÉÉ 
=
ÉÉ 
kvkUrl
ÉÉ 
,
ÉÉ 
UserName
ÑÑ 
=
ÑÑ 
kvkUserName
ÑÑ &
,
ÑÑ& '
Password
ÖÖ 
=
ÖÖ 
kvkPassword
ÖÖ &
}
ÜÜ 
;
ÜÜ 
}
áá 	
private
àà 
IEnumerable
àà 
<
àà 
string
àà "
[
àà" #
]
àà# $
>
àà$ %

GetRawFile
àà& 0
(
àà0 1
string
àà1 7
fileName
àà8 @
)
àà@ A
{
ââ 	
Log
ää 
.
ää 
Info
ää 
(
ää 
string
ää 
.
ää 
Format
ää "
(
ää" #
$str
ää# D
,
ääD E
fileName
ääF N
)
ääN O
)
ääO P
;
ääP Q
var
ãã 
listStringArray
ãã 
=
ãã  !
new
ãã" %
List
ãã& *
<
ãã* +
string
ãã+ 1
[
ãã1 2
]
ãã2 3
>
ãã3 4
(
ãã4 5
)
ãã5 6
;
ãã6 7
var
åå 
request
åå 
=
åå 
(
åå 
FtpWebRequest
åå (
)
åå( )

WebRequest
åå) 3
.
åå3 4
Create
åå4 :
(
åå: ;
fileName
åå; C
)
ååC D
;
ååD E
request
çç 
.
çç 
Method
çç 
=
çç 
WebRequestMethods
çç .
.
çç. /
Ftp
çç/ 2
.
çç2 3
DownloadFile
çç3 ?
;
çç? @
request
éé 
.
éé 
Credentials
éé 
=
éé  !
new
éé" %
NetworkCredential
éé& 7
(
éé7 8
ftpConfiguration
éé8 H
.
ééH I
UserName
ééI Q
,
ééQ R
ftpConfiguration
ééS c
.
ééc d
Password
ééd l
)
éél m
;
éém n
var
èè 
response
èè 
=
èè 
(
èè 
FtpWebResponse
èè *
)
èè* +
request
èè+ 2
.
èè2 3
GetResponse
èè3 >
(
èè> ?
)
èè? @
;
èè@ A
var
êê 
responseStream
êê 
=
êê  
response
êê! )
.
êê) *
GetResponseStream
êê* ;
(
êê; <
)
êê< =
;
êê= >
var
ëë 
reader
ëë 
=
ëë 
new
ëë 
StreamReader
ëë )
(
ëë) *
responseStream
ëë* 8
)
ëë8 9
;
ëë9 :
string
íí 
line
íí 
;
íí 
try
ìì 
{
îî 
while
ïï 
(
ïï 
(
ïï 
line
ïï 
=
ïï 
reader
ïï %
.
ïï% &
ReadLine
ïï& .
(
ïï. /
)
ïï/ 0
)
ïï0 1
!=
ïï2 4
null
ïï5 9
)
ïï9 :
{
ññ 
List
óó 
<
óó 
string
óó 
>
óó  
splitedLines
óó! -
=
óó. /
line
óó0 4
.
óó4 5
Split
óó5 :
(
óó: ;
$char
óó; ?
)
óó? @
.
óó@ A
ToList
óóA G
(
óóG H
)
óóH I
;
óóI J
listStringArray
òò #
.
òò# $
Add
òò$ '
(
òò' (
splitedLines
òò( 4
.
òò4 5
ToArray
òò5 <
(
òò< =
)
òò= >
)
òò> ?
;
òò? @
}
ôô 
response
öö 
.
öö 
Close
öö 
(
öö 
)
öö  
;
öö  !
reader
õõ 
.
õõ 
Close
õõ 
(
õõ 
)
õõ 
;
õõ 
}
úú 
catch
ùù 
(
ùù 
	Exception
ùù 
e
ùù 
)
ùù 
{
ûû 
Log
üü 
.
üü 
Warning
üü 
(
üü 
e
üü 
.
üü 
Message
üü %
)
üü% &
;
üü& '
}
†† 
return
°° 
listStringArray
°° "
;
°°" #
}
¢¢ 	
}
££ 
}§§ éû
ÇD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\FtpMobiltel.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
public 

class 

FtpMobitel 
: &
IFtpDistributorEntegration 8
{ 
public 
FtpConfiguration 
ftpConfiguration  0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
string 
DistributorName %
{ 	
get
 
{ 
return 
$str !
;! "
}# $
}% &
public 
Guid 
DistributorId !
{ 	
get
 
{ 
return 
new 
Guid 
(  
$str  F
)F G
;G H
}I J
}K L
public 

FtpMobitel 
( 
) 
{ 	
Log 
. 
Warning 
( 
$str 3
)3 4
;4 5
SetFtpConfiguration 
(  
)  !
;! "
} 	
public 
WorkOfTimeDatabase !
GetDbConnection" 1
(1 2
)2 3
{ 	
var 

tenantCode 
=  
ConfigurationManager 1
.1 2
AppSettings2 =
[= >
$str> M
]M N
.N O
ToStringO W
(W X
)X Y
;Y Z
var 
tenant 
= 
TenantConfig %
.% &

GetTenants& 0
(0 1
)1 2
.2 3
Where3 8
(8 9
a9 :
=>; =
a> ?
.? @

TenantCode@ J
==K M
ConvertN U
.U V
ToInt32V ]
(] ^

tenantCode^ h
)h i
)i j
.j k
FirstOrDefaultk y
(y z
)z {
;{ |
return   
tenant   
.   
GetDatabase   %
(  % &
)  & '
;  ' (
}!! 	
public"" 
void"" 
SetFtpConfiguration"" '
(""' (
)""( )
{## 	
var$$ 
url$$ 
=$$  
ConfigurationManager$$ *
.$$* +
AppSettings$$+ 6
[$$6 7
$str$$7 D
]$$D E
.$$E F
ToString$$F N
($$N O
)$$O P
;$$P Q
var%% 
userName%% 
=%%  
ConfigurationManager%% /
.%%/ 0
AppSettings%%0 ;
[%%; <
$str%%< N
]%%N O
.%%O P
ToString%%P X
(%%X Y
)%%Y Z
;%%Z [
var&& 
password&& 
=&&  
ConfigurationManager&& /
.&&/ 0
AppSettings&&0 ;
[&&; <
$str&&< N
]&&N O
.&&O P
ToString&&P X
(&&X Y
)&&Y Z
;&&Z [
var'' 
	directory'' 
=''  
ConfigurationManager'' 0
.''0 1
AppSettings''1 <
[''< =
$str''= P
]''P Q
.''Q R
ToString''R Z
(''Z [
)''[ \
;''\ ]
var(( 
readAllDirectory((  
=((! " 
ConfigurationManager((# 7
.((7 8
AppSettings((8 C
[((C D
$str((D ^
]((^ _
.((_ `
ToString((` h
(((h i
)((i j
;((j k
var)) 
fileExtension)) 
=))  
ConfigurationManager))  4
.))4 5
AppSettings))5 @
[))@ A
$str))A X
]))X Y
.))Y Z
ToString))Z b
())b c
)))c d
;))d e
this** 
.** 
ftpConfiguration** !
=**" #
new**$ '
FtpConfiguration**( 8
{++ 
	Directory,, 
=,, 
	directory,, %
,,,% &
Password-- 
=-- 
password-- #
,--# $
SearchAllDirectory.. "
=..# $
Convert..% ,
..., -
	ToBoolean..- 6
(..6 7
readAllDirectory..7 G
)..G H
,..H I
Url// 
=// 
url// 
,// 
UserName00 
=00 
userName00 #
,00# $
FileExtension11 
=11 
fileExtension11  -
}22 
;22 
}33 	
public44 
ResultStatus44 !
ExportFilesToDatabase44 1
(441 2
)442 3
{55 	
var66 
processDate66 
=66 
DateTime66 &
.66& '
Now66' *
.66* +
AddDays66+ 2
(662 3
-663 4
$num664 7
)667 8
;668 9
var77 
entegrationFileList77 #
=77$ %
GetFilesInFtp77& 3
(773 4
processDate774 ?
)77? @
;77@ A
var88 
result88 
=88 
new88 
ResultStatus88 )
(88) *
)88* +
;88+ ,
foreach99 
(99 
var99 
entegrationFile99 (
in99) +
entegrationFileList99, ?
)99? @
{:: 
Log;; 
.;; 
Warning;; 
(;; 
$str;; A
,;;A B
this;;C G
.;;G H
ftpConfiguration;;H X
.;;X Y
Url;;Y \
,;;\ ]
this;;^ b
.;;b c
DistributorName;;c r
,;;r s
entegrationFile	;;t É
.
;;É Ñ
FileName
;;Ñ å
)
;;å ç
;
;;ç é
var<< 
db<< 
=<< 
GetDbConnection<< (
(<<( )
)<<) *
;<<* +
result== 
=== 
db== 
.== &
InsertPRD_EntegrationFiles== 6
(==6 7
entegrationFile==7 F
)==F G
;==G H
if>> 
(>> 
!>> 
result>> 
.>> 
result>> "
)>>" #
{?? 
Log@@ 
.@@ 
Error@@ 
(@@ 
$str@@ M
,@@M N
result@@O U
.@@U V
message@@V ]
)@@] ^
;@@^ _
continueAA 
;AA 
}BB 
ifCC 
(CC 
entegrationFileCC #
.CC# $
FileTypeNameCC$ 0
==CC1 3
$strCC4 =
)CC= >
{DD 
varEE 
sellThrEE 
=EE  !
GetSellInFilesInFtpEE" 5
(EE5 6
entegrationFileEE6 E
.EEE F
FileNameEEF N
,EEN O
entegrationFileEEP _
.EE_ `
idEE` b
)EEb c
;EEc d
ifFF 
(FF 
sellThrFF 
!=FF  "
nullFF# '
&&FF( *
sellThrFF+ 2
.FF2 3
CountFF3 8
(FF8 9
)FF9 :
>FF; <
$numFF= >
)FF> ?
{GG 
varHH 
bultInsertResultHH ,
=HH- .
dbHH/ 1
.HH1 2+
BulkInsertPRD_EntegrationActionHH2 Q
(HHQ R
sellThrHHR Y
)HHY Z
;HHZ [
ifII 
(II 
!II 
bultInsertResultII -
.II- .
resultII. 4
)II4 5
LogJJ 
.JJ  
InfoJJ  $
(JJ$ %
$strJJ% ]
,JJ] ^
thisJJ_ c
.JJc d
ftpConfigurationJJd t
.JJt u
UrlJJu x
,JJx y
thisJJz ~
.JJ~ 
DistributorName	JJ é
,
JJé è
bultInsertResult
JJê †
.
JJ† °
message
JJ° ®
)
JJ® ©
;
JJ© ™
}KK 
}LL 
LogMM 
.MM 
SuccessMM 
(MM 
$strMM C
,MMC D
thisMME I
.MMI J
ftpConfigurationMMJ Z
.MMZ [
UrlMM[ ^
,MM^ _
thisMM` d
.MMd e
DistributorNameMMe t
,MMt u
entegrationFile	MMv Ö
.
MMÖ Ü
FileName
MMÜ é
)
MMé è
;
MMè ê
}NN 
LogOO 
.OO 
SuccessOO 
(OO 
$"OO 
$strOO 6
{OO6 7
DistributorNameOO7 F
}OOF G
$strOOG K
"OOK L
)OOL M
;OOM N
returnPP 
resultPP 
;PP 
}QQ 	
publicRR  
PRD_EntegrationFilesRR #
[RR# $
]RR$ %
GetFilesInFtpRR& 3
(RR3 4
DateTimeRR4 <
processDateRR= H
)RRH I
{SS 	
LogTT 
.TT 
InfoTT 
(TT 
stringTT 
.TT 
FormatTT "
(TT" #
$strTT# D
,TTD E
thisTTF J
.TTJ K
ftpConfigurationTTK [
.TT[ \
UrlTT\ _
,TT_ `
thisTTa e
.TTe f
DistributorNameTTf u
)TTu v
)TTv w
;TTw x
varUU 
directoryItemsUU 
=UU  
newUU! $
ListUU% )
<UU) *
DirectoryItemUU* 7
>UU7 8
(UU8 9
)UU9 :
;UU: ;
varVV 
fileListVV 
=VV 
newVV 
ListVV #
<VV# $
FileNameWithUrlVV$ 3
>VV3 4
(VV4 5
)VV5 6
;VV6 7
tryWW 
{XX 
varYY 
requestYY 
=YY 
(YY 
FtpWebRequestYY ,
)YY, -

WebRequestYY- 7
.YY7 8
CreateYY8 >
(YY> ?
thisYY? C
.YYC D
ftpConfigurationYYD T
.YYT U
UrlYYU X
+YYY Z
thisYY[ _
.YY_ `
ftpConfigurationYY` p
.YYp q
	DirectoryYYq z
)YYz {
;YY{ |
requestZZ 
.ZZ 
MethodZZ 
=ZZ  
WebRequestMethodsZZ! 2
.ZZ2 3
FtpZZ3 6
.ZZ6 7 
ListDirectoryDetailsZZ7 K
;ZZK L
request[[ 
.[[ 
Credentials[[ #
=[[$ %
new[[& )
NetworkCredential[[* ;
([[; <
this[[< @
.[[@ A
ftpConfiguration[[A Q
.[[Q R
UserName[[R Z
,[[Z [
this[[\ `
.[[` a
ftpConfiguration[[a q
.[[q r
Password[[r z
)[[z {
;[[{ |
string\\ 
[\\ 
]\\ 
lineList\\ !
=\\" #
null\\$ (
;\\( )
using]] 
(]] 
var]] 
response]] #
=]]$ %
(]]& '
FtpWebResponse]]' 5
)]]5 6
request]]6 =
.]]= >
GetResponse]]> I
(]]I J
)]]J K
)]]K L
using^^ 
(^^ 
var^^ 
reader^^ !
=^^" #
new^^$ '
StreamReader^^( 4
(^^4 5
response^^5 =
.^^= >
GetResponseStream^^> O
(^^O P
)^^P Q
)^^Q R
)^^R S
{__ 
lineList`` 
=`` 
reader`` %
.``% &
	ReadToEnd``& /
(``/ 0
)``0 1
.``1 2
Split``2 7
(``7 8
new``8 ;
string``< B
[``B C
]``C D
{``E F
$str``G M
}``N O
,``O P
StringSplitOptions``Q c
.``c d
RemoveEmptyEntries``d v
)``v w
;``w x
}aa 
foreachbb 
(bb 
stringbb 
linebb  $
inbb% '
lineListbb( 0
.bb0 1
Wherebb1 6
(bb6 7
xbb7 8
=>bb9 ;
xbb< =
.bb= >
Containsbb> F
(bbF G
$strbbG O
)bbO P
||bbQ S
xbbT U
.bbU V
ContainsbbV ^
(bb^ _
$strbb_ h
)bbh i
)bbi j
)bbj k
{cc 
vardd 
itemdd 
=dd 
newdd "
DirectoryItemdd# 0
(dd0 1
)dd1 2
;dd2 3
varee 
fileDateee  
=ee! "
DateTimeee# +
.ee+ ,

ParseExactee, 6
(ee6 7
lineee7 ;
.ee; <
	Substringee< E
(eeE F
$numeeF G
,eeG H
$numeeI K
)eeK L
,eeL M
$streeN a
,eea b
CultureInfoeec n
.een o
InvariantCultureeeo 
)	ee Ä
;
eeÄ Å
varff 
fileNameff  
=ff! "
Toolsff# (
.ff( )
GetItemNameff) 4
(ff4 5
lineff5 9
)ff9 :
;ff: ;
itemgg 
.gg 
BaseUrigg  
=gg! "
thisgg# '
.gg' (
ftpConfigurationgg( 8
.gg8 9
Urlgg9 <
;gg< =
itemhh 
.hh 
IsDirectoryhh $
=hh% &
Toolshh' ,
.hh, -
IsDirhh- 2
(hh2 3
linehh3 7
)hh7 8
;hh8 9
itemii 
.ii 
Nameii 
=ii 
fileNameii  (
;ii( )
itemjj 
.jj 
DateFileCreatedjj (
=jj) *
fileDatejj+ 3
;jj3 4
directoryItemskk "
.kk" #
Addkk# &
(kk& '
itemkk' +
)kk+ ,
;kk, -
ifll 
(ll 
!ll 
itemll 
.ll 
IsDirectoryll )
)ll) *
{mm 
fileListnn  
.nn  !
Addnn! $
(nn$ %
newnn% (
FileNameWithUrlnn) 8
{nn9 :
FileNamenn; C
=nnD E
itemnnF J
.nnJ K
NamennK O
,nnO P
FileCreatedDatennQ `
=nna b
itemnnc g
.nng h
DateFileCreatednnh w
,nnw x
DirectoryFileName	nny ä
=
nnã å
this
nnç ë
.
nnë í
ftpConfiguration
nní ¢
.
nn¢ £
Url
nn£ ¶
+
nnß ®
this
nn© ≠
.
nn≠ Æ
ftpConfiguration
nnÆ æ
.
nnæ ø
	Directory
nnø »
+
nn…  
$str
nnÀ œ
+
nn– —
item
nn“ ÷
.
nn÷ ◊
Name
nn◊ €
}
nn‹ ›
)
nn› ﬁ
;
nnﬁ ﬂ
}oo 
}pp 
Logqq 
.qq 
Infoqq 
(qq 
$strqq '
+qq( )
fileListqq* 2
.qq2 3
Countqq3 8
)qq8 9
;qq9 :
}rr 
catchss 
(ss 
	Exceptionss 
ess 
)ss 
{tt 
Loguu 
.uu 
Erroruu 
(uu 
thisuu 
.uu 
ftpConfigurationuu /
.uu/ 0
Urluu0 3
+uu4 5
$struu6 C
+uuD E
euuF G
.uuG H
MessageuuH O
)uuO P
;uuP Q
returnvv 
nullvv 
;vv 
}ww 
varxx 
dbxx 
=xx 
GetDbConnectionxx $
(xx$ %
)xx% &
;xx& '
varyy  
entegrationFilesInDbyy $
=yy% &
dbyy' )
.yy) *0
$GetPRD_EntegrationFilesByCreatedDateyy* N
(yyN O
processDateyyO Z
,yyZ [
DistributorNameyy\ k
)yyk l
;yyl m
varzz 
entegrationFileListzz #
=zz$ %
newzz& )
Listzz* .
<zz. / 
PRD_EntegrationFileszz/ C
>zzC D
(zzD E
)zzE F
;zzF G
foreach{{ 
({{ 
var{{ 
file{{ 
in{{  
fileList{{! )
.{{) *
Where{{* /
({{/ 0
x{{0 1
=>{{2 4
x{{5 6
.{{6 7
FileCreatedDate{{7 F
>={{G I
processDate{{J U
){{U V
){{V W
{|| 
if}} 
(}}  
entegrationFilesInDb}} (
.}}( )
Any}}) ,
(}}, -
x}}- .
=>}}/ 1
x}}2 3
.}}3 4
FileName}}4 <
.}}< =
Contains}}= E
(}}E F
file}}F J
.}}J K
FileName}}K S
)}}S T
)}}T U
)}}U V
continue~~ 
;~~ 
entegrationFileList #
.# $
Add$ '
(' (
new( + 
PRD_EntegrationFiles, @
{
ÄÄ 
id
ÅÅ 
=
ÅÅ 
Guid
ÅÅ 
.
ÅÅ 
NewGuid
ÅÅ %
(
ÅÅ% &
)
ÅÅ& '
,
ÅÅ' (
created
ÇÇ 
=
ÇÇ 
DateTime
ÇÇ &
.
ÇÇ& '
Now
ÇÇ' *
,
ÇÇ* +
	createdby
ÉÉ 
=
ÉÉ 
Guid
ÉÉ  $
.
ÉÉ$ %
Empty
ÉÉ% *
,
ÉÉ* +
CreateDateInFtp
ÑÑ #
=
ÑÑ$ %
file
ÑÑ& *
.
ÑÑ* +
FileCreatedDate
ÑÑ+ :
,
ÑÑ: ;
DistributorName
ÖÖ #
=
ÖÖ$ %
DistributorName
ÖÖ& 5
,
ÖÖ5 6
DistributorId
ÜÜ !
=
ÜÜ" #
DistributorId
ÜÜ$ 1
,
ÜÜ1 2
FileName
áá 
=
áá 
file
áá #
.
áá# $
DirectoryFileName
áá$ 5
,
áá5 6
FileNameDate
àà  
=
àà! "
Tools
àà# (
.
àà( )!
GetDateFromFileName
àà) <
(
àà< =
file
àà= A
.
ààA B
FileName
ààB J
,
ààJ K
$str
ààL X
)
ààX Y
,
ààY Z
ProcessTime
ââ 
=
ââ  !
DateTime
ââ" *
.
ââ* +
Now
ââ+ .
,
ââ. /
FileTypeName
ää  
=
ää! "
FileTypeName
ää# /
(
ää/ 0
file
ää0 4
.
ää4 5
FileName
ää5 =
)
ää= >
}
ãã 
)
ãã 
;
ãã 
}
åå 
Log
çç 
.
çç 
Warning
çç 
(
çç 
$str
çç ;
,
çç; <!
entegrationFileList
çç= P
.
ççP Q
Count
ççQ V
(
ççV W
)
ççW X
)
ççX Y
;
ççY Z
return
éé !
entegrationFileList
éé &
.
éé& '
ToArray
éé' .
(
éé. /
)
éé/ 0
;
éé0 1
}
èè 	
public
êê #
PRD_EntegrationAction
êê $
[
êê$ %
]
êê% &!
GetSellInFilesInFtp
êê' :
(
êê: ;
string
êê; A
fileName
êêB J
,
êêJ K
Guid
êêL P 
entegrationFilesId
êêQ c
)
êêc d
{
ëë 	
var
íí 
sellThrs
íí 
=
íí 
new
íí 
List
íí #
<
íí# $#
PRD_EntegrationAction
íí$ 9
>
íí9 :
(
íí: ;
)
íí; <
;
íí< =
var
ìì 
datetimeNow
ìì 
=
ìì 
DateTime
ìì &
.
ìì& '
Now
ìì' *
;
ìì* +
try
îî 
{
ïï 
List
ññ 
<
ññ 
PropertyIndex
ññ "
>
ññ" #
Index
ññ$ )
=
ññ* +
new
ññ, /
List
ññ0 4
<
ññ4 5
PropertyIndex
ññ5 B
>
ññB C
(
ññC D
)
ññD E
;
ññE F
var
óó 

getRawFile
óó 
=
óó  

GetRawFile
óó! +
(
óó+ ,
fileName
óó, 4
)
óó4 5
.
óó5 6
ToList
óó6 <
(
óó< =
)
óó= >
;
óó> ?
var
òò 

getHeaders
òò 
=
òò  

getRawFile
òò! +
[
òò+ ,
$num
òò, -
]
òò- .
;
òò. /

getRawFile
ôô 
.
ôô 
RemoveAt
ôô #
(
ôô# $
$num
ôô$ %
)
ôô% &
;
ôô& '
for
öö 
(
öö 
int
öö 
i
öö 
=
öö 
$num
öö 
;
öö 
i
öö  !
<
öö" #

getHeaders
öö$ .
.
öö. /
Length
öö/ 5
;
öö5 6
i
öö7 8
++
öö8 :
)
öö: ;
{
õõ 
Index
úú 
.
úú 
Add
úú 
(
úú 
new
úú !
PropertyIndex
úú" /
{
úú0 1
Index
úú2 7
=
úú8 9
i
úú: ;
,
úú; <
Name
úú= A
=
úúB C

getHeaders
úúD N
[
úúN O
i
úúO P
]
úúP Q
}
úúR S
)
úúS T
;
úúT U
}
ùù 
foreach
ûû 
(
ûû 
var
ûû 
rawFile
ûû $
in
ûû% '

getRawFile
ûû( 2
)
ûû2 3
{
üü 
try
†† 
{
°° 
var
¢¢ 
item
¢¢  
=
¢¢! "
new
¢¢# &#
PRD_EntegrationAction
¢¢' <
(
¢¢< =
)
¢¢= >
;
¢¢> ?
for
££ 
(
££ 
int
££  
i
££! "
=
££# $
$num
££% &
;
££& '
i
££( )
<
££* +
rawFile
££, 3
.
££3 4
Length
££4 :
;
££: ;
i
££< =
++
££= ?
)
££? @
{
§§ 
try
•• 
{
¶¶ 
var
ßß  #
	indexName
ßß$ -
=
ßß. /
Index
ßß0 5
.
ßß5 6
Where
ßß6 ;
(
ßß; <
x
ßß< =
=>
ßß> @
x
ßßA B
.
ßßB C
Index
ßßC H
==
ßßI K
i
ßßL M
)
ßßM N
.
ßßN O
Select
ßßO U
(
ßßU V
x
ßßV W
=>
ßßX Z
x
ßß[ \
.
ßß\ ]
Name
ßß] a
)
ßßa b
.
ßßb c
FirstOrDefault
ßßc q
(
ßßq r
)
ßßr s
;
ßßs t
if
®®  "
(
®®# $
	indexName
®®$ -
!=
®®. 0
null
®®1 5
)
®®5 6
{
©©  !
var
™™$ ' 
rawFileCheckedData
™™( :
=
™™; <
rawFile
™™= D
[
™™D E
i
™™E F
]
™™F G
.
™™G H
Replace
™™H O
(
™™O P
$str
™™P T
,
™™T U
$str
™™V X
)
™™X Y
.
™™Y Z
Replace
™™Z a
(
™™a b
$str
™™b f
,
™™f g
$str
™™h j
)
™™j k
;
™™k l
if
´´$ &
(
´´' (
!
´´( )
string
´´) /
.
´´/ 0
IsNullOrEmpty
´´0 =
(
´´= > 
rawFileCheckedData
´´> P
)
´´P Q
)
´´Q R
{
¨¨$ %
	indexName
≠≠( 1
=
≠≠2 3
	indexName
≠≠4 =
.
≠≠= >
ToLower
≠≠> E
(
≠≠E F
new
≠≠F I
CultureInfo
≠≠J U
(
≠≠U V
$str
≠≠V ]
,
≠≠] ^
false
≠≠_ d
)
≠≠d e
)
≠≠e f
.
≠≠f g
Replace
≠≠g n
(
≠≠n o
$str
≠≠o r
,
≠≠r s
$str
≠≠t v
)
≠≠v w
.
≠≠w x
Replace
≠≠x 
(≠≠ Ä
$str≠≠Ä É
,≠≠É Ñ
$str≠≠Ö á
)≠≠á à
;≠≠à â
if
ÆÆ( *
(
ÆÆ+ ,
	indexName
ÆÆ, 5
==
ÆÆ6 8
$str
ÆÆ9 H
)
ÆÆH I
item
ØØ, 0
.
ØØ0 1
InvoiceNumber
ØØ1 >
=
ØØ? @ 
rawFileCheckedData
ØØA S
;
ØØS T
if
∞∞( *
(
∞∞+ ,
	indexName
∞∞, 5
==
∞∞6 8
$str
∞∞9 ?
)
∞∞? @
item
±±, 0
.
±±0 1
DistributorName
±±1 @
=
±±A B 
rawFileCheckedData
±±C U
;
±±U V
if
≤≤( *
(
≤≤+ ,
	indexName
≤≤, 5
==
≤≤6 8
$str
≤≤9 O
)
≤≤O P
item
≥≥, 0
.
≥≥0 1"
CustomerOperatorCode
≥≥1 E
=
≥≥F G 
rawFileCheckedData
≥≥H Z
;
≥≥Z [
if
¥¥( *
(
¥¥+ ,
	indexName
¥¥, 5
==
¥¥6 8
$str
¥¥9 L
||
¥¥M O
	indexName
¥¥P Y
==
¥¥Z \
$str
¥¥] n
||
¥¥o q
	indexName
¥¥r {
==
¥¥| ~
$str¥¥ î
)¥¥î ï
item
µµ, 0
.
µµ0 1"
CustomerOperatorCode
µµ1 E
=
µµF G 
rawFileCheckedData
µµH Z
;
µµZ [
if
∂∂( *
(
∂∂+ ,
	indexName
∂∂, 5
==
∂∂6 8
$str
∂∂9 G
)
∂∂G H
item
∑∑, 0
.
∑∑0 1"
CustomerOperatorName
∑∑1 E
=
∑∑F G 
rawFileCheckedData
∑∑H Z
;
∑∑Z [
if
∏∏( *
(
∏∏+ ,
	indexName
∏∏, 5
==
∏∏6 8
$str
∏∏9 E
)
∏∏E F
item
ππ, 0
.
ππ0 1

BranchCode
ππ1 ;
=
ππ< = 
rawFileCheckedData
ππ> P
;
ππP Q
if
∫∫( *
(
∫∫+ ,
	indexName
∫∫, 5
==
∫∫6 8
$str
∫∫9 E
)
∫∫E F
item
ªª, 0
.
ªª0 1

BranchName
ªª1 ;
=
ªª< = 
rawFileCheckedData
ªª> P
;
ªªP Q
if
ºº( *
(
ºº+ ,
	indexName
ºº, 5
==
ºº6 8
$str
ºº9 D
)
ººD E
item
ΩΩ, 0
.
ΩΩ0 1
	TaxNumber
ΩΩ1 :
=
ΩΩ; < 
rawFileCheckedData
ΩΩ= O
;
ΩΩO P
if
ææ( *
(
ææ+ ,
	indexName
ææ, 5
==
ææ6 8
$str
ææ9 L
)
ææL M
item
øø, 0
.
øø0 1
ConsolidationCode
øø1 B
=
øøC D 
rawFileCheckedData
øøE W
;
øøW X
if
¿¿( *
(
¿¿+ ,
	indexName
¿¿, 5
==
¿¿6 8
$str
¿¿9 L
)
¿¿L M
item
¡¡, 0
.
¡¡0 1
ConsolidationName
¡¡1 B
=
¡¡C D 
rawFileCheckedData
¡¡E W
;
¡¡W X
if
¬¬( *
(
¬¬+ ,
	indexName
¬¬, 5
==
¬¬6 8
$str
¬¬9 ?
)
¬¬? @
item
√√, 0
.
√√0 1
Imei
√√1 5
=
√√6 7 
rawFileCheckedData
√√8 J
;
√√J K
if
ƒƒ( *
(
ƒƒ+ ,
	indexName
ƒƒ, 5
==
ƒƒ6 8
$str
ƒƒ9 A
)
ƒƒA B
item
≈≈, 0
.
≈≈0 1
SerialNo
≈≈1 9
=
≈≈: ; 
rawFileCheckedData
≈≈< N
;
≈≈N O
if
∆∆( *
(
∆∆+ ,
	indexName
∆∆, 5
==
∆∆6 8
$str
∆∆9 C
)
∆∆C D
item
««, 0
.
««0 1
Quantity
««1 9
=
««: ;
Convert
««< C
.
««C D
ToInt32
««D K
(
««K L 
rawFileCheckedData
««L ^
)
««^ _
;
««_ `
if
»»( *
(
»»+ ,
	indexName
»», 5
==
»»6 8
$str
»»9 ?
)
»»? @
item
……, 0
.
……0 1)
CustomerOperatorStorageCity
……1 L
=
……M N 
rawFileCheckedData
……O a
;
……a b
if
  ( *
(
  + ,
	indexName
  , 5
==
  6 8
$str
  9 ?
)
  ? @
item
ÀÀ, 0
.
ÀÀ0 1)
CustomerOperatorStorageTown
ÀÀ1 L
=
ÀÀM N 
rawFileCheckedData
ÀÀO a
;
ÀÀa b
}
ÃÃ$ %
}
ÕÕ  !
else
ŒŒ  $
{
œœ  !
Log
––$ '
.
––' (
Error
––( -
(
––- .
$str
––. M
)
––M N
;
––N O
}
——  !
}
““ 
catch
”” !
(
””" #
	Exception
””# ,
e
””- .
)
””. /
{
‘‘ 
Log
’’  #
.
’’# $
Error
’’$ )
(
’’) *
$str
’’* X
,
’’X Y
e
’’Z [
.
’’[ \
ToString
’’\ d
(
’’d e
)
’’e f
)
’’f g
;
’’g h
}
÷÷ 
}
◊◊ 
item
ÿÿ 
.
ÿÿ 
DistributorId
ÿÿ *
=
ÿÿ+ ,
DistributorId
ÿÿ- :
;
ÿÿ: ;
item
ŸŸ 
.
ŸŸ 
DistributorName
ŸŸ ,
=
ŸŸ- .
this
ŸŸ/ 3
.
ŸŸ3 4
DistributorName
ŸŸ4 C
;
ŸŸC D
item
⁄⁄ 
.
⁄⁄ 
EntegrationFileId
⁄⁄ .
=
⁄⁄/ 0 
entegrationFilesId
⁄⁄1 C
;
⁄⁄C D
var
€€ 
message
€€ #
=
€€$ %
$str
€€& (
;
€€( )
var
‹‹ 
	inventory
‹‹ %
=
‹‹& '
Finder
‹‹( .
.
‹‹. /
FindInventory
‹‹/ <
(
‹‹< =
item
‹‹= A
.
‹‹A B
SerialNo
‹‹B J
,
‹‹J K
item
‹‹L P
.
‹‹P Q
Imei
‹‹Q U
)
‹‹U V
;
‹‹V W
if
›› 
(
›› 
	inventory
›› %
==
››& (
null
››) -
)
››- .
{
ﬁﬁ 
message
ﬂﬂ #
=
ﬂﬂ$ %
$str
ﬂﬂ& J
;
ﬂﬂJ K
}
‡‡ 
var
·· 
company
·· #
=
··$ %
Finder
··& ,
.
··, -
FindCompany
··- 8
(
··8 9
item
··9 =
)
··= >
;
··> ?
if
‚‚ 
(
‚‚ 
!
‚‚ 
company
‚‚ $
.
‚‚$ %
HasValue
‚‚% -
)
‚‚- .
{
„„ 
message
‰‰ #
=
‰‰$ %
$str
‰‰& L
;
‰‰L M
}
ÂÂ 
item
ÊÊ 
.
ÊÊ 
	ProductId
ÊÊ &
=
ÊÊ' (
	inventory
ÊÊ) 2
?
ÊÊ2 3
.
ÊÊ3 4
	productId
ÊÊ4 =
;
ÊÊ= >
item
ÁÁ 
.
ÁÁ 
InventoryId
ÁÁ (
=
ÁÁ) *
	inventory
ÁÁ+ 4
?
ÁÁ4 5
.
ÁÁ5 6
id
ÁÁ6 8
;
ÁÁ8 9
item
ËË 
.
ËË  
CustomerOperatorId
ËË /
=
ËË0 1
company
ËË2 9
;
ËË9 :
sellThrs
ÈÈ  
.
ÈÈ  !
Add
ÈÈ! $
(
ÈÈ$ %
item
ÈÈ% )
)
ÈÈ) *
;
ÈÈ* +
if
ÍÍ 
(
ÍÍ 
!
ÍÍ 
string
ÍÍ #
.
ÍÍ# $
IsNullOrEmpty
ÍÍ$ 1
(
ÍÍ1 2
message
ÍÍ2 9
)
ÍÍ9 :
)
ÍÍ: ;
{
ÎÎ  
NotificationLogger
ÏÏ .
.
ÏÏ. /
	SaveError
ÏÏ/ 8
(
ÏÏ8 9
DateTime
ÏÏ9 A
.
ÏÏA B
Now
ÏÏB E
,
ÏÏE F
message
ÏÏG N
,
ÏÏN O
item
ÏÏP T
)
ÏÏT U
;
ÏÏU V
}
ÌÌ 
}
ÓÓ 
catch
ÔÔ 
(
ÔÔ 
	Exception
ÔÔ $
e
ÔÔ% &
)
ÔÔ& '
{
 
Log
ÒÒ 
.
ÒÒ 
Error
ÒÒ !
(
ÒÒ! "
$str
ÒÒ" P
,
ÒÒP Q
e
ÒÒR S
.
ÒÒS T
ToString
ÒÒT \
(
ÒÒ\ ]
)
ÒÒ] ^
)
ÒÒ^ _
;
ÒÒ_ `
}
ÚÚ 
}
ÛÛ 
}
ÙÙ 
catch
ıı 
(
ıı 
	Exception
ıı 
e
ıı 
)
ıı 
{
ˆˆ 
Log
˜˜ 
.
˜˜ 
Error
˜˜ 
(
˜˜ 
e
˜˜ 
.
˜˜ 
ToString
˜˜ $
(
˜˜$ %
)
˜˜% &
)
˜˜& '
;
˜˜' (
}
¯¯ 
return
˘˘ 
sellThrs
˘˘ 
.
˘˘ 
ToArray
˘˘ #
(
˘˘# $
)
˘˘$ %
;
˘˘% &
}
˙˙ 	
public
˚˚ 
List
˚˚ 
<
˚˚ 
string
˚˚ 
[
˚˚ 
]
˚˚ 
>
˚˚ 

GetRawFile
˚˚ (
(
˚˚( )
string
˚˚) /
fileName
˚˚0 8
)
˚˚8 9
{
¸¸ 	
Log
˝˝ 
.
˝˝ 
Info
˝˝ 
(
˝˝ 
string
˝˝ 
.
˝˝ 
Format
˝˝ "
(
˝˝" #
$str
˝˝# L
,
˝˝L M
fileName
˝˝N V
,
˝˝V W
ftpConfiguration
˝˝X h
.
˝˝h i
Url
˝˝i l
)
˝˝l m
)
˝˝m n
;
˝˝n o
var
˛˛ 
listStringArray
˛˛ 
=
˛˛  !
new
˛˛" %
List
˛˛& *
<
˛˛* +
string
˛˛+ 1
[
˛˛1 2
]
˛˛2 3
>
˛˛3 4
(
˛˛4 5
)
˛˛5 6
;
˛˛6 7
var
ˇˇ 
request
ˇˇ 
=
ˇˇ 
(
ˇˇ 
FtpWebRequest
ˇˇ (
)
ˇˇ( )

WebRequest
ˇˇ) 3
.
ˇˇ3 4
Create
ˇˇ4 :
(
ˇˇ: ;
fileName
ˇˇ; C
)
ˇˇC D
;
ˇˇD E
request
ÄÄ 
.
ÄÄ 
Method
ÄÄ 
=
ÄÄ 
WebRequestMethods
ÄÄ .
.
ÄÄ. /
Ftp
ÄÄ/ 2
.
ÄÄ2 3
DownloadFile
ÄÄ3 ?
;
ÄÄ? @
request
ÅÅ 
.
ÅÅ 
Credentials
ÅÅ 
=
ÅÅ  !
new
ÅÅ" %
NetworkCredential
ÅÅ& 7
(
ÅÅ7 8
ftpConfiguration
ÅÅ8 H
.
ÅÅH I
UserName
ÅÅI Q
,
ÅÅQ R
ftpConfiguration
ÅÅS c
.
ÅÅc d
Password
ÅÅd l
)
ÅÅl m
;
ÅÅm n
var
ÇÇ 
response
ÇÇ 
=
ÇÇ 
(
ÇÇ 
FtpWebResponse
ÇÇ *
)
ÇÇ* +
request
ÇÇ+ 2
.
ÇÇ2 3
GetResponse
ÇÇ3 >
(
ÇÇ> ?
)
ÇÇ? @
;
ÇÇ@ A
var
ÉÉ 
responseStream
ÉÉ 
=
ÉÉ  
response
ÉÉ! )
.
ÉÉ) *
GetResponseStream
ÉÉ* ;
(
ÉÉ; <
)
ÉÉ< =
;
ÉÉ= >
var
ÑÑ 
reader
ÑÑ 
=
ÑÑ 
new
ÑÑ 
StreamReader
ÑÑ )
(
ÑÑ) *
responseStream
ÑÑ* 8
)
ÑÑ8 9
;
ÑÑ9 :
string
ÖÖ 
line
ÖÖ 
;
ÖÖ 
try
ÜÜ 
{
áá 
while
àà 
(
àà 
(
àà 
line
àà 
=
àà 
reader
àà %
.
àà% &
ReadLine
àà& .
(
àà. /
)
àà/ 0
)
àà0 1
!=
àà2 4
null
àà5 9
)
àà9 :
{
ââ 
List
ää 
<
ää 
string
ää 
>
ää  
splitedLines
ää! -
=
ää. /
line
ää0 4
.
ää4 5
Split
ää5 :
(
ää: ;
$char
ää; >
)
ää> ?
.
ää? @
ToList
ää@ F
(
ääF G
)
ääG H
;
ääH I
listStringArray
ãã #
.
ãã# $
Add
ãã$ '
(
ãã' (
splitedLines
ãã( 4
.
ãã4 5
ToArray
ãã5 <
(
ãã< =
)
ãã= >
)
ãã> ?
;
ãã? @
}
åå 
response
çç 
.
çç 
Close
çç 
(
çç 
)
çç  
;
çç  !
reader
éé 
.
éé 
Close
éé 
(
éé 
)
éé 
;
éé 
}
èè 
catch
êê 
(
êê 
	Exception
êê 
e
êê 
)
êê 
{
ëë 
Log
íí 
.
íí 
Warning
íí 
(
íí 
e
íí 
.
íí 
Message
íí %
)
íí% &
;
íí& '
}
ìì 
return
îî 
listStringArray
îî "
;
îî" #
}
ïï 	
public
ññ 
string
ññ 
FileTypeName
ññ "
(
ññ" #
string
ññ# )
fileName
ññ* 2
)
ññ2 3
{
óó 	
if
òò 
(
òò 
fileName
òò 
.
òò 
Contains
òò !
(
òò! "
$str
òò" *
)
òò* +
)
òò+ ,
return
ôô 
$str
ôô 
;
ôô  
else
öö 
if
öö 
(
öö 
fileName
öö 
.
öö 
Contains
öö &
(
öö& '
$str
öö' 0
)
öö0 1
)
öö1 2
return
õõ 
$str
õõ  
;
õõ  !
else
úú 
if
úú 
(
úú 
fileName
úú 
.
úú 
Contains
úú &
(
úú& '
$str
úú' -
)
úú- .
)
úú. /
return
ùù 
$str
ùù  
;
ùù  !
else
ûû 
return
üü 
null
üü 
;
üü 
}
†† 	
}
°° 
}¢¢ éè
~D:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\FtpPort.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
public 

class 
FtpPort 
: &
IFtpDistributorEntegration 5
{ 
public 
FtpConfiguration 
ftpConfiguration  0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
string 
DistributorName %
=>& (
$str) /
;/ 0
public 
Guid 
DistributorId !
=>" $
new% (
Guid) -
(- .
$str. T
)T U
;U V
public 
FtpPort 
( 
) 
{ 	
Log 
. 
Warning 
( 
$str 0
)0 1
;1 2
SetFtpConfiguration 
(  
)  !
;! "
} 	
public 
ResultStatus !
ExportFilesToDatabase 1
(1 2
)2 3
{ 	
var 
processDate 
= 
DateTime &
.& '
Now' *
.* +
AddDays+ 2
(2 3
-3 4
$num4 6
)6 7
;7 8
var 
entegrationFileList #
=$ %
GetFilesInFtp& 3
(3 4
processDate4 ?
)? @
;@ A
var 
result 
= 
new 
ResultStatus )
() *
)* +
;+ ,
foreach 
( 
var 
entegrationFile (
in) +
entegrationFileList, ?
)? @
{   
Log!! 
.!! 
Warning!! 
(!! 
$str!! A
,!!A B
this!!C G
.!!G H
ftpConfiguration!!H X
.!!X Y
Url!!Y \
,!!\ ]
this!!^ b
.!!b c
DistributorName!!c r
,!!r s
entegrationFile	!!t É
.
!!É Ñ
FileName
!!Ñ å
)
!!å ç
;
!!ç é
var"" 
db"" 
="" 
GetDbConnection"" (
(""( )
)"") *
;""* +
result## 
=## 
db## 
.## &
InsertPRD_EntegrationFiles## 6
(##6 7
entegrationFile##7 F
)##F G
;##G H
if$$ 
($$ 
!$$ 
result$$ 
.$$ 
result$$ "
)$$" #
{%% 
Log&& 
.&& 
Error&& 
(&& 
$str&& M
,&&M N
result&&O U
.&&U V
message&&V ]
)&&] ^
;&&^ _
continue'' 
;'' 
}(( 
if)) 
()) 
entegrationFile)) #
.))# $
FileTypeName))$ 0
==))1 3
$str))4 =
)))= >
{** 
var++ 
sellThr++ 
=++  !
GetSellInFilesInFtp++" 5
(++5 6
entegrationFile++6 E
.++E F
FileName++F N
,++N O
entegrationFile++P _
.++_ `
id++` b
)++b c
;++c d
if,, 
(,, 
sellThr,, 
!=,,  "
null,,# '
&&,,( *
sellThr,,+ 2
.,,2 3
Count,,3 8
(,,8 9
),,9 :
>,,; <
$num,,= >
),,> ?
{-- 
var.. 
bultInsertResult.. ,
=..- .
db../ 1
...1 2+
BulkInsertPRD_EntegrationAction..2 Q
(..Q R
sellThr..R Y
)..Y Z
;..Z [
if// 
(// 
!// 
bultInsertResult// -
.//- .
result//. 4
)//4 5
Log00 
.00  
Info00  $
(00$ %
$str00% ^
,00^ _
this00` d
.00d e
ftpConfiguration00e u
.00u v
Url00v y
,00y z
this00{ 
.	00 Ä
DistributorName
00Ä è
,
00è ê
bultInsertResult
00ë °
.
00° ¢
message
00¢ ©
)
00© ™
;
00™ ´
}11 
}22 
Log33 
.33 
Success33 
(33 
$str33 C
,33C D
this33E I
.33I J
ftpConfiguration33J Z
.33Z [
Url33[ ^
,33^ _
this33` d
.33d e
DistributorName33e t
,33t u
entegrationFile	33v Ö
.
33Ö Ü
FileName
33Ü é
)
33é è
;
33è ê
}44 
Log55 
.55 
Success55 
(55 
$"55 
$str55 6
{556 7
DistributorName557 F
}55F G
$str55G K
"55K L
)55L M
;55M N
return66 
result66 
;66 
}77 	
public88 
string88 
FileTypeName88 "
(88" #
string88# )
fileName88* 2
)882 3
{99 	
if:: 
(:: 
fileName:: 
.:: 
Contains:: !
(::! "
$str::" *
)::* +
)::+ ,
return;; 
$str;; 
;;;  
else<< 
if<< 
(<< 
fileName<< 
.<< 
Contains<< &
(<<& '
$str<<' 0
)<<0 1
)<<1 2
return== 
$str==  
;==  !
else>> 
if>> 
(>> 
fileName>> 
.>> 
Contains>> &
(>>& '
$str>>' -
)>>- .
)>>. /
return?? 
$str??  
;??  !
else@@ 
returnAA 
nullAA 
;AA 
}BB 	
publicCC 
WorkOfTimeDatabaseCC !
GetDbConnectionCC" 1
(CC1 2
)CC2 3
{DD 	
varEE 

tenantCodeEE 
=EE  
ConfigurationManagerEE 1
.EE1 2
AppSettingsEE2 =
[EE= >
$strEE> M
]EEM N
.EEN O
ToStringEEO W
(EEW X
)EEX Y
;EEY Z
varFF 
tenantFF 
=FF 
TenantConfigFF %
.FF% &

GetTenantsFF& 0
(FF0 1
)FF1 2
.FF2 3
WhereFF3 8
(FF8 9
aFF9 :
=>FF; =
aFF> ?
.FF? @

TenantCodeFF@ J
==FFK M
ConvertFFN U
.FFU V
ToInt32FFV ]
(FF] ^

tenantCodeFF^ h
)FFh i
)FFi j
.FFj k
FirstOrDefaultFFk y
(FFy z
)FFz {
;FF{ |
returnGG 
tenantGG 
.GG 
GetDatabaseGG %
(GG% &
)GG& '
;GG' (
}HH 	
publicII  
PRD_EntegrationFilesII #
[II# $
]II$ %
GetFilesInFtpII& 3
(II3 4
DateTimeII4 <
processDateII= H
)IIH I
{JJ 	
LogKK 
.KK 
InfoKK 
(KK 
stringKK 
.KK 
FormatKK "
(KK" #
$strKK# P
,KKP Q
ftpConfigurationKKR b
.KKb c
UrlKKc f
)KKf g
)KKg h
;KKh i
varLL 
fileListLL 
=LL 
newLL 
ListLL #
<LL# $
FileNameWithUrlLL$ 3
>LL3 4
(LL4 5
)LL5 6
;LL6 7
tryMM 
{NN 
FtpWebRequestOO 
requestOO %
=OO& '
(OO( )
FtpWebRequestOO) 6
)OO6 7
FtpWebRequestOO7 D
.OOD E
CreateOOE K
(OOK L
ftpConfigurationOOL \
.OO\ ]
UrlOO] `
)OO` a
;OOa b
requestPP 
.PP 
MethodPP 
=PP  
WebRequestMethodsPP! 2
.PP2 3
FtpPP3 6
.PP6 7 
ListDirectoryDetailsPP7 K
;PPK L
requestQQ 
.QQ 
CredentialsQQ #
=QQ$ %
newQQ& )
NetworkCredentialQQ* ;
(QQ; <
ftpConfigurationQQ< L
.QQL M
UserNameQQM U
,QQU V
ftpConfigurationQQW g
.QQg h
PasswordQQh p
)QQp q
;QQq r
stringRR 
[RR 
]RR 
listRR 
=RR 
nullRR  $
;RR$ %
usingSS 
(SS 
FtpWebResponseSS %
responseSS& .
=SS/ 0
(SS1 2
FtpWebResponseSS2 @
)SS@ A
requestSSA H
.SSH I
GetResponseSSI T
(SST U
)SSU V
)SSV W
usingTT 
(TT 
StreamReaderTT #
readerTT$ *
=TT+ ,
newTT- 0
StreamReaderTT1 =
(TT= >
responseTT> F
.TTF G
GetResponseStreamTTG X
(TTX Y
)TTY Z
)TTZ [
)TT[ \
{UU 
listVV 
=VV 
readerVV !
.VV! "
	ReadToEndVV" +
(VV+ ,
)VV, -
.VV- .
SplitVV. 3
(VV3 4
newVV4 7
stringVV8 >
[VV> ?
]VV? @
{VVA B
$strVVC I
}VVJ K
,VVK L
StringSplitOptionsVVM _
.VV_ `
RemoveEmptyEntriesVV` r
)VVr s
;VVs t
}WW 
foreachXX 
(XX 
stringXX 
lineXX  $
inXX% '
listXX( ,
)XX, -
{YY 
DirectoryItemZZ !
itemZZ" &
=ZZ' (
newZZ) ,
DirectoryItemZZ- :
(ZZ: ;
)ZZ; <
;ZZ< =
string[[ 
data[[ 
=[[  !
line[[" &
;[[& '
var\\ 

dateString\\ "
=\\# $
line\\% )
.\\) *
	Substring\\* 3
(\\3 4
$num\\4 6
,\\6 7
$num\\8 :
-\\; <
$num\\= ?
)\\? @
;\\@ A
bool]] 
isDirectory]] $
=]]% &
data]]' +
[]]+ ,
$num]], -
]]]- .
.]]. /
ToString]]/ 7
(]]7 8
)]]8 9
==]]: <
$str]]= @
;]]@ A
var^^ 
name^^ 
=^^ 
data^^ #
.^^# $
	Substring^^$ -
(^^- .
$num^^. 0
)^^0 1
;^^1 2
item__ 
.__ 
DateFileCreated__ (
=__) *
DateTime__+ 3
.__3 4

ParseExact__4 >
(__> ?

dateString__? I
,__I J
$str__K Y
,__Y Z
CultureInfo__[ f
.__f g
InvariantCulture__g w
)__w x
;__x y
item`` 
.`` 
Name`` 
=`` 
name``  $
;``$ %
itemaa 
.aa 
BaseUriaa  
=aa! "
ftpConfigurationaa# 3
.aa3 4
Urlaa4 7
;aa7 8
itembb 
.bb 
IsDirectorybb $
=bb% &
isDirectorybb' 2
;bb2 3
ifcc 
(cc 
namecc 
==cc 
$strcc  #
||cc$ &
namecc' +
==cc, .
$strcc/ 3
)cc3 4
{dd 
}ee 
elseff 
{gg 
ifhh 
(hh 
!hh 
isDirectoryhh (
)hh( )
{ii 
fileListjj $
.jj$ %
Addjj% (
(jj( )
newjj) ,
FileNameWithUrljj- <
{jj= >
FileNamejj? G
=jjH I
itemjjJ N
.jjN O
NamejjO S
,jjS T
FileCreatedDatejjU d
=jje f
itemjjg k
.jjk l
DateFileCreatedjjl {
,jj{ |
DirectoryFileName	jj} é
=
jjè ê
this
jjë ï
.
jjï ñ
ftpConfiguration
jjñ ¶
.
jj¶ ß
Url
jjß ™
+
jj´ ¨
this
jj≠ ±
.
jj± ≤
ftpConfiguration
jj≤ ¬
.
jj¬ √
	Directory
jj√ Ã
+
jjÕ Œ
$str
jjœ ”
+
jj‘ ’
item
jj÷ ⁄
.
jj⁄ €
Name
jj€ ﬂ
}
jj‡ ·
)
jj· ‚
;
jj‚ „
}kk 
}ll 
}mm 
Lognn 
.nn 
Infonn 
(nn 
$strnn '
+nn( )
fileListnn* 2
.nn2 3
Countnn3 8
)nn8 9
;nn9 :
}oo 
catchpp 
(pp 
	Exceptionpp 
epp 
)pp 
{qq 
Logrr 
.rr 
Errorrr 
(rr 
ftpConfigurationrr *
.rr* +
Urlrr+ .
+rr/ 0
$strrr1 >
+rr? @
errA B
.rrB C
MessagerrC J
)rrJ K
;rrK L
}ss 
vartt 
dbtt 
=tt 
GetDbConnectiontt $
(tt$ %
)tt% &
;tt& '
varuu  
entegrationFilesInDbuu $
=uu% &
dbuu' )
.uu) *0
$GetPRD_EntegrationFilesByCreatedDateuu* N
(uuN O
processDateuuO Z
,uuZ [
DistributorNameuu\ k
)uuk l
;uul m
varvv 
entegrationFileListvv #
=vv$ %
newvv& )
Listvv* .
<vv. / 
PRD_EntegrationFilesvv/ C
>vvC D
(vvD E
)vvE F
;vvF G
foreachww 
(ww 
varww 
fileww 
inww  
fileListww! )
.ww) *
Whereww* /
(ww/ 0
xww0 1
=>ww2 4
xww5 6
.ww6 7
FileCreatedDateww7 F
>=wwG I
processDatewwJ U
)wwU V
)wwV W
{xx 
ifyy 
(yy  
entegrationFilesInDbyy (
.yy( )
Anyyy) ,
(yy, -
xyy- .
=>yy/ 1
xyy2 3
.yy3 4
FileNameyy4 <
.yy< =
Containsyy= E
(yyE F
fileyyF J
.yyJ K
FileNameyyK S
)yyS T
)yyT U
)yyU V
continuezz 
;zz 
entegrationFileList{{ #
.{{# $
Add{{$ '
({{' (
new{{( + 
PRD_EntegrationFiles{{, @
{|| 
id}} 
=}} 
Guid}} 
.}} 
NewGuid}} %
(}}% &
)}}& '
,}}' (
created~~ 
=~~ 
DateTime~~ &
.~~& '
Now~~' *
,~~* +
	createdby 
= 
Guid  $
.$ %
Empty% *
,* +
CreateDateInFtp
ÄÄ #
=
ÄÄ$ %
file
ÄÄ& *
.
ÄÄ* +
FileCreatedDate
ÄÄ+ :
,
ÄÄ: ;
DistributorName
ÅÅ #
=
ÅÅ$ %
DistributorName
ÅÅ& 5
,
ÅÅ5 6
DistributorId
ÇÇ !
=
ÇÇ" #
DistributorId
ÇÇ$ 1
,
ÇÇ1 2
FileName
ÉÉ 
=
ÉÉ 
file
ÉÉ #
.
ÉÉ# $
DirectoryFileName
ÉÉ$ 5
,
ÉÉ5 6
FileNameDate
ÑÑ  
=
ÑÑ! "
Tools
ÑÑ# (
.
ÑÑ( )!
GetDateFromFileName
ÑÑ) <
(
ÑÑ< =
file
ÑÑ= A
.
ÑÑA B
FileName
ÑÑB J
,
ÑÑJ K
$str
ÑÑL V
)
ÑÑV W
,
ÑÑW X
ProcessTime
ÖÖ 
=
ÖÖ  !
DateTime
ÖÖ" *
.
ÖÖ* +
Now
ÖÖ+ .
,
ÖÖ. /
FileTypeName
ÜÜ  
=
ÜÜ! "
FileTypeName
ÜÜ# /
(
ÜÜ/ 0
file
ÜÜ0 4
.
ÜÜ4 5
FileName
ÜÜ5 =
)
ÜÜ= >
}
áá 
)
áá 
;
áá 
}
àà 
Log
ââ 
.
ââ 
Warning
ââ 
(
ââ 
$str
ââ ;
,
ââ; <!
entegrationFileList
ââ= P
.
ââP Q
Count
ââQ V
(
ââV W
)
ââW X
)
ââX Y
;
ââY Z
return
ää !
entegrationFileList
ää &
.
ää& '
ToArray
ää' .
(
ää. /
)
ää/ 0
;
ää0 1
}
ãã 	
public
åå #
PRD_EntegrationAction
åå $
[
åå$ %
]
åå% &!
GetSellInFilesInFtp
åå' :
(
åå: ;
string
åå; A
fileName
ååB J
,
ååJ K
Guid
ååL P 
entegrationFilesId
ååQ c
)
ååc d
{
çç 	
var
éé 
sellThrs
éé 
=
éé 
new
éé 
List
éé #
<
éé# $#
PRD_EntegrationAction
éé$ 9
>
éé9 :
(
éé: ;
)
éé; <
;
éé< =
var
èè 
datetimeNow
èè 
=
èè 
DateTime
èè &
.
èè& '
Now
èè' *
;
èè* +
try
êê 
{
ëë 
List
íí 
<
íí 
PropertyIndex
íí "
>
íí" #
Index
íí$ )
=
íí* +
new
íí, /
List
íí0 4
<
íí4 5
PropertyIndex
íí5 B
>
ííB C
(
ííC D
)
ííD E
;
ííE F
var
ìì 

getRawFile
ìì 
=
ìì  

GetRawFile
ìì! +
(
ìì+ ,
fileName
ìì, 4
)
ìì4 5
.
ìì5 6
ToList
ìì6 <
(
ìì< =
)
ìì= >
;
ìì> ?
var
îî 

getHeaders
îî 
=
îî  

getRawFile
îî! +
[
îî+ ,
$num
îî, -
]
îî- .
;
îî. /

getRawFile
ïï 
.
ïï 
RemoveAt
ïï #
(
ïï# $
$num
ïï$ %
)
ïï% &
;
ïï& '
for
ññ 
(
ññ 
int
ññ 
i
ññ 
=
ññ 
$num
ññ 
;
ññ 
i
ññ  !
<
ññ" #

getHeaders
ññ$ .
.
ññ. /
Length
ññ/ 5
;
ññ5 6
i
ññ7 8
++
ññ8 :
)
ññ: ;
{
óó 
Index
òò 
.
òò 
Add
òò 
(
òò 
new
òò !
PropertyIndex
òò" /
{
òò0 1
Index
òò2 7
=
òò8 9
i
òò: ;
,
òò; <
Name
òò= A
=
òòB C

getHeaders
òòD N
[
òòN O
i
òòO P
]
òòP Q
}
òòR S
)
òòS T
;
òòT U
}
ôô 
foreach
öö 
(
öö 
var
öö 
rawFile
öö $
in
öö% '

getRawFile
öö( 2
)
öö2 3
{
õõ 
try
úú 
{
ùù 
var
ûû 
item
ûû  
=
ûû! "
new
ûû# &#
PRD_EntegrationAction
ûû' <
(
ûû< =
)
ûû= >
;
ûû> ?
for
üü 
(
üü 
int
üü  
i
üü! "
=
üü# $
$num
üü% &
;
üü& '
i
üü( )
<
üü* +
rawFile
üü, 3
.
üü3 4
Length
üü4 :
;
üü: ;
i
üü< =
++
üü= ?
)
üü? @
{
†† 
try
°° 
{
¢¢ 
var
££  #
	indexName
££$ -
=
££. /
Index
££0 5
.
££5 6
Where
££6 ;
(
££; <
x
££< =
=>
££> @
x
££A B
.
££B C
Index
££C H
==
££I K
i
££L M
)
££M N
.
££N O
Select
££O U
(
££U V
x
££V W
=>
££X Z
x
££[ \
.
££\ ]
Name
££] a
)
££a b
.
££b c
FirstOrDefault
££c q
(
££q r
)
££r s
;
££s t
if
§§  "
(
§§# $
	indexName
§§$ -
!=
§§. 0
null
§§1 5
)
§§5 6
{
••  !
var
¶¶$ ' 
rawFileCheckedData
¶¶( :
=
¶¶; <
rawFile
¶¶= D
[
¶¶D E
i
¶¶E F
]
¶¶F G
.
¶¶G H
Replace
¶¶H O
(
¶¶O P
$str
¶¶P T
,
¶¶T U
$str
¶¶V X
)
¶¶X Y
.
¶¶Y Z
Replace
¶¶Z a
(
¶¶a b
$str
¶¶b f
,
¶¶f g
$str
¶¶h j
)
¶¶j k
;
¶¶k l
if
ßß$ &
(
ßß' (
!
ßß( )
string
ßß) /
.
ßß/ 0
IsNullOrEmpty
ßß0 =
(
ßß= > 
rawFileCheckedData
ßß> P
)
ßßP Q
)
ßßQ R
{
®®$ %
	indexName
©©( 1
=
©©2 3
	indexName
©©4 =
.
©©= >
ToLower
©©> E
(
©©E F
new
©©F I
CultureInfo
©©J U
(
©©U V
$str
©©V ]
,
©©] ^
false
©©_ d
)
©©d e
)
©©e f
.
©©f g
Replace
©©g n
(
©©n o
$str
©©o r
,
©©r s
$str
©©t v
)
©©v w
.
©©w x
Replace
©©x 
(©© Ä
$str©©Ä É
,©©É Ñ
$str©©Ö á
)©©á à
;©©à â
if
™™( *
(
™™+ ,
	indexName
™™, 5
==
™™6 8
$str
™™9 H
)
™™H I
item
´´, 0
.
´´0 1
InvoiceNumber
´´1 >
=
´´? @ 
rawFileCheckedData
´´A S
;
´´S T
if
¨¨( *
(
¨¨+ ,
	indexName
¨¨, 5
==
¨¨6 8
$str
¨¨9 ?
)
¨¨? @
item
≠≠, 0
.
≠≠0 1
DistributorName
≠≠1 @
=
≠≠A B 
rawFileCheckedData
≠≠C U
;
≠≠U V
if
ÆÆ( *
(
ÆÆ+ ,
	indexName
ÆÆ, 5
==
ÆÆ6 8
$str
ÆÆ9 O
)
ÆÆO P
item
ØØ, 0
.
ØØ0 1"
CustomerOperatorCode
ØØ1 E
=
ØØF G 
rawFileCheckedData
ØØH Z
;
ØØZ [
if
∞∞( *
(
∞∞+ ,
	indexName
∞∞, 5
==
∞∞6 8
$str
∞∞9 L
||
∞∞M O
	indexName
∞∞P Y
==
∞∞Z \
$str
∞∞] n
||
∞∞o q
	indexName
∞∞r {
==
∞∞| ~
$str∞∞ î
)∞∞î ï
item
±±, 0
.
±±0 1"
CustomerOperatorCode
±±1 E
=
±±F G 
rawFileCheckedData
±±H Z
;
±±Z [
if
≤≤( *
(
≤≤+ ,
	indexName
≤≤, 5
==
≤≤6 8
$str
≤≤9 G
)
≤≤G H
item
≥≥, 0
.
≥≥0 1"
CustomerOperatorName
≥≥1 E
=
≥≥F G 
rawFileCheckedData
≥≥H Z
;
≥≥Z [
if
¥¥( *
(
¥¥+ ,
	indexName
¥¥, 5
==
¥¥6 8
$str
¥¥9 E
)
¥¥E F
item
µµ, 0
.
µµ0 1

BranchCode
µµ1 ;
=
µµ< = 
rawFileCheckedData
µµ> P
;
µµP Q
if
∂∂( *
(
∂∂+ ,
	indexName
∂∂, 5
==
∂∂6 8
$str
∂∂9 E
)
∂∂E F
item
∑∑, 0
.
∑∑0 1

BranchName
∑∑1 ;
=
∑∑< = 
rawFileCheckedData
∑∑> P
;
∑∑P Q
if
∏∏( *
(
∏∏+ ,
	indexName
∏∏, 5
==
∏∏6 8
$str
∏∏9 D
)
∏∏D E
item
ππ, 0
.
ππ0 1
	TaxNumber
ππ1 :
=
ππ; < 
rawFileCheckedData
ππ= O
;
ππO P
if
∫∫( *
(
∫∫+ ,
	indexName
∫∫, 5
==
∫∫6 8
$str
∫∫9 L
)
∫∫L M
item
ªª, 0
.
ªª0 1
ConsolidationCode
ªª1 B
=
ªªC D 
rawFileCheckedData
ªªE W
;
ªªW X
if
ºº( *
(
ºº+ ,
	indexName
ºº, 5
==
ºº6 8
$str
ºº9 L
)
ººL M
item
ΩΩ, 0
.
ΩΩ0 1
ConsolidationName
ΩΩ1 B
=
ΩΩC D 
rawFileCheckedData
ΩΩE W
;
ΩΩW X
if
ææ( *
(
ææ+ ,
	indexName
ææ, 5
==
ææ6 8
$str
ææ9 ?
)
ææ? @
item
øø, 0
.
øø0 1
Imei
øø1 5
=
øø6 7 
rawFileCheckedData
øø8 J
;
øøJ K
if
¿¿( *
(
¿¿+ ,
	indexName
¿¿, 5
==
¿¿6 8
$str
¿¿9 A
)
¿¿A B
item
¡¡, 0
.
¡¡0 1
SerialNo
¡¡1 9
=
¡¡: ; 
rawFileCheckedData
¡¡< N
;
¡¡N O
if
¬¬( *
(
¬¬+ ,
	indexName
¬¬, 5
==
¬¬6 8
$str
¬¬9 C
)
¬¬C D
item
√√, 0
.
√√0 1
Quantity
√√1 9
=
√√: ;
Convert
√√< C
.
√√C D
ToInt32
√√D K
(
√√K L 
rawFileCheckedData
√√L ^
)
√√^ _
;
√√_ `
if
ƒƒ( *
(
ƒƒ+ ,
	indexName
ƒƒ, 5
==
ƒƒ6 8
$str
ƒƒ9 ?
)
ƒƒ? @
item
≈≈, 0
.
≈≈0 1)
CustomerOperatorStorageCity
≈≈1 L
=
≈≈M N 
rawFileCheckedData
≈≈O a
;
≈≈a b
if
∆∆( *
(
∆∆+ ,
	indexName
∆∆, 5
==
∆∆6 8
$str
∆∆9 ?
)
∆∆? @
item
««, 0
.
««0 1)
CustomerOperatorStorageTown
««1 L
=
««M N 
rawFileCheckedData
««O a
;
««a b
}
»»$ %
}
……  !
else
    $
{
ÀÀ  !
Log
ÃÃ$ '
.
ÃÃ' (
Error
ÃÃ( -
(
ÃÃ- .
$str
ÃÃ. M
)
ÃÃM N
;
ÃÃN O
}
ÕÕ  !
}
ŒŒ 
catch
œœ !
(
œœ" #
	Exception
œœ# ,
e
œœ- .
)
œœ. /
{
–– 
Log
——  #
.
——# $
Error
——$ )
(
——) *
$str
——* X
,
——X Y
e
——Z [
.
——[ \
ToString
——\ d
(
——d e
)
——e f
)
——f g
;
——g h
}
““ 
}
”” 
item
‘‘ 
.
‘‘ 
DistributorId
‘‘ *
=
‘‘+ ,
DistributorId
‘‘- :
;
‘‘: ;
item
’’ 
.
’’ 
DistributorName
’’ ,
=
’’- .
this
’’/ 3
.
’’3 4
DistributorName
’’4 C
;
’’C D
item
÷÷ 
.
÷÷ 
EntegrationFileId
÷÷ .
=
÷÷/ 0 
entegrationFilesId
÷÷1 C
;
÷÷C D
var
◊◊ 
message
◊◊ #
=
◊◊$ %
$str
◊◊& (
;
◊◊( )
var
ÿÿ 
	inventory
ÿÿ %
=
ÿÿ& '
Finder
ÿÿ( .
.
ÿÿ. /
FindInventory
ÿÿ/ <
(
ÿÿ< =
item
ÿÿ= A
.
ÿÿA B
SerialNo
ÿÿB J
,
ÿÿJ K
item
ÿÿL P
.
ÿÿP Q
Imei
ÿÿQ U
)
ÿÿU V
;
ÿÿV W
if
ŸŸ 
(
ŸŸ 
	inventory
ŸŸ %
==
ŸŸ& (
null
ŸŸ) -
)
ŸŸ- .
{
⁄⁄ 
message
€€ #
=
€€$ %
$str
€€& J
;
€€J K
}
‹‹ 
var
›› 
company
›› #
=
››$ %
Finder
››& ,
.
››, -
FindCompany
››- 8
(
››8 9
item
››9 =
)
››= >
;
››> ?
if
ﬁﬁ 
(
ﬁﬁ 
!
ﬁﬁ 
company
ﬁﬁ $
.
ﬁﬁ$ %
HasValue
ﬁﬁ% -
)
ﬁﬁ- .
{
ﬂﬂ 
message
‡‡ #
=
‡‡$ %
$str
‡‡& L
;
‡‡L M
}
·· 
item
‚‚ 
.
‚‚ 
	ProductId
‚‚ &
=
‚‚' (
	inventory
‚‚) 2
?
‚‚2 3
.
‚‚3 4
	productId
‚‚4 =
;
‚‚= >
item
„„ 
.
„„ 
InventoryId
„„ (
=
„„) *
	inventory
„„+ 4
?
„„4 5
.
„„5 6
id
„„6 8
;
„„8 9
item
‰‰ 
.
‰‰  
CustomerOperatorId
‰‰ /
=
‰‰0 1
company
‰‰2 9
;
‰‰9 :
sellThrs
ÂÂ  
.
ÂÂ  !
Add
ÂÂ! $
(
ÂÂ$ %
item
ÂÂ% )
)
ÂÂ) *
;
ÂÂ* +
if
ÊÊ 
(
ÊÊ 
!
ÊÊ 
string
ÊÊ #
.
ÊÊ# $
IsNullOrEmpty
ÊÊ$ 1
(
ÊÊ1 2
message
ÊÊ2 9
)
ÊÊ9 :
)
ÊÊ: ;
{
ÁÁ  
NotificationLogger
ËË .
.
ËË. /
	SaveError
ËË/ 8
(
ËË8 9
DateTime
ËË9 A
.
ËËA B
Now
ËËB E
,
ËËE F
message
ËËG N
,
ËËN O
item
ËËP T
)
ËËT U
;
ËËU V
}
ÈÈ 
}
ÍÍ 
catch
ÎÎ 
(
ÎÎ 
	Exception
ÎÎ $
e
ÎÎ% &
)
ÎÎ& '
{
ÏÏ 
Log
ÌÌ 
.
ÌÌ 
Error
ÌÌ !
(
ÌÌ! "
$str
ÌÌ" P
,
ÌÌP Q
e
ÌÌR S
.
ÌÌS T
ToString
ÌÌT \
(
ÌÌ\ ]
)
ÌÌ] ^
)
ÌÌ^ _
;
ÌÌ_ `
}
ÓÓ 
}
ÔÔ 
}
 
catch
ÒÒ 
(
ÒÒ 
	Exception
ÒÒ 
e
ÒÒ 
)
ÒÒ 
{
ÚÚ 
Log
ÛÛ 
.
ÛÛ 
Error
ÛÛ 
(
ÛÛ 
e
ÛÛ 
.
ÛÛ 
ToString
ÛÛ $
(
ÛÛ$ %
)
ÛÛ% &
)
ÛÛ& '
;
ÛÛ' (
}
ÙÙ 
return
ıı 
sellThrs
ıı 
.
ıı 
ToArray
ıı #
(
ıı# $
)
ıı$ %
;
ıı% &
}
ˆˆ 	
public
˜˜ 
void
˜˜ !
SetFtpConfiguration
˜˜ '
(
˜˜' (
)
˜˜( )
{
¯¯ 	
var
˘˘ 
portUserName
˘˘ 
=
˘˘ "
ConfigurationManager
˘˘ 3
.
˘˘3 4
AppSettings
˘˘4 ?
[
˘˘? @
$str
˘˘@ N
]
˘˘N O
.
˘˘O P
ToString
˘˘P X
(
˘˘X Y
)
˘˘Y Z
;
˘˘Z [
var
˙˙ 
portPassword
˙˙ 
=
˙˙ "
ConfigurationManager
˙˙ 3
.
˙˙3 4
AppSettings
˙˙4 ?
[
˙˙? @
$str
˙˙@ N
]
˙˙N O
.
˙˙O P
ToString
˙˙P X
(
˙˙X Y
)
˙˙Y Z
;
˙˙Z [
var
˚˚ 
portUrl
˚˚ 
=
˚˚ "
ConfigurationManager
˚˚ .
.
˚˚. /
AppSettings
˚˚/ :
[
˚˚: ;
$str
˚˚; E
]
˚˚E F
.
˚˚F G
ToString
˚˚G O
(
˚˚O P
)
˚˚P Q
??
˚˚R T
$str
˚˚U W
;
˚˚W X
ftpConfiguration
¸¸ 
=
¸¸ 
new
¸¸ "
FtpConfiguration
¸¸# 3
{
˝˝ 
Url
˛˛ 
=
˛˛ 
portUrl
˛˛ 
,
˛˛ 
UserName
ˇˇ 
=
ˇˇ 
portUserName
ˇˇ '
,
ˇˇ' (
Password
ÄÄ 
=
ÄÄ 
portPassword
ÄÄ '
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
private
ÉÉ 
IEnumerable
ÉÉ 
<
ÉÉ 
string
ÉÉ "
[
ÉÉ" #
]
ÉÉ# $
>
ÉÉ$ %

GetRawFile
ÉÉ& 0
(
ÉÉ0 1
string
ÉÉ1 7
fileName
ÉÉ8 @
)
ÉÉ@ A
{
ÑÑ 	
Log
ÖÖ 
.
ÖÖ 
Info
ÖÖ 
(
ÖÖ 
string
ÖÖ 
.
ÖÖ 
Format
ÖÖ "
(
ÖÖ" #
$str
ÖÖ# D
,
ÖÖD E
fileName
ÖÖF N
)
ÖÖN O
)
ÖÖO P
;
ÖÖP Q
var
ÜÜ 
listStringArray
ÜÜ 
=
ÜÜ  !
new
ÜÜ" %
List
ÜÜ& *
<
ÜÜ* +
string
ÜÜ+ 1
[
ÜÜ1 2
]
ÜÜ2 3
>
ÜÜ3 4
(
ÜÜ4 5
)
ÜÜ5 6
;
ÜÜ6 7
var
áá 
request
áá 
=
áá 
(
áá 
FtpWebRequest
áá (
)
áá( )

WebRequest
áá) 3
.
áá3 4
Create
áá4 :
(
áá: ;
fileName
áá; C
)
ááC D
;
ááD E
request
àà 
.
àà 
Method
àà 
=
àà 
WebRequestMethods
àà .
.
àà. /
Ftp
àà/ 2
.
àà2 3
DownloadFile
àà3 ?
;
àà? @
request
ââ 
.
ââ 
Credentials
ââ 
=
ââ  !
new
ââ" %
NetworkCredential
ââ& 7
(
ââ7 8
ftpConfiguration
ââ8 H
.
ââH I
UserName
ââI Q
,
ââQ R
ftpConfiguration
ââS c
.
ââc d
Password
ââd l
)
ââl m
;
ââm n
var
ää 
response
ää 
=
ää 
(
ää 
FtpWebResponse
ää *
)
ää* +
request
ää+ 2
.
ää2 3
GetResponse
ää3 >
(
ää> ?
)
ää? @
;
ää@ A
var
ãã 
responseStream
ãã 
=
ãã  
response
ãã! )
.
ãã) *
GetResponseStream
ãã* ;
(
ãã; <
)
ãã< =
;
ãã= >
var
åå 
reader
åå 
=
åå 
new
åå 
StreamReader
åå )
(
åå) *
responseStream
åå* 8
)
åå8 9
;
åå9 :
string
çç 
line
çç 
;
çç 
try
éé 
{
èè 
while
êê 
(
êê 
(
êê 
line
êê 
=
êê 
reader
êê %
.
êê% &
ReadLine
êê& .
(
êê. /
)
êê/ 0
)
êê0 1
!=
êê2 4
null
êê5 9
)
êê9 :
{
ëë 
List
íí 
<
íí 
string
íí 
>
íí  
splitedLines
íí! -
=
íí. /
line
íí0 4
.
íí4 5
Split
íí5 :
(
íí: ;
$char
íí; ?
)
íí? @
.
íí@ A
ToList
ííA G
(
ííG H
)
ííH I
;
ííI J
listStringArray
ìì #
.
ìì# $
Add
ìì$ '
(
ìì' (
splitedLines
ìì( 4
.
ìì4 5
ToArray
ìì5 <
(
ìì< =
)
ìì= >
)
ìì> ?
;
ìì? @
}
îî 
response
ïï 
.
ïï 
Close
ïï 
(
ïï 
)
ïï  
;
ïï  !
reader
ññ 
.
ññ 
Close
ññ 
(
ññ 
)
ññ 
;
ññ 
}
óó 
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 
Log
öö 
.
öö 
Error
öö 
(
öö 
e
öö 
.
öö 
Message
öö #
)
öö# $
;
öö$ %
}
õõ 
return
úú 
listStringArray
úú "
;
úú" #
}
ùù 	
}
ûû 
}üü ä
ëD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\IFtpDistributorEntegration.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
	interface &
IFtpDistributorEntegration (
{		 
FtpConfiguration

 
ftpConfiguration

 )
{

* +
get

, /
;

/ 0
}

1 2
string 
DistributorName 
{  
get! $
;$ %
}& '
Guid 
DistributorId 
{ 
get  
;  !
}" #
void 
SetFtpConfiguration  
(  !
)! "
;" #
ResultStatus !
ExportFilesToDatabase *
(* +
)+ ,
;, - 
PRD_EntegrationFiles 
[ 
] 
GetFilesInFtp ,
(, -
DateTime- 5
processDate6 A
)A B
;B C!
PRD_EntegrationAction 
[ 
] 
GetSellInFilesInFtp  3
(3 4
string4 :
fileName; C
,C D
GuidE I
entegrationFilesIdJ \
)\ ]
;] ^
string 
FileTypeName 
( 
string "
fileName# +
)+ ,
;, -
} 
} ›

ÑD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\FtpConfiguration.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public 

class 
FtpConfiguration !
{ 
public 
string 
Url 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
bool 
SearchAllDirectory &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public		 
string		 
	Directory		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
string

 
FileExtension

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
} 
} ™
ÅD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\DirectoryItem.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public 

class 
DirectoryItem 
{ 
public 
string 
BaseUri 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Password		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 
string

 
AbsolutePath

 "
{

# $
get

% (
{

) *
return

+ 1
string

2 8
.

8 9
Format

9 ?
(

? @
$str

@ I
,

I J
BaseUri

K R
,

R S
Name

T X
)

X Y
;

Y Z
}

[ \
}

] ^
public 
DateTime 
DateFileNameCreated +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
DateTime 
DateFileCreated '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
bool 
IsDirectory 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
List 
< 
DirectoryItem !
>! "
Items# (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
} 
} ê
ÉD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\FileNameWithUrl.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public		 

class		 
FileNameWithUrl		  
{

 
public 
string 
FileName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
DirectoryFileName '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
DateTime 
FileCreatedDate '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
} 
} Ç
zD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\FtpUrl.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public		 

class		 
FtpUrl		 
{

 
public 
string 
Url 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
FileType 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ‘
ÅD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\PropertyIndex.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public		 

class		 
PropertyIndex		 
{

 
public 
int 
Index 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
} 
} ∫!
ÉD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\ProcessFtpEntegration.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
{ 
public		 

class		 !
ProcessFtpEntegration		 &
:		' (
IDisposable		) 4
{

 
List 
< 
Task 
> 
Tasks 
= 
new 
List #
<# $
Task$ (
>( )
() *
)* +
;+ ,
public !
ProcessFtpEntegration $
($ %
)% &
{ 	
Log 
. 
Info 
( 
$str 5
)5 6
;6 7
} 	
public 
void 
Run 
( 
) 
{ 	
Log 
. 
Error 
( 
$str 
) 
; 
var 
taskMobitel 
= 
new !
Task" &
(& '
(' (
)( )
=>* ,
{ 
new 

FtpMobitel 
( 
)  
.  !!
ExportFilesToDatabase! 6
(6 7
)7 8
;8 9
;: ;
} 
) 
; 
Tasks 
. 
Add 
( 
taskMobitel !
)! "
;" #
var 
	taskGenpa 
= 
new 
Task  $
($ %
(% &
)& '
=>( *
{ 
new 
FtpGenpa 
( 
) 
. !
ExportFilesToDatabase 4
(4 5
)5 6
;6 7
;8 9
} 
) 
; 
Tasks 
. 
Add 
( 
	taskGenpa 
)  
;  !
var 
taskKvk 
= 
new 
Task "
(" #
(# $
)$ %
=>& (
{   
new!! 
FtpKvk!! 
(!! 
)!! 
.!! !
ExportFilesToDatabase!! 2
(!!2 3
)!!3 4
;!!4 5
;!!6 7
}"" 
)"" 
;"" 
Tasks## 
.## 
Add## 
(## 
taskKvk## 
)## 
;## 
var%% 
taskPort%% 
=%% 
new%% 
Task%% #
(%%# $
(%%$ %
)%%% &
=>%%' )
{&& 
new'' 
FtpPort'' 
('' 
)'' 
.'' !
ExportFilesToDatabase'' 3
(''3 4
)''4 5
;''5 6
;''7 8
}(( 
)(( 
;(( 
Tasks)) 
.)) 
Add)) 
()) 
taskPort)) 
))) 
;))  
foreach++ 
(++ 
var++ 
task++ 
in++  
Tasks++! &
)++& '
{,, 
task-- 
.-- 
Start-- 
(-- 
)-- 
;-- 
}.. 
}00 	
public11 
void11 
Dispose11 
(11 
)11 
{22 	
Log33 
.33 
Success33 
(33 
$str33 -
)33- .
;33. /
if44 
(44 
Tasks44 
!=44 
null44 
&&44  
Tasks44! &
.44& '
Count44' ,
>44- .
$num44/ 0
)440 1
{55 
foreach66 
(66 
var66 
task66 !
in66" $
Tasks66% *
)66* +
{77 
task88 
.88 
Dispose88  
(88  !
)88! "
;88" #
}99 
Tasks:: 
=:: 
new:: 
List::  
<::  !
Task::! %
>::% &
(::& '
)::' (
;::( )
};; 
}<< 	
}== 
}>> ä
zD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Utils\Finder.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Utils6 ;
{ 
public 

class 
Finder 
{ 
public		 
static		 
VWPRD_Inventory		 %
FindInventory		& 3
(		3 4
string		4 :
serialNumber		; G
,		G H
string		I O
imei		P T
)		T U
{

 	
var 
db 
= 
new 
WorkOfTimeDatabase +
(+ ,
), -
;- .
return 
db 
. .
"GetPRD_InventoryBySerialCodeOrImei 8
(8 9
serialNumber9 E
,E F
imeiG K
)K L
;L M
} 	
public 
static 
VWCMP_Invoice #
FindInvoice$ /
(/ 0
string0 6
	invoiceId7 @
)@ A
{ 	
var 
db 
= 
new 
WorkOfTimeDatabase +
(+ ,
), -
;- .
return 
db 
.  
GetVWCMP_InvoiceById *
(* +
new+ .
Guid/ 3
(3 4
	invoiceId4 =
)= >
)> ?
;? @
} 	
public 
static 
Guid 
? 
FindCompany '
(' (!
PRD_EntegrationAction( =
item> B
)B C
{ 	
var 
db 
= 
new 
WorkOfTimeDatabase +
(+ ,
), -
;- .
var 
getByCompany 
= 
db !
.! "-
!GetVWCMP_CompanyByTaxNumberOrCode" C
(C D
itemE I
.I J 
CustomerOperatorCodeJ ^
,^ _
item` d
.d e
	TaxNumbere n
)n o
;o p
var 
getByStorage 
= 
db !
.! ""
GetVWCMP_StorageByCode" 8
(8 9
item: >
.> ? 
CustomerOperatorCode? S
)S T
;T U
if 
( 
getByCompany 
!= 
null  $
)$ %
{ 
return 
getByCompany #
.# $
id$ &
;& '
} 
if 
( 
getByStorage 
!= 
null  $
)$ %
{ 
var  
findCompanyByStorage (
=) *
db+ -
.- .
GetCMP_CompanyById. @
(@ A
getByStorageA M
.M N
	companyIdN W
.W X
ValueX ]
)] ^
;^ _
if   
(    
findCompanyByStorage   (
!=  ( *
null  * .
)  . /
{!! 
return""  
findCompanyByStorage"" /
.""/ 0
id""0 2
;""2 3
}## 
}$$ 
return%% 
null%% 
;%% 
}'' 	
public)) 
static)) 
VWCMP_Storage)) #
FindStorage))$ /
())/ 0
string))0 6
name))7 ;
,)); <
string))= C
code))D H
)))H I
{** 	
var++ 
db++ 
=++ 
new++ 
WorkOfTimeDatabase++ +
(+++ ,
)++, -
;++- .
return,, 
db,, 
.,, (
GetVWCMP_StorageByNameOrCode,, 2
(,,2 3
name,,3 7
,,,7 8
code,,9 =
),,= >
;,,> ?
}-- 	
}.. 
}// €K
yD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Utils\Tools.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Utils6 ;
{ 
public 

class 
Tools 
{ 
public 
static 
bool 
IsDir  
(  !
string! '
value( -
)- .
{ 	
return 
value 
. 
Contains !
(! "
$str" )
)) *
;* +
} 	
public 
static 
DateTime 
GetDate &
(& '
string' -
value. 3
)3 4
{ 	
var 
date 
= 
value 
. 
	Substring &
(& '
$num' (
,( )
$num* ,
), -
;- .
return 
DateTime 
. 
Parse !
(! "
date" &
,& '
CultureInfo( 3
.3 4
InvariantCulture4 D
)D E
;E F
} 	
public 
static 
string 
GetItemName (
(( )
string) /
line0 4
)4 5
{ 	
return 
line 
. 
	Substring !
(! "
$num" $
)$ %
;% &
} 	
public 
static 
DateTime 
GetDateFromFileName 2
(2 3
string3 9
fileName: B
,B C
stringD J
dateTimeFormatK Y
)Y Z
{   	
if!! 
(!! 
fileName!! 
.!! 
Contains!! !
(!!! "
$str!!" *
)!!* +
)!!+ ,
{"" 
fileName## 
=## 
fileName## #
.### $
	Substring##$ -
(##- .
$num##. /
)##/ 0
;##0 1
fileName$$ 
=$$ 
fileName$$ #
.$$# $
Split$$$ )
($$) *
$char$$* -
)$$- .
[$$. /
$num$$/ 0
]$$0 1
;$$1 2
return%% 
DateTime%% 
.%%  

ParseExact%%  *
(%%* +
fileName%%+ 3
,%%3 4
dateTimeFormat%%5 C
,%%C D
CultureInfo%%E P
.%%P Q
InvariantCulture%%Q a
)%%a b
;%%b c
}&& 
else'' 
if'' 
('' 
fileName'' 
.'' 
Contains'' %
(''% &
$str''& /
)''/ 0
)''0 1
{(( 
fileName** 
=** 
fileName** #
.**# $
	Substring**$ -
(**- .
$num**. /
)**/ 0
;**0 1
fileName++ 
=++ 
fileName++ #
.++# $
Split++$ )
(++) *
$char++* -
)++- .
[++. /
$num++/ 0
]++0 1
;++1 2
return,, 
DateTime,, 
.,,  

ParseExact,,  *
(,,* +
fileName,,+ 3
,,,3 4
dateTimeFormat,,5 C
,,,C D
CultureInfo,,E P
.,,P Q
InvariantCulture,,Q a
),,a b
;,,b c
}-- 
return.. 
new.. 
DateTime.. 
(..  
$num..  $
,..$ %
$num..% &
,..& '
$num..' (
)..( )
;..) *
}11 	
public22 
static22 
DateTime22 *
GetDateFromFileNameForMobiltel22 =
(22= >
string22> D
fileName22E M
,22M N
string22O U
dateTimeFormat22V d
)22d e
{33 	
if44 
(44 
fileName44 
.44 
Contains44 !
(44! "
$str44" *
)44* +
)44+ ,
{55 
fileName66 
=66 
fileName66 #
.66# $
	Substring66$ -
(66- .
$num66. 0
)660 1
;661 2
fileName77 
=77 
fileName77 #
.77# $
Split77$ )
(77) *
$char77* -
)77- .
[77. /
$num77/ 0
]770 1
;771 2
return88 
DateTime88 
.88  

ParseExact88  *
(88* +
fileName88+ 3
,883 4
dateTimeFormat885 C
,88C D
CultureInfo88E P
.88P Q
InvariantCulture88Q a
)88a b
;88b c
}99 
else:: 
if:: 
(:: 
fileName:: 
.:: 
Contains:: &
(::& '
$str::' 0
)::0 1
)::1 2
{;; 
fileName== 
=== 
fileName== #
.==# $
	Substring==$ -
(==- .
$num==. /
)==/ 0
;==0 1
fileName>> 
=>> 
fileName>> #
.>># $
Split>>$ )
(>>) *
$char>>* -
)>>- .
[>>. /
$num>>/ 0
]>>0 1
;>>1 2
return?? 
DateTime?? 
.??  

ParseExact??  *
(??* +
fileName??+ 3
,??3 4
dateTimeFormat??5 C
,??C D
CultureInfo??E P
.??P Q
InvariantCulture??Q a
)??a b
;??b c
}@@ 
returnAA 
newAA 
DateTimeAA 
(AA  
$numAA  $
,AA$ %
$numAA& '
,AA' (
$numAA) *
)AA* +
;AA+ ,
}DD 	
publicEE 
staticEE 
DateTimeEE '
GetDateFromFileNameForGenpaEE :
(EE: ;
stringEE; A
fileNameEEB J
,EEJ K
stringEEL R
dateTimeFormatEES a
)EEa b
{FF 	
ifGG 
(GG 
fileNameGG 
.GG 
ContainsGG !
(GG! "
$strGG" *
)GG* +
)GG+ ,
{HH 
fileNameII 
=II 
fileNameII #
.II# $
	SubstringII$ -
(II- .
$numII. /
)II/ 0
;II0 1
fileNameJJ 
=JJ 
fileNameJJ #
.JJ# $
	SubstringJJ$ -
(JJ- .
$numJJ. /
,JJ/ 0
fileNameJJ1 9
.JJ9 :
LengthJJ: @
-JJA B
$numJJC E
)JJE F
;JJF G
fileNameKK 
=KK 
fileNameKK #
.KK# $
SplitKK$ )
(KK) *
$charKK* -
)KK- .
[KK. /
$numKK/ 0
]KK0 1
;KK1 2
returnLL 
DateTimeLL 
.LL  

ParseExactLL  *
(LL* +
fileNameLL+ 3
,LL3 4
dateTimeFormatLL5 C
,LLC D
CultureInfoLLE P
.LLP Q
InvariantCultureLLQ a
)LLa b
;LLb c
}MM 
elseNN 
{OO 
fileNamePP 
=PP 
fileNamePP #
.PP# $
	SubstringPP$ -
(PP- .
$numPP. /
)PP/ 0
;PP0 1
fileNameQQ 
=QQ 
fileNameQQ #
.QQ# $
	SubstringQQ$ -
(QQ- .
$numQQ. /
,QQ/ 0
fileNameQQ1 9
.QQ9 :
LengthQQ: @
-QQA B
$numQQC E
)QQE F
;QQF G
fileNameRR 
=RR 
fileNameRR #
.RR# $
SplitRR$ )
(RR) *
$charRR* -
)RR- .
[RR. /
$numRR/ 0
]RR0 1
;RR1 2
returnTT 
DateTimeTT 
.TT  

ParseExactTT  *
(TT* +
fileNameTT+ 3
,TT3 4
dateTimeFormatTT5 C
,TTC D
CultureInfoTTE P
.TTP Q
InvariantCultureTTQ a
)TTa b
;TTb c
}UU 
}VV 	
publicWW 
staticWW 
GuidWW 

AddStorageWW %
(WW% &!
PRD_EntegrationActionWW& ;
itemWW< @
)WW@ A
{XX 	
varYY 
dbYY 
=YY 
newYY 
WorkOfTimeDatabaseYY +
(YY+ ,
)YY, -
;YY- .
varZZ 
idZZ 
=ZZ 
GuidZZ 
.ZZ 
NewGuidZZ !
(ZZ! "
)ZZ" #
;ZZ# $
db[[ 
.[[ 
InsertCMP_Company[[  
([[  !
new[[! $
CMP_Company[[% 0
{\\ 
id]] 
=]] 
id]] 
,]] 
code^^ 
=^^ 
item^^ 
.^^  
CustomerOperatorCode^^ 0
,^^0 1
created__ 
=__ 
DateTime__ "
.__" #
Now__# &
,__& '
	createdby`` 
=`` 
Guid``  
.``  !
Empty``! &
,``& '
nameaa 
=aa 
itemaa 
.aa  
CustomerOperatorNameaa 0
,aa0 1
descriptionbb 
=bb 
$strbb 8
,bb8 9
	taxNumbercc 
=cc 
itemcc  
.cc  !
	TaxNumbercc! *
,cc* +
piddd 
=dd 
itemdd 
.dd 
DistributorIddd (
}ee 
)ee 
;ee 
returnff 
idff 
;ff 
}gg 	
}hh 
}ii ¯á
aD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Log.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
{ 
public 

sealed 
class 
ErrorLogInformation +
:, -
IDisposable. 9
{ 
private 
static 
string 
ApplicationName -
{ 	
get 
{ 
if 
( 
System 
. 
Configuration (
.( ) 
ConfigurationManager) =
.= >
AppSettings> I
[I J
$strJ [
][ \
!=] _
null` d
)d e
{ 
return 
System !
.! "
Configuration" /
./ 0 
ConfigurationManager0 D
.D E
AppSettingsE P
[P Q
$strQ b
]b c
.c d
ToStringd l
(l m
)m n
;n o
} 
return 
$str 7
;7 8
} 
} 	
public 
static 
string 
LogMailUsers )
{   	
get!! 
{"" 
if$$ 
($$ 
System$$ 
.$$ 
Configuration$$ (
.$$( ) 
ConfigurationManager$$) =
.$$= >
AppSettings$$> I
[$$I J
$str$$J X
]$$X Y
!=$$Z \
null$$] a
)$$a b
{%% 
return&& 
System&& !
.&&! "
Configuration&&" /
.&&/ 0 
ConfigurationManager&&0 D
.&&D E
AppSettings&&E P
[&&P Q
$str&&Q _
]&&_ `
.&&` a
ToString&&a i
(&&i j
)&&j k
;&&k l
}'' 
return)) 
$str)) 4
;))4 5
}++ 
},, 	
private.. 
static.. 
int.. 
?.. 
LastMailSendHour.. ,
{..- .
get../ 2
;..2 3
set..4 7
;..7 8
}..9 :
private00 
static00 
List00 
<00 
ErrorInformation00 ,
>00, -
Errors00. 4
{005 6
get007 :
;00: ;
set00< ?
;00? @
}00A B
private22 
static22 
Thread22 
TaskManager22 )
{22* +
get22, /
;22/ 0
set221 4
;224 5
}226 7
private44 
static44 
void44 
SendMail44 $
(44$ %
)44% &
{55 	
try77 
{88 
var99 
header99 
=99 
$str99 W
;99W X
try;; 
{<< 
header== 
=== 
$str== A
+==B C
(>> 
!>> 
String>>  
.>>  !
IsNullOrEmpty>>! .
(>>. /
Environment>>/ :
.>>: ;
MachineName>>; F
)>>F G
?>>H I
Environment>>J U
.>>U V
MachineName>>V a
:>>b c
HttpContext>>d o
.>>o p
Current>>p w
!=>>x z
null>>{ 
?
>>Ä Å
HttpContext
>>Ç ç
.
>>ç é
Current
>>é ï
.
>>ï ñ
Server
>>ñ ú
.
>>ú ù
MachineName
>>ù ®
:
>>© ™
$str
>>´ ≠
)
>>≠ Æ
+
>>Ø ∞
$str?? 
+??  !
header@@ 
;@@ 
}AA 
catchBB 
(BB 
	ExceptionBB  
exBB! #
)BB# $
{BB% &
}BB' (
headerDD 
+=DD 
$strDD K
+DDL M
ApplicationNameDDN ]
+DD^ _
$strDD` g
;DDg h
varFF 
tblFF 
=FF 
$strFF G
+FFH I
$strGG 
+GG 
$strHH 
+HH 
$strII (
+II) *
$strII+ 2
+II3 4
$strII5 <
+II= >
$strJJ (
+JJ) *
$strJJ+ 6
+JJ7 8
$strJJ9 @
+JJA B
$strKK 
+KK 
$strKK $
+KK% &
$strKK' .
+KK/ 0
$strLL 
+LL 
$strLL "
+LL# $
$strLL% ,
+LL- .
$strMM 
+MM 
$strMM !
+MM" #
$strMM$ +
+MM, -
$strNN 
+NN 
$strNN +
+NN, -
$strNN. 5
+NN6 7
$strOO 
+OO 
$strPP 
;PP 
tblRR 
+=RR 
$strRR  
+RR! "
StringRR# )
.RR) *
JoinRR* .
(RR. /
$strRR/ 1
,RR1 2
ErrorsRR3 9
.RR9 :
SelectRR: @
(RR@ A
aRRA B
=>RRC E
aRRF G
.RRG H
TableRowRRH P
)RRP Q
)RRQ R
+RRS T
$strRRU _
+RR` a
$strSS 
;SS 
newUU 
EmailUU 
(UU 
)UU 
.UU 
SendUU  
(UU  !
$numUU! $
,UU$ %
LogMailUsersUU& 2
,UU2 3
headerUU4 :
,UU: ;
headerUU< B
+UUC D
tblUUE H
,UUH I
trueUUJ N
,UUN O
falseUUP U
)UUU V
;UUV W
ErrorsWW 
.WW 
ClearWW 
(WW 
)WW 
;WW 
}XX 
catchYY 
(YY 
	ExceptionYY 
exYY 
)YY  
{YY! "
ConsoleYY# *
.YY* +
	WriteLineYY+ 4
(YY4 5
exYY5 7
)YY7 8
;YY8 9
}YY: ;
}[[ 	
public]] 
static]] 
string]] 
GetKeyValues]] )
(]]) *
)]]* +
{^^ 	
try`` 
{aa 
ifbb 
(bb 
HttpContextbb 
.bb  
Currentbb  '
==bb( *
nullbb+ /
)bb/ 0
{cc 
returndd 
$strdd 
;dd 
}ee 
returngg 
Infolinegg 
.gg  
Helpergg  &
.gg& '
Jsongg' +
.gg+ ,
	Serializegg, 5
(gg5 6
HttpContextgg6 A
.ggA B
CurrentggB I
.ggI J
RequestggJ Q
.ggQ R
FormggR V
.ggV W
AllKeysggW ^
.hh 
ToDictionaryhh !
(hh! "
keyii 
=>ii 
keyii "
,ii" #
valjj 
=>jj 
HttpContextjj *
.jj* +
Currentjj+ 2
.jj2 3
Requestjj3 :
.jj: ;
Formjj; ?
[jj? @
valjj@ C
]jjC D
)kk 
)kk 
;kk 
}mm 
catchnn 
{oo 
returnpp 
$strpp 
;pp 
}qq 
}ss 	
publicuu 
staticuu 
voiduu 
	SaveErroruu $
(uu$ %
DateTimeuu% -
dateuu. 2
,uu2 3
stringuu4 :
messageuu; B
)uuB C
{vv 	
tryxx 
{yy 
if{{ 
({{ 
Errors{{ 
=={{ 
null{{ "
){{" #
{|| 
Errors}} 
=}} 
new}}  
List}}! %
<}}% &
ErrorInformation}}& 6
>}}6 7
(}}7 8
)}}8 9
;}}9 :
}~~ 
if
íí 
(
íí 
TaskManager
íí 
==
íí  "
null
íí# '
)
íí' (
{
ìì 
TaskManager
ïï 
=
ïï  !
new
ïï" %
Thread
ïï& ,
(
ïï, -
new
ïï- 0
ThreadStart
ïï1 <
(
ïï< =
delegate
ïï= E
{
ññ 
if
òò 
(
òò 
!
òò 
LastMailSendHour
òò -
.
òò- .
HasValue
òò. 6
)
òò6 7
{
ôô 
LastMailSendHour
öö ,
=
öö- .
DateTime
öö/ 7
.
öö7 8
Now
öö8 ;
.
öö; <
Hour
öö< @
-
ööA B
$num
ööC D
;
ööD E
}
õõ 
while
ùù 
(
ùù 
true
ùù #
)
ùù# $
{
ûû 
if
†† 
(
††  
LastMailSendHour
††  0
<
††1 2
DateTime
††3 ;
.
††; <
Now
††< ?
.
††? @
Hour
††@ D
&&
††E G
Errors
††H N
.
††N O
Count
††O T
(
††T U
)
††U V
>
††W X
$num
††Y Z
)
††Z [
{
°° 
SendMail
££  (
(
££( )
)
££) *
;
££* +
LastMailSendHour
§§  0
=
§§1 2
DateTime
§§3 ;
.
§§; <
Now
§§< ?
.
§§? @
Hour
§§@ D
;
§§D E
}
¶¶ 
System
®® "
.
®®" #
	Threading
®®# ,
.
®®, -
Thread
®®- 3
.
®®3 4
Sleep
®®4 9
(
®®9 :
$num
®®: >
*
®®? @
$num
®®A C
)
®®C D
;
®®D E
}
™™ 
}
¨¨ 
)
¨¨ 
)
¨¨ 
;
¨¨ 
TaskManager
ÆÆ 
.
ÆÆ  
Start
ÆÆ  %
(
ÆÆ% &
)
ÆÆ& '
;
ÆÆ' (
}
∞∞ 
}
≤≤ 
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
ex
≥≥ 
)
≥≥  
{
¥¥ 
Console
µµ 
.
µµ 
	WriteLine
µµ !
(
µµ! "
$str
µµ" :
+
µµ; <
$str
µµ= A
+
µµB C
ex
µµD F
.
µµF G
Message
µµG N
,
µµN O
null
µµP T
,
µµT U
false
µµV [
)
µµ[ \
;
µµ\ ]
}
∂∂ 
}
∏∏ 	
public
∫∫ 
void
∫∫ 
Dispose
∫∫ 
(
∫∫ 
)
∫∫ 
{
ªª 	
SendMail
ºº 
(
ºº 
)
ºº 
;
ºº 
TaskManager
ΩΩ 
.
ΩΩ 
Abort
ΩΩ 
(
ΩΩ 
)
ΩΩ 
;
ΩΩ  
}
ææ 	
}
¿¿ 
public
¬¬ 

class
¬¬ 
ErrorInformation
¬¬ !
{
√√ 
public
ƒƒ 
string
ƒƒ 
UserName
ƒƒ 
{
ƒƒ  
get
ƒƒ! $
;
ƒƒ$ %
set
ƒƒ& )
;
ƒƒ) *
}
ƒƒ+ ,
public
≈≈ 
string
≈≈ 
Url
≈≈ 
{
≈≈ 
get
≈≈ 
;
≈≈  
set
≈≈! $
;
≈≈$ %
}
≈≈& '
public
∆∆ 
string
∆∆ 
Message
∆∆ 
{
∆∆ 
get
∆∆  #
;
∆∆# $
set
∆∆% (
;
∆∆( )
}
∆∆* +
public
«« 
DateTime
«« 
Date
«« 
{
«« 
get
«« "
;
««" #
set
««$ '
;
««' (
}
««) *
public
»» 
string
»» 
IP
»» 
{
»» 
get
»» 
;
»» 
set
»»  #
;
»»# $
}
»»% &
public
…… 
string
…… 
Params
…… 
{
…… 
get
…… "
;
……" #
set
……$ '
;
……' (
}
……) *
public
   
string
   
TableRow
   
{
ÀÀ 	
get
ÃÃ 
{
ÕÕ 
return
œœ 
$str
œœ 
+
œœ 
$str
–– 
+
–– 
Date
–– !
.
––! "
ToString
––" *
(
––* +
$str
––+ @
)
––@ A
+
––B C
$str
––D K
+
––L M
$str
—— 
+
—— 
UserName
—— %
+
——& '
$str
——( /
+
——0 1
$str
““ 
+
““ 
Message
““ $
+
““% &
$str
““' .
+
““/ 0
$str
”” 
+
”” 
Url
””  
+
””! "
$str
””# *
+
””+ ,
$str
‘‘ 
+
‘‘ 
IP
‘‘ 
+
‘‘  !
$str
‘‘" )
+
‘‘* +
$str
’’ 
+
’’ 
Params
’’ #
+
’’$ %
$str
’’& -
+
’’. /
$str
÷÷ 
;
÷÷ 
}
ÿÿ 
}
ŸŸ 	
}
⁄⁄ 
public
‹‹ 

enum
‹‹ 
LogMessageType
‹‹ 
{
›› 
Info
ﬁﬁ 
=
ﬁﬁ 
$num
ﬁﬁ 
,
ﬁﬁ 
Success
ﬂﬂ 
=
ﬂﬂ 
$num
ﬂﬂ 
,
ﬂﬂ 
Warning
‡‡ 
=
‡‡ 
$num
‡‡ 
,
‡‡ 
Error
·· 
=
·· 
$num
·· 
,
·· 
}
‚‚ 
public
‰‰ 

class
‰‰ 
Log
‰‰ 
{
ÂÂ 
public
ÊÊ 
delegate
ÊÊ 
void
ÊÊ !
RestartEventHandler
ÊÊ 0
(
ÊÊ0 1
)
ÊÊ1 2
;
ÊÊ2 3
public
ÁÁ 
static
ÁÁ 
event
ÁÁ !
RestartEventHandler
ÁÁ /
RestartEvent
ÁÁ0 <
;
ÁÁ< =
public
ËË 
delegate
ËË 
void
ËË 
StopEventHandler
ËË -
(
ËË- .
)
ËË. /
;
ËË/ 0
public
ÈÈ 
static
ÈÈ 
event
ÈÈ 
StopEventHandler
ÈÈ ,
	StopEvent
ÈÈ- 6
;
ÈÈ6 7
static
ÎÎ 
string
ÎÎ 
FILE
ÎÎ 
=
ÎÎ 
$str
ÎÎ 
;
ÎÎ  
static
ÏÏ 
string
ÏÏ 
FILEERR
ÏÏ 
=
ÏÏ 
$str
ÏÏ  "
;
ÏÏ" #
static
ÌÌ 
bool
ÌÌ 
_start
ÌÌ 
=
ÌÌ 
true
ÌÌ !
;
ÌÌ! "
static
ÓÓ 
bool
ÓÓ 
_reset
ÓÓ 
=
ÓÓ 
false
ÓÓ "
;
ÓÓ" #
static
ÔÔ 
object
ÔÔ 
sync
ÔÔ 
=
ÔÔ 
new
ÔÔ  
object
ÔÔ! '
(
ÔÔ' (
)
ÔÔ( )
;
ÔÔ) *
public
ÒÒ 
static
ÒÒ 
bool
ÒÒ 
START
ÒÒ  
{
ÚÚ 	
get
ÛÛ 
{
ÛÛ 
return
ÛÛ 
_start
ÛÛ 
;
ÛÛ  
}
ÛÛ! "
set
ÙÙ 
{
ıı 
_start
ˆˆ 
=
ˆˆ 
value
ˆˆ 
;
ˆˆ 
if
˜˜ 
(
˜˜ 
!
˜˜ 
_start
˜˜ 
)
˜˜ 
if
¯¯ 
(
¯¯ 
	StopEvent
¯¯ !
!=
¯¯" $
null
¯¯% )
)
¯¯) *
	StopEvent
˘˘ !
(
˘˘! "
)
˘˘" #
;
˘˘# $
}
˙˙ 
}
˚˚ 	
public
˝˝ 
static
˝˝ 
bool
˝˝ 
RESET
˝˝  
{
˛˛ 	
get
ˇˇ 
{
ˇˇ 
return
ˇˇ 
_reset
ˇˇ 
;
ˇˇ  
}
ˇˇ! "
set
ÄÄ 
{
ÅÅ 
_reset
ÇÇ 
=
ÇÇ 
value
ÇÇ 
;
ÇÇ 
if
ÉÉ 
(
ÉÉ 
_reset
ÉÉ 
)
ÉÉ 
{
ÑÑ 
_start
ÖÖ 
=
ÖÖ 
false
ÖÖ "
;
ÖÖ" #
if
ÜÜ 
(
ÜÜ 
RestartEvent
ÜÜ $
!=
ÜÜ% '
null
ÜÜ( ,
)
ÜÜ, -
{
áá 
RestartEvent
àà $
(
àà$ %
)
àà% &
;
àà& '
Warning
ââ 
(
ââ  
$str
ââ  '
)
ââ' (
;
ââ( )
FILE
ää 
=
ää 
$str
ää !
;
ää! "
}
ãã 
}
åå 
}
çç 
}
éé 	
private
êê 
static
êê 

Dictionary
êê !
<
êê! "
LogMessageType
êê" 0
,
êê0 1
ConsoleColor
êê2 >
>
êê> ?
ConsoleColors
êê@ M
{
ëë 	
get
íí 
{
ìì 
return
îî 
new
îî 

Dictionary
îî %
<
îî% &
LogMessageType
îî& 4
,
îî4 5
ConsoleColor
îî6 B
>
îîB C
{
ïï 
{
ññ 
LogMessageType
ññ $
.
ññ$ %
Info
ññ% )
,
ññ) *
ConsoleColor
ññ+ 7
.
ññ7 8
Gray
ññ8 <
}
ññ= >
,
ññ> ?
{
óó 
LogMessageType
óó $
.
óó$ %
Success
óó% ,
,
óó, -
ConsoleColor
óó. :
.
óó: ;
Green
óó; @
}
óóA B
,
óóB C
{
òò 
LogMessageType
òò $
.
òò$ %
Warning
òò% ,
,
òò, -
ConsoleColor
òò. :
.
òò: ;
Yellow
òò; A
}
òòB C
,
òòC D
{
ôô 
LogMessageType
ôô $
.
ôô$ %
Error
ôô% *
,
ôô* +
ConsoleColor
ôô, 8
.
ôô8 9
Red
ôô9 <
}
ôô= >
,
ôô> ?
}
öö 
;
öö 
}
õõ 
}
úú 	
private
ûû 
static
ûû 
void
ûû 
	WriteTime
ûû %
(
ûû% &
)
ûû& '
{
üü 	
	WriteTime
†† 
(
†† 
false
†† 
)
†† 
;
†† 
}
°° 	
private
££ 
static
££ 
void
££ 
	WriteTime
££ %
(
££% &
bool
££& *
errorconsole
££+ 7
)
££7 8
{
§§ 	
lock
•• 
(
•• 
sync
•• 
)
•• 
{
¶¶ 
try
ßß 
{
®® 
Console
©© 
.
©© 
ForegroundColor
©© +
=
©©, -
ConsoleColor
©©. :
.
©©: ;
DarkGray
©©; C
;
©©C D
if
™™ 
(
™™ 
errorconsole
™™ $
)
™™$ %
{
´´ 
Console
¨¨ 
.
¨¨  
Error
¨¨  %
.
¨¨% &
Write
¨¨& +
(
¨¨+ ,
DateTime
¨¨, 4
.
¨¨4 5
Now
¨¨5 8
.
¨¨8 9
ToString
¨¨9 A
(
¨¨A B
)
¨¨B C
.
¨¨C D
PadRight
¨¨D L
(
¨¨L M
$num
¨¨M O
)
¨¨O P
+
¨¨Q R
$str
¨¨S V
)
¨¨V W
;
¨¨W X
}
≠≠ 
else
ÆÆ 
{
ØØ 
Console
∞∞ 
.
∞∞  
Write
∞∞  %
(
∞∞% &
DateTime
∞∞& .
.
∞∞. /
Now
∞∞/ 2
.
∞∞2 3
ToString
∞∞3 ;
(
∞∞; <
)
∞∞< =
.
∞∞= >
PadRight
∞∞> F
(
∞∞F G
$num
∞∞G I
)
∞∞I J
+
∞∞K L
$str
∞∞M P
)
∞∞P Q
;
∞∞Q R
}
±± 
Console
≤≤ 
.
≤≤ 

ResetColor
≤≤ &
(
≤≤& '
)
≤≤' (
;
≤≤( )
}
≥≥ 
catch
¥¥ 
{
µµ 
}
∂∂ 
}
∑∑ 
}
∏∏ 	
public
∫∫ 
static
∫∫ 
void
∫∫ 
Info
∫∫ 
(
∫∫  
string
∫∫  &
message
∫∫' .
,
∫∫. /
params
∫∫0 6
object
∫∫7 =
[
∫∫= >
]
∫∫> ?

parameters
∫∫@ J
)
∫∫J K
{
ªª 	
lock
ºº 
(
ºº 
sync
ºº 
)
ºº 
{
ΩΩ 
	WriteTime
ææ 
(
ææ 
)
ææ 
;
ææ 
try
øø 
{
¿¿ 
Console
¡¡ 
.
¡¡ 
ForegroundColor
¡¡ +
=
¡¡, -
ConsoleColor
¡¡. :
.
¡¡: ;
Gray
¡¡; ?
;
¡¡? @
Console
¬¬ 
.
¬¬ 
	WriteLine
¬¬ %
(
¬¬% &
string
¬¬& ,
.
¬¬, -
Format
¬¬- 3
(
¬¬3 4
message
¬¬4 ;
,
¬¬; <

parameters
¬¬= G
)
¬¬G H
)
¬¬H I
;
¬¬I J
Save
√√ 
(
√√ 
string
√√ 
.
√√  
Format
√√  &
(
√√& '
message
√√' .
,
√√. /

parameters
√√0 :
)
√√: ;
)
√√; <
;
√√< =
}
≈≈ 
catch
∆∆ 
{
«« 
}
»» 
}
…… 
}
   	
public
ÃÃ 
static
ÃÃ 
void
ÃÃ 
Success
ÃÃ "
(
ÃÃ" #
string
ÃÃ# )
message
ÃÃ* 1
,
ÃÃ1 2
params
ÃÃ3 9
object
ÃÃ: @
[
ÃÃ@ A
]
ÃÃA B

parameters
ÃÃC M
)
ÃÃM N
{
ÕÕ 	
lock
ŒŒ 
(
ŒŒ 
sync
ŒŒ 
)
ŒŒ 
{
œœ 
	WriteTime
–– 
(
–– 
)
–– 
;
–– 
try
—— 
{
““ 
Console
”” 
.
”” 
ForegroundColor
”” +
=
””, -
ConsoleColor
””. :
.
””: ;
Green
””; @
;
””@ A
Console
‘‘ 
.
‘‘ 
	WriteLine
‘‘ %
(
‘‘% &
string
‘‘& ,
.
‘‘, -
Format
‘‘- 3
(
‘‘3 4
message
‘‘4 ;
,
‘‘; <

parameters
‘‘= G
)
‘‘G H
)
‘‘H I
;
‘‘I J
Save
’’ 
(
’’ 
string
’’ 
.
’’  
Format
’’  &
(
’’& '
message
’’' .
,
’’. /

parameters
’’0 :
)
’’: ;
)
’’; <
;
’’< =
}
÷÷ 
catch
◊◊ 
{
ÿÿ 
}
ŸŸ 
}
⁄⁄ 
}
€€ 	
public
›› 
static
›› 
void
›› 
Error
››  
(
››  !
string
››! '
message
››( /
,
››/ 0
params
››1 7
object
››8 >
[
››> ?
]
››? @

parameters
››A K
)
››K L
{
ﬁﬁ 	
lock
ﬂﬂ 
(
ﬂﬂ 
sync
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
	WriteTime
·· 
(
·· 
true
·· 
)
·· 
;
··  
try
‚‚ 
{
„„ 
Console
ÂÂ 
.
ÂÂ 
ForegroundColor
ÂÂ +
=
ÂÂ, -
ConsoleColor
ÂÂ. :
.
ÂÂ: ;
Red
ÂÂ; >
;
ÂÂ> ?
Console
ÊÊ 
.
ÊÊ 
	WriteLine
ÊÊ %
(
ÊÊ% &
string
ÊÊ& ,
.
ÊÊ, -
Format
ÊÊ- 3
(
ÊÊ3 4
message
ÊÊ4 ;
,
ÊÊ; <

parameters
ÊÊ= G
)
ÊÊG H
)
ÊÊH I
;
ÊÊI J
Console
ÁÁ 
.
ÁÁ 

ResetColor
ÁÁ &
(
ÁÁ& '
)
ÁÁ' (
;
ÁÁ( )
SaveERR
ÈÈ 
(
ÈÈ 
string
ÈÈ "
.
ÈÈ" #
Format
ÈÈ# )
(
ÈÈ) *
message
ÈÈ* 1
,
ÈÈ1 2

parameters
ÈÈ3 =
)
ÈÈ= >
)
ÈÈ> ?
;
ÈÈ? @
}
ÎÎ 
catch
ÏÏ 
(
ÏÏ 
	Exception
ÏÏ  
ex
ÏÏ! #
)
ÏÏ# $
{
ÌÌ 
}
ÓÓ 
}
ÔÔ 
}
 	
public
ÚÚ 
static
ÚÚ 
void
ÚÚ 
ConsoleMessage
ÚÚ )
(
ÚÚ) *
LogMessageType
ÚÚ* 8
type
ÚÚ9 =
,
ÚÚ= >
string
ÚÚ? E
message
ÚÚF M
)
ÚÚM N
{
ÛÛ 	
lock
ÙÙ 
(
ÙÙ 
sync
ÙÙ 
)
ÙÙ 
{
ıı 
	WriteTime
ˆˆ 
(
ˆˆ 
true
ˆˆ 
)
ˆˆ 
;
ˆˆ  
try
˜˜ 
{
¯¯ 
Console
˘˘ 
.
˘˘ 
ForegroundColor
˘˘ +
=
˘˘, -
ConsoleColor
˘˘. :
.
˘˘: ;
Yellow
˘˘; A
;
˘˘A B
Console
˙˙ 
.
˙˙ 
	WriteLine
˙˙ %
(
˙˙% &
string
˙˙& ,
.
˙˙, -
Format
˙˙- 3
(
˙˙3 4
message
˙˙4 ;
,
˙˙; <
ConsoleColors
˙˙= J
[
˙˙J K
type
˙˙K O
]
˙˙O P
)
˙˙P Q
)
˙˙Q R
;
˙˙R S
Console
˚˚ 
.
˚˚ 

ResetColor
˚˚ &
(
˚˚& '
)
˚˚' (
;
˚˚( )
}
¸¸ 
catch
˝˝ 
{
˛˛ 
}
ˇˇ 
}
ÄÄ 
}
ÅÅ 	
public
ÉÉ 
static
ÉÉ 
void
ÉÉ 
Warning
ÉÉ "
(
ÉÉ" #
string
ÉÉ# )
message
ÉÉ* 1
,
ÉÉ1 2
params
ÉÉ3 9
object
ÉÉ: @
[
ÉÉ@ A
]
ÉÉA B

parameters
ÉÉC M
)
ÉÉM N
{
ÑÑ 	
lock
ÖÖ 
(
ÖÖ 
sync
ÖÖ 
)
ÖÖ 
{
ÜÜ 
	WriteTime
áá 
(
áá 
true
áá 
)
áá 
;
áá  
try
àà 
{
ââ 
Console
ää 
.
ää 
ForegroundColor
ää +
=
ää, -
ConsoleColor
ää. :
.
ää: ;
Yellow
ää; A
;
ääA B
Console
ãã 
.
ãã 
	WriteLine
ãã %
(
ãã% &
string
ãã& ,
.
ãã, -
Format
ãã- 3
(
ãã3 4
message
ãã4 ;
,
ãã; <

parameters
ãã= G
)
ããG H
)
ããH I
;
ããI J
Console
åå 
.
åå 

ResetColor
åå &
(
åå& '
)
åå' (
;
åå( )
Save
çç 
(
çç 
string
çç 
.
çç  
Format
çç  &
(
çç& '
message
çç' .
,
çç. /

parameters
çç0 :
)
çç: ;
)
çç; <
;
çç< =
}
èè 
catch
êê 
{
ëë 
}
íí 
}
ìì 
}
îî 	
public
ññ 
static
ññ 
void
ññ 
	Exception
ññ $
(
ññ$ %
	Exception
ññ% .
ex
ññ/ 1
,
ññ1 2
string
ññ3 9
message
ññ: A
,
ññA B
params
ññC I
object
ññJ P
[
ññP Q
]
ññQ R

parameters
ññS ]
)
ññ] ^
{
óó 	
lock
òò 
(
òò 
sync
òò 
)
òò 
{
ôô 
if
õõ 
(
õõ 
ex
õõ 
is
õõ 
System
õõ  
.
õõ  !
	Threading
õõ! *
.
õõ* +"
ThreadAbortException
õõ+ ?
)
õõ? @
{
úú 
return
ùù 
;
ùù 
}
ûû 
Error
†† 
(
†† 
message
†† 
)
†† 
;
†† 
try
°° 
{
¢¢ 
Console
££ 
.
££ 
ForegroundColor
££ +
=
££, -
ConsoleColor
££. :
.
££: ;
Red
££; >
;
££> ?
Console
§§ 
.
§§ 
Error
§§ !
.
§§! "
	WriteLine
§§" +
(
§§+ ,
$str
§§, 6
+
§§7 8
ex
§§9 ;
.
§§; <
Message
§§< C
)
§§C D
;
§§D E
Console
•• 
.
•• 
ForegroundColor
•• +
=
••, -
ConsoleColor
••. :
.
••: ;
DarkGray
••; C
;
••C D
Save
ßß 
(
ßß 
string
ßß 
.
ßß  
Format
ßß  &
(
ßß& '
message
ßß' .
,
ßß. /

parameters
ßß0 :
)
ßß: ;
)
ßß; <
;
ßß< =
}
©© 
catch
™™ 
{
™™ 
}
™™ 
}
´´ 
}
¨¨ 	
private
ÆÆ 
static
ÆÆ 
void
ÆÆ 
Save
ÆÆ  
(
ÆÆ  !
string
ÆÆ! '
str
ÆÆ( +
)
ÆÆ+ ,
{
ØØ 	
if
±± 
(
±± 
string
±± 
.
±± 
IsNullOrEmpty
±± $
(
±±$ %
str
±±% (
)
±±( )
)
±±) *
{
±±+ ,
return
±±- 3
;
±±3 4
}
±±5 6
var
≥≥ 
path
≥≥ 
=
≥≥ 
$str
≥≥ 
;
≥≥ 
if
¥¥ 
(
¥¥ 
HttpContext
¥¥ 
.
¥¥ 
Current
¥¥ #
!=
¥¥$ &
null
¥¥' +
)
¥¥+ ,
{
µµ 
path
∂∂ 
=
∂∂ 
HttpContext
∂∂ "
.
∂∂" #
Current
∂∂# *
.
∂∂* +
Server
∂∂+ 1
.
∂∂1 2
MapPath
∂∂2 9
(
∂∂9 :
$str
∂∂: A
)
∂∂A B
;
∂∂B C
}
∑∑ 
else
∏∏ 
{
ππ 
path
∫∫ 
=
∫∫ 
	AppDomain
∫∫  
.
∫∫  !
CurrentDomain
∫∫! .
.
∫∫. /
BaseDirectory
∫∫/ <
+
∫∫= >
$str
∫∫? D
;
∫∫D E
}
ªª 
if
ΩΩ 
(
ΩΩ 
!
ΩΩ 
	Directory
ΩΩ 
.
ΩΩ 
Exists
ΩΩ !
(
ΩΩ! "
path
ΩΩ" &
)
ΩΩ& '
)
ΩΩ' (
{
ææ 
	Directory
øø 
.
øø 
CreateDirectory
øø )
(
øø) *
path
øø* .
)
øø. /
;
øø/ 0
}
¿¿ 
if
¬¬ 
(
¬¬ 
string
¬¬ 
.
¬¬ 
IsNullOrEmpty
¬¬ $
(
¬¬$ %
str
¬¬% (
)
¬¬( )
)
¬¬) *
return
¬¬+ 1
;
¬¬1 2
if
√√ 
(
√√ 
string
√√ 
.
√√ 
IsNullOrEmpty
√√ $
(
√√$ %
FILE
√√% )
)
√√) *
)
√√* +
FILE
√√, 0
=
√√1 2
path
√√3 7
+
√√8 9
string
√√: @
.
√√@ A
Format
√√A G
(
√√G H
$str
√√H W
,
√√W X
DateTime
√√Y a
.
√√a b
Now
√√b e
.
√√e f
ToString
√√f n
(
√√n o
$str
√√o {
)
√√{ |
)
√√| }
;
√√} ~
using
≈≈ 
(
≈≈ 
StreamWriter
≈≈ 
sw
≈≈  "
=
≈≈# $
File
≈≈% )
.
≈≈) *

AppendText
≈≈* 4
(
≈≈4 5
FILE
≈≈5 9
)
≈≈9 :
)
≈≈: ;
{
∆∆ 
sw
«« 
.
«« 
	WriteLine
«« 
(
«« 
DateTime
«« %
.
««% &
Now
««& )
+
««* +
$str
««, /
+
««0 1
$str
««2 6
+
««7 8
str
««9 <
)
««< =
;
««= >
}
»» 
}
   	
private
ÃÃ 
static
ÃÃ 
void
ÃÃ 
SaveERR
ÃÃ #
(
ÃÃ# $
string
ÃÃ$ *
str
ÃÃ+ .
)
ÃÃ. /
{
ÕÕ 	!
ErrorLogInformation
ŒŒ 
.
ŒŒ  
	SaveError
ŒŒ  )
(
ŒŒ) *
DateTime
ŒŒ* 2
.
ŒŒ2 3
Now
ŒŒ3 6
,
ŒŒ6 7
str
ŒŒ8 ;
)
ŒŒ; <
;
ŒŒ< =
var
–– 
path
–– 
=
–– 
$str
–– 
;
–– 
if
—— 
(
—— 
HttpContext
—— 
.
—— 
Current
—— #
!=
——$ &
null
——' +
)
——+ ,
{
““ 
path
”” 
=
”” 
HttpContext
”” "
.
””" #
Current
””# *
.
””* +
Server
””+ 1
.
””1 2
MapPath
””2 9
(
””9 :
$str
””: A
)
””A B
;
””B C
}
‘‘ 
else
’’ 
{
÷÷ 
path
◊◊ 
=
◊◊ 
	AppDomain
◊◊  
.
◊◊  !
CurrentDomain
◊◊! .
.
◊◊. /
BaseDirectory
◊◊/ <
+
◊◊= >
$str
◊◊? D
;
◊◊D E
}
ÿÿ 
if
⁄⁄ 
(
⁄⁄ 
!
⁄⁄ 
	Directory
⁄⁄ 
.
⁄⁄ 
Exists
⁄⁄ !
(
⁄⁄! "
path
⁄⁄" &
)
⁄⁄& '
)
⁄⁄' (
{
€€ 
	Directory
‹‹ 
.
‹‹ 
CreateDirectory
‹‹ )
(
‹‹) *
path
‹‹* .
)
‹‹. /
;
‹‹/ 0
}
›› 
if
ﬂﬂ 
(
ﬂﬂ 
string
ﬂﬂ 
.
ﬂﬂ 
IsNullOrEmpty
ﬂﬂ $
(
ﬂﬂ$ %
str
ﬂﬂ% (
)
ﬂﬂ( )
)
ﬂﬂ) *
return
ﬂﬂ+ 1
;
ﬂﬂ1 2
if
‡‡ 
(
‡‡ 
string
‡‡ 
.
‡‡ 
IsNullOrEmpty
‡‡ $
(
‡‡$ %
FILEERR
‡‡% ,
)
‡‡, -
)
‡‡- .
FILEERR
‡‡/ 6
=
‡‡7 8
path
‡‡9 =
+
‡‡> ?
string
‡‡@ F
.
‡‡F G
Format
‡‡G M
(
‡‡M N
$str
‡‡N `
,
‡‡` a
DateTime
‡‡b j
.
‡‡j k
Now
‡‡k n
.
‡‡n o
ToString
‡‡o w
(
‡‡w x
$str‡‡x Ñ
)‡‡Ñ Ö
)‡‡Ö Ü
;‡‡Ü á
using
‚‚ 
(
‚‚ 
StreamWriter
‚‚ 
sw
‚‚  "
=
‚‚# $
File
‚‚% )
.
‚‚) *

AppendText
‚‚* 4
(
‚‚4 5
FILEERR
‚‚5 <
)
‚‚< =
)
‚‚= >
{
„„ 
sw
‰‰ 
.
‰‰ 
	WriteLine
‰‰ 
(
‰‰ 
DateTime
‰‰ %
.
‰‰% &
Now
‰‰& )
+
‰‰* +
$str
‰‰, /
+
‰‰0 1
$str
‰‰2 6
+
‰‰7 8
str
‰‰9 <
+
‰‰= >
System
‰‰? E
.
‰‰E F
Environment
‰‰F Q
.
‰‰Q R
NewLine
‰‰R Y
+
‰‰Z [!
ErrorLogInformation
‰‰\ o
.
‰‰o p
GetKeyValues
‰‰p |
(
‰‰| }
)
‰‰} ~
)
‰‰~ 
;‰‰ Ä
}
ÂÂ 
}
ÊÊ 	
}
ÁÁ 
}ËË ¸®
xD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\LogoEntegration\DataMapper.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
LogoEntegration& 5
{ 
class 	

DataMapper
 
: 
IDataMapper "
{ 
public 
ResultStatus 
CompanySave '
(' (
AdClientFind( 4
[4 5
]5 6
param7 <
,< =
string> D
firmaNoE L
)L M
{ 	
var 
db 
= 
new 
WorkOfTimeDatabase +
(+ ,
), -
;- .
var 
result 
= 
new 
ResultStatus )
{* +
result, 2
=3 4
true5 9
}: ;
;; <
if 
( 
param 
!= 
null 
) 
{ 
var 
findCompany 
=  !
db" $
.$ %
GetCMP_Company% 3
(3 4
)4 5
;5 6
foreach 
( 
var 
item !
in" $
param% *
)* +
{ 
if 
( 
item 
. 
CariKodu %
!=& (
null) -
)- .
{ 
if 
( 
findCompany '
!=( *
null+ /
&&0 2
findCompany3 >
.> ?
Where? D
(D E
aE F
=>G I
aJ K
.K L
codeL P
==Q S
firmaNoT [
+\ ]
$str^ a
+b c
itemd h
.h i
CariKodui q
)q r
.r s
Counts x
(x y
)y z
>{ |
$num} ~
)~ 
{ 
if 
(  
findCompany  +
.+ ,
Where, 1
(1 2
a2 3
=>4 6
a7 8
.8 9
name9 =
==> @
itemA E
.E F
	CariUnvanF O
)O P
.P Q
CountQ V
(V W
)W X
==Y [
$num\ ]
)] ^
{ 
result  &
=' (
CompanyUpdate) 6
(6 7
item7 ;
,; <
firmaNo= D
)D E
;E F
} 
}   
else!! 
{"" 
result## "
=### $
CompanyInsert##% 2
(##2 3
item##3 7
,##7 8
firmaNo##9 @
)##@ A
;##A B
}$$ 
}%% 
else&& 
{'' 
result(( 
.(( 
result(( %
=((& '
false((( -
;((- .
result)) 
.)) 
message)) &
=))' (
$str))) E
;))E F
return** 
result** %
;**% &
}++ 
},, 
}-- 
else.. 
{// 
result00 
.00 
result00 
=00 
false00  %
;00% &
result11 
.11 
message11 
=11  
$str11! @
;11@ A
return22 
result22 
;22 
}33 
return44 
result44 
;44 
}55 	
public66 
ResultStatus66 
CompanyInsert66 )
(66) *
AdClientFind66* 6
param667 <
,66< =
string66> D
firmaNo66E L
)66L M
{77 	
var88 
db88 
=88 
new88 
WorkOfTimeDatabase88 +
(88+ ,
)88, -
;88- .
var99 
result99 
=99 
new99 
ResultStatus99 )
{99* +
result99, 2
=993 4
true995 9
}99: ;
;99; <
if:: 
(:: 
param:: 
.:: 
	CariUnvan:: 
!=::  "
$str::# %
)::% &
{;; 
var<< 
insertCompany<< !
=<<" #
new<<$ '
CMP_Company<<( 3
{== 
id>> 
=>> 
Guid>> 
.>> 
NewGuid>> %
(>>% &
)>>& '
,>>' (
	createdby?? 
=?? 
Guid??  $
.??$ %
Empty??% *
,??* +
created@@ 
=@@ 
DateTime@@ &
.@@& '
Now@@' *
,@@* +
openAddressAA 
=AA  !
paramAA" '
.AA' (
AdresAA( -
,AA- .
codeBB 
=BB 
firmaNoBB "
+BB# $
$strBB% (
+BB) *
paramBB+ 0
.BB0 1
CariKoduBB1 9
,BB9 :
nameCC 
=CC 
paramCC  
.CC  !
	CariUnvanCC! *
,CC* +
emailDD 
=DD 
paramDD !
.DD! "
Eposta1DD" )
,DD) *
	taxOfficeEE 
=EE 
paramEE  %
.EE% &
VergiDairesiEE& 2
,EE2 3
	taxNumberFF 
=FF 
paramFF  %
.FF% &
VergiNoFF& -
,FF- .
commercialTitleGG #
=GG$ %
paramGG& +
.GG+ ,
	CariUnvanGG, 5
,GG5 6
}HH 
;HH 
resultII 
&=II 
dbII 
.II 
InsertCMP_CompanyII .
(II. /
insertCompanyII/ <
)II< =
;II= >
}JJ 
returnKK 
resultKK 
;KK 
}LL 	
publicMM 
ResultStatusMM 
CompanyUpdateMM )
(MM) *
AdClientFindMM* 6
paramMM7 <
,MM< =
stringMM> D
firmaNoMME L
)MML M
{NN 	
varOO 
dbOO 
=OO 
newOO 
WorkOfTimeDatabaseOO +
(OO+ ,
)OO, -
;OO- .
varPP 
resultPP 
=PP 
newPP 
ResultStatusPP )
{PP* +
resultPP, 2
=PP3 4
truePP5 9
}PP: ;
;PP; <
varQQ 
	checkCodeQQ 
=QQ 
dbQQ 
.QQ  
GetCMP_CompanyByCodeQQ 3
(QQ3 4
firmaNoQQ4 ;
+QQ< =
$strQQ> A
+QQB C
paramQQD I
.QQI J
CariKoduQQJ R
)QQR S
;QQS T
varRR 
	validatorRR 
=RR 
CompanyValidatorRR ,
(RR, -
paramRR- 2
,RR2 3
	checkCodeRR4 =
)RR= >
;RR> ?
ifSS 
(SS 
	validatorSS 
.SS 
resultSS  
)SS  !
{TT 
	checkCodeUU 
.UU 
nameUU 
=UU  
paramUU! &
.UU& '
	CariUnvanUU' 0
;UU0 1
	checkCodeVV 
.VV 
openAddressVV %
=VV& '
paramVV( -
.VV- .
AdresVV. 3
;VV3 4
	checkCodeWW 
.WW 
codeWW 
=WW  
firmaNoWW! (
+WW) *
$strWW+ .
+WW/ 0
paramWW1 6
.WW6 7
CariKoduWW7 ?
;WW? @
	checkCodeXX 
.XX 
emailXX 
=XX  !
paramXX" '
.XX' (
Eposta1XX( /
;XX/ 0
	checkCodeYY 
.YY 
	taxOfficeYY #
=YY$ %
paramYY& +
.YY+ ,
VergiDairesiYY, 8
;YY8 9
	checkCodeZZ 
.ZZ 
	taxNumberZZ #
=ZZ$ %
paramZZ& +
.ZZ+ ,
VergiNoZZ, 3
;ZZ3 4
	checkCode[[ 
.[[ 
commercialTitle[[ )
=[[* +
param[[, 1
.[[1 2
	CariUnvan[[2 ;
;[[; <
	checkCode\\ 
.\\ 
changed\\ !
=\\" #
DateTime\\$ ,
.\\, -
Now\\- 0
;\\0 1
	checkCode]] 
.]] 
	changedby]] #
=]]$ %
Guid]]& *
.]]* +
Empty]]+ 0
;]]0 1
result^^ 
&=^^ 
db^^ 
.^^ 
UpdateCMP_Company^^ .
(^^. /
	checkCode^^/ 8
)^^8 9
;^^9 :
}__ 
return`` 
result`` 
;`` 
}aa 	
publicbb 
ResultStatusbb 
ProductSavebb '
(bb' (
AdItemsFindListbb( 7
[bb7 8
]bb8 9
parambb: ?
)bb? @
{cc 	
vardd 
dbdd 
=dd 
newdd 
WorkOfTimeDatabasedd +
(dd+ ,
)dd, -
;dd- .
varee 
resultee 
=ee 
newee 
ResultStatusee )
{ee* +
resultee, 2
=ee3 4
trueee5 9
}ee: ;
;ee; <
ifff 
(ff 
paramff 
!=ff 
nullff 
)ff 
{gg 
varhh 
findProducthh 
=hh  !
dbhh" $
.hh$ %
GetPRD_Producthh% 3
(hh3 4
)hh4 5
;hh5 6
foreachii 
(ii 
varii 
itemii !
inii" $
paramii% *
)ii* +
{jj 
ifkk 
(kk 
itemkk 
.kk 
UrunKodukk %
!=kk& (
nullkk) -
)kk- .
{ll 
ifqq 
(qq 
findProductqq '
!=qq( *
nullqq+ /
&&qq0 2
findProductqq3 >
.qq> ?
Whereqq? D
(qqD E
aqqE F
=>qqG I
aqqJ K
.qqK L
codeqqL P
==qqQ S
itemqqT X
.qqX Y
UrunKoduqqY a
)qqa b
.qqb c
Countqqc h
(qqh i
)qqi j
==qqk m
$numqqn o
)qqo p
{rr 
resultss "
=ss# $
ProductInsertss% 2
(ss2 3
itemss3 7
)ss7 8
;ss8 9
}tt 
}uu 
elsevv 
{ww 
resultxx 
.xx 
resultxx %
=xx& '
falsexx( -
;xx- .
resultyy 
.yy 
messageyy &
=yy' (
$stryy) E
;yyE F
returnzz 
resultzz %
;zz% &
}{{ 
}|| 
}}} 
else~~ 
{ 
result
ÄÄ 
.
ÄÄ 
result
ÄÄ 
=
ÄÄ 
false
ÄÄ  %
;
ÄÄ% &
result
ÅÅ 
.
ÅÅ 
message
ÅÅ 
=
ÅÅ  
$str
ÅÅ! @
;
ÅÅ@ A
return
ÇÇ 
result
ÇÇ 
;
ÇÇ 
}
ÉÉ 
return
ÑÑ 
result
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
ÜÜ 
ResultStatus
ÜÜ 
ProductInsert
ÜÜ )
(
ÜÜ) *
AdItemsFindList
ÜÜ* 9
param
ÜÜ: ?
)
ÜÜ? @
{
áá 	
var
àà 
db
àà 
=
àà 
new
àà  
WorkOfTimeDatabase
àà +
(
àà+ ,
)
àà, -
;
àà- .
var
ââ 
result
ââ 
=
ââ 
new
ââ 
ResultStatus
ââ )
{
ââ* +
result
ââ, 2
=
ââ3 4
true
ââ5 9
}
ââ: ;
;
ââ; <
short
ää 
?
ää 
	stockType
ää 
=
ää 
$num
ää  
;
ää  !
short
ãã 
?
ãã 
type
ãã 
=
ãã 
$num
ãã 
;
ãã 
if
åå 
(
åå 
param
åå 
.
åå 
StokTakipTipi
åå #
==
åå$ &
$str
åå' 9
)
åå9 :
{
çç 
	stockType
éé 
=
éé 
(
éé 
int
éé  
)
éé  !&
EnumPRD_ProductStockType
éé! 9
.
éé9 :
Stoksuz
éé: A
;
ééA B
}
èè 
else
êê 
if
êê 
(
êê 
param
êê 
.
êê 
StokTakipTipi
êê (
==
êê) +
$str
êê, L
)
êêL M
{
ëë 
	stockType
íí 
=
íí 
(
íí 
int
íí  
)
íí  !&
EnumPRD_ProductStockType
íí! 9
.
íí9 :
SeriNoluTakip
íí: G
;
ííG H
}
ìì 
else
îî 
{
ïï 
	stockType
ññ 
=
ññ 
(
ññ 
int
ññ  
)
ññ  !&
EnumPRD_ProductStockType
ññ! 9
.
ññ9 :
NormalTakip
ññ: E
;
ññE F
}
óó 
if
ôô 
(
ôô 
param
ôô 
.
ôô #
MalzemeTuruAciklamasi
ôô +
==
ôô, .
$str
ôô/ 9
)
ôô9 :
{
öö 
type
õõ 
=
õõ 
(
õõ 
int
õõ 
)
õõ !
EnumPRD_ProductType
õõ /
.
õõ/ 0
Hammadde
õõ0 8
;
õõ8 9
}
úú 
else
ùù 
if
ùù 
(
ùù 
param
ùù 
.
ùù #
MalzemeTuruAciklamasi
ùù 0
==
ùù1 3
$str
ùù4 B
)
ùùB C
{
ûû 
type
üü 
=
üü 
(
üü 
int
üü 
)
üü !
EnumPRD_ProductType
üü /
.
üü/ 0
	TicariMal
üü0 9
;
üü9 :
}
†† 
else
°° 
if
°° 
(
°° 
param
°° 
.
°° #
MalzemeTuruAciklamasi
°° 0
==
°°1 3
$str
°°4 @
)
°°@ A
{
¢¢ 
type
££ 
=
££ 
(
££ 
int
££ 
)
££ !
EnumPRD_ProductType
££ /
.
££/ 0
	YariMamul
££0 9
;
££9 :
}
§§ 
else
•• 
if
•• 
(
•• 
param
•• 
.
•• #
MalzemeTuruAciklamasi
•• 0
==
••1 3
$str
••4 ;
)
••; <
{
¶¶ 
type
ßß 
=
ßß 
(
ßß 
int
ßß 
)
ßß !
EnumPRD_ProductType
ßß /
.
ßß/ 0
	TicariMal
ßß0 9
;
ßß9 :
}
®® 
else
©© 
{
™™ 
type
´´ 
=
´´ 
(
´´ 
int
´´ 
)
´´ !
EnumPRD_ProductType
´´ /
.
´´/ 0
Diger
´´0 5
;
´´5 6
}
¨¨ 
var
ØØ 

insertUnit
ØØ 
=
ØØ 
new
ØØ  
UT_Unit
ØØ! (
{
∞∞ 
id
±± 
=
±± 
Guid
±± 
.
±± 
NewGuid
±± !
(
±±! "
)
±±" #
,
±±# $
	createdby
≤≤ 
=
≤≤ 
Guid
≤≤  
.
≤≤  !
Empty
≤≤! &
,
≤≤& '
created
≥≥ 
=
≥≥ 
DateTime
≥≥ "
.
≥≥" #
Now
≥≥# &
,
≥≥& '
name
¥¥ 
=
¥¥ 
param
¥¥ 
.
¥¥ 
Birim
¥¥ "
,
¥¥" #
}
µµ 
;
µµ 
var
∂∂ 
insertCategory
∂∂ 
=
∂∂  
new
∂∂! $
PRD_Category
∂∂% 1
{
∑∑ 
id
∏∏ 
=
∏∏ 
Guid
∏∏ 
.
∏∏ 
NewGuid
∏∏ !
(
∏∏! "
)
∏∏" #
,
∏∏# $
	createdby
ππ 
=
ππ 
Guid
ππ  
.
ππ  !
Empty
ππ! &
,
ππ& '
created
∫∫ 
=
∫∫ 
DateTime
∫∫ "
.
∫∫" #
Now
∫∫# &
,
∫∫& '
name
ªª 
=
ªª 
param
ªª 
.
ªª 
Kategori
ªª %
,
ªª% &
code
ºº 
=
ºº 
param
ºº 
.
ºº 
MalzemeTuruKodu
ºº ,
,
ºº, -
}
ΩΩ 
;
ΩΩ 
var
ææ 
insertBrand
ææ 
=
ææ 
new
ææ !
	PRD_Brand
ææ" +
{
øø 
id
¿¿ 
=
¿¿ 
Guid
¿¿ 
.
¿¿ 
NewGuid
¿¿ !
(
¿¿! "
)
¿¿" #
,
¿¿# $
	createdby
¡¡ 
=
¡¡ 
Guid
¡¡  
.
¡¡  !
Empty
¡¡! &
,
¡¡& '
created
¬¬ 
=
¬¬ 
DateTime
¬¬ "
.
¬¬" #
Now
¬¬# &
,
¬¬& '
name
√√ 
=
√√ 
param
√√ 
.
√√ 
MarkaAciklamasi
√√ ,
,
√√, -
code
ƒƒ 
=
ƒƒ 
param
ƒƒ 
.
ƒƒ 
	MarkaKodu
ƒƒ &
,
ƒƒ& '
}
≈≈ 
;
≈≈ 
var
∆∆ 
	checkUnit
∆∆ 
=
∆∆ 
db
∆∆ 
.
∆∆ 
GetUT_UnitByName
∆∆ /
(
∆∆/ 0
param
∆∆0 5
.
∆∆5 6
Birim
∆∆6 ;
)
∆∆; <
;
∆∆< =
var
»» 
insertProduct
»» 
=
»» 
new
»»  #
PRD_Product
»»$ /
{
…… 
id
   
=
   
Guid
   
.
   
NewGuid
   !
(
  ! "
)
  " #
,
  # $
name
ÀÀ 
=
ÀÀ 
param
ÀÀ 
.
ÀÀ 
UrunAciklamasi1
ÀÀ ,
,
ÀÀ, -
description
ÃÃ 
=
ÃÃ 
param
ÃÃ #
.
ÃÃ# $
UrunAciklamasi2
ÃÃ$ 3
,
ÃÃ3 4
code
ÕÕ 
=
ÕÕ 
param
ÕÕ 
.
ÕÕ 
UrunKodu
ÕÕ %
,
ÕÕ% &

categoryId
ŒŒ 
=
ŒŒ 
insertCategory
ŒŒ +
!=
ŒŒ, .
null
ŒŒ/ 3
&&
ŒŒ4 6
insertCategory
ŒŒ7 E
.
ŒŒE F
name
ŒŒF J
!=
ŒŒK M
$str
ŒŒN P
?
ŒŒQ R
insertCategory
ŒŒS a
.
ŒŒa b
id
ŒŒb d
:
ŒŒe f
(
ŒŒg h
Guid
ŒŒh l
?
ŒŒl m
)
ŒŒm n
null
ŒŒn r
,
ŒŒr s
brandId
œœ 
=
œœ 
insertBrand
œœ %
!=
œœ& (
null
œœ) -
&&
œœ. 0
insertBrand
œœ1 <
.
œœ< =
name
œœ= A
!=
œœB D
$str
œœE G
?
œœH I
insertBrand
œœJ U
.
œœU V
id
œœV X
:
œœY Z
(
œœ[ \
Guid
œœ\ `
?
œœ` a
)
œœa b
null
œœb f
,
œœf g
unitId
–– 
=
–– 
	checkUnit
–– "
!=
––# %
null
––& *
?
––+ ,
	checkUnit
––- 6
.
––6 7
id
––7 9
:
––: ;
(
––< =
Guid
––= A
?
––A B
)
––B C
null
––C G
,
––G H
created
—— 
=
—— 
DateTime
—— "
.
——" #
Now
——# &
,
——& '
	createdby
““ 
=
““ 
Guid
““  
.
““  !
Empty
““! &
,
““& '
	stockType
”” 
=
”” 
	stockType
”” %
,
””% &
type
‘‘ 
=
‘‘ 
type
‘‘ 
,
‘‘ 
}
’’ 
;
’’ 
var
÷÷  
insertProductPrice
÷÷ "
=
÷÷# $
new
÷÷% (
PRD_ProductPrice
÷÷) 9
{
◊◊ 
created
ÿÿ 
=
ÿÿ 
DateTime
ÿÿ "
.
ÿÿ" #
Now
ÿÿ# &
,
ÿÿ& '
	createdby
ŸŸ 
=
ŸŸ 
Guid
ŸŸ  
.
ŸŸ  !
Empty
ŸŸ! &
,
ŸŸ& '
id
⁄⁄ 
=
⁄⁄ 
Guid
⁄⁄ 
.
⁄⁄ 
NewGuid
⁄⁄ !
(
⁄⁄! "
)
⁄⁄" #
,
⁄⁄# $
price
€€ 
=
€€ 
param
€€ 
.
€€ 

BirimFiyat
€€ (
,
€€( )
	productId
‹‹ 
=
‹‹ 
insertProduct
‹‹ )
!=
‹‹* ,
null
‹‹- 1
?
‹‹2 3
insertProduct
‹‹4 A
.
‹‹A B
id
‹‹B D
:
‹‹E F
(
‹‹G H
Guid
‹‹H L
?
‹‹L M
)
‹‹M N
null
‹‹N R
,
‹‹R S
}
›› 
;
›› 
if
ﬁﬁ 
(
ﬁﬁ 
	checkUnit
ﬁﬁ 
==
ﬁﬁ 
null
ﬁﬁ !
)
ﬁﬁ! "
{
ﬂﬂ 
result
‡‡ 
&=
‡‡ 
db
‡‡ 
.
‡‡ 
InsertUT_Unit
‡‡ *
(
‡‡* +

insertUnit
‡‡+ 5
)
‡‡5 6
;
‡‡6 7
}
·· 
if
‚‚ 
(
‚‚ 
insertCategory
‚‚ 
.
‚‚ 
name
‚‚ #
!=
‚‚$ &
$str
‚‚' )
)
‚‚) *
{
„„ 
result
‰‰ 
&=
‰‰ 
db
‰‰ 
.
‰‰  
InsertPRD_Category
‰‰ /
(
‰‰/ 0
insertCategory
‰‰0 >
)
‰‰> ?
;
‰‰? @
}
ÂÂ 
if
ÊÊ 
(
ÊÊ 
insertBrand
ÊÊ 
.
ÊÊ 
name
ÊÊ  
!=
ÊÊ! #
$str
ÊÊ$ &
)
ÊÊ& '
{
ÁÁ 
result
ËË 
&=
ËË 
db
ËË 
.
ËË 
InsertPRD_Brand
ËË ,
(
ËË, -
insertBrand
ËË- 8
)
ËË8 9
;
ËË9 :
}
ÈÈ 
result
ÍÍ 
&=
ÍÍ 
db
ÍÍ 
.
ÍÍ 
InsertPRD_Product
ÍÍ *
(
ÍÍ* +
insertProduct
ÍÍ+ 8
)
ÍÍ8 9
;
ÍÍ9 :
result
ÎÎ 
&=
ÎÎ 
db
ÎÎ 
.
ÎÎ $
InsertPRD_ProductPrice
ÎÎ /
(
ÎÎ/ 0 
insertProductPrice
ÎÎ0 B
)
ÎÎB C
;
ÎÎC D
return
ÏÏ 
result
ÏÏ 
;
ÏÏ 
}
ÌÌ 	
public
òò 
ResultStatus
òò 
StorageSave
òò '
(
òò' (
AdShipFindList
òò( 6
[
òò6 7
]
òò7 8
param
òò9 >
,
òò> ?
string
òò@ F
firmaNo
òòG N
)
òòN O
{
ôô 	
var
öö 
db
öö 
=
öö 
new
öö  
WorkOfTimeDatabase
öö +
(
öö+ ,
)
öö, -
;
öö- .
var
õõ 
result
õõ 
=
õõ 
new
õõ 
ResultStatus
õõ )
{
õõ* +
result
õõ, 2
=
õõ3 4
true
õõ5 9
}
õõ: ;
;
õõ; <
if
úú 
(
úú 
param
úú 
!=
úú 
null
úú 
)
úú 
{
ùù 
var
ûû 
findStorage
ûû 
=
ûû  !
db
ûû" $
.
ûû$ %
GetCMP_Storage
ûû% 3
(
ûû3 4
)
ûû4 5
;
ûû5 6
foreach
üü 
(
üü 
var
üü 
item
üü !
in
üü" $
param
üü% *
)
üü* +
{
†† 
if
°° 
(
°° 
item
°° 
.
°° 
SevkKodu
°° %
!=
°°& (
null
°°) -
)
°°- .
{
¢¢ 
if
§§ 
(
§§ 
findStorage
§§ '
!=
§§( *
null
§§+ /
&&
§§0 2
findStorage
§§3 >
.
§§> ?
Where
§§? D
(
§§D E
a
§§E F
=>
§§G I
a
§§J K
.
§§K L
code
§§L P
==
§§Q S
firmaNo
§§T [
+
§§\ ]
$str
§§^ a
+
§§b c
item
§§d h
.
§§h i
CariKodu
§§i q
+
§§r s
item
§§t x
.
§§x y
SevkKodu§§y Å
)§§Å Ç
.§§Ç É
Count§§É à
(§§à â
)§§â ä
>§§ã å
$num§§ç é
)§§é è
{
•• 
result
¶¶ "
=
¶¶# $
StorageUpdate
¶¶% 2
(
¶¶2 3
item
¶¶3 7
,
¶¶7 8
firmaNo
¶¶9 @
)
¶¶@ A
;
¶¶A B
}
ßß 
else
®® 
{
©© 
result
™™ "
=
™™# $
StorageInsert
™™% 2
(
™™2 3
item
™™3 7
,
™™7 8
firmaNo
™™9 @
)
™™@ A
;
™™A B
}
´´ 
}
¨¨ 
else
≠≠ 
{
ÆÆ 
result
ØØ 
.
ØØ 
result
ØØ %
=
ØØ& '
false
ØØ( -
;
ØØ- .
result
∞∞ 
.
∞∞ 
message
∞∞ &
=
∞∞' (
$str
∞∞) F
;
∞∞F G
return
±± 
result
±± %
;
±±% &
}
≤≤ 
}
≥≥ 
}
¥¥ 
else
µµ 
{
∂∂ 
result
∑∑ 
.
∑∑ 
result
∑∑ 
=
∑∑ 
false
∑∑  %
;
∑∑% &
result
∏∏ 
.
∏∏ 
message
∏∏ 
=
∏∏  
$str
∏∏! @
;
∏∏@ A
return
ππ 
result
ππ 
;
ππ 
}
∫∫ 
return
ªª 
result
ªª 
;
ªª 
}
ºº 	
public
ΩΩ 
ResultStatus
ΩΩ 
StorageInsert
ΩΩ )
(
ΩΩ) *
AdShipFindList
ΩΩ* 8
param
ΩΩ9 >
,
ΩΩ> ?
string
ΩΩ@ F
firmaNo
ΩΩG N
)
ΩΩN O
{
ææ 	
var
øø 
db
øø 
=
øø 
new
øø  
WorkOfTimeDatabase
øø +
(
øø+ ,
)
øø, -
;
øø- .
var
¿¿ 
result
¿¿ 
=
¿¿ 
new
¿¿ 
ResultStatus
¿¿ )
{
¿¿* +
result
¿¿, 2
=
¿¿3 4
true
¿¿5 9
}
¿¿: ;
;
¿¿; <
var
¡¡ 
findSH_User
¡¡ 
=
¡¡ 
db
¡¡  
.
¡¡  !
GetVWSH_User
¡¡! -
(
¡¡- .
)
¡¡. /
.
¡¡/ 0
Where
¡¡0 5
(
¡¡5 6
a
¡¡6 7
=>
¡¡8 :
a
¡¡; <
.
¡¡< =
FullName
¡¡= E
==
¡¡F H
param
¡¡I N
.
¡¡N O
SevkIlgiliKisi
¡¡O ]
.
¡¡] ^
ToUpper
¡¡^ e
(
¡¡e f
)
¡¡f g
)
¡¡g h
.
¡¡h i
FirstOrDefault
¡¡i w
(
¡¡w x
)
¡¡x y
;
¡¡y z
var
¬¬ 
findCari
¬¬ 
=
¬¬ 
db
¬¬ 
.
¬¬ *
GetVWCMP_CompanyByNameOrCode
¬¬ :
(
¬¬: ;
param
¬¬; @
.
¬¬@ A
	CariUnvan
¬¬A J
,
¬¬J K
firmaNo
¬¬L S
+
¬¬T U
$str
¬¬V Y
+
¬¬Z [
param
¬¬\ a
.
¬¬a b
CariKodu
¬¬b j
,
¬¬j k
null
¬¬k o
)
¬¬o p
;
¬¬p q
var
√√ 
insertStorage
√√ 
=
√√ 
new
√√  #
CMP_Storage
√√$ /
{
ƒƒ 
id
≈≈ 
=
≈≈ 
Guid
≈≈ 
.
≈≈ 
NewGuid
≈≈ !
(
≈≈! "
)
≈≈" #
,
≈≈# $
	createdby
∆∆ 
=
∆∆ 
Guid
∆∆  
.
∆∆  !
Empty
∆∆! &
,
∆∆& '
created
«« 
=
«« 
DateTime
«« "
.
««" #
Now
««# &
,
««& '
address
»» 
=
»» 
param
»» 
.
»»  

SevkAdresi
»»  *
,
»»* +
code
…… 
=
…… 
firmaNo
…… 
+
……  
$str
……! $
+
……% &
param
……' ,
.
……, -
CariKodu
……- 5
+
……6 7
param
……8 =
.
……= >
SevkKodu
……> F
,
……F G
name
   
=
   
param
   
.
   
SevkAciklamasi
   +
,
  + ,
email
ÀÀ 
=
ÀÀ 
param
ÀÀ 
.
ÀÀ 

SevkEposta
ÀÀ (
,
ÀÀ( )
supervisorId
ÃÃ 
=
ÃÃ 
findSH_User
ÃÃ *
?
ÃÃ* +
.
ÃÃ+ ,
id
ÃÃ, .
,
ÃÃ. /
phone
ÕÕ 
=
ÕÕ 
param
ÕÕ 
.
ÕÕ 
SevkTelefon
ÕÕ )
,
ÕÕ) *
postCode
ŒŒ 
=
ŒŒ 
param
ŒŒ  
.
ŒŒ  !
SevkPostaKodu
ŒŒ! .
,
ŒŒ. /
	companyId
œœ 
=
œœ 
findCari
œœ $
?
œœ$ %
.
œœ% &
id
œœ& (
,
œœ( )
}
–– 
;
–– 
result
—— 
&=
—— 
db
—— 
.
—— 
InsertCMP_Storage
—— *
(
——* +
insertStorage
——+ 8
)
——8 9
;
——9 :
return
““ 
result
““ 
;
““ 
}
”” 	
public
‘‘ 
ResultStatus
‘‘ 
StorageUpdate
‘‘ )
(
‘‘) *
AdShipFindList
‘‘* 8
param
‘‘9 >
,
‘‘> ?
string
‘‘@ F
firmaNo
‘‘G N
)
‘‘N O
{
’’ 	
var
÷÷ 
db
÷÷ 
=
÷÷ 
new
÷÷  
WorkOfTimeDatabase
÷÷ +
(
÷÷+ ,
)
÷÷, -
;
÷÷- .
var
◊◊ 
result
◊◊ 
=
◊◊ 
new
◊◊ 
ResultStatus
◊◊ )
{
◊◊* +
result
◊◊, 2
=
◊◊3 4
true
◊◊5 9
}
◊◊: ;
;
◊◊; <
var
ÿÿ 
	checkCode
ÿÿ 
=
ÿÿ 
db
ÿÿ 
.
ÿÿ "
GetCMP_StorageByCode
ÿÿ 3
(
ÿÿ3 4
firmaNo
ÿÿ4 ;
+
ÿÿ< =
$str
ÿÿ> A
+
ÿÿB C
param
ÿÿD I
.
ÿÿI J
CariKodu
ÿÿJ R
+
ÿÿS T
param
ÿÿU Z
.
ÿÿZ [
SevkKodu
ÿÿ[ c
)
ÿÿc d
;
ÿÿd e
var
ŸŸ 
findCari
ŸŸ 
=
ŸŸ 
db
ŸŸ 
.
ŸŸ *
GetVWCMP_CompanyByNameOrCode
ŸŸ :
(
ŸŸ: ;
param
ŸŸ; @
.
ŸŸ@ A
	CariUnvan
ŸŸA J
,
ŸŸJ K
firmaNo
ŸŸL S
+
ŸŸT U
$str
ŸŸV Y
+
ŸŸZ [
param
ŸŸ\ a
.
ŸŸa b
CariKodu
ŸŸb j
,
ŸŸj k
null
ŸŸk o
)
ŸŸo p
;
ŸŸp q
var
⁄⁄ 
findSH_User
⁄⁄ 
=
⁄⁄ 
db
⁄⁄  
.
⁄⁄  !
GetVWSH_User
⁄⁄! -
(
⁄⁄- .
)
⁄⁄. /
.
⁄⁄/ 0
Where
⁄⁄0 5
(
⁄⁄5 6
a
⁄⁄6 7
=>
⁄⁄8 :
a
⁄⁄; <
.
⁄⁄< =
FullName
⁄⁄= E
==
⁄⁄F H
param
⁄⁄I N
.
⁄⁄N O
SevkIlgiliKisi
⁄⁄O ]
.
⁄⁄] ^
ToUpper
⁄⁄^ e
(
⁄⁄e f
)
⁄⁄f g
)
⁄⁄g h
.
⁄⁄h i
FirstOrDefault
⁄⁄i w
(
⁄⁄w x
)
⁄⁄x y
;
⁄⁄y z
var
€€ 
	validator
€€ 
=
€€ 
StorageValidator
€€ ,
(
€€, -
param
€€- 2
,
€€2 3
	checkCode
€€4 =
)
€€= >
;
€€> ?
if
‹‹ 
(
‹‹ 
	validator
‹‹ 
.
‹‹ 
result
‹‹  
)
‹‹  !
{
›› 
	checkCode
ﬁﬁ 
.
ﬁﬁ 
changed
ﬁﬁ !
=
ﬁﬁ" #
DateTime
ﬁﬁ$ ,
.
ﬁﬁ, -
Now
ﬁﬁ- 0
;
ﬁﬁ0 1
	checkCode
ﬂﬂ 
.
ﬂﬂ 
	changedby
ﬂﬂ #
=
ﬂﬂ$ %
Guid
ﬂﬂ& *
.
ﬂﬂ* +
Empty
ﬂﬂ+ 0
;
ﬂﬂ0 1
	checkCode
‡‡ 
.
‡‡ 
name
‡‡ 
=
‡‡  
param
‡‡! &
.
‡‡& '
SevkAciklamasi
‡‡' 5
;
‡‡5 6
	checkCode
·· 
.
·· 
address
·· !
=
··" #
param
··$ )
.
··) *

SevkAdresi
··* 4
;
··4 5
	checkCode
‚‚ 
.
‚‚ 
code
‚‚ 
=
‚‚  
firmaNo
‚‚! (
+
‚‚) *
$str
‚‚+ .
+
‚‚/ 0
param
‚‚1 6
.
‚‚6 7
CariKodu
‚‚7 ?
+
‚‚@ A
param
‚‚B G
.
‚‚G H
SevkKodu
‚‚H P
;
‚‚P Q
	checkCode
„„ 
.
„„ 
email
„„ 
=
„„  !
param
„„" '
.
„„' (

SevkEposta
„„( 2
;
„„2 3
	checkCode
‰‰ 
.
‰‰ 
phone
‰‰ 
=
‰‰  !
param
‰‰" '
.
‰‰' (
SevkTelefon
‰‰( 3
;
‰‰3 4
	checkCode
ÂÂ 
.
ÂÂ 
postCode
ÂÂ "
=
ÂÂ# $
param
ÂÂ% *
.
ÂÂ* +
SevkPostaKodu
ÂÂ+ 8
;
ÂÂ8 9
	checkCode
ÊÊ 
.
ÊÊ 
supervisorId
ÊÊ &
=
ÊÊ' (
findSH_User
ÊÊ) 4
?
ÊÊ4 5
.
ÊÊ5 6
id
ÊÊ6 8
;
ÊÊ8 9
	checkCode
ÁÁ 
.
ÁÁ 
	companyId
ÁÁ #
=
ÁÁ$ %
findCari
ÁÁ& .
?
ÁÁ. /
.
ÁÁ/ 0
id
ÁÁ0 2
;
ÁÁ2 3
result
ËË 
&=
ËË 
db
ËË 
.
ËË 
UpdateCMP_Storage
ËË .
(
ËË. /
	checkCode
ËË/ 8
)
ËË8 9
;
ËË9 :
}
ÈÈ 
return
ÍÍ 
result
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
public
ÏÏ 
ResultStatus
ÏÏ 
CompanyValidator
ÏÏ ,
(
ÏÏ, -
AdClientFind
ÏÏ- 9
param
ÏÏ: ?
,
ÏÏ? @
CMP_Company
ÏÏA L
company
ÏÏM T
)
ÏÏT U
{
ÌÌ 	
var
ÓÓ 
result
ÓÓ 
=
ÓÓ 
new
ÓÓ 
ResultStatus
ÓÓ )
{
ÓÓ* +
result
ÓÓ, 2
=
ÓÓ3 4
true
ÓÓ5 9
}
ÓÓ: ;
;
ÓÓ; <
if
ÔÔ 
(
ÔÔ 
company
ÔÔ 
.
ÔÔ 
email
ÔÔ 
==
ÔÔ  
param
ÔÔ! &
.
ÔÔ& '
Eposta1
ÔÔ' .
&&
ÔÔ/ 1
company
ÔÔ2 9
.
ÔÔ9 :
openAddress
ÔÔ: E
==
ÔÔF H
param
ÔÔI N
.
ÔÔN O
Adres
ÔÔO T
&&
ÔÔU W
company
ÔÔX _
.
ÔÔ_ `
name
ÔÔ` d
==
ÔÔe g
param
ÔÔh m
.
ÔÔm n
	CariUnvan
ÔÔn w
&&
ÔÔx z
companyÔÔ{ Ç
.ÔÔÇ É
	taxOfficeÔÔÉ å
==ÔÔç è
paramÔÔê ï
.ÔÔï ñ
VergiDairesiÔÔñ ¢
&&ÔÔ£ •
companyÔÔ¶ ≠
.ÔÔ≠ Æ
	taxNumberÔÔÆ ∑
==ÔÔ∏ ∫
paramÔÔª ¿
.ÔÔ¿ ¡
VergiNoÔÔ¡ »
)ÔÔ» …
{
 
return
ÒÒ 
new
ÒÒ 
ResultStatus
ÒÒ '
{
ÚÚ 
result
ÛÛ 
=
ÛÛ 
false
ÛÛ "
,
ÛÛ" #
message
ÙÙ 
=
ÙÙ 
$str
ÙÙ -
,
ÙÙ- .
}
ıı 
;
ıı 
}
ˆˆ 
return
˜˜ 
result
˜˜ 
;
˜˜ 
}
¯¯ 	
public
˘˘ 
ResultStatus
˘˘ 
StorageValidator
˘˘ ,
(
˘˘, -
AdShipFindList
˘˘- ;
param
˘˘< A
,
˘˘A B
CMP_Storage
˘˘C N
storage
˘˘O V
)
˘˘V W
{
˙˙ 	
var
˚˚ 
result
˚˚ 
=
˚˚ 
new
˚˚ 
ResultStatus
˚˚ )
{
˚˚* +
result
˚˚, 2
=
˚˚3 4
true
˚˚5 9
}
˚˚: ;
;
˚˚; <
if
¸¸ 
(
¸¸ 
storage
¸¸ 
.
¸¸ 
email
¸¸ 
==
¸¸  
param
¸¸! &
.
¸¸& '

SevkEposta
¸¸' 1
&&
¸¸2 4
storage
¸¸5 <
.
¸¸< =
address
¸¸= D
==
¸¸E G
param
¸¸H M
.
¸¸M N

SevkAdresi
¸¸N X
&&
¸¸Y [
storage
¸¸\ c
.
¸¸c d
name
¸¸d h
==
¸¸i k
param
¸¸l q
.
¸¸q r
	CariUnvan
¸¸r {
&&
¸¸| ~
storage¸¸ Ü
.¸¸Ü á
phone¸¸á å
==¸¸ç è
param¸¸ê ï
.¸¸ï ñ
SevkTelefon¸¸ñ °
&&¸¸¢ §
storage¸¸• ¨
.¸¸¨ ≠
postCode¸¸≠ µ
==¸¸∂ ∏
param¸¸π æ
.¸¸æ ø
SevkPostaKodu¸¸ø Ã
)¸¸Ã Õ
{
˝˝ 
return
˛˛ 
new
˛˛ 
ResultStatus
˛˛ '
{
ˇˇ 
result
ÄÄ 
=
ÄÄ 
false
ÄÄ "
,
ÄÄ" #
message
ÅÅ 
=
ÅÅ 
$str
ÅÅ -
,
ÅÅ- .
}
ÇÇ 
;
ÇÇ 
}
ÉÉ 
return
ÑÑ 
result
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
ÜÜ 
ResultStatus
ÜÜ 
ProductValidator
ÜÜ ,
(
ÜÜ, -
AdItemsFindList
ÜÜ- <
param
ÜÜ= B
,
ÜÜB C
PRD_Product
ÜÜD O
product
ÜÜP W
)
ÜÜW X
{
áá 	
var
àà 
result
àà 
=
àà 
new
àà 
ResultStatus
àà )
{
àà* +
result
àà, 2
=
àà3 4
true
àà5 9
}
àà: ;
;
àà; <
if
ââ 
(
ââ 
product
ââ 
.
ââ 
name
ââ 
==
ââ 
param
ââ  %
.
ââ% &
UrunAciklamasi1
ââ& 5
&&
ââ6 8
product
ââ9 @
.
ââ@ A
description
ââA L
==
ââM O
param
ââP U
.
ââU V
UrunAciklamasi2
ââV e
)
ââe f
{
ää 
return
ãã 
new
ãã 
ResultStatus
ãã '
{
åå 
result
çç 
=
çç 
false
çç "
,
çç" #
message
éé 
=
éé 
$str
éé -
,
éé- .
}
èè 
;
èè 
}
êê 
return
ëë 
result
ëë 
;
ëë 
}
íí 	
}
ïï 
}ññ ó
yD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\LogoEntegration\IDataMapper.cs
	namespace

 	
Infoline


 
.

 
OmixEntegrationApp

 %
.

% &
LogoEntegration

& 5
{ 
public 

	interface 
IDataMapper  
{ 
ResultStatus 
CompanyValidator %
(% &
AdClientFind& 2
param3 8
,8 9
CMP_Company: E
companyF M
)M N
;N O
ResultStatus 
CompanySave  
(  !
AdClientFind! -
[- .
]. /
param0 5
,5 6
string7 =
firmaNo> E
)E F
;F G
ResultStatus 
CompanyInsert "
(" #
AdClientFind# /
param0 5
,5 6
string7 =
firmaNo> E
)E F
;F G
ResultStatus 
CompanyUpdate "
(" #
AdClientFind# /
param0 5
,5 6
string7 =
firmaNo> E
)E F
;F G
ResultStatus 
ProductValidator %
(% &
AdItemsFindList& 5
param6 ;
,; <
PRD_Product= H
productI P
)P Q
;Q R
ResultStatus 
ProductSave  
(  !
AdItemsFindList! 0
[0 1
]1 2
param3 8
)8 9
;9 :
ResultStatus 
ProductInsert "
(" #
AdItemsFindList# 2
param3 8
)8 9
;9 :
ResultStatus 
StorageValidator %
(% &
AdShipFindList& 4
param5 :
,: ;
CMP_Storage< G
storageH O
)O P
;P Q
ResultStatus 
StorageSave  
(  !
AdShipFindList! /
[/ 0
]0 1
param2 7
,7 8
string9 ?
firmaNo@ G
)G H
;H I
ResultStatus 
StorageInsert "
(" #
AdShipFindList# 1
param2 7
,7 8
string9 ?
firmaNo@ G
)G H
;H I
ResultStatus 
StorageUpdate "
(" #
AdShipFindList# 1
param2 7
,7 8
string9 ?
firmaNo@ G
)G H
;H I
} 
} ´E
eD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Program.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
{ 
class 	
Program
 
{ 
public 
static 
string 

TenantCode '
=' ( 
ConfigurationManager) =
.= >
AppSettings> I
[I J
$strJ Y
]Y Z
.Z [
ToString[ c
(c d
)d e
;e f
static 
void 
Main 
( 
string 
[  
]  !
args" &
)& '
{ 	
AgentRunControl 
( 
) 
; 
if 
( 
! 
Environment 
. 
UserInteractive ,
), -
{ 
System 
. 
ServiceProcess %
.% &
ServiceBase& 1
.1 2
Run2 5
(5 6
new6 9
System: @
.@ A
ServiceProcessA O
.O P
ServiceBaseP [
[[ \
]\ ]
{^ _
new` c

AgentStartd n
(n o
)o p
}q r
)r s
;s t
} 
else 
{ 
try 
{ 
ServiceControl "
(" #
args# '
)' (
;( )
}   
catch!! 
(!! 
	Exception!!  
ex!!! #
)!!# $
{"" 
Console## 
.## 
	WriteLine## %
(##% &
$str##& I
+##J K
Environment##L W
.##W X
NewLine##X _
+##` a
ex##b d
.##d e
Message##e l
.##l m
ToString##m u
(##u v
)##v w
)##w x
;##x y
}$$ 
try&& 
{'' 
Console(( 
.(( 
	WriteLine(( %
(((% &
$str((& 9
)((9 :
;((: ;
var)) 

agentStart)) "
=))# $
new))% (

AgentStart))) 3
())3 4
)))4 5
;))5 6

agentStart** 
.** 
Run** "
(**" #
)**# $
;**$ %
while++ 
(++ 
true++ 
)++  
{,, 
System-- 
.-- 
	Threading-- (
.--( )
Thread--) /
.--/ 0
Sleep--0 5
(--5 6
$num--6 :
)--: ;
;--; <
}.. 
}// 
catch00 
(00 
	Exception00  
ex00! #
)00# $
{11 
Console22 
.22 
	WriteLine22 %
(22% &
DateTime22& .
.22. /
Now22/ 2
+223 4
$str225 <
+22= >
ex22? A
.22A B
Message22B I
)22I J
;22J K
}33 
}55 
}66 	
private99 
static99 
void99 
ServiceControl99 *
(99* +
string99+ 1
[991 2
]992 3
args994 8
)998 9
{:: 	
var;; 
ServiceName;; 
=;; 
$str;; 4
+;;4 5

TenantCode;;5 ?
+;;? @
$str;;@ E
;;;E F
if<< 
(<< 
SvcInstaller<< 
.<< 
GetServiceStatus<< -
(<<- .
ServiceName<<. 9
)<<9 :
==<<; =
ServiceState<<> J
.<<J K
NotFound<<K S
)<<S T
{== 
Console>> 
.>> 
	WriteLine>> !
(>>! "
$str>>" 4
)>>4 5
;>>5 6
SvcInstaller@@ 
.@@ 
ServisInstall@@ *
(@@* +
ServiceName@@+ 6
,@@6 7
false@@8 =
,@@= >
false@@? D
,@@D E
System@@F L
.@@L M

Reflection@@M W
.@@W X
Assembly@@X `
.@@` a
GetEntryAssembly@@a q
(@@q r
)@@r s
.@@s t
Location@@t |
)@@| }
;@@} ~
}AA 
ifBB 
(BB 
argsBB 
.BB 
CountBB 
(BB 
)BB 
>BB 
$numBB  
&&BB! #
argsBB$ (
[BB( )
$numBB) *
]BB* +
==BB, .
$strBB/ 2
)BB2 3
{CC 
SvcInstallerDD 
.DD 
ServisUnInstallDD ,
(DD, -
ServiceNameDD- 8
)DD8 9
;DD9 :
}EE 
SvcInstallerFF 
.FF 

ServisStopFF #
(FF# $
ServiceNameFF$ /
)FF/ 0
;FF0 1
}GG 	
privateII 
staticII 
voidII 
AgentRunControlII +
(II+ ,
)II, -
{JJ 	
ifLL 
(LL 
EnvironmentLL 
.LL 
UserInteractiveLL +
)LL+ ,
{MM 
ServiceControllerNN !
scNN" $
=NN% &
ServiceControllerNN' 8
.NN8 9
GetServicesNN9 D
(NND E
)NNE F
.NNF G
FirstOrDefaultNNG U
(NNU V
sNNV W
=>NNX Z
sNN[ \
.NN\ ]
ServiceNameNN] h
.NNh i
EqualsNNi o
(NNo p
$str	NNp Ü
+
NNá à

TenantCode
NNâ ì
+
NNî ï
$str
NNñ õ
)
NNõ ú
)
NNú ù
;
NNù û
ifOO 
(OO 
scOO 
!=OO 
nullOO 
)OO 
{PP 
ifQQ 
(QQ 
scQQ 
.QQ 
StatusQQ !
.QQ! "
EqualsQQ" (
(QQ( )#
ServiceControllerStatusQQ) @
.QQ@ A
RunningQQA H
)QQH I
)QQI J
{RR 
ConsoleSS 
.SS  
	WriteLineSS  )
(SS) *
$strSS* p
,SSp q
scSSr t
.SSt u
CanStopSSu |
,SS| }
sc	SS~ Ä
.
SSÄ Å
CanShutdown
SSÅ å
,
SSå ç
sc
SSé ê
.
SSê ë!
CanPauseAndContinue
SSë §
)
SS§ •
;
SS• ¶
scTT 
.TT 
StopTT 
(TT  
)TT  !
;TT! "
scUU 
.UU 
DisposeUU "
(UU" #
)UU# $
;UU$ %
ThreadVV 
.VV 
SleepVV $
(VV$ %
$numVV% &
*VV' (
$numVV) -
)VV- .
;VV. /
}WW 
}XX 
}YY 
if[[ 
([[ 
Process[[ 
.[[ 
GetProcessesByName[[ *
([[* +
$str[[+ A
+[[B C

TenantCode[[D N
+[[O P
$str[[Q V
)[[V W
.[[W X
Length[[X ^
>[[_ `
$num[[a b
)[[b c
{\\ 
Console]] 
.]] 
	WriteLine]] !
(]]! "
$str]]" [
)]][ \
;]]\ ]
var__ 
runningProcesses__ $
=__% &
Process__' .
.__. /
GetProcesses__/ ;
(__; <
)__< =
.__= >
Where__> C
(__C D
a__D E
=>__F H
a__I J
.__J K
ProcessName__K V
.__V W
Equals__W ]
(__] ^
$str__^ t
+__u v

TenantCode	__w Å
+
__Ç É
$str
__Ñ â
)
__â ä
)
__ä ã
;
__ã å
foreach`` 
(`` 
var`` 
process`` $
in``% '
runningProcesses``( 8
)``8 9
{aa 
ifbb 
(bb 
Systembb 
.bb 
IntPtrbb %
.bb% &
Zerobb& *
!=bb+ -
processbb. 5
.bb5 6
MainWindowHandlebb6 F
&&bbG I
ProcessbbJ Q
.bbQ R
GetCurrentProcessbbR c
(bbc d
)bbd e
.bbe f
MainWindowHandlebbf v
!=bbw y
process	bbz Å
.
bbÅ Ç
MainWindowHandle
bbÇ í
)
bbí ì
{cc 
Consoledd 
.dd  
	WriteLinedd  )
(dd) *
processdd* 1
.dd1 2
ProcessNamedd2 =
+dd> ?
$strdd@ K
)ddK L
;ddL M
processee 
.ee  
Killee  $
(ee$ %
)ee% &
;ee& '
}ff 
}gg 
Threadhh 
.hh 
Sleephh 
(hh 
$numhh 
*hh  
$numhh! %
)hh% &
;hh& '
}ii 
}jj 	
}kk 
}ll †
uD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 6
)6 7
]7 8
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str 8
)8 9
]9 :
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *ø(
ÑD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\LogoEntegration\ProcessLogoEntegration.cs
	namespace

 	
Infoline


 
.

 
OmixEntegrationApp

 %
.

% &
LogoEntegration

& 5
{ 
public 

class "
ProcessLogoEntegration '
:( )
IDisposable* 5
{ 
public 
string 
FirmaNo 
{ 
get  #
=>$ & 
ConfigurationManager' ;
.; <
AppSettings< G
[G H
$strH S
]S T
.T U
ToStringU ]
(] ^
)^ _
;_ `
}a b
public "
ProcessLogoEntegration %
(% &
)& '
{ 	
Log 
. 
Info 
( 
$str 6
)6 7
;7 8
} 	
public 
void 
Run 
( 
) 
{ 	
while 
( 
true 
) 
{ 

DataMapper 
_dataMapper &
=' (
new) ,

DataMapper- 7
(7 8
)8 9
;9 :
var 
sc 
= 
new 
Service1SoapClient /
(/ 0
)0 1
;1 2
foreach 
( 
var 
firmaNo $
in% '
FirmaNo( /
./ 0
Split0 5
(5 6
$char6 9
)9 :
): ;
{ 
try 
{ 
var 
getCariList '
=( )
sc* ,
., -
GetCariList- 8
(8 9
new9 <
ClientFindParam= L
{M N
FirmaNoO V
=W X
firmaNoY `
}a b
)b c
;c d
var   
getProductList   *
=  + ,
sc  - /
.  / 0
GetMalzemeList  0 >
(  > ?
new  ? B
AdItemsFindParam  C S
{  T U
FirmaNo  V ]
=  ^ _
firmaNo  ` g
}  h i
)  i j
;  j k
_dataMapper!! #
.!!# $
CompanySave!!$ /
(!!/ 0
getCariList!!0 ;
,!!; <
firmaNo!!= D
)!!D E
;!!E F
_dataMapper"" #
.""# $
ProductSave""$ /
(""/ 0
getProductList""0 >
)""> ?
;""? @
if## 
(## 
getCariList## '
.##' (
Count##( -
(##- .
)##. /
>##0 1
$num##2 3
)##3 4
{$$ 
foreach%% #
(%%$ %
var%%% (
cariKodu%%) 1
in%%2 4
getCariList%%5 @
)%%@ A
{&& 
try''  #
{((  !
var))$ '
getStorageList))( 6
=))7 8
sc))9 ;
.)); <
GetSevkAdresList))< L
())L M
new))M P
AdShipFindParam))Q `
{))a b
FirmaNo))c j
=))k l
firmaNo))m t
,))t u
CariKodu))v ~
=	)) Ä
cariKodu
))Å â
.
))â ä
CariKodu
))ä í
}
))ì î
)
))î ï
;
))ï ñ
_dataMapper**$ /
.**/ 0
StorageSave**0 ;
(**; <
getStorageList**< J
,**J K
firmaNo**L S
)**S T
;**T U
}++  !
catch,,  %
(,,& '
	Exception,,' 0
ex,,1 3
),,3 4
{--  !
Log..$ '
...' (
Error..( -
(..- .
$str... [
+..\ ]
ex..^ `
...` a
Message..a h
+..i j
$str..k r
+..s t
ex..u w
...w x
InnerException	..x Ü
.
..Ü á
Message
..á é
)
..é è
;
..è ê
}//  !
}00 
}11 
}22 
catch33 
(33 
	Exception33 $
ex33% '
)33' (
{44 
Log55 
.55 
Error55 !
(55! "
$str55" B
+55C D
ex55E G
.55G H
Message55H O
+55P Q
$str55R Y
+55Z [
ex55\ ^
.55^ _
InnerException55_ m
.55m n
Message55n u
)55u v
;55v w
}66 
}77 
Log88 
.88 
Info88 
(88 
$str88 +
)88+ ,
;88, -
Thread99 
.99 
Sleep99 
(99 
new99  
TimeSpan99! )
(99) *
$num99* +
,99+ ,
$num99- .
,99. /
$num990 1
)991 2
)992 3
;993 4
}:: 
};; 	
public<< 
void<< 
Dispose<< 
(<< 
)<< 
{== 	
throw>> 
new>> #
NotImplementedException>> -
(>>- .
)>>. /
;>>/ 0
}?? 	
}@@ 
}AA út
ÑD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\TitanEntegration\Business\TitanService.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
TitanEntegration& 6
.6 7
Business7 ?
{ 
public 

class 
TitanService 
{ 
private 
WorkOfTimeDatabase "
db# %
=& '
new( +
WorkOfTimeDatabase, >
(> ?
)? @
;@ A
public 
string 
Host 
{ 
get  
=>! # 
ConfigurationManager$ 8
.8 9
AppSettings9 D
[D E
$strE K
]K L
.L M
ToStringM U
(U V
)V W
;W X
}Y Z
public 
TitanService 
( 
) 
{ 	
var 

tenantCode 
=  
ConfigurationManager 1
.1 2
AppSettings2 =
[= >
$str> M
]M N
.N O
ToStringO W
(W X
)X Y
;Y Z
var 
tenant 
= 
TenantConfig %
.% &

GetTenants& 0
(0 1
)1 2
.2 3
Where3 8
(8 9
a9 :
=>; =
a> ?
.? @

TenantCode@ J
==K M
ConvertN U
.U V
ToInt32V ]
(] ^

tenantCode^ h
)h i
)i j
.j k
FirstOrDefaultk y
(y z
)z {
;{ |
db 
= 
tenant 
. 
GetDatabase #
(# $
)$ %
;% &
} 	
public 
void '
CompensateFromTitanServices /
(/ 0
)0 1
{ 	
Log 
. 
Info 
( 
$str =
)= >
;> ?
var   
getAllDevices   
=   .
"GetLastDeviceListFromTitanServices    B
(  B C
)  C D
;  D E
if!! 
(!! 
getAllDevices!! 
.!! 
objects!! %
!=!!& (
null!!) -
)!!- .
{"" 
var## 
getAllDevicesList## %
=##& '
(##( )
DeviceResultList##) 9
)##9 :
getAllDevices##: G
.##G H
objects##H O
;##O P
var$$ 
databaseDevices$$ #
=$$$ %
db$$& (
.$$( )'
GetPRD_TitanDeviceActivated$$) D
($$D E
)$$E F
.$$F G
ToList$$G M
($$M N
)$$N O
;$$O P
var%% 

savingList%% 
=%%  
getAllDevicesList%%! 2
.%%2 3
Data%%3 7
.%%7 8
Where%%8 =
(%%= >
x%%> ?
=>%%@ B
!%%C D
databaseDevices%%D S
.%%S T
Select%%T Z
(%%Z [
a%%[ \
=>%%] _
a%%` a
.%%a b
IMEI1%%b g
)%%g h
.%%h i
Contains%%i q
(%%q r
x%%r s
.%%s t
IMEI1%%t y
)%%y z
||%%{ }
!%%~ 
databaseDevices	%% é
.
%%é è
Select
%%è ï
(
%%ï ñ
a
%%ñ ó
=>
%%ò ö
a
%%õ ú
.
%%ú ù
IMEI2
%%ù ¢
)
%%¢ £
.
%%£ §
Contains
%%§ ¨
(
%%¨ ≠
x
%%≠ Æ
.
%%Æ Ø
IMEI2
%%Ø ¥
)
%%¥ µ
||
%%∂ ∏
!
%%π ∫
databaseDevices
%%∫ …
.
%%…  
Select
%%  –
(
%%– —
a
%%— “
=>
%%” ’
a
%%÷ ◊
.
%%◊ ÿ
SerialNumber
%%ÿ ‰
)
%%‰ Â
.
%%Â Ê
Contains
%%Ê Ó
(
%%Ó Ô
x
%%Ô 
.
%% Ò
Serial
%%Ò ˜
)
%%˜ ¯
)
%%¯ ˘
;
%%˘ ˙
Log&& 
.&& 
Info&& 
(&& 
$str&& ;
,&&; <

savingList&&= G
.&&G H
Count&&H M
(&&M N
)&&N O
)&&O P
;&&P Q
foreach)) 
()) 
var)) 
item)) !
in))" $

savingList))% /
)))/ 0
{** 
var++ 
checkDb++ 
=++  !
db++" $
.++$ %/
#GetVWPRD_TitanDeviceActivatedByImei++% H
(++H I
item++I M
.++M N
IMEI1++N S
==++T V
null++W [
?++\ ]
item++^ b
.++b c
Serial++c i
:++j k
item++l p
.++p q
IMEI1++q v
)++v w
;++w x
if,, 
(,, 
checkDb,, 
==,,  "
null,,# '
),,' (
{-- 
var.. #
prdTitanDeviceActivated.. 3
=..4 5
new..6 9$
PRD_TitanDeviceActivated..: R
(..R S
)..S T
;..T U
var00 
getInventory00 (
=00) *
db00+ -
.00- ..
"GetPRD_InventoryBySerialCodeOrImei00. P
(00P Q
item00Q U
.00U V
Serial00V \
,00\ ]
item00^ b
.00b c
IMEI100c h
,00h i
item00j n
.00n o
IMEI200o t
)00t u
;00u v#
prdTitanDeviceActivated11 /
.11/ 0
CreatedOfTitan110 >
=11? @
item11A E
.11E F
Created11F M
.11M N
ToLocalTime11N Y
(11Y Z
)11Z [
;11[ \#
prdTitanDeviceActivated22 /
.22/ 0
DeviceId220 8
=229 :
new22; >
Guid22? C
(22C D
item22D H
.22H I
DeviceId22I Q
)22Q R
;22R S#
prdTitanDeviceActivated33 /
.33/ 0
IMEI1330 5
=336 7
item338 <
.33< =
IMEI133= B
==33C E
null33F J
?33K L
item33M Q
.33Q R
Serial33R X
:33Y Z
item33[ _
.33_ `
IMEI133` e
;33e f#
prdTitanDeviceActivated44 /
.44/ 0
IMEI2440 5
=446 7
item448 <
.44< =
IMEI244= B
;44B C#
prdTitanDeviceActivated55 /
.55/ 0
InventoryId550 ;
=55< =
getInventory55> J
?55J K
.55K L
id55L N
;55N O#
prdTitanDeviceActivated66 /
.66/ 0
	ProductId660 9
=66: ;
getInventory66< H
?66H I
.66I J
	productId66J S
;66S T#
prdTitanDeviceActivated77 /
.77/ 0
SerialNumber770 <
=77= >
item77? C
.77C D
Serial77D J
;77J K#
prdTitanDeviceActivated88 /
.88/ 0
TitanDeviceName880 ?
=88@ A
item88B F
.88F G

DeviceName88G Q
;88Q R#
prdTitanDeviceActivated99 /
.99/ 0

TitanModel990 :
=99; <
item99= A
.99A B
Model99B G
;99G H#
prdTitanDeviceActivated:: /
.::/ 0
TitanProduct::0 <
=::= >
item::? C
.::C D
Product::D K
;::K L
var<< 
dbInsertResult<< *
=<<+ ,
db<<- /
.<</ 0*
InsertPRD_TitanDeviceActivated<<0 N
(<<N O#
prdTitanDeviceActivated<<O f
)<<f g
;<<g h
if>> 
(>> 
!>> 
dbInsertResult>> +
.>>+ ,
result>>, 2
)>>2 3
Log?? 
.??  
Error??  %
(??% &
$str??& E
,??E F
item??G K
.??K L
IMEI1??L Q
)??Q R
;??R S
}@@ 
elseAA 
{BB 
LogCC 
.CC 
WarningCC #
(CC# $
$strCC$ B
,CCB C
itemCCD H
.CCH I
IMEI1CCI N
)CCN O
;CCO P
}DD 
}EE 
}GG 
LogHH 
.HH 
InfoHH 
(HH 
$strHH 8
)HH8 9
;HH9 :
}II 	
privateKK 
ResultStatusKK .
"GetLastDeviceListFromTitanServicesKK ?
(KK? @
)KK@ A
{LL 	
varMM 
lastDataTimeMM 
=MM 
dbMM !
.MM! "5
)GetPRD_TitanDeviceActivatedGetAllLastDateMM" K
(MMK L
)MML M
;MMM N
LogNN 
.NN 
InfoNN 
(NN 
$strNN ?
,NN? @
lastDataTimeNNA M
)NNM N
;NNN O
varPP 
queryPP 
=PP 
HelperPP 
.PP 
JsonPP #
.PP# $
	SerializePP$ -
(PP- .
newPP. 1
{QQ 
DataTypeRR 
=RR 
$numRR 
,RR 
StartSS 
=SS 
lastDataTimeSS $
.SS$ %
ValueSS% *
.SS* +
ToUniversalTimeSS+ :
(SS: ;
)SS; <
,SS< =
EndTT 
=TT 
DateTimeTT 
.TT 
NowTT "
.TT" #
ToUniversalTimeTT# 2
(TT2 3
)TT3 4
}UU 
)UU 
;UU 
returnVV *
GetDeviceListFromTitanServicesVV 1
<VV1 2
DeviceResultListVV2 B
>VVB C
(VVC D 
ConfigurationManagerVVD X
.VVX Y
AppSettingsVVY d
[VVd e
$str	VVe Ö
]
VVÖ Ü
.
VVÜ á
ToString
VVá è
(
VVè ê
)
VVê ë
,
VVë í
query
VVì ò
)
VVò ô
;
VVô ö
}WW 	
privateYY 
ResultStatusYY *
GetDeviceListFromTitanServicesYY ;
<YY; <
TYY< =
>YY= >
(YY> ?
stringYY? E
uriYYF I
,YYI J
stringYYK Q
queryYYR W
=YYX Y
nullYYZ ^
)YY^ _
{ZZ 	
try[[ 
{\\ 
ServicePointManager^^ #
.^^# $
Expect100Continue^^$ 5
=^^6 7
true^^8 <
;^^< =
ServicePointManager__ #
.__# $
SecurityProtocol__$ 4
=__5 6 
SecurityProtocolType__7 K
.__K L
Tls__L O
|``  
SecurityProtocolType`` -
.``- .
Tls11``. 3
|aa  
SecurityProtocolTypeaa -
.aa- .
Tls12aa. 3
|bb  
SecurityProtocolTypebb -
.bb- .
Ssl3bb. 2
;bb2 3
HttpWebRequestdd 
requestdd &
=dd' (
(dd) *
HttpWebRequestdd* 8
)dd8 9

WebRequestdd9 C
.ddC D
CreateddD J
(ddJ K
HostddK O
+ddP Q
uriddR U
)ddU V
;ddV W
requestee 
.ee 
ContentTypeee #
=ee$ %
$stree& 8
;ee8 9
requestff 
.ff 
Methodff 
=ff  
$strff! &
;ff& '
vargg 
typegg 
=gg 
requestgg "
.gg" #
GetTypegg# *
(gg* +
)gg+ ,
;gg, -
varii 
currentMethodii !
=ii" #
typeii$ (
.ii( )
GetPropertyii) 4
(ii4 5
$strii5 D
,iiD E
BindingFlagsiiF R
.iiR S
	NonPubliciiS \
|ii] ^
BindingFlagsii_ k
.iik l
Instanceiil t
)iit u
.iiu v
GetValueiiv ~
(ii~ 
request	ii Ü
)
iiÜ á
;
iiá à
varjj 

methodTypejj 
=jj  
currentMethodjj! .
.jj. /
GetTypejj/ 6
(jj6 7
)jj7 8
;jj8 9

methodTypekk 
.kk 
GetFieldkk #
(kk# $
$strkk$ ;
,kk; <
BindingFlagskk= I
.kkI J
	NonPublickkJ S
|kkT U
BindingFlagskkV b
.kkb c
Instancekkc k
)kkk l
.kkl m
SetValuekkm u
(kku v
currentMethod	kkv É
,
kkÉ Ñ
false
kkÖ ä
)
kkä ã
;
kkã å
usingll 
(ll 
varll 
streamWriterll '
=ll( )
newll* -
StreamWriterll. :
(ll: ;
requestll; B
.llB C
GetRequestStreamllC S
(llS T
)llT U
)llU V
)llV W
{mm 
streamWriternn  
.nn  !
Writenn! &
(nn& '
querynn' ,
)nn, -
;nn- .
}oo 
varss 
responsess 
=ss 
(ss  
HttpWebResponsess  /
)ss/ 0
(ss0 1
requestss1 8
.ss8 9
GetResponsess9 D
(ssD E
)ssE F
)ssF G
;ssG H
usingtt 
(tt 
vartt 
readertt !
=tt" #
newtt$ '
StreamReadertt( 4
(tt4 5
responsett5 =
.tt= >
GetResponseStreamtt> O
(ttO P
)ttP Q
,ttQ R
ASCIIEncodingttS `
.tt` a
ASCIItta f
)ttf g
)ttg h
{uu 
returnvv 
newvv 
ResultStatusvv +
{ww 
resultxx 
=xx  
truexx! %
,xx% &
messageyy 
=yy  !
$stryy" 2
,yy2 3
objectszz 
=zz  !
JsonConvertzz" -
.zz- .
DeserializeObjectzz. ?
<zz? @
Tzz@ A
>zzA B
(zzB C
readerzzC I
.zzI J
	ReadToEndzzJ S
(zzS T
)zzT U
)zzU V
}{{ 
;{{ 
}|| 
}~~ 
catch 
( 
	Exception 
ex 
)  
{
ÄÄ 
Log
ÅÅ 
.
ÅÅ 
Error
ÅÅ 
(
ÅÅ 
$str
ÅÅ B
,
ÅÅB C
ex
ÅÅD F
.
ÅÅF G
Message
ÅÅG N
)
ÅÅN O
;
ÅÅO P
return
ÉÉ 
new
ÉÉ 
ResultStatus
ÉÉ '
{
ÑÑ 
result
ÖÖ 
=
ÖÖ 
false
ÖÖ "
,
ÖÖ" #
message
ÜÜ 
=
ÜÜ 
ex
ÜÜ  
.
ÜÜ  !
Message
ÜÜ! (
,
ÜÜ( )
objects
áá 
=
áá 
null
áá "
}
àà 
;
àà 
}
ââ 
}
ää 	
}
ãã 
}åå Ö
ÄD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\TitanEntegration\Models\DeviceData.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
TitanEntegration& 6
.6 7
Models7 =
{ 
public 

class 

DeviceData 
{ 
public 
string 
Board 
{ 
get !
;! "
set# &
;& '
}( )
public		 
string		 
Brand		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
public

 
string

 

DeviceName

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
string 
Hardware 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Manufacturer "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Model 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Product 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Serial 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
IMEI1 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
IMEI2 
{ 
get !
;! "
set# &
;& '
}( )
public 
DateTime 
Created 
{  !
get" %
;% &
set' *
;* +
}, -
public 
object 
Modified 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
DeviceId 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ›
ÇD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\TitanEntegration\Models\DeviceResult.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
TitanEntegration& 6
.6 7
Models7 =
{ 
public 

class 
DeviceResultList !
{ 
public 
List 
< 

DeviceData 
> 
Data  $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
bool 
Success 
{ 
get !
;! "
set# &
;& '
}( )
public		 
List		 
<		 
string		 
>		 
Messages		 $
{		% &
get		' *
;		* +
set		, /
;		/ 0
}		1 2
}

 
} ¿
ÜD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\TitanEntegration\ProcessTitanEntegration.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
TitanEntegration& 6
{		 
public

 

class

 #
ProcessTitanEntegration

 (
:

) *
IDisposable

+ 6
{ 
TitanService 
TitanService !
=" #
new$ '
TitanService( 4
(4 5
)5 6
;6 7
public #
ProcessTitanEntegration &
(& '
)' (
{ 	
Log 
. 
Info 
( 
$str 7
)7 8
;8 9
} 	
public 
Task 
Run 
( 
) 
{ 	
while 
( 
true 
) 
{ 
TitanService 
. '
CompensateFromTitanServices 8
(8 9
)9 :
;: ;
Task 
. 
Delay 
( 
new 
TimeSpan '
(' (
$num( )
,) *
$num+ ,
,, -
$num. /
)/ 0
)0 1
.1 2
Wait2 6
(6 7
)7 8
;8 9
} 
} 	
public 
void 
Dispose 
( 
) 
{ 	
} 	
} 
}   ∫s
nD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Utils\MailSender.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
Utils& +
{		 
public

 

sealed

 
class

 
NotificationLogger

 *
:

+ ,
IDisposable

- 8
{ 
private 
static 
string 
ApplicationName -
{ 	
get 
{ 
if 
( 
System 
. 
Configuration (
.( ) 
ConfigurationManager) =
.= >
AppSettings> I
[I J
$strJ [
][ \
!=] _
null` d
)d e
{ 
return 
System !
.! "
Configuration" /
./ 0 
ConfigurationManager0 D
.D E
AppSettingsE P
[P Q
$strQ b
]b c
.c d
ToStringd l
(l m
)m n
;n o
} 
return 
$str 7
;7 8
} 
} 	
public 
static 
string 
LogMailUsers )
{ 	
get 
{ 
if 
( 
System 
. 
Configuration (
.( ) 
ConfigurationManager) =
.= >
AppSettings> I
[I J
$strJ [
][ \
!=] _
null` d
)d e
{ 
return 
System !
.! "
Configuration" /
./ 0 
ConfigurationManager0 D
.D E
AppSettingsE P
[P Q
$strQ b
]b c
.c d
ToStringd l
(l m
)m n
;n o
} 
return 
$str 4
;4 5
}   
}!! 	
private"" 
static"" 
int"" 
?"" 
LastMailSendHour"" ,
{""- .
get""/ 2
;""2 3
set""4 7
;""7 8
}""9 :
private## 
static## 
List## 
<## 
NotificationLog## +
>##+ ,
Infos##- 2
{##3 4
get##5 8
;##8 9
set##: =
;##= >
}##? @
private$$ 
static$$ 
Thread$$ 
TaskManager$$ )
{$$* +
get$$, /
;$$/ 0
set$$1 4
;$$4 5
}$$6 7
private%% 
static%% 
void%% 
SendMail%% $
(%%$ %
)%%% &
{&& 	
try'' 
{(( 
var)) 
header)) 
=)) 
$str)) W
;))W X
try** 
{++ 
header,, 
=,, 
$str,, A
+,,B C
(-- 
!-- 
String--  
.--  !
IsNullOrEmpty--! .
(--. /
Environment--/ :
.--: ;
MachineName--; F
)--F G
?--H I
Environment--J U
.--U V
MachineName--V a
:--b c
HttpContext--d o
.--o p
Current--p w
!=--x z
null--{ 
?
--Ä Å
HttpContext
--Ç ç
.
--ç é
Current
--é ï
.
--ï ñ
Server
--ñ ú
.
--ú ù
MachineName
--ù ®
:
--© ™
$str
--´ ≠
)
--≠ Æ
+
--Ø ∞
$str.. 
+..  !
header// 
;// 
}00 
catch11 
(11 
	Exception11  
ex11! #
)11# $
{11% &
}11' (
header22 
+=22 
$str22 K
+22L M
ApplicationName22N ]
+22^ _
$str22` g
;22g h
var33 
tbl33 
=33 
$str33 G
+33H I
$str44 
+44 
$str55 
+55 
$str66 (
+66) *
$str66+ 2
+663 4
$str665 <
+66= >
$str77 (
+77) *
$str77+ 8
+779 :
$str77; B
+77C D
$str88 
+88 
$str88 .
+88/ 0
$str881 8
+889 :
$str99 
+99 
$str99 +
+99, -
$str99. 5
+996 7
$str:: 
+:: 
$str:: *
+::+ ,
$str::- 4
+::5 6
$str;; 
+;; 
$str;; #
+;;$ %
$str;;& -
+;;. /
$str<< 
+<< 
$str<< $
+<<% &
$str<<' .
+<</ 0
$str== 
+== 
$str>> 
;>> 
tbl?? 
+=?? 
$str??  
+??! "
String??# )
.??) *
Join??* .
(??. /
$str??/ 1
,??1 2
Infos??3 8
.??8 9
Select??9 ?
(??? @
a??@ A
=>??B D
a??E F
.??F G
TableRow??G O
)??O P
)??P Q
+??R S
$str??T ^
+??_ `
$str@@ 
;@@ 
newAA 
EmailAA 
(AA 
)AA 
.AA 
SendAA  
(AA  !
$numAA! $
,AA$ %
LogMailUsersAA& 2
,AA2 3
$strAA4 Q
,AAQ R
headerAAS Y
+AAZ [
tblAA\ _
,AA_ `
trueAAa e
,AAe f
falseAAg l
)AAl m
;AAm n
InfosBB 
.BB 
ClearBB 
(BB 
)BB 
;BB 
}CC 
catchDD 
(DD 
	ExceptionDD 
exDD 
)DD  
{DD! "
ConsoleDD# *
.DD* +
	WriteLineDD+ 4
(DD4 5
exDD5 7
)DD7 8
;DD8 9
}DD: ;
}EE 	
publicFF 
staticFF 
stringFF 
GetKeyValuesFF )
(FF) *
)FF* +
{GG 	
tryHH 
{II 
ifJJ 
(JJ 
HttpContextJJ 
.JJ  
CurrentJJ  '
==JJ( *
nullJJ+ /
)JJ/ 0
{KK 
returnLL 
$strLL 
;LL 
}MM 
returnNN 
InfolineNN 
.NN  
HelperNN  &
.NN& '
JsonNN' +
.NN+ ,
	SerializeNN, 5
(NN5 6
HttpContextNN6 A
.NNA B
CurrentNNB I
.NNI J
RequestNNJ Q
.NNQ R
FormNNR V
.NNV W
AllKeysNNW ^
.OO 
ToDictionaryOO !
(OO! "
keyPP 
=>PP 
keyPP "
,PP" #
valQQ 
=>QQ 
HttpContextQQ *
.QQ* +
CurrentQQ+ 2
.QQ2 3
RequestQQ3 :
.QQ: ;
FormQQ; ?
[QQ? @
valQQ@ C
]QQC D
)RR 
)RR 
;RR 
}SS 
catchTT 
{UU 
returnVV 
$strVV 
;VV 
}WW 
}XX 	
publicYY 
staticYY 
voidYY 
	SaveErrorYY $
(YY$ %
DateTimeYY% -
dateYY. 2
,YY2 3
stringYY4 :
messageYY; B
,YYB C!
PRD_EntegrationActionYYD Y
deviceYYZ `
)YY` a
{ZZ 	
try[[ 
{\\ 
if]] 
(]] 
Infos]] 
==]] 
null]] !
)]]! "
{^^ 
Infos__ 
=__ 
new__ 
List__  $
<__$ %
NotificationLog__% 4
>__4 5
(__5 6
)__6 7
;__7 8
}`` 
varaa 

userStatusaa 
=aa  
HttpContextaa! ,
.aa, -
Currentaa- 4
!=aa5 7
nullaa8 <
&&aa= ?
HttpContextaa@ K
.aaK L
CurrentaaL S
.aaS T
SessionaaT [
!=aa\ ^
nullaa_ c
?bb 
(bb 
PageSecuritybb #
)bb# $
HttpContextbb$ /
.bb/ 0
Currentbb0 7
.bb7 8
Sessionbb8 ?
[bb? @
$strbb@ L
]bbL M
:cc 
nullcc 
;cc 
Infosdd 
.dd 
Adddd 
(dd 
newdd 
NotificationLogdd -
{ee 
Messageff 
=ff 
messageff %
,ff% &
ConsolidationNamegg %
=gg& '
devicegg( .
.gg. /
ConsolidationNamegg/ @
,gg@ A 
CustomerOperatorCodehh (
=hh) *
devicehh+ 1
.hh1 2 
CustomerOperatorCodehh2 F
,hhF G 
CustomerOperatorNameii (
=ii) *
deviceii+ 1
.ii1 2 
CustomerOperatorNameii2 F
,iiF G
DistributorNamejj #
=jj$ %
devicejj& ,
.jj, -
DistributorNamejj- <
,jj< =
Imeƒ±kk 
=kk 
devicekk !
.kk! "
Imeikk" &
,kk& '
InvoiceNumberll !
=ll" #
devicell$ *
.ll* +
InvoiceNumberll+ 8
,ll8 9
Datemm 
=mm 
datemm 
,mm  
}nn 
)nn 
;nn 
ifoo 
(oo 
TaskManageroo 
==oo  "
nulloo# '
)oo' (
{pp 
TaskManagerqq 
=qq  !
newqq" %
Threadqq& ,
(qq, -
newqq- 0
ThreadStartqq1 <
(qq< =
delegateqq= E
{rr 
ifss 
(ss 
!ss 
LastMailSendHourss -
.ss- .
HasValuess. 6
)ss6 7
{tt 
LastMailSendHouruu ,
=uu- .
DateTimeuu/ 7
.uu7 8
Nowuu8 ;
.uu; <
Houruu< @
-uuA B
$numuuC D
;uuD E
}vv 
whileww 
(ww 
trueww #
)ww# $
{xx 
ifyy 
(yy  
LastMailSendHouryy  0
<yy1 2
DateTimeyy3 ;
.yy; <
Nowyy< ?
.yy? @
Houryy@ D
&&yyE G
InfosyyH M
.yyM N
CountyyN S
(yyS T
)yyT U
>yyV W
$numyyX Y
)yyY Z
{zz 
SendMail{{  (
({{( )
){{) *
;{{* +
LastMailSendHour||  0
=||1 2
DateTime||3 ;
.||; <
Now||< ?
.||? @
Hour||@ D
;||D E
}}} 
System~~ "
.~~" #
	Threading~~# ,
.~~, -
Thread~~- 3
.~~3 4
Sleep~~4 9
(~~9 :
$num~~: >
*~~? @
$num~~A C
)~~C D
;~~D E
} 
}
ÄÄ 
)
ÄÄ 
)
ÄÄ 
;
ÄÄ 
TaskManager
ÅÅ 
.
ÅÅ  
Start
ÅÅ  %
(
ÅÅ% &
)
ÅÅ& '
;
ÅÅ' (
}
ÇÇ 
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
ex
ÑÑ 
)
ÑÑ  
{
ÖÖ 
Console
ÜÜ 
.
ÜÜ 
	WriteLine
ÜÜ !
(
ÜÜ! "
$str
ÜÜ" :
+
ÜÜ; <
$str
ÜÜ= A
+
ÜÜB C
ex
ÜÜD F
.
ÜÜF G
Message
ÜÜG N
,
ÜÜN O
null
ÜÜP T
,
ÜÜT U
false
ÜÜV [
)
ÜÜ[ \
;
ÜÜ\ ]
}
áá 
}
àà 	
public
ââ 
void
ââ 
Dispose
ââ 
(
ââ 
)
ââ 
{
ää 	
SendMail
ãã 
(
ãã 
)
ãã 
;
ãã 
TaskManager
åå 
.
åå 
Abort
åå 
(
åå 
)
åå 
;
åå  
}
çç 	
}
éé 
public
èè 

class
èè 
NotificationLog
èè  
{
êê 
public
ëë 
string
ëë 
DistributorName
ëë %
{
ëë& '
get
ëë( +
;
ëë+ ,
set
ëë- 0
;
ëë0 1
}
ëë2 3
public
íí 
string
íí 
InvoiceNumber
íí #
{
íí$ %
get
íí& )
;
íí) *
set
íí+ .
;
íí. /
}
íí0 1
public
ìì 
string
ìì "
CustomerOperatorCode
ìì *
{
ìì+ ,
get
ìì- 0
;
ìì0 1
set
ìì2 5
;
ìì5 6
}
ìì7 8
public
îî 
string
îî "
CustomerOperatorName
îî *
{
îî+ ,
get
îî- 0
;
îî0 1
set
îî2 5
;
îî5 6
}
îî7 8
public
ïï 
string
ïï 
Imeƒ±
ïï 
{
ïï 
get
ïï  
;
ïï  !
set
ïï" %
;
ïï% &
}
ïï' (
public
ññ 
string
ññ 
ConsolidationName
ññ '
{
ññ( )
get
ññ* -
;
ññ- .
set
ññ/ 2
;
ññ2 3
}
ññ4 5
public
óó 
string
óó 
Message
óó 
{
óó 
get
óó  #
;
óó# $
set
óó% (
;
óó( )
}
óó* +
public
òò 
DateTime
òò 
Date
òò 
{
òò 
get
òò "
;
òò" #
set
òò$ '
;
òò' (
}
òò) *
public
ôô 
string
ôô 
TableRow
ôô 
{
öö 	
get
õõ 
{
úú 
return
ùù 
$str
ùù 
+
ùù 
$str
ûû 
+
ûû 
Date
ûû !
.
ûû! "
ToString
ûû" *
(
ûû* +
$str
ûû+ @
)
ûû@ A
+
ûûB C
$str
ûûD K
+
ûûL M
$str
üü 
+
üü 
DistributorName
üü ,
+
üü- .
$str
üü/ 6
+
üü7 8
$str
†† 
+
†† 
InvoiceNumber
†† *
+
††+ ,
$str
††- 4
+
††5 6
$str
°° 
+
°° "
CustomerOperatorCode
°° 1
+
°°2 3
$str
°°4 ;
+
°°< =
$str
¢¢ 
+
¢¢ "
CustomerOperatorName
¢¢ 1
+
¢¢2 3
$str
¢¢4 ;
+
¢¢< =
$str
££ 
+
££ 
Imeƒ±
££ !
+
££" #
$str
££$ +
+
££, -
$str
§§ 
+
§§ 
Message
§§ $
+
§§% &
$str
§§' .
+
§§/ 0
$str
•• 
;
•• 
}
¶¶ 
}
ßß 	
}
®® 
}©© Ÿõ
tD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Utils\ServiceInstaller.cs
	namespace 	
ServiceInstaller
 
{ 
[ 
Flags 

]
 
public		 

enum		  
ServiceManagerRights		 $
{

 
Connect 
= 
$num 
, 
CreateService 
= 
$num 
, 
EnumerateService 
= 
$num !
,! "
Lock 
= 
$num 
, 
QueryLockStatus 
= 
$num  
,  !
ModifyBootConfig"" 
="" 
$num"" !
,""! ""
StandardRightsRequired&& 
=&&  
$num&&! (
,&&( )
	AllAccess** 
=** 
(** "
StandardRightsRequired** +
|**, -
Connect**. 5
|**6 7
CreateService**8 E
|**F G
EnumerateService++ 
|++ 
Lock++ 
|++  !
QueryLockStatus++" 1
|++2 3
ModifyBootConfig++4 D
)++D E
},, 
[11 
Flags11 

]11
 
public22 

enum22 
ServiceRights22 
{33 
QueryConfig77 
=77 
$num77 
,77 
ChangeConfig;; 
=;; 
$num;; 
,;; 
QueryStatus?? 
=?? 
$num?? 
,?? 
EnumerateDependantsCC 
=CC 
$numCC !
,CC! "
StartGG 
=GG 
$numGG 
,GG 
StopKK 
=KK 
$numKK 
,KK 
PauseContinueOO 
=OO 
$numOO 
,OO 
InterrogateSS 
=SS 
$numSS 
,SS 
UserDefinedControlWW 
=WW 
$numWW "
,WW" #
Delete[[ 
=[[ 
$num[[ 
,[[ "
StandardRightsRequired__ 
=__  
$num__! (
,__( )
	AllAccesscc 
=cc 
(cc "
StandardRightsRequiredcc +
|cc, -
QueryConfigcc. 9
|cc: ;
ChangeConfigcc< H
|ccI J
QueryStatusdd 
|dd 
EnumerateDependantsdd )
|dd* +
Startdd, 1
|dd2 3
Stopdd4 8
|dd9 :
PauseContinuedd; H
|ddI J
Interrogateee 
|ee 
UserDefinedControlee (
)ee( )
}ff 
publickk 

enumkk 
ServiceBootFlagkk 
{ll 
Startpp 
=pp 
$numpp 
,pp 
SystemStarttt 
=tt 
$numtt  
,tt  !
	AutoStartxx 
=xx 
$numxx 
,xx 
DemandStart|| 
=|| 
$num||  
,||  !
Disabled
ÄÄ 
=
ÄÄ 
$num
ÄÄ 
}
ÅÅ 
public
ÜÜ 

enum
ÜÜ 
ServiceState
ÜÜ 
{
áá 
Unknown
ãã 
=
ãã 
-
ãã 
$num
ãã 
,
ãã 
NotFound
èè 
=
èè 
$num
èè 
,
èè 
Stop
ìì 
=
ìì 
$num
ìì 
,
ìì 
Run
óó 
=
óó 
$num
óó 
,
óó 
Stopping
õõ 
=
õõ 
$num
õõ 
,
õõ 
Starting
üü 
=
üü 
$num
üü 
,
üü 
}
†† 
public
•• 

enum
•• 
ServiceControl
•• 
{
¶¶ 
Stop
™™ 
=
™™ 
$num
™™ 
,
™™ 
Pause
ÆÆ 
=
ÆÆ 
$num
ÆÆ 
,
ÆÆ 
Continue
≤≤ 
=
≤≤ 
$num
≤≤ 
,
≤≤ 
Interrogate
∂∂ 
=
∂∂ 
$num
∂∂  
,
∂∂  !
Shutdown
∫∫ 
=
∫∫ 
$num
∫∫ 
,
∫∫ 
ParamChange
ææ 
=
ææ 
$num
ææ  
,
ææ  !

NetBindAdd
¬¬ 
=
¬¬ 
$num
¬¬ 
,
¬¬  
NetBindRemove
∆∆ 
=
∆∆ 
$num
∆∆ "
,
∆∆" #
NetBindEnable
   
=
   
$num
   "
,
  " #
NetBindDisable
ŒŒ 
=
ŒŒ 
$num
ŒŒ #
}
œœ 
public
‘‘ 

enum
‘‘ 
ServiceError
‘‘ 
{
’’ 
Ignore
ŸŸ 
=
ŸŸ 
$num
ŸŸ 
,
ŸŸ 
Normal
›› 
=
›› 
$num
›› 
,
›› 
Severe
·· 
=
·· 
$num
·· 
,
·· 
Critical
ÂÂ 
=
ÂÂ 
$num
ÂÂ 
}
ÊÊ 
public
ÎÎ 

class
ÎÎ 
SvcInstaller
ÎÎ 
{
ÏÏ 
private
ÓÓ 
const
ÓÓ 
int
ÓÓ &
STANDARD_RIGHTS_REQUIRED
ÓÓ 2
=
ÓÓ3 4
$num
ÓÓ5 <
;
ÓÓ< =
private
ÔÔ 
const
ÔÔ 
int
ÔÔ '
SERVICE_WIN32_OWN_PROCESS
ÔÔ 3
=
ÔÔ4 5
$num
ÔÔ6 @
;
ÔÔ@ A
[
ÒÒ 	
StructLayout
ÒÒ	 
(
ÒÒ 

LayoutKind
ÒÒ  
.
ÒÒ  !

Sequential
ÒÒ! +
)
ÒÒ+ ,
]
ÒÒ, -
private
ÚÚ 
class
ÚÚ 
SERVICE_STATUS
ÚÚ $
{
ÛÛ 	
public
ÙÙ 
int
ÙÙ 
dwServiceType
ÙÙ $
=
ÙÙ% &
$num
ÙÙ' (
;
ÙÙ( )
public
ıı 
ServiceState
ıı 
dwCurrentState
ıı  .
=
ıı/ 0
$num
ıı1 2
;
ıı2 3
public
ˆˆ 
int
ˆˆ  
dwControlsAccepted
ˆˆ )
=
ˆˆ* +
$num
ˆˆ, -
;
ˆˆ- .
public
˜˜ 
int
˜˜ 
dwWin32ExitCode
˜˜ &
=
˜˜' (
$num
˜˜) *
;
˜˜* +
public
¯¯ 
int
¯¯ '
dwServiceSpecificExitCode
¯¯ 0
=
¯¯1 2
$num
¯¯3 4
;
¯¯4 5
public
˘˘ 
int
˘˘ 
dwCheckPoint
˘˘ #
=
˘˘$ %
$num
˘˘& '
;
˘˘' (
public
˙˙ 
int
˙˙ 

dwWaitHint
˙˙ !
=
˙˙" #
$num
˙˙$ %
;
˙˙% &
}
˚˚ 	
[
˝˝ 	
	DllImport
˝˝	 
(
˝˝ 
$str
˝˝ !
,
˝˝! "

EntryPoint
˝˝# -
=
˝˝. /
$str
˝˝0 @
)
˝˝@ A
]
˝˝A B
private
˛˛ 
static
˛˛ 
extern
˛˛ 
IntPtr
˛˛ $
OpenSCManager
˛˛% 2
(
˛˛2 3
string
˛˛3 9
lpMachineName
˛˛: G
,
˛˛G H
string
˛˛I O
lpDatabaseName
˛˛P ^
,
˛˛^ _"
ServiceManagerRights
˛˛` t
dwDesiredAccess˛˛u Ñ
)˛˛Ñ Ö
;˛˛Ö Ü
[
ÄÄ 	
	DllImport
ÄÄ	 
(
ÄÄ 
$str
ÄÄ !
,
ÄÄ! "

EntryPoint
ÄÄ# -
=
ÄÄ. /
$str
ÄÄ0 >
,
ÄÄ> ?
CharSet
ÅÅ 
=
ÅÅ 
CharSet
ÅÅ 
.
ÅÅ 
Ansi
ÅÅ 
)
ÅÅ 
]
ÅÅ  
private
ÉÉ 
static
ÉÉ 
extern
ÉÉ 
IntPtr
ÉÉ $
OpenService
ÉÉ% 0
(
ÉÉ0 1
IntPtr
ÉÉ1 7

hSCManager
ÉÉ8 B
,
ÉÉB C
string
ÉÉD J
lpServiceName
ÑÑ 
,
ÑÑ 
ServiceRights
ÑÑ $
dwDesiredAccess
ÑÑ% 4
)
ÑÑ4 5
;
ÑÑ5 6
[
ÜÜ 	
	DllImport
ÜÜ	 
(
ÜÜ 
$str
ÜÜ !
,
ÜÜ! "

EntryPoint
ÜÜ# -
=
ÜÜ. /
$str
ÜÜ0 @
)
ÜÜ@ A
]
ÜÜA B
private
áá 
static
áá 
extern
áá 
IntPtr
áá $
CreateService
áá% 2
(
áá2 3
IntPtr
áá3 9

hSCManager
áá: D
,
ááD E
string
ááF L
lpServiceName
àà 
,
àà 
string
àà 
lpDisplayName
àà +
,
àà+ ,
ServiceRights
àà- :
dwDesiredAccess
àà; J
,
ààJ K
int
ààL O
dwServiceType
ââ 
,
ââ 
ServiceBootFlag
ââ &
dwStartType
ââ' 2
,
ââ2 3
ServiceError
ââ4 @
dwErrorControl
ââA O
,
ââO P
string
ää 
lpBinaryPathName
ää 
,
ää  
string
ää! '
lpLoadOrderGroup
ää( 8
,
ää8 9
IntPtr
ää: @
	lpdwTagId
ääA J
,
ääJ K
string
ääL R
lpDependencies
ãã 
,
ãã 
string
ãã 
lp
ãã !
,
ãã! "
string
ãã# )

lpPassword
ãã* 4
)
ãã4 5
;
ãã5 6
[
éé 	
	DllImport
éé	 
(
éé 
$str
éé !
)
éé! "
]
éé" #
private
èè 
static
èè 
extern
èè 
int
èè ! 
CloseServiceHandle
èè" 4
(
èè4 5
IntPtr
èè5 ;
	hSCObject
èè< E
)
èèE F
;
èèF G
[
ëë 	
	DllImport
ëë	 
(
ëë 
$str
ëë !
)
ëë! "
]
ëë" #
private
íí 
static
íí 
extern
íí 
int
íí ! 
QueryServiceStatus
íí" 4
(
íí4 5
IntPtr
íí5 ;
hService
íí< D
,
ííD E
SERVICE_STATUS
ííF T
lpServiceStatus
ííU d
)
ííd e
;
ííe f
[
îî 	
	DllImport
îî	 
(
îî 
$str
îî !
,
îî! "
SetLastError
îî# /
=
îî0 1
true
îî2 6
)
îî6 7
]
îî7 8
private
ïï 
static
ïï 
extern
ïï 
int
ïï !
DeleteService
ïï" /
(
ïï/ 0
IntPtr
ïï0 6
hService
ïï7 ?
)
ïï? @
;
ïï@ A
[
óó 	
	DllImport
óó	 
(
óó 
$str
óó !
)
óó! "
]
óó" #
private
òò 
static
òò 
extern
òò 
int
òò !
ControlService
òò" 0
(
òò0 1
IntPtr
òò1 7
hService
òò8 @
,
òò@ A
ServiceControl
òòB P
	dwControl
òòQ Z
,
òòZ [
SERVICE_STATUS
òò\ j
lpServiceStatus
òòk z
)
òòz {
;
òò{ |
[
öö 	
	DllImport
öö	 
(
öö 
$str
öö !
,
öö! "

EntryPoint
öö# -
=
öö. /
$str
öö0 ?
)
öö? @
]
öö@ A
private
õõ 
static
õõ 
extern
õõ 
int
õõ !
StartService
õõ" .
(
õõ. /
IntPtr
õõ/ 5
hService
õõ6 >
,
õõ> ?
int
õõ@ C
dwNumServiceArgs
úú 
,
úú 
int
úú !
lpServiceArgVectors
úú 1
)
úú1 2
;
úú2 3
public
°° 
SvcInstaller
°° 
(
°° 
)
°° 
{
¢¢ 	
}
££ 	
public
©© 
static
©© 
void
©© 
	Uninstall
©© $
(
©©$ %
string
©©% +
ServiceName
©©, 7
)
©©7 8
{
™™ 	
IntPtr
´´ 
scman
´´ 
=
´´ 
OpenSCManager
´´ (
(
´´( )"
ServiceManagerRights
´´) =
.
´´= >
Connect
´´> E
)
´´E F
;
´´F G
try
¨¨ 
{
≠≠ 
IntPtr
ÆÆ 
service
ÆÆ 
=
ÆÆ  
OpenService
ÆÆ! ,
(
ÆÆ, -
scman
ÆÆ- 2
,
ÆÆ2 3
ServiceName
ÆÆ4 ?
,
ÆÆ? @
ServiceRights
ØØ 
.
ØØ $
StandardRightsRequired
ØØ 4
|
ØØ5 6
ServiceRights
ØØ7 D
.
ØØD E
Stop
ØØE I
|
ØØJ K
ServiceRights
∞∞ 
.
∞∞ 
QueryStatus
∞∞ )
)
∞∞) *
;
∞∞* +
if
±± 
(
±± 
service
±± 
==
±± 
IntPtr
±± %
.
±±% &
Zero
±±& *
)
±±* +
{
≤≤ 
throw
≥≥ 
new
≥≥ "
ApplicationException
≥≥ 2
(
≥≥2 3
$str
≥≥3 R
)
≥≥R S
;
≥≥S T
}
¥¥ 
try
µµ 
{
∂∂ 
StopService
∑∑ 
(
∑∑  
service
∑∑  '
)
∑∑' (
;
∑∑( )
int
∏∏ 
ret
∏∏ 
=
∏∏ 
DeleteService
∏∏ +
(
∏∏+ ,
service
∏∏, 3
)
∏∏3 4
;
∏∏4 5
if
ππ 
(
ππ 
ret
ππ 
==
ππ 
$num
ππ  
)
ππ  !
{
∫∫ 
int
ªª 
error
ªª !
=
ªª" #
Marshal
ªª$ +
.
ªª+ ,
GetLastWin32Error
ªª, =
(
ªª= >
)
ªª> ?
;
ªª? @
throw
ºº 
new
ºº !"
ApplicationException
ºº" 6
(
ºº6 7
$str
ºº7 U
+
ººV W
error
ººX ]
)
ºº] ^
;
ºº^ _
}
ΩΩ 
}
ææ 
finally
øø 
{
¿¿  
CloseServiceHandle
¡¡ &
(
¡¡& '
service
¡¡' .
)
¡¡. /
;
¡¡/ 0
}
¬¬ 
}
√√ 
finally
ƒƒ 
{
≈≈  
CloseServiceHandle
∆∆ "
(
∆∆" #
scman
∆∆# (
)
∆∆( )
;
∆∆) *
}
«« 
}
»» 	
public
œœ 
static
œœ 
bool
œœ  
ServiceIsInstalled
œœ -
(
œœ- .
string
œœ. 4
ServiceName
œœ5 @
)
œœ@ A
{
–– 	
IntPtr
—— 
scman
—— 
=
—— 
OpenSCManager
—— (
(
——( )"
ServiceManagerRights
——) =
.
——= >
Connect
——> E
)
——E F
;
——F G
try
““ 
{
”” 
IntPtr
‘‘ 
service
‘‘ 
=
‘‘  
OpenService
‘‘! ,
(
‘‘, -
scman
‘‘- 2
,
‘‘2 3
ServiceName
‘‘4 ?
,
‘‘? @
ServiceRights
’’ 
.
’’ 
QueryStatus
’’ )
)
’’) *
;
’’* +
if
÷÷ 
(
÷÷ 
service
÷÷ 
==
÷÷ 
IntPtr
÷÷ %
.
÷÷% &
Zero
÷÷& *
)
÷÷* +
return
÷÷, 2
false
÷÷3 8
;
÷÷8 9 
CloseServiceHandle
◊◊ "
(
◊◊" #
service
◊◊# *
)
◊◊* +
;
◊◊+ ,
return
ÿÿ 
true
ÿÿ 
;
ÿÿ 
}
ŸŸ 
finally
⁄⁄ 
{
€€  
CloseServiceHandle
‹‹ "
(
‹‹" #
scman
‹‹# (
)
‹‹( )
;
‹‹) *
}
›› 
}
ﬁﬁ 	
public
ÊÊ 
static
ÊÊ 
void
ÊÊ 
Install
ÊÊ "
(
ÊÊ" #
string
ÊÊ# )
ServiceName
ÊÊ* 5
,
ÊÊ5 6
string
ÊÊ7 =
DisplayName
ÊÊ> I
,
ÊÊI J
string
ÁÁ 
FileName
ÁÁ 
,
ÁÁ 
bool
ÁÁ 
start
ÁÁ #
)
ÁÁ# $
{
ËË 	
IntPtr
ÈÈ 
scman
ÈÈ 
=
ÈÈ 
OpenSCManager
ÈÈ (
(
ÈÈ( )"
ServiceManagerRights
ÈÈ) =
.
ÈÈ= >
Connect
ÈÈ> E
|
ÈÈF G"
ServiceManagerRights
ÍÍ  
.
ÍÍ  !
CreateService
ÍÍ! .
)
ÍÍ. /
;
ÍÍ/ 0
try
ÎÎ 
{
ÏÏ 
IntPtr
ÌÌ 
service
ÌÌ 
=
ÌÌ  
OpenService
ÌÌ! ,
(
ÌÌ, -
scman
ÌÌ- 2
,
ÌÌ2 3
ServiceName
ÌÌ4 ?
,
ÌÌ? @
ServiceRights
ÓÓ 
.
ÓÓ 
QueryStatus
ÓÓ )
|
ÓÓ* +
ServiceRights
ÓÓ, 9
.
ÓÓ9 :
Start
ÓÓ: ?
)
ÓÓ? @
;
ÓÓ@ A
if
ÔÔ 
(
ÔÔ 
service
ÔÔ 
==
ÔÔ 
IntPtr
ÔÔ %
.
ÔÔ% &
Zero
ÔÔ& *
)
ÔÔ* +
{
 
service
ÒÒ 
=
ÒÒ 
CreateService
ÒÒ +
(
ÒÒ+ ,
scman
ÒÒ, 1
,
ÒÒ1 2
ServiceName
ÒÒ3 >
,
ÒÒ> ?
DisplayName
ÒÒ@ K
,
ÒÒK L
ServiceRights
ÚÚ !
.
ÚÚ! "
QueryStatus
ÚÚ" -
|
ÚÚ. /
ServiceRights
ÚÚ0 =
.
ÚÚ= >
Start
ÚÚ> C
,
ÚÚC D'
SERVICE_WIN32_OWN_PROCESS
ÚÚE ^
,
ÚÚ^ _
ServiceBootFlag
ÛÛ #
.
ÛÛ# $
	AutoStart
ÛÛ$ -
,
ÛÛ- .
ServiceError
ÛÛ/ ;
.
ÛÛ; <
Normal
ÛÛ< B
,
ÛÛB C
FileName
ÛÛD L
,
ÛÛL M
null
ÛÛN R
,
ÛÛR S
IntPtr
ÛÛT Z
.
ÛÛZ [
Zero
ÛÛ[ _
,
ÛÛ_ `
null
ÙÙ 
,
ÙÙ 
null
ÙÙ 
,
ÙÙ 
null
ÙÙ  $
)
ÙÙ$ %
;
ÙÙ% &
}
ıı 
if
ˆˆ 
(
ˆˆ 
service
ˆˆ 
==
ˆˆ 
IntPtr
ˆˆ %
.
ˆˆ% &
Zero
ˆˆ& *
)
ˆˆ* +
{
˜˜ 
throw
¯¯ 
new
¯¯ "
ApplicationException
¯¯ 2
(
¯¯2 3
$str
¯¯3 Y
)
¯¯Y Z
;
¯¯Z [
}
˘˘ 
if
˙˙ 
(
˙˙ 
start
˙˙ 
)
˙˙ 
{
˚˚ 
try
¸¸ 
{
˝˝ 
StartService
˛˛ $
(
˛˛$ %
service
˛˛% ,
)
˛˛, -
;
˛˛- .
}
ˇˇ 
finally
ÄÄ 
{
ÅÅ  
CloseServiceHandle
ÇÇ *
(
ÇÇ* +
service
ÇÇ+ 2
)
ÇÇ2 3
;
ÇÇ3 4
}
ÉÉ 
}
ÑÑ 
}
ÖÖ 
finally
ÜÜ 
{
áá  
CloseServiceHandle
àà "
(
àà" #
scman
àà# (
)
àà( )
;
àà) *
}
ââ 
}
ää 	
public
ëë 
static
ëë 
void
ëë 
StartService
ëë '
(
ëë' (
string
ëë( .
Name
ëë/ 3
)
ëë3 4
{
íí 	
IntPtr
ìì 
scman
ìì 
=
ìì 
OpenSCManager
ìì (
(
ìì( )"
ServiceManagerRights
ìì) =
.
ìì= >
Connect
ìì> E
)
ììE F
;
ììF G
try
îî 
{
ïï 
IntPtr
ññ 
hService
ññ 
=
ññ  !
OpenService
ññ" -
(
ññ- .
scman
ññ. 3
,
ññ3 4
Name
ññ5 9
,
ññ9 :
ServiceRights
ññ; H
.
ññH I
QueryStatus
ññI T
|
ññU V
ServiceRights
óó 
.
óó 
Start
óó #
)
óó# $
;
óó$ %
if
òò 
(
òò 
hService
òò 
==
òò 
IntPtr
òò  &
.
òò& '
Zero
òò' +
)
òò+ ,
{
ôô 
throw
öö 
new
öö "
ApplicationException
öö 2
(
öö2 3
$str
öö3 L
)
ööL M
;
ööM N
}
õõ 
try
úú 
{
ùù 
StartService
ûû  
(
ûû  !
hService
ûû! )
)
ûû) *
;
ûû* +
}
üü 
finally
†† 
{
°°  
CloseServiceHandle
¢¢ &
(
¢¢& '
hService
¢¢' /
)
¢¢/ 0
;
¢¢0 1
}
££ 
}
§§ 
finally
•• 
{
¶¶  
CloseServiceHandle
ßß "
(
ßß" #
scman
ßß# (
)
ßß( )
;
ßß) *
}
®® 
}
©© 	
public
ØØ 
static
ØØ 
void
ØØ 
StopService
ØØ &
(
ØØ& '
string
ØØ' -
Name
ØØ. 2
)
ØØ2 3
{
∞∞ 	
IntPtr
±± 
scman
±± 
=
±± 
OpenSCManager
±± (
(
±±( )"
ServiceManagerRights
±±) =
.
±±= >
Connect
±±> E
)
±±E F
;
±±F G
try
≤≤ 
{
≥≥ 
IntPtr
¥¥ 
hService
¥¥ 
=
¥¥  !
OpenService
¥¥" -
(
¥¥- .
scman
¥¥. 3
,
¥¥3 4
Name
¥¥5 9
,
¥¥9 :
ServiceRights
¥¥; H
.
¥¥H I
QueryStatus
¥¥I T
|
¥¥U V
ServiceRights
µµ 
.
µµ 
Stop
µµ "
)
µµ" #
;
µµ# $
if
∂∂ 
(
∂∂ 
hService
∂∂ 
==
∂∂ 
IntPtr
∂∂  &
.
∂∂& '
Zero
∂∂' +
)
∂∂+ ,
{
∑∑ 
throw
∏∏ 
new
∏∏ "
ApplicationException
∏∏ 2
(
∏∏2 3
$str
∏∏3 L
)
∏∏L M
;
∏∏M N
}
ππ 
try
∫∫ 
{
ªª 
StopService
ºº 
(
ºº  
hService
ºº  (
)
ºº( )
;
ºº) *
}
ΩΩ 
finally
ææ 
{
øø  
CloseServiceHandle
¿¿ &
(
¿¿& '
hService
¿¿' /
)
¿¿/ 0
;
¿¿0 1
}
¡¡ 
}
¬¬ 
finally
√√ 
{
ƒƒ  
CloseServiceHandle
≈≈ "
(
≈≈" #
scman
≈≈# (
)
≈≈( )
;
≈≈) *
}
∆∆ 
}
«« 	
private
ÕÕ 
static
ÕÕ 
void
ÕÕ 
StartService
ÕÕ (
(
ÕÕ( )
IntPtr
ÕÕ) /
hService
ÕÕ0 8
)
ÕÕ8 9
{
ŒŒ 	
SERVICE_STATUS
œœ 
status
œœ !
=
œœ" #
new
œœ$ '
SERVICE_STATUS
œœ( 6
(
œœ6 7
)
œœ7 8
;
œœ8 9
StartService
–– 
(
–– 
hService
–– !
,
––! "
$num
––# $
,
––$ %
$num
––& '
)
––' (
;
––( )"
WaitForServiceStatus
——  
(
——  !
hService
——! )
,
——) *
ServiceState
——+ 7
.
——7 8
Starting
——8 @
,
——@ A
ServiceState
——B N
.
——N O
Run
——O R
)
——R S
;
——S T
}
““ 	
private
ÿÿ 
static
ÿÿ 
void
ÿÿ 
StopService
ÿÿ '
(
ÿÿ' (
IntPtr
ÿÿ( .
hService
ÿÿ/ 7
)
ÿÿ7 8
{
ŸŸ 	
SERVICE_STATUS
⁄⁄ 
status
⁄⁄ !
=
⁄⁄" #
new
⁄⁄$ '
SERVICE_STATUS
⁄⁄( 6
(
⁄⁄6 7
)
⁄⁄7 8
;
⁄⁄8 9
ControlService
€€ 
(
€€ 
hService
€€ #
,
€€# $
ServiceControl
€€% 3
.
€€3 4
Stop
€€4 8
,
€€8 9
status
€€: @
)
€€@ A
;
€€A B"
WaitForServiceStatus
‹‹  
(
‹‹  !
hService
‹‹! )
,
‹‹) *
ServiceState
‹‹+ 7
.
‹‹7 8
Stopping
‹‹8 @
,
‹‹@ A
ServiceState
‹‹B N
.
‹‹N O
Stop
‹‹O S
)
‹‹S T
;
‹‹T U
}
›› 	
public
‰‰ 
static
‰‰ 
ServiceState
‰‰ "
GetServiceStatus
‰‰# 3
(
‰‰3 4
string
‰‰4 :
ServiceName
‰‰; F
)
‰‰F G
{
ÂÂ 	
IntPtr
ÊÊ 
scman
ÊÊ 
=
ÊÊ 
OpenSCManager
ÊÊ (
(
ÊÊ( )"
ServiceManagerRights
ÊÊ) =
.
ÊÊ= >
Connect
ÊÊ> E
)
ÊÊE F
;
ÊÊF G
try
ÁÁ 
{
ËË 
IntPtr
ÈÈ 
hService
ÈÈ 
=
ÈÈ  !
OpenService
ÈÈ" -
(
ÈÈ- .
scman
ÈÈ. 3
,
ÈÈ3 4
ServiceName
ÈÈ5 @
,
ÈÈ@ A
ServiceRights
ÍÍ 
.
ÍÍ 
QueryStatus
ÍÍ )
)
ÍÍ) *
;
ÍÍ* +
if
ÎÎ 
(
ÎÎ 
hService
ÎÎ 
==
ÎÎ 
IntPtr
ÎÎ  &
.
ÎÎ& '
Zero
ÎÎ' +
)
ÎÎ+ ,
{
ÏÏ 
return
ÌÌ 
ServiceState
ÌÌ '
.
ÌÌ' (
NotFound
ÌÌ( 0
;
ÌÌ0 1
}
ÓÓ 
try
ÔÔ 
{
 
return
ÒÒ 
GetServiceStatus
ÒÒ +
(
ÒÒ+ ,
hService
ÒÒ, 4
)
ÒÒ4 5
;
ÒÒ5 6
}
ÚÚ 
finally
ÛÛ 
{
ÙÙ  
CloseServiceHandle
ıı &
(
ıı& '
scman
ıı' ,
)
ıı, -
;
ıı- .
}
ˆˆ 
}
˜˜ 
finally
¯¯ 
{
˘˘  
CloseServiceHandle
˙˙ "
(
˙˙" #
scman
˙˙# (
)
˙˙( )
;
˙˙) *
}
˚˚ 
}
¸¸ 	
private
ÉÉ 
static
ÉÉ 
ServiceState
ÉÉ #
GetServiceStatus
ÉÉ$ 4
(
ÉÉ4 5
IntPtr
ÉÉ5 ;
hService
ÉÉ< D
)
ÉÉD E
{
ÑÑ 	
SERVICE_STATUS
ÖÖ 
ssStatus
ÖÖ #
=
ÖÖ$ %
new
ÖÖ& )
SERVICE_STATUS
ÖÖ* 8
(
ÖÖ8 9
)
ÖÖ9 :
;
ÖÖ: ;
if
ÜÜ 
(
ÜÜ  
QueryServiceStatus
ÜÜ "
(
ÜÜ" #
hService
ÜÜ# +
,
ÜÜ+ ,
ssStatus
ÜÜ- 5
)
ÜÜ5 6
==
ÜÜ7 9
$num
ÜÜ: ;
)
ÜÜ; <
{
áá 
throw
àà 
new
àà "
ApplicationException
àà .
(
àà. /
$str
àà/ Q
)
ààQ R
;
ààR S
}
ââ 
return
ää 
ssStatus
ää 
.
ää 
dwCurrentState
ää *
;
ää* +
}
ãã 	
private
ïï 
static
ïï 
bool
ïï "
WaitForServiceStatus
ïï 0
(
ïï0 1
IntPtr
ïï1 7
hService
ïï8 @
,
ïï@ A
ServiceState
ïïB N

WaitStatus
ññ 
,
ññ 
ServiceState
ññ  
DesiredStatus
ññ! .
)
ññ. /
{
óó 	
SERVICE_STATUS
òò 
ssStatus
òò #
=
òò$ %
new
òò& )
SERVICE_STATUS
òò* 8
(
òò8 9
)
òò9 :
;
òò: ;
int
ôô 
dwOldCheckPoint
ôô 
;
ôô  
int
öö 
dwStartTickCount
öö  
;
öö  ! 
QueryServiceStatus
úú 
(
úú 
hService
úú '
,
úú' (
ssStatus
úú) 1
)
úú1 2
;
úú2 3
if
ùù 
(
ùù 
ssStatus
ùù 
.
ùù 
dwCurrentState
ùù '
==
ùù( *
DesiredStatus
ùù+ 8
)
ùù8 9
return
ùù: @
true
ùùA E
;
ùùE F
dwStartTickCount
ûû 
=
ûû 
Environment
ûû *
.
ûû* +
	TickCount
ûû+ 4
;
ûû4 5
dwOldCheckPoint
üü 
=
üü 
ssStatus
üü &
.
üü& '
dwCheckPoint
üü' 3
;
üü3 4
while
°° 
(
°° 
ssStatus
°° 
.
°° 
dwCurrentState
°° *
==
°°+ -

WaitStatus
°°. 8
)
°°8 9
{
¢¢ 
int
ßß 

dwWaitTime
ßß 
=
ßß  
ssStatus
ßß! )
.
ßß) *

dwWaitHint
ßß* 4
/
ßß5 6
$num
ßß7 9
;
ßß9 :
if
©© 
(
©© 

dwWaitTime
©© 
<
©©  
$num
©©! %
)
©©% &

dwWaitTime
©©' 1
=
©©2 3
$num
©©4 8
;
©©8 9
else
™™ 
if
™™ 
(
™™ 

dwWaitTime
™™ #
>
™™$ %
$num
™™& +
)
™™+ ,

dwWaitTime
™™- 7
=
™™8 9
$num
™™: ?
;
™™? @
System
¨¨ 
.
¨¨ 
	Threading
¨¨  
.
¨¨  !
Thread
¨¨! '
.
¨¨' (
Sleep
¨¨( -
(
¨¨- .

dwWaitTime
¨¨. 8
)
¨¨8 9
;
¨¨9 :
if
∞∞ 
(
∞∞  
QueryServiceStatus
∞∞ &
(
∞∞& '
hService
∞∞' /
,
∞∞/ 0
ssStatus
∞∞1 9
)
∞∞9 :
==
∞∞; =
$num
∞∞> ?
)
∞∞? @
break
∞∞A F
;
∞∞F G
if
≤≤ 
(
≤≤ 
ssStatus
≤≤ 
.
≤≤ 
dwCheckPoint
≤≤ )
>
≤≤* +
dwOldCheckPoint
≤≤, ;
)
≤≤; <
{
≥≥ 
dwStartTickCount
µµ $
=
µµ% &
Environment
µµ' 2
.
µµ2 3
	TickCount
µµ3 <
;
µµ< =
dwOldCheckPoint
∂∂ #
=
∂∂$ %
ssStatus
∂∂& .
.
∂∂. /
dwCheckPoint
∂∂/ ;
;
∂∂; <
}
∑∑ 
else
∏∏ 
{
ππ 
if
∫∫ 
(
∫∫ 
Environment
∫∫ #
.
∫∫# $
	TickCount
∫∫$ -
-
∫∫. /
dwStartTickCount
∫∫0 @
>
∫∫A B
ssStatus
∫∫C K
.
∫∫K L

dwWaitHint
∫∫L V
)
∫∫V W
{
ªª 
break
ΩΩ 
;
ΩΩ 
}
ææ 
}
øø 
}
¿¿ 
return
¡¡ 
(
¡¡ 
ssStatus
¡¡ 
.
¡¡ 
dwCurrentState
¡¡ +
==
¡¡, .
DesiredStatus
¡¡/ <
)
¡¡< =
;
¡¡= >
}
¬¬ 	
private
…… 
static
…… 
IntPtr
…… 
OpenSCManager
…… +
(
……+ ,"
ServiceManagerRights
……, @
Rights
……A G
)
……G H
{
   	
IntPtr
ÀÀ 
scman
ÀÀ 
=
ÀÀ 
OpenSCManager
ÀÀ (
(
ÀÀ( )
null
ÀÀ) -
,
ÀÀ- .
null
ÀÀ/ 3
,
ÀÀ3 4
Rights
ÀÀ5 ;
)
ÀÀ; <
;
ÀÀ< =
if
ÃÃ 
(
ÃÃ 
scman
ÃÃ 
==
ÃÃ 
IntPtr
ÃÃ 
.
ÃÃ  
Zero
ÃÃ  $
)
ÃÃ$ %
{
ÕÕ 
throw
ŒŒ 
new
ŒŒ "
ApplicationException
ŒŒ .
(
ŒŒ. /
$str
ŒŒ/ T
)
ŒŒT U
;
ŒŒU V
}
œœ 
return
–– 
scman
–– 
;
–– 
}
—— 	
[
““ 	
	DllImport
““	 
(
““ 
$str
““ 
)
““ 
]
““  
static
”” 
extern
”” 
int
”” &
CoWaitForMultipleHandles
”” 2
(
””2 3
uint
””3 7
dwFlags
””8 ?
,
””? @
uint
””A E
	dwTimeout
””F O
,
””O P
uint
‘‘ 
cHandles
‘‘ 
,
‘‘ 
IntPtr
‘‘  
[
‘‘  !
]
‘‘! "
pHandles
‘‘# +
,
‘‘+ ,
out
‘‘- 0
uint
‘‘1 5
	lpdwindex
‘‘6 ?
)
‘‘? @
;
‘‘@ A
public
÷÷ 
static
÷÷ 
void
÷÷ 
ServisInstall
÷÷ (
(
÷÷( )
String
÷÷) /
ServiceName
÷÷0 ;
,
÷÷; <
bool
÷÷= A
	ReInstall
÷÷B K
,
÷÷K L
bool
÷÷M Q
Start
÷÷R W
,
÷÷W X
string
÷÷Y _
path
÷÷` d
)
÷÷d e
{
◊◊ 	
if
ÿÿ 
(
ÿÿ 
	ReInstall
ÿÿ 
)
ÿÿ 
{
ŸŸ 
ServisUnInstall
⁄⁄ 
(
⁄⁄  
ServiceName
⁄⁄  +
)
⁄⁄+ ,
;
⁄⁄, -
SvcInstaller
€€ 
.
€€ 
Install
€€ $
(
€€$ %
ServiceName
€€% 0
,
€€0 1
ServiceName
€€2 =
,
€€= >
path
€€? C
,
€€C D
true
€€E I
)
€€I J
;
€€J K
}
‹‹ 
else
›› 
{
ﬁﬁ 
var
ﬂﬂ 
s
ﬂﬂ 
=
ﬂﬂ 
SvcInstaller
ﬂﬂ $
.
ﬂﬂ$ %
GetServiceStatus
ﬂﬂ% 5
(
ﬂﬂ5 6
ServiceName
ﬂﬂ6 A
)
ﬂﬂA B
;
ﬂﬂB C
if
‡‡ 
(
‡‡ 
s
‡‡ 
==
‡‡ 
ServiceState
‡‡ %
.
‡‡% &
NotFound
‡‡& .
)
‡‡. /
SvcInstaller
··  
.
··  !
Install
··! (
(
··( )
ServiceName
··) 4
,
··4 5
ServiceName
··6 A
,
··A B
path
··C G
,
··G H
true
··I M
)
··M N
;
··N O
}
‚‚ 
if
„„ 
(
„„ 
Start
„„ 
)
„„ 
ServisStart
‰‰ 
(
‰‰ 
ServiceName
‰‰ '
,
‰‰' (
false
‰‰) .
,
‰‰. /
$str
‰‰0 2
)
‰‰2 3
;
‰‰3 4
}
ÂÂ 	
public
ÁÁ 
static
ÁÁ 
void
ÁÁ 
ServisUnInstall
ÁÁ *
(
ÁÁ* +
String
ÁÁ+ 1
ServiceName
ÁÁ2 =
)
ÁÁ= >
{
ËË 	
var
ÈÈ 
s
ÈÈ 
=
ÈÈ 
SvcInstaller
ÈÈ  
.
ÈÈ  !
GetServiceStatus
ÈÈ! 1
(
ÈÈ1 2
ServiceName
ÈÈ2 =
)
ÈÈ= >
;
ÈÈ> ?
if
ÍÍ 
(
ÍÍ 
s
ÍÍ 
!=
ÍÍ 
ServiceState
ÍÍ !
.
ÍÍ! "
NotFound
ÍÍ" *
)
ÍÍ* +
{
ÎÎ 
if
ÏÏ 
(
ÏÏ 
s
ÏÏ 
==
ÏÏ 
ServiceState
ÏÏ %
.
ÏÏ% &
Run
ÏÏ& )
)
ÏÏ) *
SvcInstaller
ÌÌ  
.
ÌÌ  !
StopService
ÌÌ! ,
(
ÌÌ, -
ServiceName
ÌÌ- 8
)
ÌÌ8 9
;
ÌÌ9 :
SvcInstaller
ÓÓ 
.
ÓÓ 
	Uninstall
ÓÓ &
(
ÓÓ& '
ServiceName
ÓÓ' 2
)
ÓÓ2 3
;
ÓÓ3 4
}
ÔÔ 
}
 	
public
ÚÚ 
static
ÚÚ 
void
ÚÚ 
ServisStart
ÚÚ &
(
ÚÚ& '
String
ÚÚ' -
ServiceName
ÚÚ. 9
,
ÚÚ9 :
bool
ÚÚ; ?
Install
ÚÚ@ G
,
ÚÚG H
string
ÚÚI O
path
ÚÚP T
)
ÚÚT U
{
ÛÛ 	
if
ÙÙ 
(
ÙÙ 
Install
ÙÙ 
)
ÙÙ 
ServisInstall
ıı 
(
ıı 
ServiceName
ıı )
,
ıı) *
false
ıı+ 0
,
ıı0 1
true
ıı2 6
,
ıı6 7
path
ıı8 <
)
ıı< =
;
ıı= >
else
ˆˆ 
{
˜˜ 
var
¯¯ 
s
¯¯ 
=
¯¯ 
SvcInstaller
¯¯ $
.
¯¯$ %
GetServiceStatus
¯¯% 5
(
¯¯5 6
ServiceName
¯¯6 A
)
¯¯A B
;
¯¯B C
{
˙˙ 
if
˚˚ 
(
˚˚ 
s
˚˚ 
==
˚˚ 
ServiceState
˚˚ )
.
˚˚) *
Stop
˚˚* .
)
˚˚. /
SvcInstaller
¸¸ $
.
¸¸$ %
StartService
¸¸% 1
(
¸¸1 2
ServiceName
¸¸2 =
)
¸¸= >
;
¸¸> ?
}
˝˝ 
}
˛˛ 
}
ˇˇ 	
public
ÅÅ 
static
ÅÅ 
void
ÅÅ 

ServisStop
ÅÅ %
(
ÅÅ% &
String
ÅÅ& ,
ServiceName
ÅÅ- 8
)
ÅÅ8 9
{
ÇÇ 	
var
ÉÉ 
s
ÉÉ 
=
ÉÉ 
SvcInstaller
ÉÉ  
.
ÉÉ  !
GetServiceStatus
ÉÉ! 1
(
ÉÉ1 2
ServiceName
ÉÉ2 =
)
ÉÉ= >
;
ÉÉ> ?
{
ÖÖ 
if
ÜÜ 
(
ÜÜ 
s
ÜÜ 
==
ÜÜ 
ServiceState
ÜÜ %
.
ÜÜ% &
Starting
ÜÜ& .
||
ÜÜ/ 1
s
ÜÜ2 3
==
ÜÜ4 6
ServiceState
ÜÜ7 C
.
ÜÜC D
Run
ÜÜD G
)
ÜÜG H
SvcInstaller
áá  
.
áá  !
StopService
áá! ,
(
áá, -
ServiceName
áá- 8
)
áá8 9
;
áá9 :
}
àà 
}
ââ 	
static
ãã 
void
ãã 
ServisReStart
ãã !
(
ãã! "
String
ãã" (
ServiceName
ãã) 4
,
ãã4 5
string
ãã6 <
path
ãã= A
)
ããA B
{
åå 	

ServisStop
çç 
(
çç 
ServiceName
çç "
)
çç" #
;
çç# $
ServisStart
éé 
(
éé 
ServiceName
éé #
,
éé# $
true
éé% )
,
éé) *
path
éé+ /
)
éé/ 0
;
éé0 1
}
èè 	
}
êê 
}ìì 