‡
hD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\AgentStart.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
{ 
public 

class 

AgentStart 
: 
ServiceBase )
{ 
List 
< 
Task 
> 
Tasks 
= 
new 
List #
<# $
Task$ (
>( )
() *
)* +
;+ ,
public 

AgentStart 
( 
) 
{ 	
} 	
public 
void 
Run 
( 
) 
{ 	
var &
taskProcessLogoEntegration *
=+ ,
new- 0
Task1 5
(5 6
(6 7
)7 8
=>9 ;
{ 
new "
ProcessLogoEntegration )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 
) 
; 
Tasks 
. 
Add 
( &
taskProcessLogoEntegration 0
)0 1
;1 2
var '
taskProcessTitanEntegration +
=, -
new. 1
Task2 6
(6 7
(7 8
)8 9
=>: <
{   
new!! #
ProcessTitanEntegration!! *
(!!* +
)!!+ ,
.!!, -
Run!!- 0
(!!0 1
)!!1 2
;!!2 3
}"" 
)"" 
;"" 
Tasks## 
.## 
Add## 
(## '
taskProcessTitanEntegration## 1
)##1 2
;##2 3
var%% )
taskProcessFtpDistEntegration%% -
=%%. /
new%%0 3
Task%%4 8
(%%8 9
(%%9 :
)%%: ;
=>%%< >
{&& 
new'' !
ProcessFtpEntegration'' (
(''( )
)'') *
.''* +
Run''+ .
(''. /
)''/ 0
;''0 1
}(( 
)(( 
;(( 
Tasks)) 
.)) 
Add)) 
()) )
taskProcessFtpDistEntegration)) 3
)))3 4
;))4 5)
taskProcessFtpDistEntegration,,
 '
.,,' (
Start,,( -
(,,- .
),,. /
;,,/ 0
}// 	
	protected11 
override11 
void11 
OnStart11  '
(11' (
string11( .
[11. /
]11/ 0
args111 5
)115 6
{22 	
Run33 
(33 
)33 
;33 
}44 	
	protected66 
override66 
void66 
OnStop66  &
(66& '
)66' (
{77 	
Log88 
.88 
Success88 
(88 
$str88 -
)88- .
;88. /
if99 
(99 
Tasks99 
!=99 
null99 
&&99  
Tasks99! &
.99& '
Count99' ,
>99- .
$num99/ 0
)990 1
{:: 
foreach;; 
(;; 
var;; 
task;; !
in;;" $
Tasks;;% *
);;* +
{<< 
task== 
.== 
Dispose==  
(==  !
)==! "
;==" #
}>> 
Tasks?? 
=?? 
new?? 
List??  
<??  !
Task??! %
>??% &
(??& '
)??' (
;??( )
}@@ 
}AA 	
}BB 
}CC „õ
D:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\FtpGenpa.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
public 

class 
FtpGenpa 
: &
IFtpDistributorEntegration 6
{ 
public 
FtpConfiguration 
ftpConfiguration  0
{1 2
get3 6
;6 7
private8 ?
set@ C
;C D
}E F
private 
string 
Token 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
DistributorName %
{& '
get( +
{, -
return. 4
$str5 <
;< =
}> ?
}@ A
public 
Guid 
DistributorId !
{" #
get$ '
{( )
return* 0
new1 4
Guid5 9
(9 :
$str: `
)` a
;a b
}c d
}e f
private 
string 
DirUrl 
{ 
get  #
;# $
set% (
;( )
}* +
private 
string 
LoginUrl 
{  !
get" %
;% &
set' *
;* +
}, -
public 
FtpGenpa 
( 
) 
{ 	
Log 
. 
Warning 
( 
$str 1
)1 2
;2 3
SetFtpConfiguration 
(  
)  !
;! "
Login 
( 
) 
; 
GetFilesInFtp 
( 
DateTime "
." #
Now# &
)& '
;' (
} 	
public   
WorkOfTimeDatabase   !
GetDbConnection  " 1
(  1 2
)  2 3
{!! 	
var"" 

tenantCode"" 
=""  
ConfigurationManager"" 1
.""1 2
AppSettings""2 =
[""= >
$str""> M
]""M N
.""N O
ToString""O W
(""W X
)""X Y
;""Y Z
var## 
tenant## 
=## 
TenantConfig## %
.##% &

GetTenants##& 0
(##0 1
)##1 2
.##2 3
Where##3 8
(##8 9
a##9 :
=>##; =
a##> ?
.##? @

TenantCode##@ J
==##K M
Convert##N U
.##U V
ToInt32##V ]
(##] ^

tenantCode##^ h
)##h i
)##i j
.##j k
FirstOrDefault##k y
(##y z
)##z {
;##{ |
return$$ 
tenant$$ 
.$$ 
GetDatabase$$ %
($$% &
)$$& '
;$$' (
}%% 	
public&& 
ResultStatus&& !
ExportFilesToDatabase&& 1
(&&1 2
)&&2 3
{'' 	
var(( 
processDate(( 
=(( 
DateTime(( &
.((& '
Now((' *
.((* +
AddDays((+ 2
(((2 3
-((3 4
$num((4 6
)((6 7
;((7 8
var)) 
entegrationFileList)) #
=))$ %
GetFilesInFtp))& 3
())3 4
processDate))4 ?
)))? @
;))@ A
var++ 
result++ 
=++ 
new++ 
ResultStatus++ )
(++) *
)++* +
;+++ ,
foreach,, 
(,, 
var,, 
entegrationFile,, (
in,,) +
entegrationFileList,,, ?
),,? @
{-- 
Log.. 
... 
Warning.. 
(.. 
$str.. A
,..A B
this..C G
...G H
ftpConfiguration..H X
...X Y
Url..Y \
,..\ ]
this..^ b
...b c
DistributorName..c r
,..r s
entegrationFile	..t É
.
..É Ñ
FileName
..Ñ å
)
..å ç
;
..ç é
var00 
db00 
=00 
GetDbConnection00 (
(00( )
)00) *
;00* +
result11 
=11 
db11 
.11 &
InsertPRD_EntegrationFiles11 6
(116 7
entegrationFile117 F
)11F G
;11G H
if22 
(22 
!22 
result22 
.22 
result22 "
)22" #
{33 
Log44 
.44 
Error44 
(44 
$str44 M
,44M N
result44O U
.44U V
message44V ]
)44] ^
;44^ _
continue55 
;55 
}66 
if88 
(88 
entegrationFile88 #
.88# $
FileTypeName88$ 0
==881 3
$str884 =
)88= >
{99 
var:: 
sellThr:: 
=::  !
GetSellInFilesInFtp::" 5
(::5 6
entegrationFile::6 E
.::E F
FileName::F N
,::N O
entegrationFile::P _
.::_ `
id::` b
)::b c
;::c d
if;; 
(;; 
sellThr;; 
!=;;  "
null;;# '
&&;;( *
sellThr;;+ 2
.;;2 3
Count;;3 8
(;;8 9
);;9 :
>;;; <
$num;;= >
);;> ?
{<< 
var== 
bultInsertResult== ,
===- .
db==/ 1
.==1 2+
BulkInsertPRD_EntegrationAction==2 Q
(==Q R
sellThr==R Y
)==Y Z
;==Z [
if>> 
(>> 
!>> 
bultInsertResult>> -
.>>- .
result>>. 4
)>>4 5
Log?? 
.??  
Info??  $
(??$ %
$str??% ]
,??] ^
this??_ c
.??c d
ftpConfiguration??d t
.??t u
Url??u x
,??x y
this??z ~
.??~ 
DistributorName	?? é
,
??é è
bultInsertResult
??ê †
.
??† °
message
??° ®
)
??® ©
;
??© ™
}@@ 
}AA 
LogBB 
.BB 
SuccessBB 
(BB 
$strBB C
,BBC D
thisBBE I
.BBI J
ftpConfigurationBBJ Z
.BBZ [
UrlBB[ ^
,BB^ _
thisBB` d
.BBd e
DistributorNameBBe t
,BBt u
entegrationFile	BBv Ö
.
BBÖ Ü
FileName
BBÜ é
)
BBé è
;
BBè ê
}CC 
returnDD 
resultDD 
;DD 
}EE 	
publicFF 
stringFF 
FileTypeNameFF "
(FF" #
stringFF# )
fileNameFF* 2
)FF2 3
{GG 	
ifHH 
(HH 
fileNameHH 
.HH 
ContainsHH !
(HH! "
$strHH" *
)HH* +
)HH+ ,
returnII 
$strII 
;II  
elseJJ 
ifJJ 
(JJ 
fileNameJJ 
.JJ 
ContainsJJ &
(JJ& '
$strJJ' 0
)JJ0 1
)JJ1 2
returnKK 
$strKK  
;KK  !
elseLL 
ifLL 
(LL 
fileNameLL 
.LL 
ContainsLL &
(LL& '
$strLL' -
)LL- .
)LL. /
returnMM 
$strMM  
;MM  !
elseNN 
returnOO 
nullOO 
;OO 
}PP 	
publicQQ  
PRD_EntegrationFilesQQ #
[QQ# $
]QQ$ %
GetFilesInFtpQQ& 3
(QQ3 4
DateTimeQQ4 <
processDateQQ= H
)QQH I
{RR 	
LogSS 
.SS 
InfoSS 
(SS 
$strSS F
)SSF G
;SSG H
varTT 
directoryItemsTT 
=TT  
newTT! $
ListTT% )
<TT) *
DirectoryItemTT* 7
>TT7 8
(TT8 9
)TT9 :
;TT: ;
tryUU 
{VV 
varWW 

webRequestWW 
=WW  

WebRequestWW! +
.WW+ ,
CreateWW, 2
(WW2 3
DirUrlWW3 9
)WW9 :
;WW: ;

webRequestXX 
.XX 
HeadersXX "
.XX" #
AddXX# &
(XX& '
$strXX' /
,XX/ 0
$strXX1 l
+XXm n
TokenXXo t
+XXu v
$strXXw z
)XXz {
;XX{ |

webRequestYY 
.YY 
MethodYY !
=YY" #
$strYY$ *
;YY* +
XmlDocumentZZ 
documentZZ $
=ZZ% &
newZZ' *
XmlDocumentZZ+ 6
(ZZ6 7
)ZZ7 8
;ZZ8 9
using[[ 
([[ 
var[[ 
response[[ #
=[[$ %

webRequest[[& 0
.[[0 1
GetResponse[[1 <
([[< =
)[[= >
)[[> ?
using\\ 
(\\ 
var\\ 
content\\ "
=\\# $
response\\% -
.\\- .
GetResponseStream\\. ?
(\\? @
)\\@ A
)\\A B
using]] 
(]] 
	XmlReader]]  
reader]]! '
=]]( )
	XmlReader]]* 3
.]]3 4
Create]]4 :
(]]: ;
content]]; B
)]]B C
)]]C D
{^^ 
document__ 
.__ 
Load__ !
(__! "
reader__" (
)__( )
;__) *
var`` 
tagName`` 
=``  !
document``" *
.``* +
DocumentElement``+ :
.``: ; 
GetElementsByTagName``; O
(``O P
$str``P V
)``V W
;``W X
varaa 
datesaa 
=aa 
documentaa  (
.aa( )
DocumentElementaa) 8
.aa8 9 
GetElementsByTagNameaa9 M
(aaM N
$straaN T
)aaT U
;aaU V
forbb 
(bb 
intbb 
ibb 
=bb  
$numbb! "
;bb" #
ibb$ %
<bb& '
tagNamebb( /
.bb/ 0
Countbb0 5
;bb5 6
ibb7 8
++bb8 :
)bb: ;
{cc 
vardd 
fileNamedd $
=dd% &
tagNamedd' .
[dd. /
idd/ 0
]dd0 1
.dd1 2
	InnerTextdd2 ;
;dd; <
varee 
dateee  
=ee! "
DateTimeee# +
.ee+ ,
Parseee, 1
(ee1 2
datesee2 7
[ee7 8
iee8 9
]ee9 :
.ee: ;
	InnerTextee; D
)eeD E
;eeE F
ifff 
(ff 
(ff 
fileNameff %
.ff% &
Containsff& .
(ff. /
$strff/ 7
)ff7 8
||ff9 ;
fileNameff< D
.ffD E
ContainsffE M
(ffM N
$strffN W
)ffW X
)ffX Y
)ffY Z
{gg 
directoryItemshh *
.hh* +
Addhh+ .
(hh. /
newhh/ 2
DirectoryItemhh3 @
{hhA B
NamehhC G
=hhH I
fileNamehhJ R
,hhR S
DateFileCreatedhhT c
=hhd e
datehhf j
}hhk l
)hhl m
;hhm n
}ii 
}jj 
}kk 
Logll 
.ll 
Infoll 
(ll 
$strll '
+ll' (
directoryItemsll) 7
.ll7 8
Countll8 =
)ll= >
;ll> ?
}nn 
catchoo 
(oo 
	Exceptionoo 
eoo 
)oo 
{pp 
Logqq 
.qq 
Errorqq 
(qq 
$strqq $
+qq% &
eqq' (
.qq( )
ToStringqq) 1
(qq1 2
)qq2 3
)qq3 4
;qq4 5
}rr 
;rr 
varss 
dbss 
=ss 
GetDbConnectionss $
(ss$ %
)ss% &
;ss& '
vartt  
entegrationFilesInDbtt $
=tt% &
dbtt' )
.tt) *0
$GetPRD_EntegrationFilesByCreatedDatett* N
(ttN O
processDatettO Z
,ttZ [
DistributorNamett\ k
)ttk l
;ttl m
varuu 
entegrationFileListuu #
=uu$ %
newuu& )
Listuu* .
<uu. / 
PRD_EntegrationFilesuu/ C
>uuC D
(uuD E
)uuE F
;uuF G
foreachvv 
(vv 
varvv 
filevv 
invv  
directoryItemsvv! /
)vv/ 0
{ww 
ifxx 
(xx  
entegrationFilesInDbxx (
.xx( )
Anyxx) ,
(xx, -
xxx- .
=>xx/ 1
xxx2 3
.xx3 4
FileNamexx4 <
.xx< =
Containsxx= E
(xxE F
filexxF J
.xxJ K
NamexxK O
)xxO P
)xxP Q
)xxQ R
continueyy 
;yy 
entegrationFileListzz #
.zz# $
Addzz$ '
(zz' (
newzz( + 
PRD_EntegrationFileszz, @
{{{ 
id|| 
=|| 
Guid|| 
.|| 
NewGuid|| %
(||% &
)||& '
,||' (
created}} 
=}} 
DateTime}} &
.}}& '
Now}}' *
,}}* +
	createdby~~ 
=~~ 
Guid~~  $
.~~$ %
Empty~~% *
,~~* +
CreateDateInFtp #
=$ %
file& *
.* +
DateFileCreated+ :
,: ;
DistributorName
ÄÄ #
=
ÄÄ$ %
DistributorName
ÄÄ& 5
,
ÄÄ5 6
DistributorId
ÅÅ !
=
ÅÅ" #
DistributorId
ÅÅ$ 1
,
ÅÅ1 2
FileName
ÇÇ 
=
ÇÇ 
file
ÇÇ #
.
ÇÇ# $
Name
ÇÇ$ (
,
ÇÇ( )
FileNameDate
ÉÉ  
=
ÉÉ! "
Tools
ÉÉ# (
.
ÉÉ( ))
GetDateFromFileNameForGenpa
ÉÉ) D
(
ÉÉD E
file
ÉÉE I
.
ÉÉI J
Name
ÉÉJ N
,
ÉÉN O
$str
ÉÉP Z
)
ÉÉZ [
,
ÉÉ[ \
ProcessTime
ÑÑ 
=
ÑÑ  !
DateTime
ÑÑ" *
.
ÑÑ* +
Now
ÑÑ+ .
,
ÑÑ. /
FileTypeName
ÖÖ  
=
ÖÖ! "
FileTypeName
ÖÖ# /
(
ÖÖ/ 0
file
ÖÖ0 4
.
ÖÖ4 5
Name
ÖÖ5 9
)
ÖÖ9 :
}
ÜÜ 
)
ÜÜ 
;
ÜÜ 
}
áá 
return
àà !
entegrationFileList
àà &
.
àà& '
ToArray
àà' .
(
àà. /
)
àà/ 0
;
àà0 1
}
ââ 	
public
ää #
PRD_EntegrationAction
ää $
[
ää$ %
]
ää% &!
GetSellInFilesInFtp
ää' :
(
ää: ;
string
ää; A
fileName
ääB J
,
ääJ K
Guid
ääL P 
entegrationFilesId
ääQ c
)
ääc d
{
ãã 	
var
åå 
sellThrs
åå 
=
åå 
new
åå 
List
åå #
<
åå# $#
PRD_EntegrationAction
åå$ 9
>
åå9 :
(
åå: ;
)
åå; <
;
åå< =
var
çç 
datetimeNow
çç 
=
çç 
DateTime
çç &
.
çç& '
Now
çç' *
;
çç* +
try
éé 
{
èè 
List
êê 
<
êê 
PropertyIndex
êê "
>
êê" #
Index
êê$ )
=
êê* +
new
êê, /
List
êê0 4
<
êê4 5
PropertyIndex
êê5 B
>
êêB C
(
êêC D
)
êêD E
;
êêE F
var
ëë 

getRawFile
ëë 
=
ëë  

GetRawFile
ëë! +
(
ëë+ ,
fileName
ëë, 4
)
ëë4 5
.
ëë5 6
ToList
ëë6 <
(
ëë< =
)
ëë= >
;
ëë> ?
var
íí 

getHeaders
íí 
=
íí  

getRawFile
íí! +
[
íí+ ,
$num
íí, -
]
íí- .
;
íí. /

getRawFile
ìì 
.
ìì 
RemoveAt
ìì #
(
ìì# $
$num
ìì$ %
)
ìì% &
;
ìì& '
for
îî 
(
îî 
int
îî 
i
îî 
=
îî 
$num
îî 
;
îî 
i
îî  !
<
îî" #

getHeaders
îî$ .
.
îî. /
Length
îî/ 5
;
îî5 6
i
îî7 8
++
îî8 :
)
îî: ;
{
ïï 
Index
ññ 
.
ññ 
Add
ññ 
(
ññ 
new
ññ !
PropertyIndex
ññ" /
{
ññ0 1
Index
ññ2 7
=
ññ8 9
i
ññ: ;
,
ññ; <
Name
ññ= A
=
ññB C

getHeaders
ññD N
[
ññN O
i
ññO P
]
ññP Q
}
ññR S
)
ññS T
;
ññT U
}
óó 
foreach
òò 
(
òò 
var
òò 
rawFile
òò $
in
òò% '

getRawFile
òò( 2
)
òò2 3
{
ôô 
try
öö 
{
õõ 
var
úú 
item
úú  
=
úú! "
new
úú# &#
PRD_EntegrationAction
úú' <
(
úú< =
)
úú= >
;
úú> ?
for
ùù 
(
ùù 
int
ùù  
i
ùù! "
=
ùù# $
$num
ùù% &
;
ùù& '
i
ùù( )
<
ùù* +
rawFile
ùù, 3
.
ùù3 4
Length
ùù4 :
;
ùù: ;
i
ùù< =
++
ùù= ?
)
ùù? @
{
ûû 
try
üü 
{
†† 
var
°°  #
	indexName
°°$ -
=
°°. /
Index
°°0 5
.
°°5 6
Where
°°6 ;
(
°°; <
x
°°< =
=>
°°> @
x
°°A B
.
°°B C
Index
°°C H
==
°°I K
i
°°L M
)
°°M N
.
°°N O
Select
°°O U
(
°°U V
x
°°V W
=>
°°X Z
x
°°[ \
.
°°\ ]
Name
°°] a
)
°°a b
.
°°b c
FirstOrDefault
°°c q
(
°°q r
)
°°r s
;
°°s t
if
¢¢  "
(
¢¢# $
	indexName
¢¢$ -
!=
¢¢. 0
null
¢¢1 5
)
¢¢5 6
{
££  !
var
§§$ ' 
rawFileCheckedData
§§( :
=
§§; <
rawFile
§§= D
[
§§D E
i
§§E F
]
§§F G
.
§§G H
Replace
§§H O
(
§§O P
$str
§§P T
,
§§T U
$str
§§V X
)
§§X Y
.
§§Y Z
Replace
§§Z a
(
§§a b
$str
§§b f
,
§§f g
$str
§§h j
)
§§j k
;
§§k l
if
••$ &
(
••' (
!
••( )
string
••) /
.
••/ 0
IsNullOrEmpty
••0 =
(
••= > 
rawFileCheckedData
••> P
)
••P Q
)
••Q R
{
¶¶$ %
	indexName
ßß( 1
=
ßß2 3
	indexName
ßß4 =
.
ßß= >
ToLower
ßß> E
(
ßßE F
new
ßßF I
CultureInfo
ßßJ U
(
ßßU V
$str
ßßV ]
,
ßß] ^
false
ßß_ d
)
ßßd e
)
ßße f
.
ßßf g
Replace
ßßg n
(
ßßn o
$str
ßßo r
,
ßßr s
$str
ßßt v
)
ßßv w
;
ßßw x
if
®®( *
(
®®+ ,
	indexName
®®, 5
==
®®6 8
$str
®®9 H
)
®®H I
item
©©, 0
.
©©0 1
InvoiceNumber
©©1 >
=
©©? @ 
rawFileCheckedData
©©A S
;
©©S T
if
™™( *
(
™™+ ,
	indexName
™™, 5
==
™™6 8
$str
™™9 ?
)
™™? @
item
´´, 0
.
´´0 1
DistributorName
´´1 @
=
´´A B 
rawFileCheckedData
´´C U
;
´´U V
if
¨¨( *
(
¨¨+ ,
	indexName
¨¨, 5
==
¨¨6 8
$str
¨¨9 O
)
¨¨O P
item
≠≠, 0
.
≠≠0 1"
CustomerOperatorCode
≠≠1 E
=
≠≠F G 
rawFileCheckedData
≠≠H Z
;
≠≠Z [
if
ÆÆ( *
(
ÆÆ+ ,
	indexName
ÆÆ, 5
==
ÆÆ6 8
$str
ÆÆ9 L
||
ÆÆM O
	indexName
ÆÆP Y
==
ÆÆZ \
$str
ÆÆ] n
||
ÆÆo q
	indexName
ÆÆr {
==
ÆÆ| ~
$strÆÆ î
)ÆÆî ï
item
ØØ, 0
.
ØØ0 1"
CustomerOperatorCode
ØØ1 E
=
ØØF G 
rawFileCheckedData
ØØH Z
;
ØØZ [
if
∞∞( *
(
∞∞+ ,
	indexName
∞∞, 5
==
∞∞6 8
$str
∞∞9 G
)
∞∞G H
item
±±, 0
.
±±0 1"
CustomerOperatorName
±±1 E
=
±±F G 
rawFileCheckedData
±±H Z
;
±±Z [
if
≤≤( *
(
≤≤+ ,
	indexName
≤≤, 5
==
≤≤6 8
$str
≤≤9 E
)
≤≤E F
item
≥≥, 0
.
≥≥0 1

BranchCode
≥≥1 ;
=
≥≥< = 
rawFileCheckedData
≥≥> P
;
≥≥P Q
if
¥¥( *
(
¥¥+ ,
	indexName
¥¥, 5
==
¥¥6 8
$str
¥¥9 E
)
¥¥E F
item
µµ, 0
.
µµ0 1

BranchName
µµ1 ;
=
µµ< = 
rawFileCheckedData
µµ> P
;
µµP Q
if
∂∂( *
(
∂∂+ ,
	indexName
∂∂, 5
==
∂∂6 8
$str
∂∂9 D
)
∂∂D E
item
∑∑, 0
.
∑∑0 1
	TaxNumber
∑∑1 :
=
∑∑; < 
rawFileCheckedData
∑∑= O
;
∑∑O P
if
∏∏( *
(
∏∏+ ,
	indexName
∏∏, 5
==
∏∏6 8
$str
∏∏9 L
)
∏∏M N
item
ππ, 0
.
ππ0 1
ConsolidationCode
ππ1 B
=
ππC D 
rawFileCheckedData
ππE W
;
ππW X
if
∫∫( *
(
∫∫+ ,
	indexName
∫∫, 5
==
∫∫6 8
$str
∫∫9 L
)
∫∫L M
item
ªª, 0
.
ªª0 1
ConsolidationName
ªª1 B
=
ªªC D 
rawFileCheckedData
ªªE W
;
ªªW X
if
ºº( *
(
ºº+ ,
	indexName
ºº, 5
==
ºº6 8
$str
ºº9 ?
)
ºº? @
item
ΩΩ, 0
.
ΩΩ0 1
Imei
ΩΩ1 5
=
ΩΩ6 7 
rawFileCheckedData
ΩΩ8 J
;
ΩΩJ K
if
ææ( *
(
ææ+ ,
	indexName
ææ, 5
==
ææ6 8
$str
ææ9 A
)
ææA B
item
øø, 0
.
øø0 1
SerialNo
øø1 9
=
øø: ; 
rawFileCheckedData
øø< N
;
øøN O
if
¿¿( *
(
¿¿+ ,
	indexName
¿¿, 5
==
¿¿6 8
$str
¿¿9 C
)
¿¿C D
item
¡¡, 0
.
¡¡0 1
Quantity
¡¡1 9
=
¡¡: ;
Convert
¡¡< C
.
¡¡C D
ToInt32
¡¡D K
(
¡¡K L 
rawFileCheckedData
¡¡L ^
)
¡¡^ _
;
¡¡_ `
if
¬¬( *
(
¬¬+ ,
	indexName
¬¬, 5
==
¬¬6 8
$str
¬¬9 ?
)
¬¬? @
item
√√, 0
.
√√0 1)
CustomerOperatorStorageCity
√√1 L
=
√√M N 
rawFileCheckedData
√√O a
;
√√a b
if
ƒƒ( *
(
ƒƒ+ ,
	indexName
ƒƒ, 5
==
ƒƒ6 8
$str
ƒƒ9 ?
)
ƒƒ? @
item
≈≈, 0
.
≈≈0 1)
CustomerOperatorStorageTown
≈≈1 L
=
≈≈M N 
rawFileCheckedData
≈≈O a
;
≈≈a b
}
∆∆$ %
}
««  !
else
»»  $
{
……  !
Log
  $ '
.
  ' (
Error
  ( -
(
  - .
$str
  . M
)
  M N
;
  N O
}
ÀÀ  !
}
ÃÃ 
catch
ÕÕ !
(
ÕÕ" #
	Exception
ÕÕ# ,
e
ÕÕ- .
)
ÕÕ. /
{
ŒŒ 
Log
œœ  #
.
œœ# $
Error
œœ$ )
(
œœ) *
$str
œœ* X
,
œœX Y
e
œœZ [
.
œœ[ \
ToString
œœ\ d
(
œœd e
)
œœe f
)
œœf g
;
œœg h
}
–– 
}
—— 
item
““ 
.
““ 
	ProductId
““ &
=
““' (
Finder
““) /
.
““/ 0
FindInventory
““0 =
(
““= >
item
““> B
.
““B C
SerialNo
““C K
,
““K L
item
““M Q
.
““Q R
Imei
““R V
)
““V W
?
““W X
.
““X Y
	productId
““Y b
;
““b c
item
”” 
.
”” 
InventoryId
”” (
=
””) *
Finder
””+ 1
.
””1 2
FindInventory
””2 ?
(
””? @
item
””@ D
.
””D E
SerialNo
””E M
,
””M N
item
””O S
.
””S T
Imei
””T X
)
””X Y
?
””Y Z
.
””Z [
id
””[ ]
;
””] ^
item
‘‘ 
.
‘‘ 
DistributorId
‘‘ *
=
‘‘+ ,
DistributorId
‘‘- :
;
‘‘: ;
item
’’ 
.
’’ 
DistributorName
’’ ,
=
’’- .
this
’’/ 3
.
’’3 4
DistributorName
’’4 C
;
’’C D
item
÷÷ 
.
÷÷ 
EntegrationFileId
÷÷ .
=
÷÷/ 0 
entegrationFilesId
÷÷1 C
;
÷÷C D
item
◊◊ 
.
◊◊  
CustomerOperatorId
◊◊ /
=
◊◊0 1
Finder
◊◊2 8
.
◊◊8 9
FindCompany
◊◊9 D
(
◊◊D E
item
◊◊E I
)
◊◊I J
;
◊◊J K
sellThrs
ÿÿ  
.
ÿÿ  !
Add
ÿÿ! $
(
ÿÿ$ %
item
ÿÿ% )
)
ÿÿ) *
;
ÿÿ* +
}
ŸŸ 
catch
⁄⁄ 
(
⁄⁄ 
	Exception
⁄⁄ $
e
⁄⁄% &
)
⁄⁄& '
{
€€ 
Log
‹‹ 
.
‹‹ 
Error
‹‹ !
(
‹‹! "
$str
‹‹" P
,
‹‹P Q
e
‹‹R S
.
‹‹S T
ToString
‹‹T \
(
‹‹\ ]
)
‹‹] ^
)
‹‹^ _
;
‹‹_ `
}
›› 
}
ﬁﬁ 
}
ﬂﬂ 
catch
‡‡ 
(
‡‡ 
	Exception
‡‡ 
e
‡‡ 
)
‡‡ 
{
·· 
Log
‚‚ 
.
‚‚ 
Error
‚‚ 
(
‚‚ 
e
‚‚ 
.
‚‚ 
ToString
‚‚ $
(
‚‚$ %
)
‚‚% &
)
‚‚& '
;
‚‚' (
}
„„ 
return
‰‰ 
sellThrs
‰‰ 
.
‰‰ 
ToArray
‰‰ #
(
‰‰# $
)
‰‰$ %
;
‰‰% &
}
ÂÂ 	
private
ÊÊ 
IEnumerable
ÊÊ 
<
ÊÊ 
string
ÊÊ "
[
ÊÊ" #
]
ÊÊ# $
>
ÊÊ$ %

GetRawFile
ÊÊ& 0
(
ÊÊ0 1
string
ÊÊ1 7
FileName
ÊÊ8 @
)
ÊÊ@ A
{
ÁÁ 	
var
ËË 
liststringArray
ËË 
=
ËË  !
new
ËË" %
List
ËË& *
<
ËË* +
string
ËË+ 1
[
ËË1 2
]
ËË2 3
>
ËË3 4
(
ËË4 5
)
ËË5 6
;
ËË6 7
var
ÈÈ 
downloadUrl
ÈÈ 
=
ÈÈ 
$str
ÈÈ L
+
ÈÈM N
FileName
ÈÈO W
+
ÈÈX Y
$str
ÈÈZ ]
+
ÈÈ^ _
Token
ÈÈ` e
+
ÈÈf g
$str
ÈÈh 
;ÈÈ Ä
var
ÍÍ 

webRequest
ÍÍ 
=
ÍÍ 

WebRequest
ÍÍ '
.
ÍÍ' (
Create
ÍÍ( .
(
ÍÍ. /
downloadUrl
ÍÍ/ :
)
ÍÍ: ;
;
ÍÍ; <
using
ÎÎ 
(
ÎÎ 
var
ÎÎ 
response
ÎÎ 
=
ÎÎ  !

webRequest
ÎÎ" ,
.
ÎÎ, -
GetResponse
ÎÎ- 8
(
ÎÎ8 9
)
ÎÎ9 :
)
ÎÎ: ;
using
ÏÏ 
(
ÏÏ 
var
ÏÏ 
content
ÏÏ 
=
ÏÏ  
response
ÏÏ! )
.
ÏÏ) *
GetResponseStream
ÏÏ* ;
(
ÏÏ; <
)
ÏÏ< =
)
ÏÏ= >
using
ÌÌ 
(
ÌÌ 
var
ÌÌ 
reader
ÌÌ 
=
ÌÌ 
new
ÌÌ  #
StreamReader
ÌÌ$ 0
(
ÌÌ0 1
content
ÌÌ1 8
)
ÌÌ8 9
)
ÌÌ9 :
{
ÓÓ 
string
ÔÔ 
line
ÔÔ 
;
ÔÔ 
try
 
{
ÒÒ 
while
ÚÚ 
(
ÚÚ 
(
ÚÚ 
line
ÚÚ  
=
ÚÚ! "
reader
ÚÚ# )
.
ÚÚ) *
ReadLine
ÚÚ* 2
(
ÚÚ2 3
)
ÚÚ3 4
)
ÚÚ4 5
!=
ÚÚ6 8
null
ÚÚ9 =
)
ÚÚ= >
{
ÛÛ 
List
ÙÙ 
<
ÙÙ 
string
ÙÙ #
>
ÙÙ# $
splitedLines
ÙÙ% 1
=
ÙÙ2 3
line
ÙÙ4 8
.
ÙÙ8 9
Split
ÙÙ9 >
(
ÙÙ> ?
$char
ÙÙ? C
)
ÙÙC D
.
ÙÙD E
ToList
ÙÙE K
(
ÙÙK L
)
ÙÙL M
;
ÙÙM N
liststringArray
ıı '
.
ıı' (
Add
ıı( +
(
ıı+ ,
splitedLines
ıı, 8
.
ıı8 9
ToArray
ıı9 @
(
ıı@ A
)
ııA B
)
ııB C
;
ııC D
}
ˆˆ 
response
˜˜ 
.
˜˜ 
Close
˜˜ "
(
˜˜" #
)
˜˜# $
;
˜˜$ %
reader
¯¯ 
.
¯¯ 
Close
¯¯  
(
¯¯  !
)
¯¯! "
;
¯¯" #
}
˘˘ 
catch
˙˙ 
(
˙˙ 
	Exception
˙˙  
e
˙˙! "
)
˙˙" #
{
˚˚ 
Log
¸¸ 
.
¸¸ 
Error
¸¸ 
(
¸¸ 
e
¸¸ 
.
¸¸  
Message
¸¸  '
)
¸¸' (
;
¸¸( )
}
˝˝ 
}
˛˛ 
return
ˇˇ 
liststringArray
ˇˇ "
;
ˇˇ" #
}
ÄÄ 	
public
ÅÅ 
void
ÅÅ !
SetFtpConfiguration
ÅÅ '
(
ÅÅ' (
)
ÅÅ( )
{
ÇÇ 	
var
ÉÉ 
userName
ÉÉ 
=
ÉÉ "
ConfigurationManager
ÉÉ /
.
ÉÉ/ 0
AppSettings
ÉÉ0 ;
[
ÉÉ; <
$str
ÉÉ< K
]
ÉÉK L
.
ÉÉL M
ToString
ÉÉM U
(
ÉÉU V
)
ÉÉV W
;
ÉÉW X
var
ÑÑ 
password
ÑÑ 
=
ÑÑ "
ConfigurationManager
ÑÑ /
.
ÑÑ/ 0
AppSettings
ÑÑ0 ;
[
ÑÑ; <
$str
ÑÑ< K
]
ÑÑK L
.
ÑÑL M
ToString
ÑÑM U
(
ÑÑU V
)
ÑÑV W
;
ÑÑW X
var
ÖÖ 
dirUrl
ÖÖ 
=
ÖÖ "
ConfigurationManager
ÖÖ -
.
ÖÖ- .
AppSettings
ÖÖ. 9
[
ÖÖ9 :
$str
ÖÖ: G
]
ÖÖG H
.
ÖÖH I
ToString
ÖÖI Q
(
ÖÖQ R
)
ÖÖR S
;
ÖÖS T
if
ÜÜ 
(
ÜÜ 
dirUrl
ÜÜ 
==
ÜÜ 
null
ÜÜ 
)
ÜÜ 
{
áá 
Log
àà 
.
àà 
Error
àà 
(
àà 
$str
àà 3
)
àà3 4
;
àà4 5
}
ââ 
else
ää 
{
ãã 
this
åå 
.
åå 
DirUrl
åå 
=
åå 
dirUrl
åå $
;
åå$ %
}
çç 
var
éé 
loginUrl
éé 
=
éé "
ConfigurationManager
éé /
.
éé/ 0
AppSettings
éé0 ;
[
éé; <
$str
éé< K
]
ééK L
.
ééL M
ToString
ééM U
(
ééU V
)
ééV W
;
ééW X
if
èè 
(
èè 
loginUrl
èè 
==
èè 
null
èè  
)
èè  !
{
êê 
Log
ëë 
.
ëë 
Error
ëë 
(
ëë 
$str
ëë /
)
ëë/ 0
;
ëë0 1
}
íí 
else
ìì 
{
îî 
this
ïï 
.
ïï 
LoginUrl
ïï 
=
ïï 
loginUrl
ïï  (
;
ïï( )
}
ññ 
this
óó 
.
óó 
ftpConfiguration
óó !
=
óó" #
new
óó$ '
FtpConfiguration
óó( 8
{
òò 
Password
ôô 
=
ôô 
password
ôô #
,
ôô# $
UserName
öö 
=
öö 
userName
öö #
,
öö# $
}
õõ 
;
õõ 
}
úú 	
private
ùù 
void
ùù 
Login
ùù 
(
ùù 
)
ùù 
{
ûû 	
Log
üü 
.
üü 
Info
üü 
(
üü 
$str
üü 7
)
üü7 8
;
üü8 9
try
†† 
{
°° !
ServicePointManager
¢¢ #
.
¢¢# $1
#ServerCertificateValidationCallback
¢¢$ G
=
¢¢H I
delegate
¢¢J R
{
¢¢S T
return
¢¢U [
true
¢¢\ `
;
¢¢` a
}
¢¢b c
;
¢¢c d
var
££ 
httpRequest
££ 
=
££  !
(
££" #
HttpWebRequest
££# 1
)
££1 2

WebRequest
££2 <
.
££< =
Create
££= C
(
££C D
LoginUrl
££D L
)
££L M
;
££M N
httpRequest
§§ 
.
§§ 
Method
§§ "
=
§§# $
$str
§§% +
;
§§+ ,
httpRequest
•• 
.
•• 
ContentType
•• '
=
••( )
$str
••* ?
;
••? @
var
¶¶ 
formData
¶¶ 
=
¶¶ 
$str
¶¶ *
+
¶¶+ ,
this
¶¶- 1
.
¶¶1 2
ftpConfiguration
¶¶2 B
.
¶¶B C
UserName
¶¶C K
+
¶¶L M
$str
¶¶N Z
+
¶¶[ \
ftpConfiguration
¶¶] m
.
¶¶m n
Password
¶¶n v
+
¶¶w x
$str¶¶y â
+¶¶ä ã 
ftpConfiguration¶¶å ú
.¶¶ú ù
UserName¶¶ù •
+¶¶¶ ß
$str¶¶® ∏
+¶¶π ∫ 
ftpConfiguration¶¶ª À
.¶¶À Ã
Password¶¶Ã ‘
+¶¶’ ÷
$str¶¶◊ ı
;¶¶ı ˆ
using
ßß 
(
ßß 
var
ßß 
streamWriter
ßß '
=
ßß( )
new
ßß* -
StreamWriter
ßß. :
(
ßß: ;
httpRequest
ßß; F
.
ßßF G
GetRequestStream
ßßG W
(
ßßW X
)
ßßX Y
)
ßßY Z
)
ßßZ [
{
®® 
streamWriter
©©  
.
©©  !
Write
©©! &
(
©©& '
formData
©©' /
)
©©/ 0
;
©©0 1
}
™™ 
var
´´ 
httpResponse
´´  
=
´´! "
(
´´# $
HttpWebResponse
´´$ 3
)
´´3 4
httpRequest
´´4 ?
.
´´? @
GetResponse
´´@ K
(
´´K L
)
´´L M
;
´´M N
using
¨¨ 
(
¨¨ 
var
¨¨ 
streamReader
¨¨ '
=
¨¨( )
new
¨¨* -
StreamReader
¨¨. :
(
¨¨: ;
httpResponse
¨¨; G
.
¨¨G H
GetResponseStream
¨¨H Y
(
¨¨Y Z
)
¨¨Z [
)
¨¨[ \
)
¨¨\ ]
{
≠≠ 
var
ÆÆ 
cookie
ÆÆ 
=
ÆÆ  
httpResponse
ÆÆ! -
.
ÆÆ- .
Headers
ÆÆ. 5
[
ÆÆ5 6
$str
ÆÆ6 B
]
ÆÆB C
;
ÆÆC D
int
ØØ 
indexofComma
ØØ $
=
ØØ% &
cookie
ØØ' -
.
ØØ- .
IndexOf
ØØ. 5
(
ØØ5 6
$char
ØØ6 9
)
ØØ9 :
;
ØØ: ;
Token
∞∞ 
=
∞∞ 
cookie
∞∞ "
.
∞∞" #
	Substring
∞∞# ,
(
∞∞, -
$num
∞∞- .
,
∞∞. /
indexofComma
∞∞0 <
)
∞∞< =
;
∞∞= >
}
±± 
}
≤≤ 
catch
≥≥ 
(
≥≥ 
	Exception
≥≥ 
e
≥≥ 
)
≥≥ 
{
¥¥ 
Log
µµ 
.
µµ 
Error
µµ 
(
µµ 
$str
µµ $
+
µµ% &
e
µµ' (
.
µµ( )
ToString
µµ) 1
(
µµ1 2
)
µµ2 3
)
µµ3 4
;
µµ4 5
}
∂∂ 
}
∑∑ 	
}
∏∏ 
}ππ »à
}D:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\FtpKvk.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
public 

class 
FtpKvk 
: &
IFtpDistributorEntegration 4
{ 
public 
FtpConfiguration 
ftpConfiguration  0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
string 
DistributorName %
=>& (
$str) .
;. /
public 
Guid 
DistributorId !
=>" $
new% (
Guid) -
(- .
$str. T
)T U
;U V
public 
FtpKvk 
( 
) 
{ 	
Log 
. 
Warning 
( 
$str /
)/ 0
;0 1
SetFtpConfiguration 
(  
)  !
;! "
} 	
public 
ResultStatus !
ExportFilesToDatabase 1
(1 2
)2 3
{ 	
var   
processDate   
=   
DateTime   &
.  & '
Now  ' *
.  * +
AddDays  + 2
(  2 3
-  3 4
$num  4 8
)  8 9
;  9 :
var!! 
entegrationFileList!! #
=!!$ %
GetFilesInFtp!!& 3
(!!3 4
processDate!!4 ?
)!!? @
;!!@ A
var## 
result## 
=## 
new## 
ResultStatus## )
(##) *
)##* +
;##+ ,
foreach$$ 
($$ 
var$$ 
entegrationFile$$ (
in$$) +
entegrationFileList$$, ?
)$$? @
{%% 
Log&& 
.&& 
Warning&& 
(&& 
$str&& A
,&&A B
this&&C G
.&&G H
ftpConfiguration&&H X
.&&X Y
Url&&Y \
,&&\ ]
this&&^ b
.&&b c
DistributorName&&c r
,&&r s
entegrationFile	&&t É
.
&&É Ñ
FileName
&&Ñ å
)
&&å ç
;
&&ç é
var(( 
db(( 
=(( 
GetDbConnection(( (
(((( )
)(() *
;((* +
result)) 
=)) 
db)) 
.)) &
InsertPRD_EntegrationFiles)) 6
())6 7
entegrationFile))7 F
)))F G
;))G H
if** 
(** 
!** 
result** 
.** 
result** "
)**" #
{++ 
Log,, 
.,, 
Error,, 
(,, 
$str,, M
,,,M N
result,,O U
.,,U V
message,,V ]
),,] ^
;,,^ _
continue-- 
;-- 
}.. 
if00 
(00 
entegrationFile00 #
.00# $
FileTypeName00$ 0
==001 3
$str004 =
)00= >
{11 
var22 
sellThr22 
=22  !
GetSellInFilesInFtp22" 5
(225 6
entegrationFile226 E
.22E F
FileName22F N
,22N O
entegrationFile22P _
.22_ `
id22` b
)22b c
;22c d
if33 
(33 
sellThr33 
!=33  "
null33# '
&&33( *
sellThr33+ 2
.332 3
Count333 8
(338 9
)339 :
>33; <
$num33= >
)33> ?
{44 
var55 
bultInsertResult55 ,
=55- .
db55/ 1
.551 2+
BulkInsertPRD_EntegrationAction552 Q
(55Q R
sellThr55R Y
)55Y Z
;55Z [
if66 
(66 
!66 
bultInsertResult66 -
.66- .
result66. 4
)664 5
Log77 
.77  
Info77  $
(77$ %
$str77% ^
,77^ _
this77` d
.77d e
ftpConfiguration77e u
.77u v
Url77v y
,77y z
this77{ 
.	77 Ä
DistributorName
77Ä è
,
77è ê
bultInsertResult
77ë °
.
77° ¢
message
77¢ ©
)
77© ™
;
77™ ´
}88 
}99 
Log:: 
.:: 
Success:: 
(:: 
$str:: C
,::C D
this::E I
.::I J
ftpConfiguration::J Z
.::Z [
Url::[ ^
,::^ _
this::` d
.::d e
DistributorName::e t
,::t u
entegrationFile	::v Ö
.
::Ö Ü
FileName
::Ü é
)
::é è
;
::è ê
};; 
return<< 
result<< 
;<< 
}== 	
public?? 
WorkOfTimeDatabase?? !
GetDbConnection??" 1
(??1 2
)??2 3
{@@ 	
varAA 

tenantCodeAA 
=AA  
ConfigurationManagerAA 1
.AA1 2
AppSettingsAA2 =
[AA= >
$strAA> M
]AAM N
.AAN O
ToStringAAO W
(AAW X
)AAX Y
;AAY Z
varBB 
tenantBB 
=BB 
TenantConfigBB %
.BB% &

GetTenantsBB& 0
(BB0 1
)BB1 2
.BB2 3
WhereBB3 8
(BB8 9
aBB9 :
=>BB; =
aBB> ?
.BB? @

TenantCodeBB@ J
==BBK M
ConvertBBN U
.BBU V
ToInt32BBV ]
(BB] ^

tenantCodeBB^ h
)BBh i
)BBi j
.BBj k
FirstOrDefaultBBk y
(BBy z
)BBz {
;BB{ |
returnCC 
tenantCC 
.CC 
GetDatabaseCC %
(CC% &
)CC& '
;CC' (
}DD 	
publicFF 
stringFF 
FileTypeNameFF "
(FF" #
stringFF# )
fileNameFF* 2
)FF2 3
{GG 	
ifHH 
(HH 
fileNameHH 
.HH 
ContainsHH !
(HH! "
$strHH" *
)HH* +
)HH+ ,
returnII 
$strII 
;II  
elseJJ 
ifJJ 
(JJ 
fileNameJJ 
.JJ 
ContainsJJ &
(JJ& '
$strJJ' 0
)JJ0 1
)JJ1 2
returnKK 
$strKK  
;KK  !
elseLL 
ifLL 
(LL 
fileNameLL 
.LL 
ContainsLL &
(LL& '
$strLL' -
)LL- .
)LL. /
returnMM 
$strMM  
;MM  !
elseNN 
returnOO 
nullOO 
;OO 
}PP 	
publicRR  
PRD_EntegrationFilesRR #
[RR# $
]RR$ %
GetFilesInFtpRR& 3
(RR3 4
DateTimeRR4 <
processDateRR= H
)RRH I
{SS 	
LogTT 
.TT 
InfoTT 
(TT 
stringTT 
.TT 
FormatTT "
(TT" #
$strTT# O
,TTO P
ftpConfigurationTTQ a
.TTa b
UrlTTb e
)TTe f
)TTf g
;TTg h
varUU 
fileListUU 
=UU 
newUU 
ListUU #
<UU# $
FileNameWithUrlUU$ 3
>UU3 4
(UU4 5
)UU5 6
;UU6 7
tryVV 
{WW 
FtpWebRequestXX 
requestXX %
=XX& '
(XX( )
FtpWebRequestXX) 6
)XX6 7
FtpWebRequestXX7 D
.XXD E
CreateXXE K
(XXK L
ftpConfigurationXXL \
.XX\ ]
UrlXX] `
)XX` a
;XXa b
requestYY 
.YY 
MethodYY 
=YY  
WebRequestMethodsYY! 2
.YY2 3
FtpYY3 6
.YY6 7 
ListDirectoryDetailsYY7 K
;YYK L
requestZZ 
.ZZ 
CredentialsZZ #
=ZZ$ %
newZZ& )
NetworkCredentialZZ* ;
(ZZ; <
ftpConfigurationZZ< L
.ZZL M
UserNameZZM U
,ZZU V
ftpConfigurationZZW g
.ZZg h
PasswordZZh p
)ZZp q
;ZZq r
string[[ 
[[[ 
][[ 
list[[ 
=[[ 
null[[  $
;[[$ %
using\\ 
(\\ 
FtpWebResponse\\ %
response\\& .
=\\/ 0
(\\1 2
FtpWebResponse\\2 @
)\\@ A
request\\A H
.\\H I
GetResponse\\I T
(\\T U
)\\U V
)\\V W
using]] 
(]] 
StreamReader]] #
reader]]$ *
=]]+ ,
new]]- 0
StreamReader]]1 =
(]]= >
response]]> F
.]]F G
GetResponseStream]]G X
(]]X Y
)]]Y Z
)]]Z [
)]][ \
{^^ 
list__ 
=__ 
reader__ !
.__! "
	ReadToEnd__" +
(__+ ,
)__, -
.__- .
Split__. 3
(__3 4
new__4 7
string__8 >
[__> ?
]__? @
{__A B
$str__C I
}__J K
,__K L
StringSplitOptions__M _
.___ `
RemoveEmptyEntries__` r
)__r s
;__s t
}`` 
foreachaa 
(aa 
stringaa 
lineaa  $
inaa% '
listaa( ,
)aa, -
{bb 
DirectoryItemcc !
itemcc" &
=cc' (
newcc) ,
DirectoryItemcc- :
(cc: ;
)cc; <
;cc< =
stringdd 
datadd 
=dd  !
linedd" &
;dd& '
varee 

dateStringee "
=ee# $
lineee% )
.ee) *
	Substringee* 3
(ee3 4
$numee4 6
,ee6 7
$numee8 :
-ee; <
$numee= ?
)ee? @
;ee@ A
boolgg 
isDirectorygg $
=gg% &
datagg' +
[gg+ ,
$numgg, -
]gg- .
.gg. /
ToStringgg/ 7
(gg7 8
)gg8 9
==gg: <
$strgg= @
;gg@ A
varhh 
namehh 
=hh 
datahh #
.hh# $
	Substringhh$ -
(hh- .
$numhh. 0
)hh0 1
;hh1 2
varii 
dateii 
=ii 
lineii #
.ii# $
	Substringii$ -
(ii- .
$numii. 0
,ii0 1
$numii2 4
-ii5 6
$numii7 9
)ii9 :
;ii: ;
itemjj 
.jj 
Namejj 
=jj 
namejj  $
;jj$ %
itemkk 
.kk 
BaseUrikk  
=kk! "
ftpConfigurationkk# 3
.kk3 4
Urlkk4 7
;kk7 8
itemll 
.ll 
IsDirectoryll $
=ll% &
isDirectoryll' 2
;ll2 3
ifmm 
(mm 
namemm 
==mm 
$strmm  #
||mm$ &
namemm' +
==mm, .
$strmm/ 3
)mm3 4
{nn 
}oo 
elsepp 
{qq 
ifrr 
(rr 
!rr 
isDirectoryrr (
)rr( )
{ss 
vartt 
isTransformedtt  -
=tt- .
DateTimett/ 7
.tt7 8
TryParseExacttt8 E
(ttE F
datettF J
,ttJ K
$strttL Z
,ttZ [
CultureInfott\ g
.ttg h
InvariantCulturetth x
,ttx y
DateTimeStyles	tty á
.
ttá à
None
ttà å
,
ttå ç
out
ttç ê
var
ttë î

parsedDate
ttï ü
)
ttü †
;
tt† °
ifuu 
(uu  
isTransformeduu  -
)uu- .
{vv 
itemww  $
.ww$ %
DateFileCreatedww% 4
=ww5 6

parsedDateww7 A
;wwA B
}xx 
fileListzz $
.zz$ %
Addzz% (
(zz( )
newzz) ,
FileNameWithUrlzz- <
{zz= >
FileNamezz? G
=zzH I
itemzzJ N
.zzN O
NamezzO S
,zzS T
FileCreatedDatezzU d
=zze f
itemzzg k
.zzk l
DateFileCreatedzzl {
,zz{ |
DirectoryFileName	zz} é
=
zzè ê
this
zzë ï
.
zzï ñ
ftpConfiguration
zzñ ¶
.
zz¶ ß
Url
zzß ™
+
zz´ ¨
this
zz≠ ±
.
zz± ≤
ftpConfiguration
zz≤ ¬
.
zz¬ √
	Directory
zz√ Ã
+
zzÕ Œ
$str
zzœ ”
+
zz‘ ’
item
zz÷ ⁄
.
zz⁄ €
Name
zz€ ﬂ
}
zz‡ ·
)
zz· ‚
;
zz‚ „
}{{ 
}|| 
}}} 
Log~~ 
.~~ 
Info~~ 
(~~ 
$str~~ '
+~~( )
fileList~~* 2
.~~2 3
Count~~3 8
)~~8 9
;~~9 :
} 
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
e
ÄÄ 
)
ÄÄ 
{
ÅÅ 
Log
ÇÇ 
.
ÇÇ 
Error
ÇÇ 
(
ÇÇ 
ftpConfiguration
ÇÇ *
.
ÇÇ* +
Url
ÇÇ+ .
+
ÇÇ/ 0
$str
ÇÇ1 >
+
ÇÇ? @
e
ÇÇA B
.
ÇÇB C
Message
ÇÇC J
)
ÇÇJ K
;
ÇÇK L
}
ÉÉ 
var
ÑÑ 
db
ÑÑ 
=
ÑÑ 
GetDbConnection
ÑÑ $
(
ÑÑ$ %
)
ÑÑ% &
;
ÑÑ& '
var
ÖÖ "
entegrationFilesInDb
ÖÖ $
=
ÖÖ% &
db
ÖÖ' )
.
ÖÖ) *2
$GetPRD_EntegrationFilesByCreatedDate
ÖÖ* N
(
ÖÖN O
processDate
ÖÖO Z
,
ÖÖZ [
DistributorName
ÖÖ\ k
)
ÖÖk l
;
ÖÖl m
var
ÜÜ !
entegrationFileList
ÜÜ #
=
ÜÜ$ %
new
ÜÜ& )
List
ÜÜ* .
<
ÜÜ. /"
PRD_EntegrationFiles
ÜÜ/ C
>
ÜÜC D
(
ÜÜD E
)
ÜÜE F
;
ÜÜF G
foreach
áá 
(
áá 
var
áá 
file
áá 
in
áá  
fileList
áá! )
.
áá) *
Where
áá* /
(
áá/ 0
x
áá0 1
=>
áá2 4
x
áá5 6
.
áá6 7
FileCreatedDate
áá7 F
>=
ááG I
processDate
ááJ U
)
ááU V
)
ááV W
{
àà 
if
ââ 
(
ââ "
entegrationFilesInDb
ââ (
.
ââ( )
Any
ââ) ,
(
ââ, -
x
ââ- .
=>
ââ/ 1
x
ââ2 3
.
ââ3 4
FileName
ââ4 <
.
ââ< =
Contains
ââ= E
(
ââE F
file
ââF J
.
ââJ K
FileName
ââK S
)
ââS T
&&
ââT V
x
ââV W
.
ââW X
DistributorId
ââX e
==
ââe g
this
ââg k
.
ââk l
DistributorId
ââl y
)
âây z
)
ââz {
continue
ää 
;
ää !
entegrationFileList
åå #
.
åå# $
Add
åå$ '
(
åå' (
new
åå( +"
PRD_EntegrationFiles
åå, @
{
çç 
id
éé 
=
éé 
Guid
éé 
.
éé 
NewGuid
éé %
(
éé% &
)
éé& '
,
éé' (
created
èè 
=
èè 
DateTime
èè &
.
èè& '
Now
èè' *
,
èè* +
	createdby
êê 
=
êê 
Guid
êê  $
.
êê$ %
Empty
êê% *
,
êê* +
CreateDateInFtp
ëë #
=
ëë$ %
file
ëë& *
.
ëë* +
FileCreatedDate
ëë+ :
,
ëë: ;
DistributorName
íí #
=
íí$ %
DistributorName
íí& 5
,
íí5 6
DistributorId
ìì !
=
ìì" #
DistributorId
ìì$ 1
,
ìì1 2
FileName
îî 
=
îî 
file
îî #
.
îî# $
DirectoryFileName
îî$ 5
,
îî5 6
FileNameDate
ïï  
=
ïï! "
Tools
ïï# (
.
ïï( )!
GetDateFromFileName
ïï) <
(
ïï< =
file
ïï= A
.
ïïA B
FileName
ïïB J
,
ïïJ K
$str
ïïL V
)
ïïV W
,
ïïW X
ProcessTime
ññ 
=
ññ  !
DateTime
ññ" *
.
ññ* +
Now
ññ+ .
,
ññ. /
FileTypeName
óó  
=
óó! "
FileTypeName
óó# /
(
óó/ 0
file
óó0 4
.
óó4 5
FileName
óó5 =
)
óó= >
}
òò 
)
òò 
;
òò 
}
ôô 
Log
öö 
.
öö 
Warning
öö 
(
öö 
$str
öö ;
,
öö; <!
entegrationFileList
öö= P
.
ööP Q
Count
ööQ V
(
ööV W
)
ööW X
)
ööX Y
;
ööY Z
return
õõ !
entegrationFileList
õõ &
.
õõ& '
ToArray
õõ' .
(
õõ. /
)
õõ/ 0
;
õõ0 1
}
úú 	
public
ûû #
PRD_EntegrationAction
ûû $
[
ûû$ %
]
ûû% &!
GetSellInFilesInFtp
ûû' :
(
ûû: ;
string
ûû; A
fileName
ûûB J
,
ûûJ K
Guid
ûûL P 
entegrationFilesId
ûûQ c
)
ûûc d
{
üü 	
var
†† 
sellThrs
†† 
=
†† 
new
†† 
List
†† #
<
††# $#
PRD_EntegrationAction
††$ 9
>
††9 :
(
††: ;
)
††; <
;
††< =
var
°° 
datetimeNow
°° 
=
°° 
DateTime
°° &
.
°°& '
Now
°°' *
;
°°* +
try
££ 
{
§§ 
List
•• 
<
•• 
PropertyIndex
•• "
>
••" #
Index
••$ )
=
••* +
new
••, /
List
••0 4
<
••4 5
PropertyIndex
••5 B
>
••B C
(
••C D
)
••D E
;
••E F
var
¶¶ 

getRawFile
¶¶ 
=
¶¶  

GetRawFile
¶¶! +
(
¶¶+ ,
fileName
¶¶, 4
)
¶¶4 5
.
¶¶5 6
ToList
¶¶6 <
(
¶¶< =
)
¶¶= >
;
¶¶> ?
var
ßß 

getHeaders
ßß 
=
ßß  

getRawFile
ßß! +
[
ßß+ ,
$num
ßß, -
]
ßß- .
;
ßß. /

getRawFile
®® 
.
®® 
RemoveAt
®® #
(
®®# $
$num
®®$ %
)
®®% &
;
®®& '
for
©© 
(
©© 
int
©© 
i
©© 
=
©© 
$num
©© 
;
©© 
i
©©  !
<
©©" #

getHeaders
©©$ .
.
©©. /
Length
©©/ 5
;
©©5 6
i
©©7 8
++
©©8 :
)
©©: ;
{
™™ 
Index
´´ 
.
´´ 
Add
´´ 
(
´´ 
new
´´ !
PropertyIndex
´´" /
{
´´0 1
Index
´´2 7
=
´´8 9
i
´´: ;
,
´´; <
Name
´´= A
=
´´B C

getHeaders
´´D N
[
´´N O
i
´´O P
]
´´P Q
}
´´R S
)
´´S T
;
´´T U
}
¨¨ 
foreach
≠≠ 
(
≠≠ 
var
≠≠ 
rawFile
≠≠ $
in
≠≠% '

getRawFile
≠≠( 2
)
≠≠2 3
{
ÆÆ 
try
ØØ 
{
∞∞ 
var
±± 
item
±±  
=
±±! "
new
±±# &#
PRD_EntegrationAction
±±' <
(
±±< =
)
±±= >
;
±±> ?
for
≤≤ 
(
≤≤ 
int
≤≤  
i
≤≤! "
=
≤≤# $
$num
≤≤% &
;
≤≤& '
i
≤≤( )
<
≤≤* +
rawFile
≤≤, 3
.
≤≤3 4
Length
≤≤4 :
;
≤≤: ;
i
≤≤< =
++
≤≤= ?
)
≤≤? @
{
≥≥ 
try
¥¥ 
{
µµ 
var
∂∂  #
	indexName
∂∂$ -
=
∂∂. /
Index
∂∂0 5
.
∂∂5 6
Where
∂∂6 ;
(
∂∂; <
x
∂∂< =
=>
∂∂> @
x
∂∂A B
.
∂∂B C
Index
∂∂C H
==
∂∂I K
i
∂∂L M
)
∂∂M N
.
∂∂N O
Select
∂∂O U
(
∂∂U V
x
∂∂V W
=>
∂∂X Z
x
∂∂[ \
.
∂∂\ ]
Name
∂∂] a
)
∂∂a b
.
∂∂b c
FirstOrDefault
∂∂c q
(
∂∂q r
)
∂∂r s
;
∂∂s t
if
∑∑  "
(
∑∑# $
	indexName
∑∑$ -
!=
∑∑. 0
null
∑∑1 5
)
∑∑5 6
{
∏∏  !
var
ππ$ ' 
rawFileCheckedData
ππ( :
=
ππ; <
rawFile
ππ= D
[
ππD E
i
ππE F
]
ππF G
.
ππG H
Replace
ππH O
(
ππO P
$str
ππP T
,
ππT U
$str
ππV X
)
ππX Y
.
ππY Z
Replace
ππZ a
(
ππa b
$str
ππb f
,
ππf g
$str
ππh j
)
ππj k
;
ππk l
if
∫∫$ &
(
∫∫' (
!
∫∫( )
string
∫∫) /
.
∫∫/ 0
IsNullOrEmpty
∫∫0 =
(
∫∫= > 
rawFileCheckedData
∫∫> P
)
∫∫P Q
)
∫∫Q R
{
ªª$ %
	indexName
ºº( 1
=
ºº2 3
	indexName
ºº4 =
.
ºº= >
ToLower
ºº> E
(
ººE F
new
ººF I
CultureInfo
ººJ U
(
ººU V
$str
ººV ]
,
ºº] ^
false
ºº_ d
)
ººd e
)
ººe f
.
ººf g
Replace
ººg n
(
ººn o
$str
ººo r
,
ººr s
$str
ººt v
)
ººv w
;
ººw x
if
ΩΩ( *
(
ΩΩ+ ,
	indexName
ΩΩ, 5
==
ΩΩ6 8
$str
ΩΩ9 H
)
ΩΩH I
item
ææ, 0
.
ææ0 1
InvoiceNumber
ææ1 >
=
ææ? @ 
rawFileCheckedData
ææA S
;
ææS T
if
øø( *
(
øø+ ,
	indexName
øø, 5
==
øø6 8
$str
øø9 ?
)
øø? @
item
¿¿, 0
.
¿¿0 1
DistributorName
¿¿1 @
=
¿¿A B 
rawFileCheckedData
¿¿C U
;
¿¿U V
if
¡¡( *
(
¡¡+ ,
	indexName
¡¡, 5
==
¡¡6 8
$str
¡¡9 O
)
¡¡O P
item
¬¬, 0
.
¬¬0 1"
CustomerOperatorCode
¬¬1 E
=
¬¬F G 
rawFileCheckedData
¬¬H Z
;
¬¬Z [
if
√√( *
(
√√+ ,
	indexName
√√, 5
==
√√6 8
$str
√√9 G
)
√√G H
item
ƒƒ, 0
.
ƒƒ0 1"
CustomerOperatorName
ƒƒ1 E
=
ƒƒF G 
rawFileCheckedData
ƒƒH Z
;
ƒƒZ [
if
≈≈( *
(
≈≈+ ,
	indexName
≈≈, 5
==
≈≈6 8
$str
≈≈9 E
)
≈≈E F
item
∆∆, 0
.
∆∆0 1

BranchCode
∆∆1 ;
=
∆∆< = 
rawFileCheckedData
∆∆> P
;
∆∆P Q
if
««( *
(
««+ ,
	indexName
««, 5
==
««6 8
$str
««9 E
)
««E F
item
»», 0
.
»»0 1

BranchName
»»1 ;
=
»»< = 
rawFileCheckedData
»»> P
;
»»P Q
if
……( *
(
……+ ,
	indexName
……, 5
==
……6 8
$str
……9 D
)
……D E
item
  , 0
.
  0 1
	TaxNumber
  1 :
=
  ; < 
rawFileCheckedData
  = O
;
  O P
if
ÀÀ( *
(
ÀÀ+ ,
	indexName
ÀÀ, 5
==
ÀÀ6 8
$str
ÀÀ9 L
)
ÀÀL M
item
ÃÃ, 0
.
ÃÃ0 1
ConsolidationCode
ÃÃ1 B
=
ÃÃC D 
rawFileCheckedData
ÃÃE W
;
ÃÃW X
if
ÕÕ( *
(
ÕÕ+ ,
	indexName
ÕÕ, 5
==
ÕÕ6 8
$str
ÕÕ9 L
)
ÕÕL M
item
ŒŒ, 0
.
ŒŒ0 1
ConsolidationName
ŒŒ1 B
=
ŒŒC D 
rawFileCheckedData
ŒŒE W
;
ŒŒW X
if
œœ( *
(
œœ+ ,
	indexName
œœ, 5
==
œœ6 8
$str
œœ9 ?
)
œœ? @
item
––, 0
.
––0 1
Imei
––1 5
=
––6 7 
rawFileCheckedData
––8 J
;
––J K
if
——( *
(
——+ ,
	indexName
——, 5
==
——6 8
$str
——9 A
)
——A B
item
““, 0
.
““0 1
SerialNo
““1 9
=
““: ; 
rawFileCheckedData
““< N
;
““N O
if
””( *
(
””+ ,
	indexName
””, 5
==
””6 8
$str
””9 C
)
””C D
item
‘‘, 0
.
‘‘0 1
Quantity
‘‘1 9
=
‘‘: ;
Convert
‘‘< C
.
‘‘C D
ToInt32
‘‘D K
(
‘‘K L 
rawFileCheckedData
‘‘L ^
)
‘‘^ _
;
‘‘_ `
if
’’( *
(
’’+ ,
	indexName
’’, 5
==
’’6 8
$str
’’9 ?
)
’’? @
item
÷÷, 0
.
÷÷0 1)
CustomerOperatorStorageCity
÷÷1 L
=
÷÷M N 
rawFileCheckedData
÷÷O a
;
÷÷a b
if
◊◊( *
(
◊◊+ ,
	indexName
◊◊, 5
==
◊◊6 8
$str
◊◊9 ?
)
◊◊? @
item
ÿÿ, 0
.
ÿÿ0 1)
CustomerOperatorStorageTown
ÿÿ1 L
=
ÿÿM N 
rawFileCheckedData
ÿÿO a
;
ÿÿa b
}
ŸŸ$ %
}
⁄⁄  !
else
€€  $
{
‹‹  !
Log
››$ '
.
››' (
Error
››( -
(
››- .
$str
››. M
)
››M N
;
››N O
}
ﬁﬁ  !
}
ﬂﬂ 
catch
‡‡ !
(
‡‡" #
	Exception
‡‡# ,
e
‡‡- .
)
‡‡. /
{
·· 
Log
‚‚  #
.
‚‚# $
Error
‚‚$ )
(
‚‚) *
$str
‚‚* X
,
‚‚X Y
e
‚‚Z [
.
‚‚[ \
ToString
‚‚\ d
(
‚‚d e
)
‚‚e f
)
‚‚f g
;
‚‚g h
}
„„ 
}
‰‰ 
item
ÊÊ 
.
ÊÊ 
	ProductId
ÊÊ &
=
ÊÊ' (
Finder
ÊÊ) /
.
ÊÊ/ 0
FindInventory
ÊÊ0 =
(
ÊÊ= >
item
ÊÊ> B
.
ÊÊB C
SerialNo
ÊÊC K
,
ÊÊK L
item
ÊÊM Q
.
ÊÊQ R
Imei
ÊÊR V
)
ÊÊV W
?
ÊÊW X
.
ÊÊX Y
	productId
ÊÊY b
;
ÊÊb c
item
ÁÁ 
.
ÁÁ 
InventoryId
ÁÁ (
=
ÁÁ) *
Finder
ÁÁ+ 1
.
ÁÁ1 2
FindInventory
ÁÁ2 ?
(
ÁÁ? @
item
ÁÁ@ D
.
ÁÁD E
SerialNo
ÁÁE M
,
ÁÁM N
item
ÁÁO S
.
ÁÁS T
Imei
ÁÁT X
)
ÁÁX Y
?
ÁÁY Z
.
ÁÁZ [
id
ÁÁ[ ]
;
ÁÁ] ^
item
ËË 
.
ËË 
DistributorId
ËË *
=
ËË+ ,
DistributorId
ËË- :
;
ËË: ;
item
ÈÈ 
.
ÈÈ 
DistributorName
ÈÈ ,
=
ÈÈ- .
this
ÈÈ/ 3
.
ÈÈ3 4
DistributorName
ÈÈ4 C
;
ÈÈC D
item
ÍÍ 
.
ÍÍ 
EntegrationFileId
ÍÍ .
=
ÍÍ/ 0 
entegrationFilesId
ÍÍ1 C
;
ÍÍC D
item
ÎÎ 
.
ÎÎ  
CustomerOperatorId
ÎÎ /
=
ÎÎ0 1
Finder
ÎÎ2 8
.
ÎÎ8 9
FindCompany
ÎÎ9 D
(
ÎÎD E
item
ÎÎE I
)
ÎÎI J
;
ÎÎJ K
sellThrs
ÏÏ  
.
ÏÏ  !
Add
ÏÏ! $
(
ÏÏ$ %
item
ÏÏ% )
)
ÏÏ) *
;
ÏÏ* +
}
ÌÌ 
catch
ÓÓ 
(
ÓÓ 
	Exception
ÓÓ $
e
ÓÓ% &
)
ÓÓ& '
{
ÔÔ 
Log
 
.
 
Error
 !
(
! "
$str
" P
,
P Q
e
R S
.
S T
ToString
T \
(
\ ]
)
] ^
)
^ _
;
_ `
}
ÒÒ 
}
ÚÚ 
}
ÛÛ 
catch
ÙÙ 
(
ÙÙ 
	Exception
ÙÙ 
e
ÙÙ 
)
ÙÙ 
{
ıı 
Log
ˆˆ 
.
ˆˆ 
Error
ˆˆ 
(
ˆˆ 
e
ˆˆ 
.
ˆˆ 
ToString
ˆˆ $
(
ˆˆ$ %
)
ˆˆ% &
)
ˆˆ& '
;
ˆˆ' (
}
˜˜ 
return
¯¯ 
sellThrs
¯¯ 
.
¯¯ 
ToArray
¯¯ #
(
¯¯# $
)
¯¯$ %
;
¯¯% &
}
˘˘ 	
public
˚˚ 
void
˚˚ !
SetFtpConfiguration
˚˚ '
(
˚˚' (
)
˚˚( )
{
¸¸ 	
var
˝˝ 
kvkUserName
˝˝ 
=
˝˝ "
ConfigurationManager
˝˝ 2
.
˝˝2 3
AppSettings
˝˝3 >
[
˝˝> ?
$str
˝˝? L
]
˝˝L M
.
˝˝M N
ToString
˝˝N V
(
˝˝V W
)
˝˝W X
;
˝˝X Y
var
˛˛ 
kvkPassword
˛˛ 
=
˛˛ "
ConfigurationManager
˛˛ 2
.
˛˛2 3
AppSettings
˛˛3 >
[
˛˛> ?
$str
˛˛? L
]
˛˛L M
.
˛˛M N
ToString
˛˛N V
(
˛˛V W
)
˛˛W X
;
˛˛X Y
var
ˇˇ 
kvkUrl
ˇˇ 
=
ˇˇ "
ConfigurationManager
ˇˇ -
.
ˇˇ- .
AppSettings
ˇˇ. 9
[
ˇˇ9 :
$str
ˇˇ: C
]
ˇˇC D
.
ˇˇD E
ToString
ˇˇE M
(
ˇˇM N
)
ˇˇN O
??
ˇˇP R
$str
ˇˇS U
;
ˇˇU V
ftpConfiguration
ÄÄ 
=
ÄÄ 
new
ÄÄ "
FtpConfiguration
ÄÄ# 3
{
ÅÅ 
Url
ÇÇ 
=
ÇÇ 
kvkUrl
ÇÇ 
,
ÇÇ 
UserName
ÉÉ 
=
ÉÉ 
kvkUserName
ÉÉ &
,
ÉÉ& '
Password
ÑÑ 
=
ÑÑ 
kvkPassword
ÑÑ &
}
ÖÖ 
;
ÖÖ 
}
àà 	
private
ââ 
IEnumerable
ââ 
<
ââ 
string
ââ "
[
ââ" #
]
ââ# $
>
ââ$ %

GetRawFile
ââ& 0
(
ââ0 1
string
ââ1 7
fileName
ââ8 @
)
ââ@ A
{
ää 	
Log
ãã 
.
ãã 
Info
ãã 
(
ãã 
string
ãã 
.
ãã 
Format
ãã "
(
ãã" #
$str
ãã# D
,
ããD E
fileName
ããF N
)
ããN O
)
ããO P
;
ããP Q
var
åå 
listStringArray
åå 
=
åå  !
new
åå" %
List
åå& *
<
åå* +
string
åå+ 1
[
åå1 2
]
åå2 3
>
åå3 4
(
åå4 5
)
åå5 6
;
åå6 7
var
çç 
request
çç 
=
çç 
(
çç 
FtpWebRequest
çç (
)
çç( )

WebRequest
çç) 3
.
çç3 4
Create
çç4 :
(
çç: ;
fileName
çç; C
)
ççC D
;
ççD E
request
éé 
.
éé 
Method
éé 
=
éé 
WebRequestMethods
éé .
.
éé. /
Ftp
éé/ 2
.
éé2 3
DownloadFile
éé3 ?
;
éé? @
request
èè 
.
èè 
Credentials
èè 
=
èè  !
new
èè" %
NetworkCredential
èè& 7
(
èè7 8
ftpConfiguration
èè8 H
.
èèH I
UserName
èèI Q
,
èèQ R
ftpConfiguration
èèS c
.
èèc d
Password
èèd l
)
èèl m
;
èèm n
var
êê 
response
êê 
=
êê 
(
êê 
FtpWebResponse
êê *
)
êê* +
request
êê+ 2
.
êê2 3
GetResponse
êê3 >
(
êê> ?
)
êê? @
;
êê@ A
var
ëë 
responseStream
ëë 
=
ëë  
response
ëë! )
.
ëë) *
GetResponseStream
ëë* ;
(
ëë; <
)
ëë< =
;
ëë= >
var
íí 
reader
íí 
=
íí 
new
íí 
StreamReader
íí )
(
íí) *
responseStream
íí* 8
)
íí8 9
;
íí9 :
string
ìì 
line
ìì 
;
ìì 
try
îî 
{
ïï 
while
ññ 
(
ññ 
(
ññ 
line
ññ 
=
ññ 
reader
ññ %
.
ññ% &
ReadLine
ññ& .
(
ññ. /
)
ññ/ 0
)
ññ0 1
!=
ññ2 4
null
ññ5 9
)
ññ9 :
{
óó 
List
òò 
<
òò 
string
òò 
>
òò  
splitedLines
òò! -
=
òò. /
line
òò0 4
.
òò4 5
Split
òò5 :
(
òò: ;
$char
òò; ?
)
òò? @
.
òò@ A
ToList
òòA G
(
òòG H
)
òòH I
;
òòI J
listStringArray
ôô #
.
ôô# $
Add
ôô$ '
(
ôô' (
splitedLines
ôô( 4
.
ôô4 5
ToArray
ôô5 <
(
ôô< =
)
ôô= >
)
ôô> ?
;
ôô? @
}
öö 
response
õõ 
.
õõ 
Close
õõ 
(
õõ 
)
õõ  
;
õõ  !
reader
úú 
.
úú 
Close
úú 
(
úú 
)
úú 
;
úú 
}
ùù 
catch
ûû 
(
ûû 
	Exception
ûû 
e
ûû 
)
ûû 
{
üü 
Log
†† 
.
†† 
Warning
†† 
(
†† 
e
†† 
.
†† 
Message
†† %
)
††% &
;
††& '
}
°° 
return
¢¢ 
listStringArray
¢¢ "
;
¢¢" #
}
££ 	
}
§§ 
}•• ®î
ÇD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\FtpMobiltel.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
public 

class 

FtpMobitel 
: &
IFtpDistributorEntegration 8
{ 
public 
FtpConfiguration 
ftpConfiguration  0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
string 
DistributorName %
{ 	
get
 
{ 
return 
$str !
;! "
}# $
}% &
public 
Guid 
DistributorId !
{ 	
get
 
{ 
return 
new 
Guid 
(  
$str  F
)F G
;G H
}I J
}K L
public 

FtpMobitel 
( 
) 
{ 	
Log 
. 
Warning 
( 
$str 3
)3 4
;4 5
SetFtpConfiguration 
(  
)  !
;! "
} 	
public 
WorkOfTimeDatabase !
GetDbConnection" 1
(1 2
)2 3
{ 	
var   

tenantCode   
=    
ConfigurationManager   1
.  1 2
AppSettings  2 =
[  = >
$str  > M
]  M N
.  N O
ToString  O W
(  W X
)  X Y
;  Y Z
var!! 
tenant!! 
=!! 
TenantConfig!! %
.!!% &

GetTenants!!& 0
(!!0 1
)!!1 2
.!!2 3
Where!!3 8
(!!8 9
a!!9 :
=>!!; =
a!!> ?
.!!? @

TenantCode!!@ J
==!!K M
Convert!!N U
.!!U V
ToInt32!!V ]
(!!] ^

tenantCode!!^ h
)!!h i
)!!i j
.!!j k
FirstOrDefault!!k y
(!!y z
)!!z {
;!!{ |
return"" 
tenant"" 
."" 
GetDatabase"" %
(""% &
)""& '
;""' (
}## 	
public%% 
void%% 
SetFtpConfiguration%% '
(%%' (
)%%( )
{&& 	
var'' 
url'' 
=''  
ConfigurationManager'' *
.''* +
AppSettings''+ 6
[''6 7
$str''7 D
]''D E
.''E F
ToString''F N
(''N O
)''O P
;''P Q
var(( 
userName(( 
=((  
ConfigurationManager(( /
.((/ 0
AppSettings((0 ;
[((; <
$str((< N
]((N O
.((O P
ToString((P X
(((X Y
)((Y Z
;((Z [
var)) 
password)) 
=))  
ConfigurationManager)) /
.))/ 0
AppSettings))0 ;
[)); <
$str))< N
]))N O
.))O P
ToString))P X
())X Y
)))Y Z
;))Z [
var** 
	directory** 
=**  
ConfigurationManager** 0
.**0 1
AppSettings**1 <
[**< =
$str**= P
]**P Q
.**Q R
ToString**R Z
(**Z [
)**[ \
;**\ ]
var++ 
readAllDirectory++  
=++! " 
ConfigurationManager++# 7
.++7 8
AppSettings++8 C
[++C D
$str++D ^
]++^ _
.++_ `
ToString++` h
(++h i
)++i j
;++j k
var,, 
fileExtension,, 
=,,  
ConfigurationManager,,  4
.,,4 5
AppSettings,,5 @
[,,@ A
$str,,A X
],,X Y
.,,Y Z
ToString,,Z b
(,,b c
),,c d
;,,d e
this.. 
... 
ftpConfiguration.. !
=.." #
new..$ '
FtpConfiguration..( 8
{// 
	Directory00 
=00 
	directory00 %
,00% &
Password11 
=11 
password11 #
,11# $
SearchAllDirectory22 "
=22# $
Convert22% ,
.22, -
	ToBoolean22- 6
(226 7
readAllDirectory227 G
)22G H
,22H I
Url33 
=33 
url33 
,33 
UserName44 
=44 
userName44 #
,44# $
FileExtension55 
=55 
fileExtension55  -
}66 
;66 
}77 	
public99 
ResultStatus99 !
ExportFilesToDatabase99 1
(991 2
)992 3
{:: 	
var;; 
processDate;; 
=;; 
DateTime;; &
.;;& '
Now;;' *
.;;* +
AddDays;;+ 2
(;;2 3
-;;3 4
$num;;4 7
);;7 8
;;;8 9
var<< 
entegrationFileList<< #
=<<$ %
GetFilesInFtp<<& 3
(<<3 4
processDate<<4 ?
)<<? @
;<<@ A
var>> 
result>> 
=>> 
new>> 
ResultStatus>> )
(>>) *
)>>* +
;>>+ ,
foreach?? 
(?? 
var?? 
entegrationFile?? (
in??) +
entegrationFileList??, ?
)??? @
{@@ 
LogAA 
.AA 
WarningAA 
(AA 
$strAA A
,AAA B
thisAAC G
.AAG H
ftpConfigurationAAH X
.AAX Y
UrlAAY \
,AA\ ]
thisAA^ b
.AAb c
DistributorNameAAc r
,AAr s
entegrationFile	AAt É
.
AAÉ Ñ
FileName
AAÑ å
)
AAå ç
;
AAç é
varCC 
dbCC 
=CC 
GetDbConnectionCC (
(CC( )
)CC) *
;CC* +
resultDD 
=DD 
dbDD 
.DD &
InsertPRD_EntegrationFilesDD 6
(DD6 7
entegrationFileDD7 F
)DDF G
;DDG H
ifEE 
(EE 
!EE 
resultEE 
.EE 
resultEE "
)EE" #
{FF 
LogGG 
.GG 
ErrorGG 
(GG 
$strGG M
,GGM N
resultGGO U
.GGU V
messageGGV ]
)GG] ^
;GG^ _
continueHH 
;HH 
}II 
ifKK 
(KK 
entegrationFileKK #
.KK# $
FileTypeNameKK$ 0
==KK1 3
$strKK4 =
)KK= >
{LL 
varMM 
sellThrMM 
=MM  !
GetSellInFilesInFtpMM" 5
(MM5 6
entegrationFileMM6 E
.MME F
FileNameMMF N
,MMN O
entegrationFileMMP _
.MM_ `
idMM` b
)MMb c
;MMc d
ifNN 
(NN 
sellThrNN 
!=NN  "
nullNN# '
&&NN( *
sellThrNN+ 2
.NN2 3
CountNN3 8
(NN8 9
)NN9 :
>NN; <
$numNN= >
)NN> ?
{OO 
varPP 
bultInsertResultPP ,
=PP- .
dbPP/ 1
.PP1 2+
BulkInsertPRD_EntegrationActionPP2 Q
(PPQ R
sellThrPPR Y
)PPY Z
;PPZ [
ifQQ 
(QQ 
!QQ 
bultInsertResultQQ -
.QQ- .
resultQQ. 4
)QQ4 5
LogRR 
.RR  
InfoRR  $
(RR$ %
$strRR% ]
,RR] ^
thisRR_ c
.RRc d
ftpConfigurationRRd t
.RRt u
UrlRRu x
,RRx y
thisRRz ~
.RR~ 
DistributorName	RR é
,
RRé è
bultInsertResult
RRê †
.
RR† °
message
RR° ®
)
RR® ©
;
RR© ™
}SS 
}TT 
LogUU 
.UU 
SuccessUU 
(UU 
$strUU C
,UUC D
thisUUE I
.UUI J
ftpConfigurationUUJ Z
.UUZ [
UrlUU[ ^
,UU^ _
thisUU` d
.UUd e
DistributorNameUUe t
,UUt u
entegrationFile	UUv Ö
.
UUÖ Ü
FileName
UUÜ é
)
UUé è
;
UUè ê
}VV 
returnWW 
resultWW 
;WW 
}XX 	
publicZZ  
PRD_EntegrationFilesZZ #
[ZZ# $
]ZZ$ %
GetFilesInFtpZZ& 3
(ZZ3 4
DateTimeZZ4 <
processDateZZ= H
)ZZH I
{[[ 	
Log\\ 
.\\ 
Info\\ 
(\\ 
string\\ 
.\\ 
Format\\ "
(\\" #
$str\\# D
,\\D E
this\\F J
.\\J K
ftpConfiguration\\K [
.\\[ \
Url\\\ _
,\\_ `
this\\a e
.\\e f
DistributorName\\f u
)\\u v
)\\v w
;\\w x
var]] 
directoryItems]] 
=]]  
new]]! $
List]]% )
<]]) *
DirectoryItem]]* 7
>]]7 8
(]]8 9
)]]9 :
;]]: ;
var^^ 
fileList^^ 
=^^ 
new^^ 
List^^ #
<^^# $
FileNameWithUrl^^$ 3
>^^3 4
(^^4 5
)^^5 6
;^^6 7
try`` 
{aa 
varbb 
requestbb 
=bb 
(bb 
FtpWebRequestbb ,
)bb, -

WebRequestbb- 7
.bb7 8
Createbb8 >
(bb> ?
thisbb? C
.bbC D
ftpConfigurationbbD T
.bbT U
UrlbbU X
+bbY Z
thisbb[ _
.bb_ `
ftpConfigurationbb` p
.bbp q
	Directorybbq z
)bbz {
;bb{ |
requestcc 
.cc 
Methodcc 
=cc  
WebRequestMethodscc! 2
.cc2 3
Ftpcc3 6
.cc6 7 
ListDirectoryDetailscc7 K
;ccK L
requestdd 
.dd 
Credentialsdd #
=dd$ %
newdd& )
NetworkCredentialdd* ;
(dd; <
thisdd< @
.dd@ A
ftpConfigurationddA Q
.ddQ R
UserNameddR Z
,ddZ [
thisdd\ `
.dd` a
ftpConfigurationdda q
.ddq r
Passwordddr z
)ddz {
;dd{ |
stringee 
[ee 
]ee 
lineListee !
=ee" #
nullee$ (
;ee( )
usingff 
(ff 
varff 
responseff #
=ff$ %
(ff& '
FtpWebResponseff' 5
)ff5 6
requestff6 =
.ff= >
GetResponseff> I
(ffI J
)ffJ K
)ffK L
usinggg 
(gg 
vargg 
readergg !
=gg" #
newgg$ '
StreamReadergg( 4
(gg4 5
responsegg5 =
.gg= >
GetResponseStreamgg> O
(ggO P
)ggP Q
)ggQ R
)ggR S
{hh 
lineListii 
=ii 
readerii %
.ii% &
	ReadToEndii& /
(ii/ 0
)ii0 1
.ii1 2
Splitii2 7
(ii7 8
newii8 ;
stringii< B
[iiB C
]iiC D
{iiE F
$striiG M
}iiN O
,iiO P
StringSplitOptionsiiQ c
.iic d
RemoveEmptyEntriesiid v
)iiv w
;iiw x
}jj 
foreachll 
(ll 
stringll 
linell  $
inll% '
lineListll( 0
.ll0 1
Wherell1 6
(ll6 7
xll7 8
=>ll9 ;
xll< =
.ll= >
Containsll> F
(llF G
$strllG O
)llO P
||llQ S
xllT U
.llU V
ContainsllV ^
(ll^ _
$strll_ h
)llh i
)lli j
)llj k
{mm 
varnn 
itemnn 
=nn 
newnn "
DirectoryItemnn# 0
(nn0 1
)nn1 2
;nn2 3
varoo 
fileDateoo  
=oo! "
DateTimeoo# +
.oo+ ,

ParseExactoo, 6
(oo6 7
lineoo7 ;
.oo; <
	Substringoo< E
(ooE F
$numooF G
,ooG H
$numooI K
)ooK L
,ooL M
$strooM `
,oo` a
CultureInfooob m
.oom n
InvariantCultureoon ~
)oo~ 
;	oo Ä
varpp 
fileNamepp  
=pp! "
Toolspp# (
.pp( )
GetItemNamepp) 4
(pp4 5
linepp5 9
)pp9 :
;pp: ;
itemqq 
.qq 
BaseUriqq  
=qq! "
thisqq# '
.qq' (
ftpConfigurationqq( 8
.qq8 9
Urlqq9 <
;qq< =
itemrr 
.rr 
IsDirectoryrr $
=rr% &
Toolsrr' ,
.rr, -
IsDirrr- 2
(rr2 3
linerr3 7
)rr7 8
;rr8 9
itemss 
.ss 
Namess 
=ss 
fileNamess  (
;ss( )
itemtt 
.tt 
DateFileCreatedtt (
=tt) *
fileDatett+ 3
;tt3 4
directoryItemsuu "
.uu" #
Adduu# &
(uu& '
itemuu' +
)uu+ ,
;uu, -
ifvv 
(vv 
!vv 
itemvv 
.vv 
IsDirectoryvv )
)vv) *
{ww 
fileListxx  
.xx  !
Addxx! $
(xx$ %
newxx% (
FileNameWithUrlxx) 8
{xx9 :
FileNamexx; C
=xxD E
itemxxF J
.xxJ K
NamexxK O
,xxO P
FileCreatedDatexxQ `
=xxa b
itemxxc g
.xxg h
DateFileCreatedxxh w
,xxw x
DirectoryFileName	xxy ä
=
xxã å
this
xxç ë
.
xxë í
ftpConfiguration
xxí ¢
.
xx¢ £
Url
xx£ ¶
+
xxß ®
this
xx© ≠
.
xx≠ Æ
ftpConfiguration
xxÆ æ
.
xxæ ø
	Directory
xxø »
+
xx…  
$str
xxÀ œ
+
xx– —
item
xx“ ÷
.
xx÷ ◊
Name
xx◊ €
}
xx‹ ›
)
xx› ﬁ
;
xxﬁ ﬂ
}yy 
}zz 
Log{{ 
.{{ 
Info{{ 
({{ 
$str{{ '
+{{( )
fileList{{* 2
.{{2 3
Count{{3 8
){{8 9
;{{9 :
}|| 
catch}} 
(}} 
	Exception}} 
e}} 
)}} 
{~~ 
Log 
. 
Error 
( 
this 
. 
ftpConfiguration /
./ 0
Url0 3
+4 5
$str6 C
+D E
eF G
.G H
MessageH O
)O P
;P Q
return
ÄÄ 
null
ÄÄ 
;
ÄÄ 
}
ÅÅ 
var
ÉÉ 
db
ÉÉ 
=
ÉÉ 
GetDbConnection
ÉÉ $
(
ÉÉ$ %
)
ÉÉ% &
;
ÉÉ& '
var
ÑÑ "
entegrationFilesInDb
ÑÑ $
=
ÑÑ% &
db
ÑÑ' )
.
ÑÑ) *2
$GetPRD_EntegrationFilesByCreatedDate
ÑÑ* N
(
ÑÑN O
processDate
ÑÑO Z
,
ÑÑZ [
DistributorName
ÑÑ[ j
)
ÑÑj k
;
ÑÑk l
var
ÖÖ !
entegrationFileList
ÖÖ #
=
ÖÖ$ %
new
ÖÖ& )
List
ÖÖ* .
<
ÖÖ. /"
PRD_EntegrationFiles
ÖÖ/ C
>
ÖÖC D
(
ÖÖD E
)
ÖÖE F
;
ÖÖF G
foreach
ÜÜ 
(
ÜÜ 
var
ÜÜ 
file
ÜÜ 
in
ÜÜ  
fileList
ÜÜ! )
.
ÜÜ) *
Where
ÜÜ* /
(
ÜÜ/ 0
x
ÜÜ0 1
=>
ÜÜ2 4
x
ÜÜ5 6
.
ÜÜ6 7
FileCreatedDate
ÜÜ7 F
>=
ÜÜG I
processDate
ÜÜJ U
)
ÜÜU V
)
ÜÜV W
{
áá 
if
àà 
(
àà "
entegrationFilesInDb
àà (
.
àà( )
Any
àà) ,
(
àà, -
x
àà- .
=>
àà/ 1
x
àà2 3
.
àà3 4
FileName
àà4 <
.
àà< =
Contains
àà= E
(
ààE F
file
ààF J
.
ààJ K
FileName
ààK S
)
ààS T
)
ààT U
)
ààU V
continue
ââ 
;
ââ !
entegrationFileList
ãã #
.
ãã# $
Add
ãã$ '
(
ãã' (
new
ãã( +"
PRD_EntegrationFiles
ãã, @
{
åå 
id
çç 
=
çç 
Guid
çç 
.
çç 
NewGuid
çç %
(
çç% &
)
çç& '
,
çç' (
created
éé 
=
éé 
DateTime
éé &
.
éé& '
Now
éé' *
,
éé* +
	createdby
èè 
=
èè 
Guid
èè  $
.
èè$ %
Empty
èè% *
,
èè* +
CreateDateInFtp
êê #
=
êê$ %
file
êê& *
.
êê* +
FileCreatedDate
êê+ :
,
êê: ;
DistributorName
ëë #
=
ëë$ %
DistributorName
ëë& 5
,
ëë5 6
DistributorId
íí !
=
íí" #
DistributorId
íí$ 1
,
íí1 2
FileName
ìì 
=
ìì 
file
ìì #
.
ìì# $
DirectoryFileName
ìì$ 5
,
ìì5 6
FileNameDate
îî  
=
îî! "
Tools
îî# (
.
îî( )!
GetDateFromFileName
îî) <
(
îî< =
file
îî= A
.
îîA B
FileName
îîB J
,
îîJ K
$str
îîL X
)
îîX Y
,
îîY Z
ProcessTime
ïï 
=
ïï  !
DateTime
ïï" *
.
ïï* +
Now
ïï+ .
,
ïï. /
FileTypeName
ññ  
=
ññ! "
FileTypeName
ññ# /
(
ññ/ 0
file
ññ0 4
.
ññ4 5
FileName
ññ5 =
)
ññ= >
}
óó 
)
óó 
;
óó 
}
òò 
Log
ôô 
.
ôô 
Warning
ôô 
(
ôô 
$str
ôô ;
,
ôô; <!
entegrationFileList
ôô= P
.
ôôP Q
Count
ôôQ V
(
ôôV W
)
ôôW X
)
ôôX Y
;
ôôY Z
return
öö !
entegrationFileList
öö &
.
öö& '
ToArray
öö' .
(
öö. /
)
öö/ 0
;
öö0 1
}
õõ 	
public
ùù #
PRD_EntegrationAction
ùù $
[
ùù$ %
]
ùù% &!
GetSellInFilesInFtp
ùù' :
(
ùù: ;
string
ùù; A
fileName
ùùB J
,
ùùJ K
Guid
ùùL P 
entegrationFilesId
ùùQ c
)
ùùc d
{
ûû 	
var
üü 
sellThrs
üü 
=
üü 
new
üü 
List
üü #
<
üü# $#
PRD_EntegrationAction
üü$ 9
>
üü9 :
(
üü: ;
)
üü; <
;
üü< =
var
†† 
datetimeNow
†† 
=
†† 
DateTime
†† &
.
††& '
Now
††' *
;
††* +
try
¢¢ 
{
££ 
List
§§ 
<
§§ 
PropertyIndex
§§ "
>
§§" #
Index
§§$ )
=
§§* +
new
§§, /
List
§§0 4
<
§§4 5
PropertyIndex
§§5 B
>
§§B C
(
§§C D
)
§§D E
;
§§E F
var
•• 

getRawFile
•• 
=
••  

GetRawFile
••! +
(
••+ ,
fileName
••, 4
)
••4 5
.
••5 6
ToList
••6 <
(
••< =
)
••= >
;
••> ?
var
¶¶ 

getHeaders
¶¶ 
=
¶¶  

getRawFile
¶¶! +
[
¶¶+ ,
$num
¶¶, -
]
¶¶- .
;
¶¶. /

getRawFile
ßß 
.
ßß 
RemoveAt
ßß #
(
ßß# $
$num
ßß$ %
)
ßß% &
;
ßß& '
for
®® 
(
®® 
int
®® 
i
®® 
=
®® 
$num
®® 
;
®® 
i
®®  !
<
®®" #

getHeaders
®®$ .
.
®®. /
Length
®®/ 5
;
®®5 6
i
®®7 8
++
®®8 :
)
®®: ;
{
©© 
Index
™™ 
.
™™ 
Add
™™ 
(
™™ 
new
™™ !
PropertyIndex
™™" /
{
™™0 1
Index
™™2 7
=
™™8 9
i
™™: ;
,
™™; <
Name
™™= A
=
™™B C

getHeaders
™™D N
[
™™N O
i
™™O P
]
™™P Q
}
™™R S
)
™™S T
;
™™T U
}
´´ 
foreach
¨¨ 
(
¨¨ 
var
¨¨ 
rawFile
¨¨ $
in
¨¨% '

getRawFile
¨¨( 2
)
¨¨2 3
{
≠≠ 
try
ÆÆ 
{
ØØ 
var
∞∞ 
item
∞∞  
=
∞∞! "
new
∞∞# &#
PRD_EntegrationAction
∞∞' <
(
∞∞< =
)
∞∞= >
;
∞∞> ?
for
±± 
(
±± 
int
±±  
i
±±! "
=
±±# $
$num
±±% &
;
±±& '
i
±±( )
<
±±* +
rawFile
±±, 3
.
±±3 4
Length
±±4 :
;
±±: ;
i
±±< =
++
±±= ?
)
±±? @
{
≤≤ 
try
≥≥ 
{
¥¥ 
var
µµ  #
	indexName
µµ$ -
=
µµ. /
Index
µµ0 5
.
µµ5 6
Where
µµ6 ;
(
µµ; <
x
µµ< =
=>
µµ> @
x
µµA B
.
µµB C
Index
µµC H
==
µµI K
i
µµL M
)
µµM N
.
µµN O
Select
µµO U
(
µµU V
x
µµV W
=>
µµX Z
x
µµ[ \
.
µµ\ ]
Name
µµ] a
)
µµa b
.
µµb c
FirstOrDefault
µµc q
(
µµq r
)
µµr s
;
µµs t
if
∂∂  "
(
∂∂# $
	indexName
∂∂$ -
!=
∂∂. 0
null
∂∂1 5
)
∂∂5 6
{
∑∑  !
var
∏∏$ ' 
rawFileCheckedData
∏∏( :
=
∏∏; <
rawFile
∏∏= D
[
∏∏D E
i
∏∏E F
]
∏∏F G
.
∏∏G H
Replace
∏∏H O
(
∏∏O P
$str
∏∏P T
,
∏∏T U
$str
∏∏V X
)
∏∏X Y
.
∏∏Y Z
Replace
∏∏Z a
(
∏∏a b
$str
∏∏b f
,
∏∏f g
$str
∏∏h j
)
∏∏j k
;
∏∏k l
if
ππ$ &
(
ππ' (
!
ππ( )
string
ππ) /
.
ππ/ 0
IsNullOrEmpty
ππ0 =
(
ππ= > 
rawFileCheckedData
ππ> P
)
ππP Q
)
ππQ R
{
∫∫$ %
	indexName
ªª( 1
=
ªª2 3
	indexName
ªª4 =
.
ªª= >
ToLower
ªª> E
(
ªªE F
new
ªªF I
CultureInfo
ªªJ U
(
ªªU V
$str
ªªV ]
,
ªª] ^
false
ªª_ d
)
ªªd e
)
ªªe f
.
ªªf g
Replace
ªªg n
(
ªªn o
$str
ªªo r
,
ªªr s
$str
ªªt v
)
ªªv w
;
ªªw x
if
ºº( *
(
ºº+ ,
	indexName
ºº, 5
==
ºº6 8
$str
ºº9 H
)
ººH I
item
ΩΩ, 0
.
ΩΩ0 1
InvoiceNumber
ΩΩ1 >
=
ΩΩ? @ 
rawFileCheckedData
ΩΩA S
;
ΩΩS T
if
ææ( *
(
ææ+ ,
	indexName
ææ, 5
==
ææ6 8
$str
ææ9 ?
)
ææ? @
item
øø, 0
.
øø0 1
DistributorName
øø1 @
=
øøA B 
rawFileCheckedData
øøC U
;
øøU V
if
¿¿( *
(
¿¿+ ,
	indexName
¿¿, 5
==
¿¿6 8
$str
¿¿9 O
)
¿¿O P
item
¡¡, 0
.
¡¡0 1"
CustomerOperatorCode
¡¡1 E
=
¡¡F G 
rawFileCheckedData
¡¡H Z
;
¡¡Z [
if
¬¬( *
(
¬¬+ ,
	indexName
¬¬, 5
==
¬¬6 8
$str
¬¬9 L
||
¬¬M O
	indexName
¬¬P Y
==
¬¬Z \
$str
¬¬] n
||
¬¬o q
	indexName
¬¬r {
==
¬¬| ~
$str¬¬ î
)¬¬î ï
item
√√, 0
.
√√0 1"
CustomerOperatorCode
√√1 E
=
√√F G 
rawFileCheckedData
√√H Z
;
√√Z [
if
ƒƒ( *
(
ƒƒ+ ,
	indexName
ƒƒ, 5
==
ƒƒ6 8
$str
ƒƒ9 G
)
ƒƒG H
item
≈≈, 0
.
≈≈0 1"
CustomerOperatorName
≈≈1 E
=
≈≈F G 
rawFileCheckedData
≈≈H Z
;
≈≈Z [
if
∆∆( *
(
∆∆+ ,
	indexName
∆∆, 5
==
∆∆6 8
$str
∆∆9 E
)
∆∆E F
item
««, 0
.
««0 1

BranchCode
««1 ;
=
««< = 
rawFileCheckedData
««> P
;
««P Q
if
»»( *
(
»»+ ,
	indexName
»», 5
==
»»6 8
$str
»»9 E
)
»»E F
item
……, 0
.
……0 1

BranchName
……1 ;
=
……< = 
rawFileCheckedData
……> P
;
……P Q
if
  ( *
(
  + ,
	indexName
  , 5
==
  6 8
$str
  9 D
)
  D E
item
ÀÀ, 0
.
ÀÀ0 1
	TaxNumber
ÀÀ1 :
=
ÀÀ; < 
rawFileCheckedData
ÀÀ= O
;
ÀÀO P
if
ÃÃ( *
(
ÃÃ+ ,
	indexName
ÃÃ, 5
==
ÃÃ6 8
$str
ÃÃ9 L
)
ÃÃL M
item
ÕÕ, 0
.
ÕÕ0 1
ConsolidationCode
ÕÕ1 B
=
ÕÕC D 
rawFileCheckedData
ÕÕE W
;
ÕÕW X
if
ŒŒ( *
(
ŒŒ+ ,
	indexName
ŒŒ, 5
==
ŒŒ6 8
$str
ŒŒ9 L
)
ŒŒL M
item
œœ, 0
.
œœ0 1
ConsolidationName
œœ1 B
=
œœC D 
rawFileCheckedData
œœE W
;
œœW X
if
––( *
(
––+ ,
	indexName
––, 5
==
––6 8
$str
––9 ?
)
––? @
item
——, 0
.
——0 1
Imei
——1 5
=
——6 7 
rawFileCheckedData
——8 J
;
——J K
if
““( *
(
““+ ,
	indexName
““, 5
==
““6 8
$str
““9 A
)
““A B
item
””, 0
.
””0 1
SerialNo
””1 9
=
””: ; 
rawFileCheckedData
””< N
;
””N O
if
‘‘( *
(
‘‘+ ,
	indexName
‘‘, 5
==
‘‘6 8
$str
‘‘9 C
)
‘‘C D
item
’’, 0
.
’’0 1
Quantity
’’1 9
=
’’: ;
Convert
’’< C
.
’’C D
ToInt32
’’D K
(
’’K L 
rawFileCheckedData
’’L ^
)
’’^ _
;
’’_ `
if
÷÷( *
(
÷÷+ ,
	indexName
÷÷, 5
==
÷÷6 8
$str
÷÷9 ?
)
÷÷? @
item
◊◊, 0
.
◊◊0 1)
CustomerOperatorStorageCity
◊◊1 L
=
◊◊M N 
rawFileCheckedData
◊◊O a
;
◊◊a b
if
ÿÿ( *
(
ÿÿ+ ,
	indexName
ÿÿ, 5
==
ÿÿ6 8
$str
ÿÿ9 ?
)
ÿÿ? @
item
ŸŸ, 0
.
ŸŸ0 1)
CustomerOperatorStorageTown
ŸŸ1 L
=
ŸŸM N 
rawFileCheckedData
ŸŸO a
;
ŸŸa b
}
⁄⁄$ %
}
€€  !
else
‹‹  $
{
››  !
Log
ﬁﬁ$ '
.
ﬁﬁ' (
Error
ﬁﬁ( -
(
ﬁﬁ- .
$str
ﬁﬁ. M
)
ﬁﬁM N
;
ﬁﬁN O
}
ﬂﬂ  !
}
‡‡ 
catch
·· !
(
··" #
	Exception
··# ,
e
··- .
)
··. /
{
‚‚ 
Log
„„  #
.
„„# $
Error
„„$ )
(
„„) *
$str
„„* X
,
„„X Y
e
„„Z [
.
„„[ \
ToString
„„\ d
(
„„d e
)
„„e f
)
„„f g
;
„„g h
}
‰‰ 
}
ÂÂ 
item
ÁÁ 
.
ÁÁ 
	ProductId
ÁÁ &
=
ÁÁ' (
Finder
ÁÁ) /
.
ÁÁ/ 0
FindInventory
ÁÁ0 =
(
ÁÁ= >
item
ÁÁ> B
.
ÁÁB C
SerialNo
ÁÁC K
,
ÁÁK L
item
ÁÁM Q
.
ÁÁQ R
Imei
ÁÁR V
)
ÁÁV W
?
ÁÁW X
.
ÁÁX Y
	productId
ÁÁY b
;
ÁÁb c
item
ËË 
.
ËË 
InventoryId
ËË (
=
ËË) *
Finder
ËË+ 1
.
ËË1 2
FindInventory
ËË2 ?
(
ËË? @
item
ËË@ D
.
ËËD E
SerialNo
ËËE M
,
ËËM N
item
ËËO S
.
ËËS T
Imei
ËËT X
)
ËËX Y
?
ËËY Z
.
ËËZ [
id
ËË[ ]
;
ËË] ^
item
ÈÈ 
.
ÈÈ 
DistributorId
ÈÈ *
=
ÈÈ+ ,
DistributorId
ÈÈ- :
;
ÈÈ: ;
item
ÍÍ 
.
ÍÍ 
DistributorName
ÍÍ ,
=
ÍÍ- .
this
ÍÍ/ 3
.
ÍÍ3 4
DistributorName
ÍÍ4 C
;
ÍÍC D
item
ÎÎ 
.
ÎÎ 
EntegrationFileId
ÎÎ .
=
ÎÎ/ 0 
entegrationFilesId
ÎÎ1 C
;
ÎÎC D
item
ÏÏ 
.
ÏÏ  
CustomerOperatorId
ÏÏ /
=
ÏÏ0 1
Finder
ÏÏ2 8
.
ÏÏ8 9
FindCompany
ÏÏ9 D
(
ÏÏD E
item
ÏÏE I
)
ÏÏI J
;
ÏÏJ K
sellThrs
ÌÌ  
.
ÌÌ  !
Add
ÌÌ! $
(
ÌÌ$ %
item
ÌÌ% )
)
ÌÌ) *
;
ÌÌ* +
}
ÓÓ 
catch
ÔÔ 
(
ÔÔ 
	Exception
ÔÔ $
e
ÔÔ% &
)
ÔÔ& '
{
 
Log
ÒÒ 
.
ÒÒ 
Error
ÒÒ !
(
ÒÒ! "
$str
ÒÒ" P
,
ÒÒP Q
e
ÒÒR S
.
ÒÒS T
ToString
ÒÒT \
(
ÒÒ\ ]
)
ÒÒ] ^
)
ÒÒ^ _
;
ÒÒ_ `
}
ÚÚ 
}
ÛÛ 
}
ÙÙ 
catch
ıı 
(
ıı 
	Exception
ıı 
e
ıı 
)
ıı 
{
ˆˆ 
Log
˜˜ 
.
˜˜ 
Error
˜˜ 
(
˜˜ 
e
˜˜ 
.
˜˜ 
ToString
˜˜ $
(
˜˜$ %
)
˜˜% &
)
˜˜& '
;
˜˜' (
}
¯¯ 
return
˘˘ 
sellThrs
˘˘ 
.
˘˘ 
ToArray
˘˘ #
(
˘˘# $
)
˘˘$ %
;
˘˘% &
}
˙˙ 	
public
¸¸ 
List
¸¸ 
<
¸¸ 
string
¸¸ 
[
¸¸ 
]
¸¸ 
>
¸¸ 

GetRawFile
¸¸ (
(
¸¸( )
string
¸¸) /
fileName
¸¸0 8
)
¸¸8 9
{
˝˝ 	
Log
˛˛ 
.
˛˛ 
Info
˛˛ 
(
˛˛ 
string
˛˛ 
.
˛˛ 
Format
˛˛ "
(
˛˛" #
$str
˛˛# L
,
˛˛L M
fileName
˛˛N V
,
˛˛V W
ftpConfiguration
˛˛X h
.
˛˛h i
Url
˛˛i l
)
˛˛l m
)
˛˛m n
;
˛˛n o
var
ˇˇ 
listStringArray
ˇˇ 
=
ˇˇ  !
new
ˇˇ" %
List
ˇˇ& *
<
ˇˇ* +
string
ˇˇ+ 1
[
ˇˇ1 2
]
ˇˇ2 3
>
ˇˇ3 4
(
ˇˇ4 5
)
ˇˇ5 6
;
ˇˇ6 7
var
ÄÄ 
request
ÄÄ 
=
ÄÄ 
(
ÄÄ 
FtpWebRequest
ÄÄ (
)
ÄÄ( )

WebRequest
ÄÄ) 3
.
ÄÄ3 4
Create
ÄÄ4 :
(
ÄÄ: ;
fileName
ÄÄ; C
)
ÄÄC D
;
ÄÄD E
request
ÅÅ 
.
ÅÅ 
Method
ÅÅ 
=
ÅÅ 
WebRequestMethods
ÅÅ .
.
ÅÅ. /
Ftp
ÅÅ/ 2
.
ÅÅ2 3
DownloadFile
ÅÅ3 ?
;
ÅÅ? @
request
ÇÇ 
.
ÇÇ 
Credentials
ÇÇ 
=
ÇÇ  !
new
ÇÇ" %
NetworkCredential
ÇÇ& 7
(
ÇÇ7 8
ftpConfiguration
ÇÇ8 H
.
ÇÇH I
UserName
ÇÇI Q
,
ÇÇQ R
ftpConfiguration
ÇÇS c
.
ÇÇc d
Password
ÇÇd l
)
ÇÇl m
;
ÇÇm n
var
ÉÉ 
response
ÉÉ 
=
ÉÉ 
(
ÉÉ 
FtpWebResponse
ÉÉ *
)
ÉÉ* +
request
ÉÉ+ 2
.
ÉÉ2 3
GetResponse
ÉÉ3 >
(
ÉÉ> ?
)
ÉÉ? @
;
ÉÉ@ A
var
ÑÑ 
responseStream
ÑÑ 
=
ÑÑ  
response
ÑÑ! )
.
ÑÑ) *
GetResponseStream
ÑÑ* ;
(
ÑÑ; <
)
ÑÑ< =
;
ÑÑ= >
var
ÖÖ 
reader
ÖÖ 
=
ÖÖ 
new
ÖÖ 
StreamReader
ÖÖ )
(
ÖÖ) *
responseStream
ÖÖ* 8
)
ÖÖ8 9
;
ÖÖ9 :
string
ÜÜ 
line
ÜÜ 
;
ÜÜ 
try
áá 
{
àà 
while
ââ 
(
ââ 
(
ââ 
line
ââ 
=
ââ 
reader
ââ %
.
ââ% &
ReadLine
ââ& .
(
ââ. /
)
ââ/ 0
)
ââ0 1
!=
ââ2 4
null
ââ5 9
)
ââ9 :
{
ää 
List
ãã 
<
ãã 
string
ãã 
>
ãã  
splitedLines
ãã! -
=
ãã. /
line
ãã0 4
.
ãã4 5
Split
ãã5 :
(
ãã: ;
$char
ãã; >
)
ãã> ?
.
ãã? @
ToList
ãã@ F
(
ããF G
)
ããG H
;
ããH I
listStringArray
åå #
.
åå# $
Add
åå$ '
(
åå' (
splitedLines
åå( 4
.
åå4 5
ToArray
åå5 <
(
åå< =
)
åå= >
)
åå> ?
;
åå? @
}
çç 
response
éé 
.
éé 
Close
éé 
(
éé 
)
éé  
;
éé  !
reader
èè 
.
èè 
Close
èè 
(
èè 
)
èè 
;
èè 
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
e
ëë 
)
ëë 
{
íí 
Log
ìì 
.
ìì 
Warning
ìì 
(
ìì 
e
ìì 
.
ìì 
Message
ìì %
)
ìì% &
;
ìì& '
}
îî 
return
ïï 
listStringArray
ïï "
;
ïï" #
}
ññ 	
public
òò 
string
òò 
FileTypeName
òò "
(
òò" #
string
òò# )
fileName
òò* 2
)
òò2 3
{
ôô 	
if
öö 
(
öö 
fileName
öö 
.
öö 
Contains
öö !
(
öö! "
$str
öö" *
)
öö* +
)
öö+ ,
return
õõ 
$str
õõ 
;
õõ  
else
úú 
if
úú 
(
úú 
fileName
úú 
.
úú 
Contains
úú &
(
úú& '
$str
úú' 0
)
úú0 1
)
úú1 2
return
ùù 
$str
ùù  
;
ùù  !
else
ûû 
if
ûû 
(
ûû 
fileName
ûû 
.
ûû 
Contains
ûû &
(
ûû& '
$str
ûû' -
)
ûû- .
)
ûû. /
return
üü 
$str
üü  
;
üü  !
else
†† 
return
°° 
null
°° 
;
°° 
}
¢¢ 	
}
££ 
}§§ ®Ö
~D:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\FtpPort.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
public 

class 
FtpPort 
: &
IFtpDistributorEntegration 5
{ 
public 
FtpConfiguration 
ftpConfiguration  0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
string 
DistributorName %
=>& (
$str) /
;/ 0
public 
Guid 
DistributorId !
=>" $
new% (
Guid) -
(- .
$str. T
)T U
;U V
public 
FtpPort 
( 
) 
{ 	
Log 
. 
Warning 
( 
$str 0
)0 1
;1 2
SetFtpConfiguration 
(  
)  !
;! "
} 	
public 
ResultStatus !
ExportFilesToDatabase 1
(1 2
)2 3
{ 	
var 
processDate 
= 
DateTime &
.& '
Now' *
.* +
AddDays+ 2
(2 3
-3 4
$num4 6
)6 7
;7 8
var   
entegrationFileList   #
=  $ %
GetFilesInFtp  & 3
(  3 4
processDate  4 ?
)  ? @
;  @ A
var"" 
result"" 
="" 
new"" 
ResultStatus"" )
("") *
)""* +
;""+ ,
foreach## 
(## 
var## 
entegrationFile## (
in##) +
entegrationFileList##, ?
)##? @
{$$ 
Log%% 
.%% 
Warning%% 
(%% 
$str%% A
,%%A B
this%%C G
.%%G H
ftpConfiguration%%H X
.%%X Y
Url%%Y \
,%%\ ]
this%%^ b
.%%b c
DistributorName%%c r
,%%r s
entegrationFile	%%t É
.
%%É Ñ
FileName
%%Ñ å
)
%%å ç
;
%%ç é
var'' 
db'' 
='' 
GetDbConnection'' (
(''( )
)'') *
;''* +
result(( 
=(( 
db(( 
.(( &
InsertPRD_EntegrationFiles(( 6
(((6 7
entegrationFile((7 F
)((F G
;((G H
if)) 
()) 
!)) 
result)) 
.)) 
result)) "
)))" #
{** 
Log++ 
.++ 
Error++ 
(++ 
$str++ M
,++M N
result++O U
.++U V
message++V ]
)++] ^
;++^ _
continue,, 
;,, 
}-- 
if// 
(// 
entegrationFile// #
.//# $
FileTypeName//$ 0
==//1 3
$str//4 =
)//= >
{00 
var11 
sellThr11 
=11  !
GetSellInFilesInFtp11" 5
(115 6
entegrationFile116 E
.11E F
FileName11F N
,11N O
entegrationFile11P _
.11_ `
id11` b
)11b c
;11c d
if22 
(22 
sellThr22 
!=22  "
null22# '
&&22( *
sellThr22+ 2
.222 3
Count223 8
(228 9
)229 :
>22; <
$num22= >
)22> ?
{33 
var44 
bultInsertResult44 ,
=44- .
db44/ 1
.441 2+
BulkInsertPRD_EntegrationAction442 Q
(44Q R
sellThr44R Y
)44Y Z
;44Z [
if55 
(55 
!55 
bultInsertResult55 -
.55- .
result55. 4
)554 5
Log66 
.66  
Info66  $
(66$ %
$str66% ^
,66^ _
this66` d
.66d e
ftpConfiguration66e u
.66u v
Url66v y
,66y z
this66{ 
.	66 Ä
DistributorName
66Ä è
,
66è ê
bultInsertResult
66ë °
.
66° ¢
message
66¢ ©
)
66© ™
;
66™ ´
}77 
}88 
Log99 
.99 
Success99 
(99 
$str99 C
,99C D
this99E I
.99I J
ftpConfiguration99J Z
.99Z [
Url99[ ^
,99^ _
this99` d
.99d e
DistributorName99e t
,99t u
entegrationFile	99v Ö
.
99Ö Ü
FileName
99Ü é
)
99é è
;
99è ê
}:: 
return;; 
result;; 
;;; 
}<< 	
public>> 
string>> 
FileTypeName>> "
(>>" #
string>># )
fileName>>* 2
)>>2 3
{?? 	
if@@ 
(@@ 
fileName@@ 
.@@ 
Contains@@ !
(@@! "
$str@@" *
)@@* +
)@@+ ,
returnAA 
$strAA 
;AA  
elseBB 
ifBB 
(BB 
fileNameBB 
.BB 
ContainsBB &
(BB& '
$strBB' 0
)BB0 1
)BB1 2
returnCC 
$strCC  
;CC  !
elseDD 
ifDD 
(DD 
fileNameDD 
.DD 
ContainsDD &
(DD& '
$strDD' -
)DD- .
)DD. /
returnEE 
$strEE  
;EE  !
elseFF 
returnGG 
nullGG 
;GG 
}HH 	
publicII 
WorkOfTimeDatabaseII !
GetDbConnectionII" 1
(II1 2
)II2 3
{JJ 	
varKK 

tenantCodeKK 
=KK  
ConfigurationManagerKK 1
.KK1 2
AppSettingsKK2 =
[KK= >
$strKK> M
]KKM N
.KKN O
ToStringKKO W
(KKW X
)KKX Y
;KKY Z
varLL 
tenantLL 
=LL 
TenantConfigLL %
.LL% &

GetTenantsLL& 0
(LL0 1
)LL1 2
.LL2 3
WhereLL3 8
(LL8 9
aLL9 :
=>LL; =
aLL> ?
.LL? @

TenantCodeLL@ J
==LLK M
ConvertLLN U
.LLU V
ToInt32LLV ]
(LL] ^

tenantCodeLL^ h
)LLh i
)LLi j
.LLj k
FirstOrDefaultLLk y
(LLy z
)LLz {
;LL{ |
returnMM 
tenantMM 
.MM 
GetDatabaseMM %
(MM% &
)MM& '
;MM' (
}NN 	
publicPP  
PRD_EntegrationFilesPP #
[PP# $
]PP$ %
GetFilesInFtpPP& 3
(PP3 4
DateTimePP4 <
processDatePP= H
)PPH I
{QQ 	
LogRR 
.RR 
InfoRR 
(RR 
stringRR 
.RR 
FormatRR "
(RR" #
$strRR# P
,RRP Q
ftpConfigurationRRR b
.RRb c
UrlRRc f
)RRf g
)RRg h
;RRh i
varSS 
fileListSS 
=SS 
newSS 
ListSS #
<SS# $
FileNameWithUrlSS$ 3
>SS3 4
(SS4 5
)SS5 6
;SS6 7
tryTT 
{UU 
FtpWebRequestVV 
requestVV %
=VV& '
(VV( )
FtpWebRequestVV) 6
)VV6 7
FtpWebRequestVV7 D
.VVD E
CreateVVE K
(VVK L
ftpConfigurationVVL \
.VV\ ]
UrlVV] `
)VV` a
;VVa b
requestWW 
.WW 
MethodWW 
=WW  
WebRequestMethodsWW! 2
.WW2 3
FtpWW3 6
.WW6 7 
ListDirectoryDetailsWW7 K
;WWK L
requestXX 
.XX 
CredentialsXX #
=XX$ %
newXX& )
NetworkCredentialXX* ;
(XX; <
ftpConfigurationXX< L
.XXL M
UserNameXXM U
,XXU V
ftpConfigurationXXW g
.XXg h
PasswordXXh p
)XXp q
;XXq r
stringYY 
[YY 
]YY 
listYY 
=YY 
nullYY  $
;YY$ %
usingZZ 
(ZZ 
FtpWebResponseZZ %
responseZZ& .
=ZZ/ 0
(ZZ1 2
FtpWebResponseZZ2 @
)ZZ@ A
requestZZA H
.ZZH I
GetResponseZZI T
(ZZT U
)ZZU V
)ZZV W
using[[ 
([[ 
StreamReader[[ #
reader[[$ *
=[[+ ,
new[[- 0
StreamReader[[1 =
([[= >
response[[> F
.[[F G
GetResponseStream[[G X
([[X Y
)[[Y Z
)[[Z [
)[[[ \
{\\ 
list]] 
=]] 
reader]] !
.]]! "
	ReadToEnd]]" +
(]]+ ,
)]], -
.]]- .
Split]]. 3
(]]3 4
new]]4 7
string]]8 >
[]]> ?
]]]? @
{]]A B
$str]]C I
}]]J K
,]]K L
StringSplitOptions]]M _
.]]_ `
RemoveEmptyEntries]]` r
)]]r s
;]]s t
}^^ 
foreach__ 
(__ 
string__ 
line__  $
in__% '
list__( ,
)__, -
{`` 
DirectoryItemaa !
itemaa" &
=aa' (
newaa) ,
DirectoryItemaa- :
(aa: ;
)aa; <
;aa< =
stringbb 
databb 
=bb  !
linebb" &
;bb& '
varcc 

dateStringcc "
=cc# $
linecc% )
.cc) *
	Substringcc* 3
(cc3 4
$numcc4 6
,cc6 7
$numcc8 :
-cc; <
$numcc= ?
)cc? @
;cc@ A
boolee 
isDirectoryee $
=ee% &
dataee' +
[ee+ ,
$numee, -
]ee- .
.ee. /
ToStringee/ 7
(ee7 8
)ee8 9
==ee: <
$stree= @
;ee@ A
varff 
nameff 
=ff 
dataff #
.ff# $
	Substringff$ -
(ff- .
$numff. 0
)ff0 1
;ff1 2
itemgg 
.gg 
DateFileCreatedgg (
=gg) *
DateTimegg+ 3
.gg3 4

ParseExactgg4 >
(gg> ?

dateStringgg? I
,ggI J
$strggK Y
,ggY Z
CultureInfogg[ f
.ggf g
InvariantCultureggg w
)ggw x
;ggx y
itemhh 
.hh 
Namehh 
=hh 
namehh  $
;hh$ %
itemii 
.ii 
BaseUriii  
=ii! "
ftpConfigurationii# 3
.ii3 4
Urlii4 7
;ii7 8
itemjj 
.jj 
IsDirectoryjj $
=jj% &
isDirectoryjj' 2
;jj2 3
ifll 
(ll 
namell 
==ll 
$strll  #
||ll$ &
namell' +
==ll, .
$strll/ 3
)ll3 4
{mm 
}nn 
elseoo 
{pp 
ifqq 
(qq 
!qq 
isDirectoryqq (
)qq( )
{rr 
fileListss $
.ss$ %
Addss% (
(ss( )
newss) ,
FileNameWithUrlss- <
{ss= >
FileNamess? G
=ssH I
itemssJ N
.ssN O
NamessO S
,ssS T
FileCreatedDatessU d
=sse f
itemssg k
.ssk l
DateFileCreatedssl {
,ss{ |
DirectoryFileName	ss} é
=
ssè ê
this
ssë ï
.
ssï ñ
ftpConfiguration
ssñ ¶
.
ss¶ ß
Url
ssß ™
+
ss´ ¨
this
ss≠ ±
.
ss± ≤
ftpConfiguration
ss≤ ¬
.
ss¬ √
	Directory
ss√ Ã
+
ssÕ Œ
$str
ssœ ”
+
ss‘ ’
item
ss÷ ⁄
.
ss⁄ €
Name
ss€ ﬂ
}
ss‡ ·
)
ss· ‚
;
ss‚ „
}tt 
}uu 
}ww 
Logxx 
.xx 
Infoxx 
(xx 
$strxx '
+xx( )
fileListxx* 2
.xx2 3
Countxx3 8
)xx8 9
;xx9 :
}yy 
catchzz 
(zz 
	Exceptionzz 
ezz 
)zz 
{{{ 
Log|| 
.|| 
Error|| 
(|| 
ftpConfiguration|| *
.||* +
Url||+ .
+||/ 0
$str||1 >
+||? @
e||A B
.||B C
Message||C J
)||J K
;||K L
}}} 
var~~ 
db~~ 
=~~ 
GetDbConnection~~ $
(~~$ %
)~~% &
;~~& '
var  
entegrationFilesInDb $
=% &
db' )
.) *0
$GetPRD_EntegrationFilesByCreatedDate* N
(N O
processDateO Z
,Z [
DistributorName[ j
)j k
;k l
var
ÄÄ !
entegrationFileList
ÄÄ #
=
ÄÄ$ %
new
ÄÄ& )
List
ÄÄ* .
<
ÄÄ. /"
PRD_EntegrationFiles
ÄÄ/ C
>
ÄÄC D
(
ÄÄD E
)
ÄÄE F
;
ÄÄF G
foreach
ÅÅ 
(
ÅÅ 
var
ÅÅ 
file
ÅÅ 
in
ÅÅ  
fileList
ÅÅ! )
.
ÅÅ) *
Where
ÅÅ* /
(
ÅÅ/ 0
x
ÅÅ0 1
=>
ÅÅ2 4
x
ÅÅ5 6
.
ÅÅ6 7
FileCreatedDate
ÅÅ7 F
>=
ÅÅG I
processDate
ÅÅJ U
)
ÅÅU V
)
ÅÅV W
{
ÇÇ 
if
ÉÉ 
(
ÉÉ "
entegrationFilesInDb
ÉÉ (
.
ÉÉ( )
Any
ÉÉ) ,
(
ÉÉ, -
x
ÉÉ- .
=>
ÉÉ/ 1
x
ÉÉ2 3
.
ÉÉ3 4
FileName
ÉÉ4 <
.
ÉÉ< =
Contains
ÉÉ= E
(
ÉÉE F
file
ÉÉF J
.
ÉÉJ K
FileName
ÉÉK S
)
ÉÉS T
)
ÉÉT U
)
ÉÉU V
continue
ÑÑ 
;
ÑÑ !
entegrationFileList
ÜÜ #
.
ÜÜ# $
Add
ÜÜ$ '
(
ÜÜ' (
new
ÜÜ( +"
PRD_EntegrationFiles
ÜÜ, @
{
áá 
id
àà 
=
àà 
Guid
àà 
.
àà 
NewGuid
àà %
(
àà% &
)
àà& '
,
àà' (
created
ââ 
=
ââ 
DateTime
ââ &
.
ââ& '
Now
ââ' *
,
ââ* +
	createdby
ää 
=
ää 
Guid
ää  $
.
ää$ %
Empty
ää% *
,
ää* +
CreateDateInFtp
ãã #
=
ãã$ %
file
ãã& *
.
ãã* +
FileCreatedDate
ãã+ :
,
ãã: ;
DistributorName
åå #
=
åå$ %
DistributorName
åå& 5
,
åå5 6
DistributorId
çç !
=
çç" #
DistributorId
çç$ 1
,
çç1 2
FileName
éé 
=
éé 
file
éé #
.
éé# $
DirectoryFileName
éé$ 5
,
éé5 6
FileNameDate
èè  
=
èè! "
Tools
èè# (
.
èè( )!
GetDateFromFileName
èè) <
(
èè< =
file
èè= A
.
èèA B
FileName
èèB J
,
èèJ K
$str
èèL V
)
èèV W
,
èèW X
ProcessTime
êê 
=
êê  !
DateTime
êê" *
.
êê* +
Now
êê+ .
,
êê. /
FileTypeName
ëë  
=
ëë! "
FileTypeName
ëë# /
(
ëë/ 0
file
ëë0 4
.
ëë4 5
FileName
ëë5 =
)
ëë= >
}
íí 
)
íí 
;
íí 
}
ìì 
Log
îî 
.
îî 
Warning
îî 
(
îî 
$str
îî ;
,
îî; <!
entegrationFileList
îî= P
.
îîP Q
Count
îîQ V
(
îîV W
)
îîW X
)
îîX Y
;
îîY Z
return
ïï !
entegrationFileList
ïï &
.
ïï& '
ToArray
ïï' .
(
ïï. /
)
ïï/ 0
;
ïï0 1
}
ññ 	
public
òò #
PRD_EntegrationAction
òò $
[
òò$ %
]
òò% &!
GetSellInFilesInFtp
òò' :
(
òò: ;
string
òò; A
fileName
òòB J
,
òòJ K
Guid
òòL P 
entegrationFilesId
òòQ c
)
òòc d
{
ôô 	
var
öö 
sellThrs
öö 
=
öö 
new
öö 
List
öö #
<
öö# $#
PRD_EntegrationAction
öö$ 9
>
öö9 :
(
öö: ;
)
öö; <
;
öö< =
var
õõ 
datetimeNow
õõ 
=
õõ 
DateTime
õõ &
.
õõ& '
Now
õõ' *
;
õõ* +
try
ùù 
{
ûû 
List
üü 
<
üü 
PropertyIndex
üü "
>
üü" #
Index
üü$ )
=
üü* +
new
üü, /
List
üü0 4
<
üü4 5
PropertyIndex
üü5 B
>
üüB C
(
üüC D
)
üüD E
;
üüE F
var
†† 

getRawFile
†† 
=
††  

GetRawFile
††! +
(
††+ ,
fileName
††, 4
)
††4 5
.
††5 6
ToList
††6 <
(
††< =
)
††= >
;
††> ?
var
°° 

getHeaders
°° 
=
°°  

getRawFile
°°! +
[
°°+ ,
$num
°°, -
]
°°- .
;
°°. /

getRawFile
¢¢ 
.
¢¢ 
RemoveAt
¢¢ #
(
¢¢# $
$num
¢¢$ %
)
¢¢% &
;
¢¢& '
for
££ 
(
££ 
int
££ 
i
££ 
=
££ 
$num
££ 
;
££ 
i
££  !
<
££" #

getHeaders
££$ .
.
££. /
Length
££/ 5
;
££5 6
i
££7 8
++
££8 :
)
££: ;
{
§§ 
Index
•• 
.
•• 
Add
•• 
(
•• 
new
•• !
PropertyIndex
••" /
{
••0 1
Index
••2 7
=
••8 9
i
••: ;
,
••; <
Name
••= A
=
••B C

getHeaders
••D N
[
••N O
i
••O P
]
••P Q
}
••R S
)
••S T
;
••T U
}
¶¶ 
foreach
ßß 
(
ßß 
var
ßß 
rawFile
ßß $
in
ßß% '

getRawFile
ßß( 2
)
ßß2 3
{
®® 
try
©© 
{
™™ 
var
´´ 
item
´´  
=
´´! "
new
´´# &#
PRD_EntegrationAction
´´' <
(
´´< =
)
´´= >
;
´´> ?
for
¨¨ 
(
¨¨ 
int
¨¨  
i
¨¨! "
=
¨¨# $
$num
¨¨% &
;
¨¨& '
i
¨¨( )
<
¨¨* +
rawFile
¨¨, 3
.
¨¨3 4
Length
¨¨4 :
;
¨¨: ;
i
¨¨< =
++
¨¨= ?
)
¨¨? @
{
≠≠ 
try
ÆÆ 
{
ØØ 
var
∞∞  #
	indexName
∞∞$ -
=
∞∞. /
Index
∞∞0 5
.
∞∞5 6
Where
∞∞6 ;
(
∞∞; <
x
∞∞< =
=>
∞∞> @
x
∞∞A B
.
∞∞B C
Index
∞∞C H
==
∞∞I K
i
∞∞L M
)
∞∞M N
.
∞∞N O
Select
∞∞O U
(
∞∞U V
x
∞∞V W
=>
∞∞X Z
x
∞∞[ \
.
∞∞\ ]
Name
∞∞] a
)
∞∞a b
.
∞∞b c
FirstOrDefault
∞∞c q
(
∞∞q r
)
∞∞r s
;
∞∞s t
if
±±  "
(
±±# $
	indexName
±±$ -
!=
±±. 0
null
±±1 5
)
±±5 6
{
≤≤  !
var
≥≥$ ' 
rawFileCheckedData
≥≥( :
=
≥≥; <
rawFile
≥≥= D
[
≥≥D E
i
≥≥E F
]
≥≥F G
.
≥≥G H
Replace
≥≥H O
(
≥≥O P
$str
≥≥P T
,
≥≥T U
$str
≥≥V X
)
≥≥X Y
.
≥≥Y Z
Replace
≥≥Z a
(
≥≥a b
$str
≥≥b f
,
≥≥f g
$str
≥≥h j
)
≥≥j k
;
≥≥k l
if
¥¥$ &
(
¥¥' (
!
¥¥( )
string
¥¥) /
.
¥¥/ 0
IsNullOrEmpty
¥¥0 =
(
¥¥= > 
rawFileCheckedData
¥¥> P
)
¥¥P Q
)
¥¥Q R
{
µµ$ %
	indexName
∂∂( 1
=
∂∂2 3
	indexName
∂∂4 =
.
∂∂= >
ToLower
∂∂> E
(
∂∂E F
new
∂∂F I
CultureInfo
∂∂J U
(
∂∂U V
$str
∂∂V ]
,
∂∂] ^
false
∂∂_ d
)
∂∂d e
)
∂∂e f
.
∂∂f g
Replace
∂∂g n
(
∂∂n o
$str
∂∂o r
,
∂∂r s
$str
∂∂t v
)
∂∂v w
;
∂∂w x
if
∑∑( *
(
∑∑+ ,
	indexName
∑∑, 5
==
∑∑6 8
$str
∑∑9 H
)
∑∑H I
item
∏∏, 0
.
∏∏0 1
InvoiceNumber
∏∏1 >
=
∏∏? @ 
rawFileCheckedData
∏∏A S
;
∏∏S T
if
ππ( *
(
ππ+ ,
	indexName
ππ, 5
==
ππ6 8
$str
ππ9 ?
)
ππ? @
item
∫∫, 0
.
∫∫0 1
DistributorName
∫∫1 @
=
∫∫A B 
rawFileCheckedData
∫∫C U
;
∫∫U V
if
ªª( *
(
ªª+ ,
	indexName
ªª, 5
==
ªª6 8
$str
ªª9 O
)
ªªO P
item
ºº, 0
.
ºº0 1"
CustomerOperatorCode
ºº1 E
=
ººF G 
rawFileCheckedData
ººH Z
;
ººZ [
if
ΩΩ( *
(
ΩΩ+ ,
	indexName
ΩΩ, 5
==
ΩΩ6 8
$str
ΩΩ9 L
||
ΩΩM O
	indexName
ΩΩP Y
==
ΩΩZ \
$str
ΩΩ] n
||
ΩΩo q
	indexName
ΩΩr {
==
ΩΩ| ~
$strΩΩ î
)ΩΩî ï
item
ææ, 0
.
ææ0 1"
CustomerOperatorCode
ææ1 E
=
ææF G 
rawFileCheckedData
ææH Z
;
ææZ [
if
øø( *
(
øø+ ,
	indexName
øø, 5
==
øø6 8
$str
øø9 G
)
øøG H
item
¿¿, 0
.
¿¿0 1"
CustomerOperatorName
¿¿1 E
=
¿¿F G 
rawFileCheckedData
¿¿H Z
;
¿¿Z [
if
¡¡( *
(
¡¡+ ,
	indexName
¡¡, 5
==
¡¡6 8
$str
¡¡9 E
)
¡¡E F
item
¬¬, 0
.
¬¬0 1

BranchCode
¬¬1 ;
=
¬¬< = 
rawFileCheckedData
¬¬> P
;
¬¬P Q
if
√√( *
(
√√+ ,
	indexName
√√, 5
==
√√6 8
$str
√√9 E
)
√√E F
item
ƒƒ, 0
.
ƒƒ0 1

BranchName
ƒƒ1 ;
=
ƒƒ< = 
rawFileCheckedData
ƒƒ> P
;
ƒƒP Q
if
≈≈( *
(
≈≈+ ,
	indexName
≈≈, 5
==
≈≈6 8
$str
≈≈9 D
)
≈≈D E
item
∆∆, 0
.
∆∆0 1
	TaxNumber
∆∆1 :
=
∆∆; < 
rawFileCheckedData
∆∆= O
;
∆∆O P
if
««( *
(
««+ ,
	indexName
««, 5
==
««6 8
$str
««9 L
)
««L M
item
»», 0
.
»»0 1
ConsolidationCode
»»1 B
=
»»C D 
rawFileCheckedData
»»E W
;
»»W X
if
……( *
(
……+ ,
	indexName
……, 5
==
……6 8
$str
……9 L
)
……L M
item
  , 0
.
  0 1
ConsolidationName
  1 B
=
  C D 
rawFileCheckedData
  E W
;
  W X
if
ÀÀ( *
(
ÀÀ+ ,
	indexName
ÀÀ, 5
==
ÀÀ6 8
$str
ÀÀ9 ?
)
ÀÀ? @
item
ÃÃ, 0
.
ÃÃ0 1
Imei
ÃÃ1 5
=
ÃÃ6 7 
rawFileCheckedData
ÃÃ8 J
;
ÃÃJ K
if
ÕÕ( *
(
ÕÕ+ ,
	indexName
ÕÕ, 5
==
ÕÕ6 8
$str
ÕÕ9 A
)
ÕÕA B
item
ŒŒ, 0
.
ŒŒ0 1
SerialNo
ŒŒ1 9
=
ŒŒ: ; 
rawFileCheckedData
ŒŒ< N
;
ŒŒN O
if
œœ( *
(
œœ+ ,
	indexName
œœ, 5
==
œœ6 8
$str
œœ9 C
)
œœC D
item
––, 0
.
––0 1
Quantity
––1 9
=
––: ;
Convert
––< C
.
––C D
ToInt32
––D K
(
––K L 
rawFileCheckedData
––L ^
)
––^ _
;
––_ `
if
——( *
(
——+ ,
	indexName
——, 5
==
——6 8
$str
——9 ?
)
——? @
item
““, 0
.
““0 1)
CustomerOperatorStorageCity
““1 L
=
““M N 
rawFileCheckedData
““O a
;
““a b
if
””( *
(
””+ ,
	indexName
””, 5
==
””6 8
$str
””9 ?
)
””? @
item
‘‘, 0
.
‘‘0 1)
CustomerOperatorStorageTown
‘‘1 L
=
‘‘M N 
rawFileCheckedData
‘‘O a
;
‘‘a b
}
’’$ %
}
÷÷  !
else
◊◊  $
{
ÿÿ  !
Log
ŸŸ$ '
.
ŸŸ' (
Error
ŸŸ( -
(
ŸŸ- .
$str
ŸŸ. M
)
ŸŸM N
;
ŸŸN O
}
⁄⁄  !
}
€€ 
catch
‹‹ !
(
‹‹" #
	Exception
‹‹# ,
e
‹‹- .
)
‹‹. /
{
›› 
Log
ﬁﬁ  #
.
ﬁﬁ# $
Error
ﬁﬁ$ )
(
ﬁﬁ) *
$str
ﬁﬁ* X
,
ﬁﬁX Y
e
ﬁﬁZ [
.
ﬁﬁ[ \
ToString
ﬁﬁ\ d
(
ﬁﬁd e
)
ﬁﬁe f
)
ﬁﬁf g
;
ﬁﬁg h
}
ﬂﬂ 
}
‡‡ 
item
‚‚ 
.
‚‚ 
	ProductId
‚‚ &
=
‚‚' (
Finder
‚‚) /
.
‚‚/ 0
FindInventory
‚‚0 =
(
‚‚= >
item
‚‚> B
.
‚‚B C
SerialNo
‚‚C K
,
‚‚K L
item
‚‚M Q
.
‚‚Q R
Imei
‚‚R V
)
‚‚V W
?
‚‚W X
.
‚‚X Y
	productId
‚‚Y b
;
‚‚b c
item
„„ 
.
„„ 
InventoryId
„„ (
=
„„) *
Finder
„„+ 1
.
„„1 2
FindInventory
„„2 ?
(
„„? @
item
„„@ D
.
„„D E
SerialNo
„„E M
,
„„M N
item
„„O S
.
„„S T
Imei
„„T X
)
„„X Y
?
„„Y Z
.
„„Z [
id
„„[ ]
;
„„] ^
item
‰‰ 
.
‰‰ 
DistributorId
‰‰ *
=
‰‰+ ,
DistributorId
‰‰- :
;
‰‰: ;
item
ÂÂ 
.
ÂÂ 
DistributorName
ÂÂ ,
=
ÂÂ- .
this
ÂÂ/ 3
.
ÂÂ3 4
DistributorName
ÂÂ4 C
;
ÂÂC D
item
ÊÊ 
.
ÊÊ 
EntegrationFileId
ÊÊ .
=
ÊÊ/ 0 
entegrationFilesId
ÊÊ1 C
;
ÊÊC D
item
ÁÁ 
.
ÁÁ  
CustomerOperatorId
ÁÁ /
=
ÁÁ0 1
Finder
ÁÁ2 8
.
ÁÁ8 9
FindCompany
ÁÁ9 D
(
ÁÁD E
item
ÁÁE I
)
ÁÁI J
;
ÁÁJ K
sellThrs
ËË  
.
ËË  !
Add
ËË! $
(
ËË$ %
item
ËË% )
)
ËË) *
;
ËË* +
}
ÈÈ 
catch
ÍÍ 
(
ÍÍ 
	Exception
ÍÍ $
e
ÍÍ% &
)
ÍÍ& '
{
ÎÎ 
Log
ÏÏ 
.
ÏÏ 
Error
ÏÏ !
(
ÏÏ! "
$str
ÏÏ" P
,
ÏÏP Q
e
ÏÏR S
.
ÏÏS T
ToString
ÏÏT \
(
ÏÏ\ ]
)
ÏÏ] ^
)
ÏÏ^ _
;
ÏÏ_ `
}
ÌÌ 
}
ÓÓ 
}
ÔÔ 
catch
 
(
 
	Exception
 
e
 
)
 
{
ÒÒ 
Log
ÚÚ 
.
ÚÚ 
Error
ÚÚ 
(
ÚÚ 
e
ÚÚ 
.
ÚÚ 
ToString
ÚÚ $
(
ÚÚ$ %
)
ÚÚ% &
)
ÚÚ& '
;
ÚÚ' (
}
ÛÛ 
return
ÙÙ 
sellThrs
ÙÙ 
.
ÙÙ 
ToArray
ÙÙ #
(
ÙÙ# $
)
ÙÙ$ %
;
ÙÙ% &
}
ıı 	
public
˜˜ 
void
˜˜ !
SetFtpConfiguration
˜˜ '
(
˜˜' (
)
˜˜( )
{
¯¯ 	
var
˘˘ 
portUserName
˘˘ 
=
˘˘ "
ConfigurationManager
˘˘ 3
.
˘˘3 4
AppSettings
˘˘4 ?
[
˘˘? @
$str
˘˘@ N
]
˘˘N O
.
˘˘O P
ToString
˘˘P X
(
˘˘X Y
)
˘˘Y Z
;
˘˘Z [
var
˙˙ 
portPassword
˙˙ 
=
˙˙ "
ConfigurationManager
˙˙ 3
.
˙˙3 4
AppSettings
˙˙4 ?
[
˙˙? @
$str
˙˙@ N
]
˙˙N O
.
˙˙O P
ToString
˙˙P X
(
˙˙X Y
)
˙˙Y Z
;
˙˙Z [
var
˚˚ 
portUrl
˚˚ 
=
˚˚ "
ConfigurationManager
˚˚ .
.
˚˚. /
AppSettings
˚˚/ :
[
˚˚: ;
$str
˚˚; E
]
˚˚E F
.
˚˚F G
ToString
˚˚G O
(
˚˚O P
)
˚˚P Q
??
˚˚R T
$str
˚˚U W
;
˚˚W X
ftpConfiguration
¸¸ 
=
¸¸ 
new
¸¸ "
FtpConfiguration
¸¸# 3
{
˝˝ 
Url
˛˛ 
=
˛˛ 
portUrl
˛˛ 
,
˛˛ 
UserName
ˇˇ 
=
ˇˇ 
portUserName
ˇˇ '
,
ˇˇ' (
Password
ÄÄ 
=
ÄÄ 
portPassword
ÄÄ '
}
ÅÅ 
;
ÅÅ 
}
ÇÇ 	
private
ÉÉ 
IEnumerable
ÉÉ 
<
ÉÉ 
string
ÉÉ "
[
ÉÉ" #
]
ÉÉ# $
>
ÉÉ$ %

GetRawFile
ÉÉ& 0
(
ÉÉ0 1
string
ÉÉ1 7
fileName
ÉÉ8 @
)
ÉÉ@ A
{
ÑÑ 	
Log
ÖÖ 
.
ÖÖ 
Info
ÖÖ 
(
ÖÖ 
string
ÖÖ 
.
ÖÖ 
Format
ÖÖ "
(
ÖÖ" #
$str
ÖÖ# D
,
ÖÖD E
fileName
ÖÖF N
)
ÖÖN O
)
ÖÖO P
;
ÖÖP Q
var
ÜÜ 
listStringArray
ÜÜ 
=
ÜÜ  !
new
ÜÜ" %
List
ÜÜ& *
<
ÜÜ* +
string
ÜÜ+ 1
[
ÜÜ1 2
]
ÜÜ2 3
>
ÜÜ3 4
(
ÜÜ4 5
)
ÜÜ5 6
;
ÜÜ6 7
var
áá 
request
áá 
=
áá 
(
áá 
FtpWebRequest
áá (
)
áá( )

WebRequest
áá) 3
.
áá3 4
Create
áá4 :
(
áá: ;
fileName
áá; C
)
ááC D
;
ááD E
request
àà 
.
àà 
Method
àà 
=
àà 
WebRequestMethods
àà .
.
àà. /
Ftp
àà/ 2
.
àà2 3
DownloadFile
àà3 ?
;
àà? @
request
ââ 
.
ââ 
Credentials
ââ 
=
ââ  !
new
ââ" %
NetworkCredential
ââ& 7
(
ââ7 8
ftpConfiguration
ââ8 H
.
ââH I
UserName
ââI Q
,
ââQ R
ftpConfiguration
ââS c
.
ââc d
Password
ââd l
)
ââl m
;
ââm n
var
ää 
response
ää 
=
ää 
(
ää 
FtpWebResponse
ää *
)
ää* +
request
ää+ 2
.
ää2 3
GetResponse
ää3 >
(
ää> ?
)
ää? @
;
ää@ A
var
ãã 
responseStream
ãã 
=
ãã  
response
ãã! )
.
ãã) *
GetResponseStream
ãã* ;
(
ãã; <
)
ãã< =
;
ãã= >
var
åå 
reader
åå 
=
åå 
new
åå 
StreamReader
åå )
(
åå) *
responseStream
åå* 8
)
åå8 9
;
åå9 :
string
çç 
line
çç 
;
çç 
try
éé 
{
èè 
while
êê 
(
êê 
(
êê 
line
êê 
=
êê 
reader
êê %
.
êê% &
ReadLine
êê& .
(
êê. /
)
êê/ 0
)
êê0 1
!=
êê2 4
null
êê5 9
)
êê9 :
{
ëë 
List
íí 
<
íí 
string
íí 
>
íí  
splitedLines
íí! -
=
íí. /
line
íí0 4
.
íí4 5
Split
íí5 :
(
íí: ;
$char
íí; ?
)
íí? @
.
íí@ A
ToList
ííA G
(
ííG H
)
ííH I
;
ííI J
listStringArray
ìì #
.
ìì# $
Add
ìì$ '
(
ìì' (
splitedLines
ìì( 4
.
ìì4 5
ToArray
ìì5 <
(
ìì< =
)
ìì= >
)
ìì> ?
;
ìì? @
}
îî 
response
ïï 
.
ïï 
Close
ïï 
(
ïï 
)
ïï  
;
ïï  !
reader
ññ 
.
ññ 
Close
ññ 
(
ññ 
)
ññ 
;
ññ 
}
óó 
catch
òò 
(
òò 
	Exception
òò 
e
òò 
)
òò 
{
ôô 
Log
öö 
.
öö 
Warning
öö 
(
öö 
e
öö 
.
öö 
Message
öö %
)
öö% &
;
öö& '
}
õõ 
return
úú 
listStringArray
úú "
;
úú" #
}
ùù 	
}
ûû 
}üü ä
ëD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Business\IFtpDistributorEntegration.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Business6 >
{ 
	interface &
IFtpDistributorEntegration (
{		 
FtpConfiguration

 
ftpConfiguration

 )
{

* +
get

, /
;

/ 0
}

1 2
string 
DistributorName 
{  
get! $
;$ %
}& '
Guid 
DistributorId 
{ 
get  
;  !
}" #
void 
SetFtpConfiguration  
(  !
)! "
;" #
ResultStatus !
ExportFilesToDatabase *
(* +
)+ ,
;, - 
PRD_EntegrationFiles 
[ 
] 
GetFilesInFtp ,
(, -
DateTime- 5
processDate6 A
)A B
;B C!
PRD_EntegrationAction 
[ 
] 
GetSellInFilesInFtp  3
(3 4
string4 :
fileName; C
,C D
GuidE I
entegrationFilesIdJ \
)\ ]
;] ^
string 
FileTypeName 
( 
string "
fileName# +
)+ ,
;, -
} 
} ›

ÑD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\FtpConfiguration.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public 

class 
FtpConfiguration !
{ 
public 
string 
Url 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
bool 
SearchAllDirectory &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public		 
string		 
	Directory		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public

 
string

 
FileExtension

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
} 
} ™
ÅD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\DirectoryItem.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public 

class 
DirectoryItem 
{ 
public 
string 
BaseUri 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Password		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 
string

 
AbsolutePath

 "
{

# $
get

% (
{

) *
return

+ 1
string

2 8
.

8 9
Format

9 ?
(

? @
$str

@ I
,

I J
BaseUri

K R
,

R S
Name

T X
)

X Y
;

Y Z
}

[ \
}

] ^
public 
DateTime 
DateFileNameCreated +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
DateTime 
DateFileCreated '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
bool 
IsDirectory 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
List 
< 
DirectoryItem !
>! "
Items# (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
} 
} ê
ÉD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\FileNameWithUrl.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public		 

class		 
FileNameWithUrl		  
{

 
public 
string 
FileName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
DirectoryFileName '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
DateTime 
FileCreatedDate '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
} 
} Ç
zD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\FtpUrl.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public		 

class		 
FtpUrl		 
{

 
public 
string 
Url 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
FileType 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ‘
ÅD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Model\PropertyIndex.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Model6 ;
{ 
public		 

class		 
PropertyIndex		 
{

 
public 
int 
Index 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
} 
} » 
ÉD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\ProcessFtpEntegration.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
{ 
public		 

class		 !
ProcessFtpEntegration		 &
:		' (
IDisposable		) 4
{

 
List 
< 
Task 
> 
Tasks 
= 
new 
List #
<# $
Task$ (
>( )
() *
)* +
;+ ,
public !
ProcessFtpEntegration $
($ %
)% &
{ 	
Log 
. 
Info 
( 
$str 5
)5 6
;6 7
} 	
public 
void 
Run 
( 
) 
{ 	
var 
taskMobitel 
= 
new !
Task" &
(& '
(' (
)( )
=>* ,
{ 
new 

FtpMobitel 
( 
)  
.  !!
ExportFilesToDatabase! 6
(6 7
)7 8
;8 9
;: ;
} 
) 
; 
Tasks 
. 
Add 
( 
taskMobitel !
)! "
;" #
var 
	taskGenpa 
= 
new 
Task  $
($ %
(% &
)& '
=>( *
{ 
new 
FtpGenpa 
( 
) 
. !
ExportFilesToDatabase 4
(4 5
)5 6
;6 7
;8 9
} 
) 
; 
Tasks 
. 
Add 
( 
	taskGenpa 
)  
;  !
var 
taskKvk 
= 
new 
Task "
(" #
(# $
)$ %
=>& (
{ 
new   
FtpKvk   
(   
)   
.   !
ExportFilesToDatabase   2
(  2 3
)  3 4
;  4 5
;  6 7
}!! 
)!! 
;!! 
Tasks"" 
."" 
Add"" 
("" 
taskKvk"" 
)"" 
;"" 
var$$ 
taskPort$$ 
=$$ 
new$$ 
Task$$ #
($$# $
($$$ %
)$$% &
=>$$' )
{%% 
new&& 
FtpPort&& 
(&& 
)&& 
.&& !
ExportFilesToDatabase&& 3
(&&3 4
)&&4 5
;&&5 6
;&&7 8
}'' 
)'' 
;'' 
Tasks(( 
.(( 
Add(( 
((( 
taskPort(( 
)(( 
;((  
foreach** 
(** 
var** 
task** 
in**  
Tasks**! &
)**& '
{++ 
task,, 
.,, 
Start,, 
(,, 
),, 
;,, 
}-- 
}// 	
public00 
void00 
Dispose00 
(00 
)00 
{11 	
Log22 
.22 
Success22 
(22 
$str22 -
)22- .
;22. /
if33 
(33 
Tasks33 
!=33 
null33 
&&33  
Tasks33! &
.33& '
Count33' ,
>33- .
$num33/ 0
)330 1
{44 
foreach55 
(55 
var55 
task55 !
in55" $
Tasks55% *
)55* +
{66 
task77 
.77 
Dispose77  
(77  !
)77! "
;77" #
}88 
Tasks99 
=99 
new99 
List99  
<99  !
Task99! %
>99% &
(99& '
)99' (
;99( )
}:: 
};; 	
}<< 
}== Ç
zD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Utils\Finder.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Utils6 ;
{ 
public 

class 
Finder 
{ 
public		 
static		 
VWPRD_Inventory		 %
FindInventory		& 3
(		3 4
string		4 :
serialNumber		; G
,		G H
string		I O
imei		P T
)		T U
{

 	
var 
db 
= 
new 
WorkOfTimeDatabase +
(+ ,
), -
;- .
return 
db 
. .
"GetPRD_InventoryBySerialCodeOrImei 8
(8 9
serialNumber9 E
,E F
imeiG K
)K L
;L M
} 	
public 
static 
VWCMP_Invoice #
FindInvoice$ /
(/ 0
string0 6
	invoiceId7 @
)@ A
{ 	
var 
db 
= 
new 
WorkOfTimeDatabase +
(+ ,
), -
;- .
return 
db 
.  
GetVWCMP_InvoiceById *
(* +
new+ .
Guid/ 3
(3 4
	invoiceId4 =
)= >
)> ?
;? @
} 	
public 
static 
Guid 
? 
FindCompany '
(' (!
PRD_EntegrationAction( =
item> B
)B C
{ 	
var 
db 
= 
new 
WorkOfTimeDatabase +
(+ ,
), -
;- .
var 
getByCompany 
= 
db !
.! "-
!GetVWCMP_CompanyByTaxNumberOrCode" C
(C D
itemE I
.I J 
CustomerOperatorCodeJ ^
,^ _
item` d
.d e
	TaxNumbere n
)n o
;o p
var 
getByStorage 
= 
db !
.! ""
GetVWCMP_StorageByCode" 8
(8 9
item: >
.> ? 
CustomerOperatorCode? S
)S T
;T U
if 
( 
getByCompany 
!= 
null  $
)$ %
{ 
return 
getByCompany #
.# $
id$ &
;& '
} 
if 
( 
getByStorage 
!= 
null  $
)$ %
{ 
var  
findCompanyByStorage (
=) *
db+ -
.- .
GetCMP_CompanyById. @
(@ A
getByStorageA M
.M N
	companyIdN W
.W X
ValueX ]
)] ^
;^ _
if   
(    
findCompanyByStorage   (
!=  ( *
null  * .
)  . /
{!! 
return"" 
getByStorage"" '
.""' (
id""( *
;""* +
}## 
}%% 
return'' 
null'' 
;'' 
})) 	
public++ 
static++ 
VWCMP_Storage++ #
FindStorage++$ /
(++/ 0
string++0 6
name++7 ;
,++; <
string++= C
code++D H
)++H I
{,, 	
var-- 
db-- 
=-- 
new-- 
WorkOfTimeDatabase-- +
(--+ ,
)--, -
;--- .
return.. 
db.. 
... (
GetVWCMP_StorageByNameOrCode.. 2
(..2 3
name..3 7
,..7 8
code..9 =
)..= >
;..> ?
}// 	
}00 
}11 €K
yD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\FtpEntegrations\Utils\Tools.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
FtpEntegrations& 5
.5 6
Utils6 ;
{ 
public 

class 
Tools 
{ 
public 
static 
bool 
IsDir  
(  !
string! '
value( -
)- .
{ 	
return 
value 
. 
Contains !
(! "
$str" )
)) *
;* +
} 	
public 
static 
DateTime 
GetDate &
(& '
string' -
value. 3
)3 4
{ 	
var 
date 
= 
value 
. 
	Substring &
(& '
$num' (
,( )
$num* ,
), -
;- .
return 
DateTime 
. 
Parse !
(! "
date" &
,& '
CultureInfo( 3
.3 4
InvariantCulture4 D
)D E
;E F
} 	
public 
static 
string 
GetItemName (
(( )
string) /
line0 4
)4 5
{ 	
return 
line 
. 
	Substring !
(! "
$num" $
)$ %
;% &
} 	
public 
static 
DateTime 
GetDateFromFileName 2
(2 3
string3 9
fileName: B
,B C
stringD J
dateTimeFormatK Y
)Y Z
{   	
if!! 
(!! 
fileName!! 
.!! 
Contains!! !
(!!! "
$str!!" *
)!!* +
)!!+ ,
{"" 
fileName## 
=## 
fileName## #
.### $
	Substring##$ -
(##- .
$num##. /
)##/ 0
;##0 1
fileName$$ 
=$$ 
fileName$$ #
.$$# $
Split$$$ )
($$) *
$char$$* -
)$$- .
[$$. /
$num$$/ 0
]$$0 1
;$$1 2
return%% 
DateTime%% 
.%%  

ParseExact%%  *
(%%* +
fileName%%+ 3
,%%3 4
dateTimeFormat%%5 C
,%%C D
CultureInfo%%E P
.%%P Q
InvariantCulture%%Q a
)%%a b
;%%b c
}&& 
else'' 
if'' 
('' 
fileName'' 
.'' 
Contains'' %
(''% &
$str''& /
)''/ 0
)''0 1
{(( 
fileName** 
=** 
fileName** #
.**# $
	Substring**$ -
(**- .
$num**. /
)**/ 0
;**0 1
fileName++ 
=++ 
fileName++ #
.++# $
Split++$ )
(++) *
$char++* -
)++- .
[++. /
$num++/ 0
]++0 1
;++1 2
return,, 
DateTime,, 
.,,  

ParseExact,,  *
(,,* +
fileName,,+ 3
,,,3 4
dateTimeFormat,,5 C
,,,C D
CultureInfo,,E P
.,,P Q
InvariantCulture,,Q a
),,a b
;,,b c
}-- 
return.. 
new.. 
DateTime.. 
(..  
$num..  $
,..$ %
$num..% &
,..& '
$num..' (
)..( )
;..) *
}11 	
public22 
static22 
DateTime22 *
GetDateFromFileNameForMobiltel22 =
(22= >
string22> D
fileName22E M
,22M N
string22O U
dateTimeFormat22V d
)22d e
{33 	
if44 
(44 
fileName44 
.44 
Contains44 !
(44! "
$str44" *
)44* +
)44+ ,
{55 
fileName66 
=66 
fileName66 #
.66# $
	Substring66$ -
(66- .
$num66. 0
)660 1
;661 2
fileName77 
=77 
fileName77 #
.77# $
Split77$ )
(77) *
$char77* -
)77- .
[77. /
$num77/ 0
]770 1
;771 2
return88 
DateTime88 
.88  

ParseExact88  *
(88* +
fileName88+ 3
,883 4
dateTimeFormat885 C
,88C D
CultureInfo88E P
.88P Q
InvariantCulture88Q a
)88a b
;88b c
}99 
else:: 
if:: 
(:: 
fileName:: 
.:: 
Contains:: &
(::& '
$str::' 0
)::0 1
)::1 2
{;; 
fileName== 
=== 
fileName== #
.==# $
	Substring==$ -
(==- .
$num==. /
)==/ 0
;==0 1
fileName>> 
=>> 
fileName>> #
.>># $
Split>>$ )
(>>) *
$char>>* -
)>>- .
[>>. /
$num>>/ 0
]>>0 1
;>>1 2
return?? 
DateTime?? 
.??  

ParseExact??  *
(??* +
fileName??+ 3
,??3 4
dateTimeFormat??5 C
,??C D
CultureInfo??E P
.??P Q
InvariantCulture??Q a
)??a b
;??b c
}@@ 
returnAA 
newAA 
DateTimeAA 
(AA  
$numAA  $
,AA$ %
$numAA& '
,AA' (
$numAA) *
)AA* +
;AA+ ,
}DD 	
publicEE 
staticEE 
DateTimeEE '
GetDateFromFileNameForGenpaEE :
(EE: ;
stringEE; A
fileNameEEB J
,EEJ K
stringEEL R
dateTimeFormatEES a
)EEa b
{FF 	
ifGG 
(GG 
fileNameGG 
.GG 
ContainsGG !
(GG! "
$strGG" *
)GG* +
)GG+ ,
{HH 
fileNameII 
=II 
fileNameII #
.II# $
	SubstringII$ -
(II- .
$numII. /
)II/ 0
;II0 1
fileNameJJ 
=JJ 
fileNameJJ #
.JJ# $
	SubstringJJ$ -
(JJ- .
$numJJ. /
,JJ/ 0
fileNameJJ1 9
.JJ9 :
LengthJJ: @
-JJA B
$numJJC E
)JJE F
;JJF G
fileNameKK 
=KK 
fileNameKK #
.KK# $
SplitKK$ )
(KK) *
$charKK* -
)KK- .
[KK. /
$numKK/ 0
]KK0 1
;KK1 2
returnLL 
DateTimeLL 
.LL  

ParseExactLL  *
(LL* +
fileNameLL+ 3
,LL3 4
dateTimeFormatLL5 C
,LLC D
CultureInfoLLE P
.LLP Q
InvariantCultureLLQ a
)LLa b
;LLb c
}MM 
elseNN 
{OO 
fileNamePP 
=PP 
fileNamePP #
.PP# $
	SubstringPP$ -
(PP- .
$numPP. /
)PP/ 0
;PP0 1
fileNameQQ 
=QQ 
fileNameQQ #
.QQ# $
	SubstringQQ$ -
(QQ- .
$numQQ. /
,QQ/ 0
fileNameQQ1 9
.QQ9 :
LengthQQ: @
-QQA B
$numQQC E
)QQE F
;QQF G
fileNameRR 
=RR 
fileNameRR #
.RR# $
SplitRR$ )
(RR) *
$charRR* -
)RR- .
[RR. /
$numRR/ 0
]RR0 1
;RR1 2
returnTT 
DateTimeTT 
.TT  

ParseExactTT  *
(TT* +
fileNameTT+ 3
,TT3 4
dateTimeFormatTT5 C
,TTC D
CultureInfoTTE P
.TTP Q
InvariantCultureTTQ a
)TTa b
;TTb c
}UU 
}VV 	
publicWW 
staticWW 
GuidWW 

AddStorageWW %
(WW% &!
PRD_EntegrationActionWW& ;
itemWW< @
)WW@ A
{XX 	
varYY 
dbYY 
=YY 
newYY 
WorkOfTimeDatabaseYY +
(YY+ ,
)YY, -
;YY- .
varZZ 
idZZ 
=ZZ 
GuidZZ 
.ZZ 
NewGuidZZ !
(ZZ! "
)ZZ" #
;ZZ# $
db[[ 
.[[ 
InsertCMP_Company[[  
([[  !
new[[! $
CMP_Company[[% 0
{\\ 
id]] 
=]] 
id]] 
,]] 
code^^ 
=^^ 
item^^ 
.^^  
CustomerOperatorCode^^ 0
,^^0 1
created__ 
=__ 
DateTime__ "
.__" #
Now__# &
,__& '
	createdby`` 
=`` 
Guid``  
.``  !
Empty``! &
,``& '
nameaa 
=aa 
itemaa 
.aa  
CustomerOperatorNameaa 0
,aa0 1
descriptionbb 
=bb 
$strbb 8
,bb8 9
	taxNumbercc 
=cc 
itemcc  
.cc  !
	TaxNumbercc! *
,cc* +
piddd 
=dd 
itemdd 
.dd 
DistributorIddd (
}ee 
)ee 
;ee 
returnff 
idff 
;ff 
}gg 	
}hh 
}ii ∞ô
aD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Log.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
{		 
public

 

static

 
class

 
Log

 
{ 
public 
delegate 
void 
RestartEventHandler 0
(0 1
)1 2
;2 3
public 
static 
event 
RestartEventHandler /
RestartEvent0 <
;< =
public 
delegate 
void 
StopEventHandler -
(- .
). /
;/ 0
public 
static 
event 
StopEventHandler ,
	StopEvent- 6
;6 7
static 
bool 
_start 
= 
true !
;! "
public 
static 
bool 
START  
{ 	
get 
{ 
return 
_start 
;  
}! "
set 
{ 
_start 
= 
value 
; 
if 
( 
! 
_start 
) 
if 
( 
	StopEvent !
!=" $
null% )
)) *
	StopEvent !
(! "
)" #
;# $
} 
} 	
static 
bool 
_reset 
= 
false "
;" #
public 
static 
bool 
RESET  
{   	
get!! 
{!! 
return!! 
_reset!! 
;!!  
}!!! "
set"" 
{## 
_reset$$ 
=$$ 
value$$ 
;$$ 
if%% 
(%% 
_reset%% 
)%% 
{&& 
_start'' 
='' 
false'' "
;''" #
if(( 
((( 
RestartEvent(( $
!=((% '
null((( ,
)((, -
{)) 
RestartEvent** $
(**$ %
)**% &
;**& '
Log++ 
.++ 
Warning++ #
(++# $
$str++$ +
)+++ ,
;++, -
FILE,, 
=,, 
$str,, !
;,,! "
}-- 
}.. 
}// 
}00 	
private33 
static33 
void33 
	WriteTime33 %
(33% &
)33& '
{44 	
	WriteTime55 
(55 
false55 
)55 
;55 
}66 	
static77 
object77 
sync77 
=77 
new77  
object77! '
(77' (
)77( )
;77) *
private88 
static88 
void88 
	WriteTime88 %
(88% &
bool88& *
errorconsole88+ 7
)887 8
{99 	
lock:: 
(:: 
sync:: 
):: 
{;; 
try<< 
{== 
Console>> 
.>> 
ForegroundColor>> +
=>>, -
ConsoleColor>>. :
.>>: ;
DarkGray>>; C
;>>C D
if?? 
(?? 
errorconsole?? $
)??$ %
{@@ 
ConsoleAA 
.AA  
ErrorAA  %
.AA% &
WriteAA& +
(AA+ ,
DateTimeAA, 4
.AA4 5
NowAA5 8
.AA8 9
ToStringAA9 A
(AAA B
)AAB C
.AAC D
PadRightAAD L
(AAL M
$numAAM O
)AAO P
+AAQ R
$strAAS V
)AAV W
;AAW X
}BB 
elseCC 
{DD 
ConsoleEE 
.EE  
WriteEE  %
(EE% &
DateTimeEE& .
.EE. /
NowEE/ 2
.EE2 3
ToStringEE3 ;
(EE; <
)EE< =
.EE= >
PadRightEE> F
(EEF G
$numEEG I
)EEI J
+EEK L
$strEEM P
)EEP Q
;EEQ R
}GG 
ConsoleHH 
.HH 

ResetColorHH &
(HH& '
)HH' (
;HH( )
}II 
catchJJ 
{KK 
}LL 
}MM 
}NN 	
publicOO 
staticOO 
voidOO 
InfoOO 
(OO  
stringOO  &
messageOO' .
,OO. /
paramsOO0 6
objectOO7 =
[OO= >
]OO> ?

parametersOO@ J
)OOJ K
{PP 	
lockQQ 
(QQ 
syncQQ 
)QQ 
{RR 
	WriteTimeSS 
(SS 
)SS 
;SS 
tryTT 
{UU 
ConsoleVV 
.VV 
ForegroundColorVV +
=VV, -
ConsoleColorVV. :
.VV: ;
GrayVV; ?
;VV? @
ConsoleWW 
.WW 
	WriteLineWW %
(WW% &
stringWW& ,
.WW, -
FormatWW- 3
(WW3 4
messageWW4 ;
,WW; <

parametersWW= G
)WWG H
)WWH I
;WWI J
SaveXX 
(XX 
stringXX 
.XX  
FormatXX  &
(XX& '
messageXX' .
,XX. /

parametersXX0 :
)XX: ;
)XX; <
;XX< =
}ZZ 
catch[[ 
{\\ 
}]] 
}^^ 
}__ 	
publicbb 
staticbb 
voidbb 
Successbb "
(bb" #
stringbb# )
messagebb* 1
,bb1 2
paramsbb3 9
objectbb: @
[bb@ A
]bbA B

parametersbbC M
)bbM N
{cc 	
lockdd 
(dd 
syncdd 
)dd 
{ee 
	WriteTimeff 
(ff 
)ff 
;ff 
trygg 
{hh 
Consoleii 
.ii 
ForegroundColorii +
=ii, -
ConsoleColorii. :
.ii: ;
Greenii; @
;ii@ A
Consolejj 
.jj 
	WriteLinejj %
(jj% &
stringjj& ,
.jj, -
Formatjj- 3
(jj3 4
messagejj4 ;
,jj; <

parametersjj= G
)jjG H
)jjH I
;jjI J
Savekk 
(kk 
stringkk 
.kk  
Formatkk  &
(kk& '
messagekk' .
,kk. /

parameterskk0 :
)kk: ;
)kk; <
;kk< =
}mm 
catchnn 
{oo 
}pp 
}qq 
}rr 	
publicss 
staticss 
voidss 
SuccessMagentass )
(ss) *
stringss* 0
messagess1 8
,ss8 9
paramsss: @
objectssA G
[ssG H
]ssH I

parametersssJ T
)ssT U
{tt 	
lockuu 
(uu 
syncuu 
)uu 
{vv 
	WriteTimeww 
(ww 
)ww 
;ww 
tryxx 
{yy 
Consolezz 
.zz 
ForegroundColorzz +
=zz, -
ConsoleColorzz. :
.zz: ;
Magentazz; B
;zzB C
Console{{ 
.{{ 
	WriteLine{{ %
({{% &
string{{& ,
.{{, -
Format{{- 3
({{3 4
message{{4 ;
,{{; <

parameters{{= G
){{G H
){{H I
;{{I J
Save|| 
(|| 
string|| 
.||  
Format||  &
(||& '
message||' .
,||. /

parameters||0 :
)||: ;
)||; <
;||< =
}~~ 
catch 
{
ÄÄ 
}
ÅÅ 
}
ÇÇ 
}
ÉÉ 	
public
ÖÖ 
static
ÖÖ 
void
ÖÖ 
Error
ÖÖ  
(
ÖÖ  !
string
ÖÖ! '
message
ÖÖ( /
,
ÖÖ/ 0
params
ÖÖ1 7
object
ÖÖ8 >
[
ÖÖ> ?
]
ÖÖ? @

parameters
ÖÖA K
)
ÖÖK L
{
ÜÜ 	
{
àà 
	WriteTime
ââ 
(
ââ 
true
ââ 
)
ââ 
;
ââ  
try
ää 
{
ãã 
Console
çç 
.
çç 
ForegroundColor
çç +
=
çç, -
ConsoleColor
çç. :
.
çç: ;
Red
çç; >
;
çç> ?
Console
éé 
.
éé 
	WriteLine
éé %
(
éé% &
string
éé& ,
.
éé, -
Format
éé- 3
(
éé3 4
message
éé4 ;
,
éé; <

parameters
éé= G
)
ééG H
)
ééH I
;
ééI J
Console
èè 
.
èè 

ResetColor
èè &
(
èè& '
)
èè' (
;
èè( )
Save
ëë 
(
ëë 
$str
ëë 
+
ëë  !
string
ëë" (
.
ëë( )
Format
ëë) /
(
ëë/ 0
message
ëë0 7
,
ëë7 8

parameters
ëë9 C
)
ëëC D
)
ëëD E
;
ëëE F
}
ìì 
catch
îî 
{
ïï 
}
ññ 
}
óó 
}
òò 	
public
ôô 
static
ôô 
void
ôô 
Warning
ôô "
(
ôô" #
string
ôô# )
message
ôô* 1
,
ôô1 2
params
ôô3 9
object
ôô: @
[
ôô@ A
]
ôôA B

parameters
ôôC M
)
ôôM N
{
öö 	
lock
õõ 
(
õõ 
sync
õõ 
)
õõ 
{
úú 
	WriteTime
ùù 
(
ùù 
true
ùù 
)
ùù 
;
ùù  
try
ûû 
{
üü 
Console
†† 
.
†† 
ForegroundColor
†† +
=
††, -
ConsoleColor
††. :
.
††: ;
Yellow
††; A
;
††A B
Console
°° 
.
°° 
	WriteLine
°° %
(
°°% &
string
°°& ,
.
°°, -
Format
°°- 3
(
°°3 4
message
°°4 ;
,
°°; <

parameters
°°= G
)
°°G H
)
°°H I
;
°°I J
Console
¢¢ 
.
¢¢ 

ResetColor
¢¢ &
(
¢¢& '
)
¢¢' (
;
¢¢( )
}
££ 
catch
§§ 
{
•• 
}
¶¶ 
Save
ßß 
(
ßß 
string
ßß 
.
ßß 
Format
ßß "
(
ßß" #
message
ßß# *
,
ßß* +

parameters
ßß, 6
)
ßß6 7
)
ßß7 8
;
ßß8 9
}
®® 
}
©© 	
public
™™ 
static
™™ 
void
™™ 
Warning2
™™ #
(
™™# $
string
™™$ *
message
™™+ 2
,
™™2 3
params
™™4 :
object
™™; A
[
™™A B
]
™™B C

parameters
™™D N
)
™™N O
{
´´ 	
lock
¨¨ 
(
¨¨ 
sync
¨¨ 
)
¨¨ 
{
≠≠ 
	WriteTime
ÆÆ 
(
ÆÆ 
true
ÆÆ 
)
ÆÆ 
;
ÆÆ  
try
ØØ 
{
∞∞ 
Console
±± 
.
±± 
ForegroundColor
±± +
=
±±, -
ConsoleColor
±±. :
.
±±: ;
DarkMagenta
±±; F
;
±±F G
Console
≤≤ 
.
≤≤ 
	WriteLine
≤≤ %
(
≤≤% &
string
≤≤& ,
.
≤≤, -
Format
≤≤- 3
(
≤≤3 4
message
≤≤4 ;
,
≤≤; <

parameters
≤≤= G
)
≤≤G H
)
≤≤H I
;
≤≤I J
Console
≥≥ 
.
≥≥ 

ResetColor
≥≥ &
(
≥≥& '
)
≥≥' (
;
≥≥( )
}
¥¥ 
catch
µµ 
{
∂∂ 
}
∑∑ 
Save
∏∏ 
(
∏∏ 
string
∏∏ 
.
∏∏ 
Format
∏∏ "
(
∏∏" #
message
∏∏# *
,
∏∏* +

parameters
∏∏, 6
)
∏∏6 7
)
∏∏7 8
;
∏∏8 9
}
ππ 
}
∫∫ 	
public
ªª 
static
ªª 
void
ªª 
Warning3
ªª #
(
ªª# $
string
ªª$ *
message
ªª+ 2
,
ªª2 3
params
ªª4 :
object
ªª; A
[
ªªA B
]
ªªB C

parameters
ªªD N
)
ªªN O
{
ºº 	
lock
ΩΩ 
(
ΩΩ 
sync
ΩΩ 
)
ΩΩ 
{
ææ 
	WriteTime
øø 
(
øø 
true
øø 
)
øø 
;
øø  
try
¿¿ 
{
¡¡ 
Console
¬¬ 
.
¬¬ 
ForegroundColor
¬¬ +
=
¬¬, -
ConsoleColor
¬¬. :
.
¬¬: ;
Cyan
¬¬; ?
;
¬¬? @
Console
√√ 
.
√√ 
	WriteLine
√√ %
(
√√% &
string
√√& ,
.
√√, -
Format
√√- 3
(
√√3 4
message
√√4 ;
,
√√; <

parameters
√√= G
)
√√G H
)
√√H I
;
√√I J
Console
ƒƒ 
.
ƒƒ 

ResetColor
ƒƒ &
(
ƒƒ& '
)
ƒƒ' (
;
ƒƒ( )
}
≈≈ 
catch
∆∆ 
{
«« 
}
»» 
Save
…… 
(
…… 
string
…… 
.
…… 
Format
…… "
(
……" #
message
……# *
,
……* +

parameters
……, 6
)
……6 7
)
……7 8
;
……8 9
}
   
}
ÀÀ 	
public
ÃÃ 
static
ÃÃ 
void
ÃÃ 
Warning4
ÃÃ #
(
ÃÃ# $
string
ÃÃ$ *
message
ÃÃ+ 2
,
ÃÃ2 3
params
ÃÃ4 :
object
ÃÃ; A
[
ÃÃA B
]
ÃÃB C

parameters
ÃÃD N
)
ÃÃN O
{
ÕÕ 	
lock
ŒŒ 
(
ŒŒ 
sync
ŒŒ 
)
ŒŒ 
{
œœ 
	WriteTime
–– 
(
–– 
true
–– 
)
–– 
;
––  
try
—— 
{
““ 
Console
”” 
.
”” 
ForegroundColor
”” +
=
””, -
ConsoleColor
””. :
.
””: ;
DarkCyan
””; C
;
””C D
Console
‘‘ 
.
‘‘ 
	WriteLine
‘‘ %
(
‘‘% &
string
‘‘& ,
.
‘‘, -
Format
‘‘- 3
(
‘‘3 4
message
‘‘4 ;
,
‘‘; <

parameters
‘‘= G
)
‘‘G H
)
‘‘H I
;
‘‘I J
Console
’’ 
.
’’ 

ResetColor
’’ &
(
’’& '
)
’’' (
;
’’( )
}
÷÷ 
catch
◊◊ 
{
ÿÿ 
}
ŸŸ 
Save
⁄⁄ 
(
⁄⁄ 
string
⁄⁄ 
.
⁄⁄ 
Format
⁄⁄ "
(
⁄⁄" #
message
⁄⁄# *
,
⁄⁄* +

parameters
⁄⁄, 6
)
⁄⁄6 7
)
⁄⁄7 8
;
⁄⁄8 9
}
€€ 
}
‹‹ 	
public
›› 
static
›› 
void
›› 
	Exception
›› $
(
››$ %
	Exception
››% .
ex
››/ 1
,
››1 2
string
››3 9
message
››: A
,
››A B
params
››C I
object
››J P
[
››P Q
]
››Q R

parameters
››S ]
)
››] ^
{
ﬁﬁ 	
lock
ﬂﬂ 
(
ﬂﬂ 
sync
ﬂﬂ 
)
ﬂﬂ 
{
‡‡ 
if
‚‚ 
(
‚‚ 
ex
‚‚ 
is
‚‚ 
System
‚‚  
.
‚‚  !
	Threading
‚‚! *
.
‚‚* +"
ThreadAbortException
‚‚+ ?
)
‚‚? @
return
„„ 
;
„„ 
Error
‰‰ 
(
‰‰ 
message
‰‰ 
)
‰‰ 
;
‰‰ 
try
ÂÂ 
{
ÊÊ 
Console
ÁÁ 
.
ÁÁ 
ForegroundColor
ÁÁ +
=
ÁÁ, -
ConsoleColor
ÁÁ. :
.
ÁÁ: ;
Red
ÁÁ; >
;
ÁÁ> ?
Console
ËË 
.
ËË 
Error
ËË !
.
ËË! "
	WriteLine
ËË" +
(
ËË+ ,
$str
ËË, 6
+
ËË7 8
ex
ËË9 ;
.
ËË; <
Message
ËË< C
)
ËËC D
;
ËËD E
Console
ÈÈ 
.
ÈÈ 
ForegroundColor
ÈÈ +
=
ÈÈ, -
ConsoleColor
ÈÈ. :
.
ÈÈ: ;
DarkGray
ÈÈ; C
;
ÈÈC D
Save
ÎÎ 
(
ÎÎ 
string
ÎÎ 
.
ÎÎ  
Format
ÎÎ  &
(
ÎÎ& '
message
ÎÎ' .
,
ÎÎ. /

parameters
ÎÎ0 :
)
ÎÎ: ;
)
ÎÎ; <
;
ÎÎ< =
}
ÌÌ 
catch
ÓÓ 
{
ÔÔ 
}
 
}
ÒÒ 
}
ÚÚ 	
static
ÙÙ 
string
ÙÙ 
FILE
ÙÙ 
=
ÙÙ 
$str
ÙÙ 
;
ÙÙ  
private
ˆˆ 
static
ˆˆ 
void
ˆˆ 
Save
ˆˆ  
(
ˆˆ  !
string
ˆˆ! '
str
ˆˆ( +
)
ˆˆ+ ,
{
˜˜ 	
try
˘˘ 
{
˙˙ 
	Directory
˚˚ 
.
˚˚ 
CreateDirectory
˚˚ )
(
˚˚) *
	AppDomain
˚˚* 3
.
˚˚3 4
CurrentDomain
˚˚4 A
.
˚˚A B
BaseDirectory
˚˚B O
+
˚˚P Q
$str
˚˚R W
)
˚˚W X
;
˚˚X Y
if
¸¸ 
(
¸¸ 
string
¸¸ 
.
¸¸ 
IsNullOrEmpty
¸¸ (
(
¸¸( )
str
¸¸) ,
)
¸¸, -
)
¸¸- .
return
¸¸/ 5
;
¸¸5 6
if
˝˝ 
(
˝˝ 
string
˝˝ 
.
˝˝ 
IsNullOrEmpty
˝˝ (
(
˝˝( )
FILE
˝˝) -
)
˝˝- .
)
˝˝. /
FILE
˝˝0 4
=
˝˝5 6
	AppDomain
˝˝7 @
.
˝˝@ A
CurrentDomain
˝˝A N
.
˝˝N O
BaseDirectory
˝˝O \
+
˝˝] ^
$str
˝˝_ e
+
˝˝f g
Path
˝˝h l
.
˝˝l m%
DirectorySeparatorChar˝˝m É
+˝˝Ñ Ö
string˝˝Ü å
.˝˝å ç
Format˝˝ç ì
(˝˝ì î
$str˝˝î ¢
,˝˝¢ £
DateTime˝˝§ ¨
.˝˝¨ ≠
Now˝˝≠ ∞
.˝˝∞ ±
ToString˝˝± π
(˝˝π ∫
$str˝˝∫ Õ
)˝˝Õ Œ
)˝˝Œ œ
;˝˝œ –
if
ˇˇ 
(
ˇˇ 
!
ˇˇ 
File
ˇˇ 
.
ˇˇ 
Exists
ˇˇ  
(
ˇˇ  !
FILE
ˇˇ! %
)
ˇˇ% &
)
ˇˇ& '
System
ˇˇ( .
.
ˇˇ. /
IO
ˇˇ/ 1
.
ˇˇ1 2
File
ˇˇ2 6
.
ˇˇ6 7
WriteAllText
ˇˇ7 C
(
ˇˇC D
FILE
ˇˇD H
,
ˇˇH I
DateTime
ˇˇJ R
.
ˇˇR S
Now
ˇˇS V
.
ˇˇV W
ToString
ˇˇW _
(
ˇˇ_ `
)
ˇˇ` a
)
ˇˇa b
;
ˇˇb c
using
ÅÅ 
(
ÅÅ 
StreamWriter
ÅÅ #
sw
ÅÅ$ &
=
ÅÅ' (
File
ÅÅ) -
.
ÅÅ- .

AppendText
ÅÅ. 8
(
ÅÅ8 9
FILE
ÅÅ9 =
)
ÅÅ= >
)
ÅÅ> ?
{
ÇÇ 
sw
ÉÉ 
.
ÉÉ 
	WriteLine
ÉÉ  
(
ÉÉ  !
DateTime
ÉÉ! )
.
ÉÉ) *
Now
ÉÉ* -
+
ÉÉ. /
$str
ÉÉ0 3
+
ÉÉ4 5
str
ÉÉ6 9
)
ÉÉ9 :
;
ÉÉ: ;
}
ÑÑ 
}
ÜÜ 
catch
áá 
(
áá 
	Exception
áá 
)
áá 
{
àà 
}
ää 
}
åå 	
}
éé 
}èè ¸®
xD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\LogoEntegration\DataMapper.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
LogoEntegration& 5
{ 
class 	

DataMapper
 
: 
IDataMapper "
{ 
public 
ResultStatus 
CompanySave '
(' (
AdClientFind( 4
[4 5
]5 6
param7 <
,< =
string> D
firmaNoE L
)L M
{ 	
var 
db 
= 
new 
WorkOfTimeDatabase +
(+ ,
), -
;- .
var 
result 
= 
new 
ResultStatus )
{* +
result, 2
=3 4
true5 9
}: ;
;; <
if 
( 
param 
!= 
null 
) 
{ 
var 
findCompany 
=  !
db" $
.$ %
GetCMP_Company% 3
(3 4
)4 5
;5 6
foreach 
( 
var 
item !
in" $
param% *
)* +
{ 
if 
( 
item 
. 
CariKodu %
!=& (
null) -
)- .
{ 
if 
( 
findCompany '
!=( *
null+ /
&&0 2
findCompany3 >
.> ?
Where? D
(D E
aE F
=>G I
aJ K
.K L
codeL P
==Q S
firmaNoT [
+\ ]
$str^ a
+b c
itemd h
.h i
CariKodui q
)q r
.r s
Counts x
(x y
)y z
>{ |
$num} ~
)~ 
{ 
if 
(  
findCompany  +
.+ ,
Where, 1
(1 2
a2 3
=>4 6
a7 8
.8 9
name9 =
==> @
itemA E
.E F
	CariUnvanF O
)O P
.P Q
CountQ V
(V W
)W X
==Y [
$num\ ]
)] ^
{ 
result  &
=' (
CompanyUpdate) 6
(6 7
item7 ;
,; <
firmaNo= D
)D E
;E F
} 
}   
else!! 
{"" 
result## "
=### $
CompanyInsert##% 2
(##2 3
item##3 7
,##7 8
firmaNo##9 @
)##@ A
;##A B
}$$ 
}%% 
else&& 
{'' 
result(( 
.(( 
result(( %
=((& '
false((( -
;((- .
result)) 
.)) 
message)) &
=))' (
$str))) E
;))E F
return** 
result** %
;**% &
}++ 
},, 
}-- 
else.. 
{// 
result00 
.00 
result00 
=00 
false00  %
;00% &
result11 
.11 
message11 
=11  
$str11! @
;11@ A
return22 
result22 
;22 
}33 
return44 
result44 
;44 
}55 	
public66 
ResultStatus66 
CompanyInsert66 )
(66) *
AdClientFind66* 6
param667 <
,66< =
string66> D
firmaNo66E L
)66L M
{77 	
var88 
db88 
=88 
new88 
WorkOfTimeDatabase88 +
(88+ ,
)88, -
;88- .
var99 
result99 
=99 
new99 
ResultStatus99 )
{99* +
result99, 2
=993 4
true995 9
}99: ;
;99; <
if:: 
(:: 
param:: 
.:: 
	CariUnvan:: 
!=::  "
$str::# %
)::% &
{;; 
var<< 
insertCompany<< !
=<<" #
new<<$ '
CMP_Company<<( 3
{== 
id>> 
=>> 
Guid>> 
.>> 
NewGuid>> %
(>>% &
)>>& '
,>>' (
	createdby?? 
=?? 
Guid??  $
.??$ %
Empty??% *
,??* +
created@@ 
=@@ 
DateTime@@ &
.@@& '
Now@@' *
,@@* +
openAddressAA 
=AA  !
paramAA" '
.AA' (
AdresAA( -
,AA- .
codeBB 
=BB 
firmaNoBB "
+BB# $
$strBB% (
+BB) *
paramBB+ 0
.BB0 1
CariKoduBB1 9
,BB9 :
nameCC 
=CC 
paramCC  
.CC  !
	CariUnvanCC! *
,CC* +
emailDD 
=DD 
paramDD !
.DD! "
Eposta1DD" )
,DD) *
	taxOfficeEE 
=EE 
paramEE  %
.EE% &
VergiDairesiEE& 2
,EE2 3
	taxNumberFF 
=FF 
paramFF  %
.FF% &
VergiNoFF& -
,FF- .
commercialTitleGG #
=GG$ %
paramGG& +
.GG+ ,
	CariUnvanGG, 5
,GG5 6
}HH 
;HH 
resultII 
&=II 
dbII 
.II 
InsertCMP_CompanyII .
(II. /
insertCompanyII/ <
)II< =
;II= >
}JJ 
returnKK 
resultKK 
;KK 
}LL 	
publicMM 
ResultStatusMM 
CompanyUpdateMM )
(MM) *
AdClientFindMM* 6
paramMM7 <
,MM< =
stringMM> D
firmaNoMME L
)MML M
{NN 	
varOO 
dbOO 
=OO 
newOO 
WorkOfTimeDatabaseOO +
(OO+ ,
)OO, -
;OO- .
varPP 
resultPP 
=PP 
newPP 
ResultStatusPP )
{PP* +
resultPP, 2
=PP3 4
truePP5 9
}PP: ;
;PP; <
varQQ 
	checkCodeQQ 
=QQ 
dbQQ 
.QQ  
GetCMP_CompanyByCodeQQ 3
(QQ3 4
firmaNoQQ4 ;
+QQ< =
$strQQ> A
+QQB C
paramQQD I
.QQI J
CariKoduQQJ R
)QQR S
;QQS T
varRR 
	validatorRR 
=RR 
CompanyValidatorRR ,
(RR, -
paramRR- 2
,RR2 3
	checkCodeRR4 =
)RR= >
;RR> ?
ifSS 
(SS 
	validatorSS 
.SS 
resultSS  
)SS  !
{TT 
	checkCodeUU 
.UU 
nameUU 
=UU  
paramUU! &
.UU& '
	CariUnvanUU' 0
;UU0 1
	checkCodeVV 
.VV 
openAddressVV %
=VV& '
paramVV( -
.VV- .
AdresVV. 3
;VV3 4
	checkCodeWW 
.WW 
codeWW 
=WW  
firmaNoWW! (
+WW) *
$strWW+ .
+WW/ 0
paramWW1 6
.WW6 7
CariKoduWW7 ?
;WW? @
	checkCodeXX 
.XX 
emailXX 
=XX  !
paramXX" '
.XX' (
Eposta1XX( /
;XX/ 0
	checkCodeYY 
.YY 
	taxOfficeYY #
=YY$ %
paramYY& +
.YY+ ,
VergiDairesiYY, 8
;YY8 9
	checkCodeZZ 
.ZZ 
	taxNumberZZ #
=ZZ$ %
paramZZ& +
.ZZ+ ,
VergiNoZZ, 3
;ZZ3 4
	checkCode[[ 
.[[ 
commercialTitle[[ )
=[[* +
param[[, 1
.[[1 2
	CariUnvan[[2 ;
;[[; <
	checkCode\\ 
.\\ 
changed\\ !
=\\" #
DateTime\\$ ,
.\\, -
Now\\- 0
;\\0 1
	checkCode]] 
.]] 
	changedby]] #
=]]$ %
Guid]]& *
.]]* +
Empty]]+ 0
;]]0 1
result^^ 
&=^^ 
db^^ 
.^^ 
UpdateCMP_Company^^ .
(^^. /
	checkCode^^/ 8
)^^8 9
;^^9 :
}__ 
return`` 
result`` 
;`` 
}aa 	
publicbb 
ResultStatusbb 
ProductSavebb '
(bb' (
AdItemsFindListbb( 7
[bb7 8
]bb8 9
parambb: ?
)bb? @
{cc 	
vardd 
dbdd 
=dd 
newdd 
WorkOfTimeDatabasedd +
(dd+ ,
)dd, -
;dd- .
varee 
resultee 
=ee 
newee 
ResultStatusee )
{ee* +
resultee, 2
=ee3 4
trueee5 9
}ee: ;
;ee; <
ifff 
(ff 
paramff 
!=ff 
nullff 
)ff 
{gg 
varhh 
findProducthh 
=hh  !
dbhh" $
.hh$ %
GetPRD_Producthh% 3
(hh3 4
)hh4 5
;hh5 6
foreachii 
(ii 
varii 
itemii !
inii" $
paramii% *
)ii* +
{jj 
ifkk 
(kk 
itemkk 
.kk 
UrunKodukk %
!=kk& (
nullkk) -
)kk- .
{ll 
ifqq 
(qq 
findProductqq '
!=qq( *
nullqq+ /
&&qq0 2
findProductqq3 >
.qq> ?
Whereqq? D
(qqD E
aqqE F
=>qqG I
aqqJ K
.qqK L
codeqqL P
==qqQ S
itemqqT X
.qqX Y
UrunKoduqqY a
)qqa b
.qqb c
Countqqc h
(qqh i
)qqi j
==qqk m
$numqqn o
)qqo p
{rr 
resultss "
=ss# $
ProductInsertss% 2
(ss2 3
itemss3 7
)ss7 8
;ss8 9
}tt 
}uu 
elsevv 
{ww 
resultxx 
.xx 
resultxx %
=xx& '
falsexx( -
;xx- .
resultyy 
.yy 
messageyy &
=yy' (
$stryy) E
;yyE F
returnzz 
resultzz %
;zz% &
}{{ 
}|| 
}}} 
else~~ 
{ 
result
ÄÄ 
.
ÄÄ 
result
ÄÄ 
=
ÄÄ 
false
ÄÄ  %
;
ÄÄ% &
result
ÅÅ 
.
ÅÅ 
message
ÅÅ 
=
ÅÅ  
$str
ÅÅ! @
;
ÅÅ@ A
return
ÇÇ 
result
ÇÇ 
;
ÇÇ 
}
ÉÉ 
return
ÑÑ 
result
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
ÜÜ 
ResultStatus
ÜÜ 
ProductInsert
ÜÜ )
(
ÜÜ) *
AdItemsFindList
ÜÜ* 9
param
ÜÜ: ?
)
ÜÜ? @
{
áá 	
var
àà 
db
àà 
=
àà 
new
àà  
WorkOfTimeDatabase
àà +
(
àà+ ,
)
àà, -
;
àà- .
var
ââ 
result
ââ 
=
ââ 
new
ââ 
ResultStatus
ââ )
{
ââ* +
result
ââ, 2
=
ââ3 4
true
ââ5 9
}
ââ: ;
;
ââ; <
short
ää 
?
ää 
	stockType
ää 
=
ää 
$num
ää  
;
ää  !
short
ãã 
?
ãã 
type
ãã 
=
ãã 
$num
ãã 
;
ãã 
if
åå 
(
åå 
param
åå 
.
åå 
StokTakipTipi
åå #
==
åå$ &
$str
åå' 9
)
åå9 :
{
çç 
	stockType
éé 
=
éé 
(
éé 
int
éé  
)
éé  !&
EnumPRD_ProductStockType
éé! 9
.
éé9 :
Stoksuz
éé: A
;
ééA B
}
èè 
else
êê 
if
êê 
(
êê 
param
êê 
.
êê 
StokTakipTipi
êê (
==
êê) +
$str
êê, L
)
êêL M
{
ëë 
	stockType
íí 
=
íí 
(
íí 
int
íí  
)
íí  !&
EnumPRD_ProductStockType
íí! 9
.
íí9 :
SeriNoluTakip
íí: G
;
ííG H
}
ìì 
else
îî 
{
ïï 
	stockType
ññ 
=
ññ 
(
ññ 
int
ññ  
)
ññ  !&
EnumPRD_ProductStockType
ññ! 9
.
ññ9 :
NormalTakip
ññ: E
;
ññE F
}
óó 
if
ôô 
(
ôô 
param
ôô 
.
ôô #
MalzemeTuruAciklamasi
ôô +
==
ôô, .
$str
ôô/ 9
)
ôô9 :
{
öö 
type
õõ 
=
õõ 
(
õõ 
int
õõ 
)
õõ !
EnumPRD_ProductType
õõ /
.
õõ/ 0
Hammadde
õõ0 8
;
õõ8 9
}
úú 
else
ùù 
if
ùù 
(
ùù 
param
ùù 
.
ùù #
MalzemeTuruAciklamasi
ùù 0
==
ùù1 3
$str
ùù4 B
)
ùùB C
{
ûû 
type
üü 
=
üü 
(
üü 
int
üü 
)
üü !
EnumPRD_ProductType
üü /
.
üü/ 0
	TicariMal
üü0 9
;
üü9 :
}
†† 
else
°° 
if
°° 
(
°° 
param
°° 
.
°° #
MalzemeTuruAciklamasi
°° 0
==
°°1 3
$str
°°4 @
)
°°@ A
{
¢¢ 
type
££ 
=
££ 
(
££ 
int
££ 
)
££ !
EnumPRD_ProductType
££ /
.
££/ 0
	YariMamul
££0 9
;
££9 :
}
§§ 
else
•• 
if
•• 
(
•• 
param
•• 
.
•• #
MalzemeTuruAciklamasi
•• 0
==
••1 3
$str
••4 ;
)
••; <
{
¶¶ 
type
ßß 
=
ßß 
(
ßß 
int
ßß 
)
ßß !
EnumPRD_ProductType
ßß /
.
ßß/ 0
	TicariMal
ßß0 9
;
ßß9 :
}
®® 
else
©© 
{
™™ 
type
´´ 
=
´´ 
(
´´ 
int
´´ 
)
´´ !
EnumPRD_ProductType
´´ /
.
´´/ 0
Diger
´´0 5
;
´´5 6
}
¨¨ 
var
ØØ 

insertUnit
ØØ 
=
ØØ 
new
ØØ  
UT_Unit
ØØ! (
{
∞∞ 
id
±± 
=
±± 
Guid
±± 
.
±± 
NewGuid
±± !
(
±±! "
)
±±" #
,
±±# $
	createdby
≤≤ 
=
≤≤ 
Guid
≤≤  
.
≤≤  !
Empty
≤≤! &
,
≤≤& '
created
≥≥ 
=
≥≥ 
DateTime
≥≥ "
.
≥≥" #
Now
≥≥# &
,
≥≥& '
name
¥¥ 
=
¥¥ 
param
¥¥ 
.
¥¥ 
Birim
¥¥ "
,
¥¥" #
}
µµ 
;
µµ 
var
∂∂ 
insertCategory
∂∂ 
=
∂∂  
new
∂∂! $
PRD_Category
∂∂% 1
{
∑∑ 
id
∏∏ 
=
∏∏ 
Guid
∏∏ 
.
∏∏ 
NewGuid
∏∏ !
(
∏∏! "
)
∏∏" #
,
∏∏# $
	createdby
ππ 
=
ππ 
Guid
ππ  
.
ππ  !
Empty
ππ! &
,
ππ& '
created
∫∫ 
=
∫∫ 
DateTime
∫∫ "
.
∫∫" #
Now
∫∫# &
,
∫∫& '
name
ªª 
=
ªª 
param
ªª 
.
ªª 
Kategori
ªª %
,
ªª% &
code
ºº 
=
ºº 
param
ºº 
.
ºº 
MalzemeTuruKodu
ºº ,
,
ºº, -
}
ΩΩ 
;
ΩΩ 
var
ææ 
insertBrand
ææ 
=
ææ 
new
ææ !
	PRD_Brand
ææ" +
{
øø 
id
¿¿ 
=
¿¿ 
Guid
¿¿ 
.
¿¿ 
NewGuid
¿¿ !
(
¿¿! "
)
¿¿" #
,
¿¿# $
	createdby
¡¡ 
=
¡¡ 
Guid
¡¡  
.
¡¡  !
Empty
¡¡! &
,
¡¡& '
created
¬¬ 
=
¬¬ 
DateTime
¬¬ "
.
¬¬" #
Now
¬¬# &
,
¬¬& '
name
√√ 
=
√√ 
param
√√ 
.
√√ 
MarkaAciklamasi
√√ ,
,
√√, -
code
ƒƒ 
=
ƒƒ 
param
ƒƒ 
.
ƒƒ 
	MarkaKodu
ƒƒ &
,
ƒƒ& '
}
≈≈ 
;
≈≈ 
var
∆∆ 
	checkUnit
∆∆ 
=
∆∆ 
db
∆∆ 
.
∆∆ 
GetUT_UnitByName
∆∆ /
(
∆∆/ 0
param
∆∆0 5
.
∆∆5 6
Birim
∆∆6 ;
)
∆∆; <
;
∆∆< =
var
»» 
insertProduct
»» 
=
»» 
new
»»  #
PRD_Product
»»$ /
{
…… 
id
   
=
   
Guid
   
.
   
NewGuid
   !
(
  ! "
)
  " #
,
  # $
name
ÀÀ 
=
ÀÀ 
param
ÀÀ 
.
ÀÀ 
UrunAciklamasi1
ÀÀ ,
,
ÀÀ, -
description
ÃÃ 
=
ÃÃ 
param
ÃÃ #
.
ÃÃ# $
UrunAciklamasi2
ÃÃ$ 3
,
ÃÃ3 4
code
ÕÕ 
=
ÕÕ 
param
ÕÕ 
.
ÕÕ 
UrunKodu
ÕÕ %
,
ÕÕ% &

categoryId
ŒŒ 
=
ŒŒ 
insertCategory
ŒŒ +
!=
ŒŒ, .
null
ŒŒ/ 3
&&
ŒŒ4 6
insertCategory
ŒŒ7 E
.
ŒŒE F
name
ŒŒF J
!=
ŒŒK M
$str
ŒŒN P
?
ŒŒQ R
insertCategory
ŒŒS a
.
ŒŒa b
id
ŒŒb d
:
ŒŒe f
(
ŒŒg h
Guid
ŒŒh l
?
ŒŒl m
)
ŒŒm n
null
ŒŒn r
,
ŒŒr s
brandId
œœ 
=
œœ 
insertBrand
œœ %
!=
œœ& (
null
œœ) -
&&
œœ. 0
insertBrand
œœ1 <
.
œœ< =
name
œœ= A
!=
œœB D
$str
œœE G
?
œœH I
insertBrand
œœJ U
.
œœU V
id
œœV X
:
œœY Z
(
œœ[ \
Guid
œœ\ `
?
œœ` a
)
œœa b
null
œœb f
,
œœf g
unitId
–– 
=
–– 
	checkUnit
–– "
!=
––# %
null
––& *
?
––+ ,
	checkUnit
––- 6
.
––6 7
id
––7 9
:
––: ;
(
––< =
Guid
––= A
?
––A B
)
––B C
null
––C G
,
––G H
created
—— 
=
—— 
DateTime
—— "
.
——" #
Now
——# &
,
——& '
	createdby
““ 
=
““ 
Guid
““  
.
““  !
Empty
““! &
,
““& '
	stockType
”” 
=
”” 
	stockType
”” %
,
””% &
type
‘‘ 
=
‘‘ 
type
‘‘ 
,
‘‘ 
}
’’ 
;
’’ 
var
÷÷  
insertProductPrice
÷÷ "
=
÷÷# $
new
÷÷% (
PRD_ProductPrice
÷÷) 9
{
◊◊ 
created
ÿÿ 
=
ÿÿ 
DateTime
ÿÿ "
.
ÿÿ" #
Now
ÿÿ# &
,
ÿÿ& '
	createdby
ŸŸ 
=
ŸŸ 
Guid
ŸŸ  
.
ŸŸ  !
Empty
ŸŸ! &
,
ŸŸ& '
id
⁄⁄ 
=
⁄⁄ 
Guid
⁄⁄ 
.
⁄⁄ 
NewGuid
⁄⁄ !
(
⁄⁄! "
)
⁄⁄" #
,
⁄⁄# $
price
€€ 
=
€€ 
param
€€ 
.
€€ 

BirimFiyat
€€ (
,
€€( )
	productId
‹‹ 
=
‹‹ 
insertProduct
‹‹ )
!=
‹‹* ,
null
‹‹- 1
?
‹‹2 3
insertProduct
‹‹4 A
.
‹‹A B
id
‹‹B D
:
‹‹E F
(
‹‹G H
Guid
‹‹H L
?
‹‹L M
)
‹‹M N
null
‹‹N R
,
‹‹R S
}
›› 
;
›› 
if
ﬁﬁ 
(
ﬁﬁ 
	checkUnit
ﬁﬁ 
==
ﬁﬁ 
null
ﬁﬁ !
)
ﬁﬁ! "
{
ﬂﬂ 
result
‡‡ 
&=
‡‡ 
db
‡‡ 
.
‡‡ 
InsertUT_Unit
‡‡ *
(
‡‡* +

insertUnit
‡‡+ 5
)
‡‡5 6
;
‡‡6 7
}
·· 
if
‚‚ 
(
‚‚ 
insertCategory
‚‚ 
.
‚‚ 
name
‚‚ #
!=
‚‚$ &
$str
‚‚' )
)
‚‚) *
{
„„ 
result
‰‰ 
&=
‰‰ 
db
‰‰ 
.
‰‰  
InsertPRD_Category
‰‰ /
(
‰‰/ 0
insertCategory
‰‰0 >
)
‰‰> ?
;
‰‰? @
}
ÂÂ 
if
ÊÊ 
(
ÊÊ 
insertBrand
ÊÊ 
.
ÊÊ 
name
ÊÊ  
!=
ÊÊ! #
$str
ÊÊ$ &
)
ÊÊ& '
{
ÁÁ 
result
ËË 
&=
ËË 
db
ËË 
.
ËË 
InsertPRD_Brand
ËË ,
(
ËË, -
insertBrand
ËË- 8
)
ËË8 9
;
ËË9 :
}
ÈÈ 
result
ÍÍ 
&=
ÍÍ 
db
ÍÍ 
.
ÍÍ 
InsertPRD_Product
ÍÍ *
(
ÍÍ* +
insertProduct
ÍÍ+ 8
)
ÍÍ8 9
;
ÍÍ9 :
result
ÎÎ 
&=
ÎÎ 
db
ÎÎ 
.
ÎÎ $
InsertPRD_ProductPrice
ÎÎ /
(
ÎÎ/ 0 
insertProductPrice
ÎÎ0 B
)
ÎÎB C
;
ÎÎC D
return
ÏÏ 
result
ÏÏ 
;
ÏÏ 
}
ÌÌ 	
public
òò 
ResultStatus
òò 
StorageSave
òò '
(
òò' (
AdShipFindList
òò( 6
[
òò6 7
]
òò7 8
param
òò9 >
,
òò> ?
string
òò@ F
firmaNo
òòG N
)
òòN O
{
ôô 	
var
öö 
db
öö 
=
öö 
new
öö  
WorkOfTimeDatabase
öö +
(
öö+ ,
)
öö, -
;
öö- .
var
õõ 
result
õõ 
=
õõ 
new
õõ 
ResultStatus
õõ )
{
õõ* +
result
õõ, 2
=
õõ3 4
true
õõ5 9
}
õõ: ;
;
õõ; <
if
úú 
(
úú 
param
úú 
!=
úú 
null
úú 
)
úú 
{
ùù 
var
ûû 
findStorage
ûû 
=
ûû  !
db
ûû" $
.
ûû$ %
GetCMP_Storage
ûû% 3
(
ûû3 4
)
ûû4 5
;
ûû5 6
foreach
üü 
(
üü 
var
üü 
item
üü !
in
üü" $
param
üü% *
)
üü* +
{
†† 
if
°° 
(
°° 
item
°° 
.
°° 
SevkKodu
°° %
!=
°°& (
null
°°) -
)
°°- .
{
¢¢ 
if
§§ 
(
§§ 
findStorage
§§ '
!=
§§( *
null
§§+ /
&&
§§0 2
findStorage
§§3 >
.
§§> ?
Where
§§? D
(
§§D E
a
§§E F
=>
§§G I
a
§§J K
.
§§K L
code
§§L P
==
§§Q S
firmaNo
§§T [
+
§§\ ]
$str
§§^ a
+
§§b c
item
§§d h
.
§§h i
CariKodu
§§i q
+
§§r s
item
§§t x
.
§§x y
SevkKodu§§y Å
)§§Å Ç
.§§Ç É
Count§§É à
(§§à â
)§§â ä
>§§ã å
$num§§ç é
)§§é è
{
•• 
result
¶¶ "
=
¶¶# $
StorageUpdate
¶¶% 2
(
¶¶2 3
item
¶¶3 7
,
¶¶7 8
firmaNo
¶¶9 @
)
¶¶@ A
;
¶¶A B
}
ßß 
else
®® 
{
©© 
result
™™ "
=
™™# $
StorageInsert
™™% 2
(
™™2 3
item
™™3 7
,
™™7 8
firmaNo
™™9 @
)
™™@ A
;
™™A B
}
´´ 
}
¨¨ 
else
≠≠ 
{
ÆÆ 
result
ØØ 
.
ØØ 
result
ØØ %
=
ØØ& '
false
ØØ( -
;
ØØ- .
result
∞∞ 
.
∞∞ 
message
∞∞ &
=
∞∞' (
$str
∞∞) F
;
∞∞F G
return
±± 
result
±± %
;
±±% &
}
≤≤ 
}
≥≥ 
}
¥¥ 
else
µµ 
{
∂∂ 
result
∑∑ 
.
∑∑ 
result
∑∑ 
=
∑∑ 
false
∑∑  %
;
∑∑% &
result
∏∏ 
.
∏∏ 
message
∏∏ 
=
∏∏  
$str
∏∏! @
;
∏∏@ A
return
ππ 
result
ππ 
;
ππ 
}
∫∫ 
return
ªª 
result
ªª 
;
ªª 
}
ºº 	
public
ΩΩ 
ResultStatus
ΩΩ 
StorageInsert
ΩΩ )
(
ΩΩ) *
AdShipFindList
ΩΩ* 8
param
ΩΩ9 >
,
ΩΩ> ?
string
ΩΩ@ F
firmaNo
ΩΩG N
)
ΩΩN O
{
ææ 	
var
øø 
db
øø 
=
øø 
new
øø  
WorkOfTimeDatabase
øø +
(
øø+ ,
)
øø, -
;
øø- .
var
¿¿ 
result
¿¿ 
=
¿¿ 
new
¿¿ 
ResultStatus
¿¿ )
{
¿¿* +
result
¿¿, 2
=
¿¿3 4
true
¿¿5 9
}
¿¿: ;
;
¿¿; <
var
¡¡ 
findSH_User
¡¡ 
=
¡¡ 
db
¡¡  
.
¡¡  !
GetVWSH_User
¡¡! -
(
¡¡- .
)
¡¡. /
.
¡¡/ 0
Where
¡¡0 5
(
¡¡5 6
a
¡¡6 7
=>
¡¡8 :
a
¡¡; <
.
¡¡< =
FullName
¡¡= E
==
¡¡F H
param
¡¡I N
.
¡¡N O
SevkIlgiliKisi
¡¡O ]
.
¡¡] ^
ToUpper
¡¡^ e
(
¡¡e f
)
¡¡f g
)
¡¡g h
.
¡¡h i
FirstOrDefault
¡¡i w
(
¡¡w x
)
¡¡x y
;
¡¡y z
var
¬¬ 
findCari
¬¬ 
=
¬¬ 
db
¬¬ 
.
¬¬ *
GetVWCMP_CompanyByNameOrCode
¬¬ :
(
¬¬: ;
param
¬¬; @
.
¬¬@ A
	CariUnvan
¬¬A J
,
¬¬J K
firmaNo
¬¬L S
+
¬¬T U
$str
¬¬V Y
+
¬¬Z [
param
¬¬\ a
.
¬¬a b
CariKodu
¬¬b j
,
¬¬j k
null
¬¬k o
)
¬¬o p
;
¬¬p q
var
√√ 
insertStorage
√√ 
=
√√ 
new
√√  #
CMP_Storage
√√$ /
{
ƒƒ 
id
≈≈ 
=
≈≈ 
Guid
≈≈ 
.
≈≈ 
NewGuid
≈≈ !
(
≈≈! "
)
≈≈" #
,
≈≈# $
	createdby
∆∆ 
=
∆∆ 
Guid
∆∆  
.
∆∆  !
Empty
∆∆! &
,
∆∆& '
created
«« 
=
«« 
DateTime
«« "
.
««" #
Now
««# &
,
««& '
address
»» 
=
»» 
param
»» 
.
»»  

SevkAdresi
»»  *
,
»»* +
code
…… 
=
…… 
firmaNo
…… 
+
……  
$str
……! $
+
……% &
param
……' ,
.
……, -
CariKodu
……- 5
+
……6 7
param
……8 =
.
……= >
SevkKodu
……> F
,
……F G
name
   
=
   
param
   
.
   
SevkAciklamasi
   +
,
  + ,
email
ÀÀ 
=
ÀÀ 
param
ÀÀ 
.
ÀÀ 

SevkEposta
ÀÀ (
,
ÀÀ( )
supervisorId
ÃÃ 
=
ÃÃ 
findSH_User
ÃÃ *
?
ÃÃ* +
.
ÃÃ+ ,
id
ÃÃ, .
,
ÃÃ. /
phone
ÕÕ 
=
ÕÕ 
param
ÕÕ 
.
ÕÕ 
SevkTelefon
ÕÕ )
,
ÕÕ) *
postCode
ŒŒ 
=
ŒŒ 
param
ŒŒ  
.
ŒŒ  !
SevkPostaKodu
ŒŒ! .
,
ŒŒ. /
	companyId
œœ 
=
œœ 
findCari
œœ $
?
œœ$ %
.
œœ% &
id
œœ& (
,
œœ( )
}
–– 
;
–– 
result
—— 
&=
—— 
db
—— 
.
—— 
InsertCMP_Storage
—— *
(
——* +
insertStorage
——+ 8
)
——8 9
;
——9 :
return
““ 
result
““ 
;
““ 
}
”” 	
public
‘‘ 
ResultStatus
‘‘ 
StorageUpdate
‘‘ )
(
‘‘) *
AdShipFindList
‘‘* 8
param
‘‘9 >
,
‘‘> ?
string
‘‘@ F
firmaNo
‘‘G N
)
‘‘N O
{
’’ 	
var
÷÷ 
db
÷÷ 
=
÷÷ 
new
÷÷  
WorkOfTimeDatabase
÷÷ +
(
÷÷+ ,
)
÷÷, -
;
÷÷- .
var
◊◊ 
result
◊◊ 
=
◊◊ 
new
◊◊ 
ResultStatus
◊◊ )
{
◊◊* +
result
◊◊, 2
=
◊◊3 4
true
◊◊5 9
}
◊◊: ;
;
◊◊; <
var
ÿÿ 
	checkCode
ÿÿ 
=
ÿÿ 
db
ÿÿ 
.
ÿÿ "
GetCMP_StorageByCode
ÿÿ 3
(
ÿÿ3 4
firmaNo
ÿÿ4 ;
+
ÿÿ< =
$str
ÿÿ> A
+
ÿÿB C
param
ÿÿD I
.
ÿÿI J
CariKodu
ÿÿJ R
+
ÿÿS T
param
ÿÿU Z
.
ÿÿZ [
SevkKodu
ÿÿ[ c
)
ÿÿc d
;
ÿÿd e
var
ŸŸ 
findCari
ŸŸ 
=
ŸŸ 
db
ŸŸ 
.
ŸŸ *
GetVWCMP_CompanyByNameOrCode
ŸŸ :
(
ŸŸ: ;
param
ŸŸ; @
.
ŸŸ@ A
	CariUnvan
ŸŸA J
,
ŸŸJ K
firmaNo
ŸŸL S
+
ŸŸT U
$str
ŸŸV Y
+
ŸŸZ [
param
ŸŸ\ a
.
ŸŸa b
CariKodu
ŸŸb j
,
ŸŸj k
null
ŸŸk o
)
ŸŸo p
;
ŸŸp q
var
⁄⁄ 
findSH_User
⁄⁄ 
=
⁄⁄ 
db
⁄⁄  
.
⁄⁄  !
GetVWSH_User
⁄⁄! -
(
⁄⁄- .
)
⁄⁄. /
.
⁄⁄/ 0
Where
⁄⁄0 5
(
⁄⁄5 6
a
⁄⁄6 7
=>
⁄⁄8 :
a
⁄⁄; <
.
⁄⁄< =
FullName
⁄⁄= E
==
⁄⁄F H
param
⁄⁄I N
.
⁄⁄N O
SevkIlgiliKisi
⁄⁄O ]
.
⁄⁄] ^
ToUpper
⁄⁄^ e
(
⁄⁄e f
)
⁄⁄f g
)
⁄⁄g h
.
⁄⁄h i
FirstOrDefault
⁄⁄i w
(
⁄⁄w x
)
⁄⁄x y
;
⁄⁄y z
var
€€ 
	validator
€€ 
=
€€ 
StorageValidator
€€ ,
(
€€, -
param
€€- 2
,
€€2 3
	checkCode
€€4 =
)
€€= >
;
€€> ?
if
‹‹ 
(
‹‹ 
	validator
‹‹ 
.
‹‹ 
result
‹‹  
)
‹‹  !
{
›› 
	checkCode
ﬁﬁ 
.
ﬁﬁ 
changed
ﬁﬁ !
=
ﬁﬁ" #
DateTime
ﬁﬁ$ ,
.
ﬁﬁ, -
Now
ﬁﬁ- 0
;
ﬁﬁ0 1
	checkCode
ﬂﬂ 
.
ﬂﬂ 
	changedby
ﬂﬂ #
=
ﬂﬂ$ %
Guid
ﬂﬂ& *
.
ﬂﬂ* +
Empty
ﬂﬂ+ 0
;
ﬂﬂ0 1
	checkCode
‡‡ 
.
‡‡ 
name
‡‡ 
=
‡‡  
param
‡‡! &
.
‡‡& '
SevkAciklamasi
‡‡' 5
;
‡‡5 6
	checkCode
·· 
.
·· 
address
·· !
=
··" #
param
··$ )
.
··) *

SevkAdresi
··* 4
;
··4 5
	checkCode
‚‚ 
.
‚‚ 
code
‚‚ 
=
‚‚  
firmaNo
‚‚! (
+
‚‚) *
$str
‚‚+ .
+
‚‚/ 0
param
‚‚1 6
.
‚‚6 7
CariKodu
‚‚7 ?
+
‚‚@ A
param
‚‚B G
.
‚‚G H
SevkKodu
‚‚H P
;
‚‚P Q
	checkCode
„„ 
.
„„ 
email
„„ 
=
„„  !
param
„„" '
.
„„' (

SevkEposta
„„( 2
;
„„2 3
	checkCode
‰‰ 
.
‰‰ 
phone
‰‰ 
=
‰‰  !
param
‰‰" '
.
‰‰' (
SevkTelefon
‰‰( 3
;
‰‰3 4
	checkCode
ÂÂ 
.
ÂÂ 
postCode
ÂÂ "
=
ÂÂ# $
param
ÂÂ% *
.
ÂÂ* +
SevkPostaKodu
ÂÂ+ 8
;
ÂÂ8 9
	checkCode
ÊÊ 
.
ÊÊ 
supervisorId
ÊÊ &
=
ÊÊ' (
findSH_User
ÊÊ) 4
?
ÊÊ4 5
.
ÊÊ5 6
id
ÊÊ6 8
;
ÊÊ8 9
	checkCode
ÁÁ 
.
ÁÁ 
	companyId
ÁÁ #
=
ÁÁ$ %
findCari
ÁÁ& .
?
ÁÁ. /
.
ÁÁ/ 0
id
ÁÁ0 2
;
ÁÁ2 3
result
ËË 
&=
ËË 
db
ËË 
.
ËË 
UpdateCMP_Storage
ËË .
(
ËË. /
	checkCode
ËË/ 8
)
ËË8 9
;
ËË9 :
}
ÈÈ 
return
ÍÍ 
result
ÍÍ 
;
ÍÍ 
}
ÎÎ 	
public
ÏÏ 
ResultStatus
ÏÏ 
CompanyValidator
ÏÏ ,
(
ÏÏ, -
AdClientFind
ÏÏ- 9
param
ÏÏ: ?
,
ÏÏ? @
CMP_Company
ÏÏA L
company
ÏÏM T
)
ÏÏT U
{
ÌÌ 	
var
ÓÓ 
result
ÓÓ 
=
ÓÓ 
new
ÓÓ 
ResultStatus
ÓÓ )
{
ÓÓ* +
result
ÓÓ, 2
=
ÓÓ3 4
true
ÓÓ5 9
}
ÓÓ: ;
;
ÓÓ; <
if
ÔÔ 
(
ÔÔ 
company
ÔÔ 
.
ÔÔ 
email
ÔÔ 
==
ÔÔ  
param
ÔÔ! &
.
ÔÔ& '
Eposta1
ÔÔ' .
&&
ÔÔ/ 1
company
ÔÔ2 9
.
ÔÔ9 :
openAddress
ÔÔ: E
==
ÔÔF H
param
ÔÔI N
.
ÔÔN O
Adres
ÔÔO T
&&
ÔÔU W
company
ÔÔX _
.
ÔÔ_ `
name
ÔÔ` d
==
ÔÔe g
param
ÔÔh m
.
ÔÔm n
	CariUnvan
ÔÔn w
&&
ÔÔx z
companyÔÔ{ Ç
.ÔÔÇ É
	taxOfficeÔÔÉ å
==ÔÔç è
paramÔÔê ï
.ÔÔï ñ
VergiDairesiÔÔñ ¢
&&ÔÔ£ •
companyÔÔ¶ ≠
.ÔÔ≠ Æ
	taxNumberÔÔÆ ∑
==ÔÔ∏ ∫
paramÔÔª ¿
.ÔÔ¿ ¡
VergiNoÔÔ¡ »
)ÔÔ» …
{
 
return
ÒÒ 
new
ÒÒ 
ResultStatus
ÒÒ '
{
ÚÚ 
result
ÛÛ 
=
ÛÛ 
false
ÛÛ "
,
ÛÛ" #
message
ÙÙ 
=
ÙÙ 
$str
ÙÙ -
,
ÙÙ- .
}
ıı 
;
ıı 
}
ˆˆ 
return
˜˜ 
result
˜˜ 
;
˜˜ 
}
¯¯ 	
public
˘˘ 
ResultStatus
˘˘ 
StorageValidator
˘˘ ,
(
˘˘, -
AdShipFindList
˘˘- ;
param
˘˘< A
,
˘˘A B
CMP_Storage
˘˘C N
storage
˘˘O V
)
˘˘V W
{
˙˙ 	
var
˚˚ 
result
˚˚ 
=
˚˚ 
new
˚˚ 
ResultStatus
˚˚ )
{
˚˚* +
result
˚˚, 2
=
˚˚3 4
true
˚˚5 9
}
˚˚: ;
;
˚˚; <
if
¸¸ 
(
¸¸ 
storage
¸¸ 
.
¸¸ 
email
¸¸ 
==
¸¸  
param
¸¸! &
.
¸¸& '

SevkEposta
¸¸' 1
&&
¸¸2 4
storage
¸¸5 <
.
¸¸< =
address
¸¸= D
==
¸¸E G
param
¸¸H M
.
¸¸M N

SevkAdresi
¸¸N X
&&
¸¸Y [
storage
¸¸\ c
.
¸¸c d
name
¸¸d h
==
¸¸i k
param
¸¸l q
.
¸¸q r
	CariUnvan
¸¸r {
&&
¸¸| ~
storage¸¸ Ü
.¸¸Ü á
phone¸¸á å
==¸¸ç è
param¸¸ê ï
.¸¸ï ñ
SevkTelefon¸¸ñ °
&&¸¸¢ §
storage¸¸• ¨
.¸¸¨ ≠
postCode¸¸≠ µ
==¸¸∂ ∏
param¸¸π æ
.¸¸æ ø
SevkPostaKodu¸¸ø Ã
)¸¸Ã Õ
{
˝˝ 
return
˛˛ 
new
˛˛ 
ResultStatus
˛˛ '
{
ˇˇ 
result
ÄÄ 
=
ÄÄ 
false
ÄÄ "
,
ÄÄ" #
message
ÅÅ 
=
ÅÅ 
$str
ÅÅ -
,
ÅÅ- .
}
ÇÇ 
;
ÇÇ 
}
ÉÉ 
return
ÑÑ 
result
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
public
ÜÜ 
ResultStatus
ÜÜ 
ProductValidator
ÜÜ ,
(
ÜÜ, -
AdItemsFindList
ÜÜ- <
param
ÜÜ= B
,
ÜÜB C
PRD_Product
ÜÜD O
product
ÜÜP W
)
ÜÜW X
{
áá 	
var
àà 
result
àà 
=
àà 
new
àà 
ResultStatus
àà )
{
àà* +
result
àà, 2
=
àà3 4
true
àà5 9
}
àà: ;
;
àà; <
if
ââ 
(
ââ 
product
ââ 
.
ââ 
name
ââ 
==
ââ 
param
ââ  %
.
ââ% &
UrunAciklamasi1
ââ& 5
&&
ââ6 8
product
ââ9 @
.
ââ@ A
description
ââA L
==
ââM O
param
ââP U
.
ââU V
UrunAciklamasi2
ââV e
)
ââe f
{
ää 
return
ãã 
new
ãã 
ResultStatus
ãã '
{
åå 
result
çç 
=
çç 
false
çç "
,
çç" #
message
éé 
=
éé 
$str
éé -
,
éé- .
}
èè 
;
èè 
}
êê 
return
ëë 
result
ëë 
;
ëë 
}
íí 	
}
ïï 
}ññ ó
yD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\LogoEntegration\IDataMapper.cs
	namespace

 	
Infoline


 
.

 
OmixEntegrationApp

 %
.

% &
LogoEntegration

& 5
{ 
public 

	interface 
IDataMapper  
{ 
ResultStatus 
CompanyValidator %
(% &
AdClientFind& 2
param3 8
,8 9
CMP_Company: E
companyF M
)M N
;N O
ResultStatus 
CompanySave  
(  !
AdClientFind! -
[- .
]. /
param0 5
,5 6
string7 =
firmaNo> E
)E F
;F G
ResultStatus 
CompanyInsert "
(" #
AdClientFind# /
param0 5
,5 6
string7 =
firmaNo> E
)E F
;F G
ResultStatus 
CompanyUpdate "
(" #
AdClientFind# /
param0 5
,5 6
string7 =
firmaNo> E
)E F
;F G
ResultStatus 
ProductValidator %
(% &
AdItemsFindList& 5
param6 ;
,; <
PRD_Product= H
productI P
)P Q
;Q R
ResultStatus 
ProductSave  
(  !
AdItemsFindList! 0
[0 1
]1 2
param3 8
)8 9
;9 :
ResultStatus 
ProductInsert "
(" #
AdItemsFindList# 2
param3 8
)8 9
;9 :
ResultStatus 
StorageValidator %
(% &
AdShipFindList& 4
param5 :
,: ;
CMP_Storage< G
storageH O
)O P
;P Q
ResultStatus 
StorageSave  
(  !
AdShipFindList! /
[/ 0
]0 1
param2 7
,7 8
string9 ?
firmaNo@ G
)G H
;H I
ResultStatus 
StorageInsert "
(" #
AdShipFindList# 1
param2 7
,7 8
string9 ?
firmaNo@ G
)G H
;H I
ResultStatus 
StorageUpdate "
(" #
AdShipFindList# 1
param2 7
,7 8
string9 ?
firmaNo@ G
)G H
;H I
} 
} ´E
eD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Program.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
{ 
class 	
Program
 
{ 
public 
static 
string 

TenantCode '
=' ( 
ConfigurationManager) =
.= >
AppSettings> I
[I J
$strJ Y
]Y Z
.Z [
ToString[ c
(c d
)d e
;e f
static 
void 
Main 
( 
string 
[  
]  !
args" &
)& '
{ 	
AgentRunControl 
( 
) 
; 
if 
( 
! 
Environment 
. 
UserInteractive ,
), -
{ 
System 
. 
ServiceProcess %
.% &
ServiceBase& 1
.1 2
Run2 5
(5 6
new6 9
System: @
.@ A
ServiceProcessA O
.O P
ServiceBaseP [
[[ \
]\ ]
{^ _
new` c

AgentStartd n
(n o
)o p
}q r
)r s
;s t
} 
else 
{ 
try 
{ 
ServiceControl "
(" #
args# '
)' (
;( )
}   
catch!! 
(!! 
	Exception!!  
ex!!! #
)!!# $
{"" 
Console## 
.## 
	WriteLine## %
(##% &
$str##& I
+##J K
Environment##L W
.##W X
NewLine##X _
+##` a
ex##b d
.##d e
Message##e l
.##l m
ToString##m u
(##u v
)##v w
)##w x
;##x y
}$$ 
try&& 
{'' 
Console(( 
.(( 
	WriteLine(( %
(((% &
$str((& 9
)((9 :
;((: ;
var)) 

agentStart)) "
=))# $
new))% (

AgentStart))) 3
())3 4
)))4 5
;))5 6

agentStart** 
.** 
Run** "
(**" #
)**# $
;**$ %
while++ 
(++ 
true++ 
)++  
{,, 
System-- 
.-- 
	Threading-- (
.--( )
Thread--) /
.--/ 0
Sleep--0 5
(--5 6
$num--6 :
)--: ;
;--; <
}.. 
}// 
catch00 
(00 
	Exception00  
ex00! #
)00# $
{11 
Console22 
.22 
	WriteLine22 %
(22% &
DateTime22& .
.22. /
Now22/ 2
+223 4
$str225 <
+22= >
ex22? A
.22A B
Message22B I
)22I J
;22J K
}33 
}55 
}66 	
private99 
static99 
void99 
ServiceControl99 *
(99* +
string99+ 1
[991 2
]992 3
args994 8
)998 9
{:: 	
var;; 
ServiceName;; 
=;; 
$str;; 4
+;;4 5

TenantCode;;5 ?
+;;? @
$str;;@ E
;;;E F
if<< 
(<< 
SvcInstaller<< 
.<< 
GetServiceStatus<< -
(<<- .
ServiceName<<. 9
)<<9 :
==<<; =
ServiceState<<> J
.<<J K
NotFound<<K S
)<<S T
{== 
Console>> 
.>> 
	WriteLine>> !
(>>! "
$str>>" 4
)>>4 5
;>>5 6
SvcInstaller@@ 
.@@ 
ServisInstall@@ *
(@@* +
ServiceName@@+ 6
,@@6 7
false@@8 =
,@@= >
false@@? D
,@@D E
System@@F L
.@@L M

Reflection@@M W
.@@W X
Assembly@@X `
.@@` a
GetEntryAssembly@@a q
(@@q r
)@@r s
.@@s t
Location@@t |
)@@| }
;@@} ~
}AA 
ifBB 
(BB 
argsBB 
.BB 
CountBB 
(BB 
)BB 
>BB 
$numBB  
&&BB! #
argsBB$ (
[BB( )
$numBB) *
]BB* +
==BB, .
$strBB/ 2
)BB2 3
{CC 
SvcInstallerDD 
.DD 
ServisUnInstallDD ,
(DD, -
ServiceNameDD- 8
)DD8 9
;DD9 :
}EE 
SvcInstallerFF 
.FF 

ServisStopFF #
(FF# $
ServiceNameFF$ /
)FF/ 0
;FF0 1
}GG 	
privateII 
staticII 
voidII 
AgentRunControlII +
(II+ ,
)II, -
{JJ 	
ifLL 
(LL 
EnvironmentLL 
.LL 
UserInteractiveLL +
)LL+ ,
{MM 
ServiceControllerNN !
scNN" $
=NN% &
ServiceControllerNN' 8
.NN8 9
GetServicesNN9 D
(NND E
)NNE F
.NNF G
FirstOrDefaultNNG U
(NNU V
sNNV W
=>NNX Z
sNN[ \
.NN\ ]
ServiceNameNN] h
.NNh i
EqualsNNi o
(NNo p
$str	NNp Ü
+
NNá à

TenantCode
NNâ ì
+
NNî ï
$str
NNñ õ
)
NNõ ú
)
NNú ù
;
NNù û
ifOO 
(OO 
scOO 
!=OO 
nullOO 
)OO 
{PP 
ifQQ 
(QQ 
scQQ 
.QQ 
StatusQQ !
.QQ! "
EqualsQQ" (
(QQ( )#
ServiceControllerStatusQQ) @
.QQ@ A
RunningQQA H
)QQH I
)QQI J
{RR 
ConsoleSS 
.SS  
	WriteLineSS  )
(SS) *
$strSS* p
,SSp q
scSSr t
.SSt u
CanStopSSu |
,SS| }
sc	SS~ Ä
.
SSÄ Å
CanShutdown
SSÅ å
,
SSå ç
sc
SSé ê
.
SSê ë!
CanPauseAndContinue
SSë §
)
SS§ •
;
SS• ¶
scTT 
.TT 
StopTT 
(TT  
)TT  !
;TT! "
scUU 
.UU 
DisposeUU "
(UU" #
)UU# $
;UU$ %
ThreadVV 
.VV 
SleepVV $
(VV$ %
$numVV% &
*VV' (
$numVV) -
)VV- .
;VV. /
}WW 
}XX 
}YY 
if[[ 
([[ 
Process[[ 
.[[ 
GetProcessesByName[[ *
([[* +
$str[[+ A
+[[B C

TenantCode[[D N
+[[O P
$str[[Q V
)[[V W
.[[W X
Length[[X ^
>[[_ `
$num[[a b
)[[b c
{\\ 
Console]] 
.]] 
	WriteLine]] !
(]]! "
$str]]" [
)]][ \
;]]\ ]
var__ 
runningProcesses__ $
=__% &
Process__' .
.__. /
GetProcesses__/ ;
(__; <
)__< =
.__= >
Where__> C
(__C D
a__D E
=>__F H
a__I J
.__J K
ProcessName__K V
.__V W
Equals__W ]
(__] ^
$str__^ t
+__u v

TenantCode	__w Å
+
__Ç É
$str
__Ñ â
)
__â ä
)
__ä ã
;
__ã å
foreach`` 
(`` 
var`` 
process`` $
in``% '
runningProcesses``( 8
)``8 9
{aa 
ifbb 
(bb 
Systembb 
.bb 
IntPtrbb %
.bb% &
Zerobb& *
!=bb+ -
processbb. 5
.bb5 6
MainWindowHandlebb6 F
&&bbG I
ProcessbbJ Q
.bbQ R
GetCurrentProcessbbR c
(bbc d
)bbd e
.bbe f
MainWindowHandlebbf v
!=bbw y
process	bbz Å
.
bbÅ Ç
MainWindowHandle
bbÇ í
)
bbí ì
{cc 
Consoledd 
.dd  
	WriteLinedd  )
(dd) *
processdd* 1
.dd1 2
ProcessNamedd2 =
+dd> ?
$strdd@ K
)ddK L
;ddL M
processee 
.ee  
Killee  $
(ee$ %
)ee% &
;ee& '
}ff 
}gg 
Threadhh 
.hh 
Sleephh 
(hh 
$numhh 
*hh  
$numhh! %
)hh% &
;hh& '
}ii 
}jj 	
}kk 
}ll †
uD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 6
)6 7
]7 8
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str 8
)8 9
]9 :
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *ø(
ÑD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\LogoEntegration\ProcessLogoEntegration.cs
	namespace

 	
Infoline


 
.

 
OmixEntegrationApp

 %
.

% &
LogoEntegration

& 5
{ 
public 

class "
ProcessLogoEntegration '
:( )
IDisposable* 5
{ 
public 
string 
FirmaNo 
{ 
get  #
=>$ & 
ConfigurationManager' ;
.; <
AppSettings< G
[G H
$strH S
]S T
.T U
ToStringU ]
(] ^
)^ _
;_ `
}a b
public "
ProcessLogoEntegration %
(% &
)& '
{ 	
Log 
. 
Info 
( 
$str 6
)6 7
;7 8
} 	
public 
void 
Run 
( 
) 
{ 	
while 
( 
true 
) 
{ 

DataMapper 
_dataMapper &
=' (
new) ,

DataMapper- 7
(7 8
)8 9
;9 :
var 
sc 
= 
new 
Service1SoapClient /
(/ 0
)0 1
;1 2
foreach 
( 
var 
firmaNo $
in% '
FirmaNo( /
./ 0
Split0 5
(5 6
$char6 9
)9 :
): ;
{ 
try 
{ 
var 
getCariList '
=( )
sc* ,
., -
GetCariList- 8
(8 9
new9 <
ClientFindParam= L
{M N
FirmaNoO V
=W X
firmaNoY `
}a b
)b c
;c d
var   
getProductList   *
=  + ,
sc  - /
.  / 0
GetMalzemeList  0 >
(  > ?
new  ? B
AdItemsFindParam  C S
{  T U
FirmaNo  V ]
=  ^ _
firmaNo  ` g
}  h i
)  i j
;  j k
_dataMapper!! #
.!!# $
CompanySave!!$ /
(!!/ 0
getCariList!!0 ;
,!!; <
firmaNo!!= D
)!!D E
;!!E F
_dataMapper"" #
.""# $
ProductSave""$ /
(""/ 0
getProductList""0 >
)""> ?
;""? @
if## 
(## 
getCariList## '
.##' (
Count##( -
(##- .
)##. /
>##0 1
$num##2 3
)##3 4
{$$ 
foreach%% #
(%%$ %
var%%% (
cariKodu%%) 1
in%%2 4
getCariList%%5 @
)%%@ A
{&& 
try''  #
{((  !
var))$ '
getStorageList))( 6
=))7 8
sc))9 ;
.)); <
GetSevkAdresList))< L
())L M
new))M P
AdShipFindParam))Q `
{))a b
FirmaNo))c j
=))k l
firmaNo))m t
,))t u
CariKodu))v ~
=	)) Ä
cariKodu
))Å â
.
))â ä
CariKodu
))ä í
}
))ì î
)
))î ï
;
))ï ñ
_dataMapper**$ /
.**/ 0
StorageSave**0 ;
(**; <
getStorageList**< J
,**J K
firmaNo**L S
)**S T
;**T U
}++  !
catch,,  %
(,,& '
	Exception,,' 0
ex,,1 3
),,3 4
{--  !
Log..$ '
...' (
Error..( -
(..- .
$str... [
+..\ ]
ex..^ `
...` a
Message..a h
+..i j
$str..k r
+..s t
ex..u w
...w x
InnerException	..x Ü
.
..Ü á
Message
..á é
)
..é è
;
..è ê
}//  !
}00 
}11 
}22 
catch33 
(33 
	Exception33 $
ex33% '
)33' (
{44 
Log55 
.55 
Error55 !
(55! "
$str55" B
+55C D
ex55E G
.55G H
Message55H O
+55P Q
$str55R Y
+55Z [
ex55\ ^
.55^ _
InnerException55_ m
.55m n
Message55n u
)55u v
;55v w
}66 
}77 
Log88 
.88 
Info88 
(88 
$str88 +
)88+ ,
;88, -
Thread99 
.99 
Sleep99 
(99 
new99  
TimeSpan99! )
(99) *
$num99* +
,99+ ,
$num99- .
,99. /
$num990 1
)991 2
)992 3
;993 4
}:: 
};; 	
public<< 
void<< 
Dispose<< 
(<< 
)<< 
{== 	
throw>> 
new>> #
NotImplementedException>> -
(>>- .
)>>. /
;>>/ 0
}?? 	
}@@ 
}AA út
ÑD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\TitanEntegration\Business\TitanService.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
TitanEntegration& 6
.6 7
Business7 ?
{ 
public 

class 
TitanService 
{ 
private 
WorkOfTimeDatabase "
db# %
=& '
new( +
WorkOfTimeDatabase, >
(> ?
)? @
;@ A
public 
string 
Host 
{ 
get  
=>! # 
ConfigurationManager$ 8
.8 9
AppSettings9 D
[D E
$strE K
]K L
.L M
ToStringM U
(U V
)V W
;W X
}Y Z
public 
TitanService 
( 
) 
{ 	
var 

tenantCode 
=  
ConfigurationManager 1
.1 2
AppSettings2 =
[= >
$str> M
]M N
.N O
ToStringO W
(W X
)X Y
;Y Z
var 
tenant 
= 
TenantConfig %
.% &

GetTenants& 0
(0 1
)1 2
.2 3
Where3 8
(8 9
a9 :
=>; =
a> ?
.? @

TenantCode@ J
==K M
ConvertN U
.U V
ToInt32V ]
(] ^

tenantCode^ h
)h i
)i j
.j k
FirstOrDefaultk y
(y z
)z {
;{ |
db 
= 
tenant 
. 
GetDatabase #
(# $
)$ %
;% &
} 	
public 
void '
CompensateFromTitanServices /
(/ 0
)0 1
{ 	
Log 
. 
Info 
( 
$str =
)= >
;> ?
var   
getAllDevices   
=   .
"GetLastDeviceListFromTitanServices    B
(  B C
)  C D
;  D E
if!! 
(!! 
getAllDevices!! 
.!! 
objects!! %
!=!!& (
null!!) -
)!!- .
{"" 
var## 
getAllDevicesList## %
=##& '
(##( )
DeviceResultList##) 9
)##9 :
getAllDevices##: G
.##G H
objects##H O
;##O P
var$$ 
databaseDevices$$ #
=$$$ %
db$$& (
.$$( )'
GetPRD_TitanDeviceActivated$$) D
($$D E
)$$E F
.$$F G
ToList$$G M
($$M N
)$$N O
;$$O P
var%% 

savingList%% 
=%%  
getAllDevicesList%%! 2
.%%2 3
Data%%3 7
.%%7 8
Where%%8 =
(%%= >
x%%> ?
=>%%@ B
!%%C D
databaseDevices%%D S
.%%S T
Select%%T Z
(%%Z [
a%%[ \
=>%%] _
a%%` a
.%%a b
IMEI1%%b g
)%%g h
.%%h i
Contains%%i q
(%%q r
x%%r s
.%%s t
IMEI1%%t y
)%%y z
||%%{ }
!%%~ 
databaseDevices	%% é
.
%%é è
Select
%%è ï
(
%%ï ñ
a
%%ñ ó
=>
%%ò ö
a
%%õ ú
.
%%ú ù
IMEI2
%%ù ¢
)
%%¢ £
.
%%£ §
Contains
%%§ ¨
(
%%¨ ≠
x
%%≠ Æ
.
%%Æ Ø
IMEI2
%%Ø ¥
)
%%¥ µ
||
%%∂ ∏
!
%%π ∫
databaseDevices
%%∫ …
.
%%…  
Select
%%  –
(
%%– —
a
%%— “
=>
%%” ’
a
%%÷ ◊
.
%%◊ ÿ
SerialNumber
%%ÿ ‰
)
%%‰ Â
.
%%Â Ê
Contains
%%Ê Ó
(
%%Ó Ô
x
%%Ô 
.
%% Ò
Serial
%%Ò ˜
)
%%˜ ¯
)
%%¯ ˘
;
%%˘ ˙
Log&& 
.&& 
Info&& 
(&& 
$str&& ;
,&&; <

savingList&&= G
.&&G H
Count&&H M
(&&M N
)&&N O
)&&O P
;&&P Q
foreach)) 
()) 
var)) 
item)) !
in))" $

savingList))% /
)))/ 0
{** 
var++ 
checkDb++ 
=++  !
db++" $
.++$ %/
#GetVWPRD_TitanDeviceActivatedByImei++% H
(++H I
item++I M
.++M N
IMEI1++N S
==++T V
null++W [
?++\ ]
item++^ b
.++b c
Serial++c i
:++j k
item++l p
.++p q
IMEI1++q v
)++v w
;++w x
if,, 
(,, 
checkDb,, 
==,,  "
null,,# '
),,' (
{-- 
var.. #
prdTitanDeviceActivated.. 3
=..4 5
new..6 9$
PRD_TitanDeviceActivated..: R
(..R S
)..S T
;..T U
var00 
getInventory00 (
=00) *
db00+ -
.00- ..
"GetPRD_InventoryBySerialCodeOrImei00. P
(00P Q
item00Q U
.00U V
Serial00V \
,00\ ]
item00^ b
.00b c
IMEI100c h
,00h i
item00j n
.00n o
IMEI200o t
)00t u
;00u v#
prdTitanDeviceActivated11 /
.11/ 0
CreatedOfTitan110 >
=11? @
item11A E
.11E F
Created11F M
.11M N
ToLocalTime11N Y
(11Y Z
)11Z [
;11[ \#
prdTitanDeviceActivated22 /
.22/ 0
DeviceId220 8
=229 :
new22; >
Guid22? C
(22C D
item22D H
.22H I
DeviceId22I Q
)22Q R
;22R S#
prdTitanDeviceActivated33 /
.33/ 0
IMEI1330 5
=336 7
item338 <
.33< =
IMEI133= B
==33C E
null33F J
?33K L
item33M Q
.33Q R
Serial33R X
:33Y Z
item33[ _
.33_ `
IMEI133` e
;33e f#
prdTitanDeviceActivated44 /
.44/ 0
IMEI2440 5
=446 7
item448 <
.44< =
IMEI244= B
;44B C#
prdTitanDeviceActivated55 /
.55/ 0
InventoryId550 ;
=55< =
getInventory55> J
?55J K
.55K L
id55L N
;55N O#
prdTitanDeviceActivated66 /
.66/ 0
	ProductId660 9
=66: ;
getInventory66< H
?66H I
.66I J
	productId66J S
;66S T#
prdTitanDeviceActivated77 /
.77/ 0
SerialNumber770 <
=77= >
item77? C
.77C D
Serial77D J
;77J K#
prdTitanDeviceActivated88 /
.88/ 0
TitanDeviceName880 ?
=88@ A
item88B F
.88F G

DeviceName88G Q
;88Q R#
prdTitanDeviceActivated99 /
.99/ 0

TitanModel990 :
=99; <
item99= A
.99A B
Model99B G
;99G H#
prdTitanDeviceActivated:: /
.::/ 0
TitanProduct::0 <
=::= >
item::? C
.::C D
Product::D K
;::K L
var<< 
dbInsertResult<< *
=<<+ ,
db<<- /
.<</ 0*
InsertPRD_TitanDeviceActivated<<0 N
(<<N O#
prdTitanDeviceActivated<<O f
)<<f g
;<<g h
if>> 
(>> 
!>> 
dbInsertResult>> +
.>>+ ,
result>>, 2
)>>2 3
Log?? 
.??  
Error??  %
(??% &
$str??& E
,??E F
item??G K
.??K L
IMEI1??L Q
)??Q R
;??R S
}@@ 
elseAA 
{BB 
LogCC 
.CC 
WarningCC #
(CC# $
$strCC$ B
,CCB C
itemCCD H
.CCH I
IMEI1CCI N
)CCN O
;CCO P
}DD 
}EE 
}GG 
LogHH 
.HH 
InfoHH 
(HH 
$strHH 8
)HH8 9
;HH9 :
}II 	
privateKK 
ResultStatusKK .
"GetLastDeviceListFromTitanServicesKK ?
(KK? @
)KK@ A
{LL 	
varMM 
lastDataTimeMM 
=MM 
dbMM !
.MM! "5
)GetPRD_TitanDeviceActivatedGetAllLastDateMM" K
(MMK L
)MML M
;MMM N
LogNN 
.NN 
InfoNN 
(NN 
$strNN ?
,NN? @
lastDataTimeNNA M
)NNM N
;NNN O
varPP 
queryPP 
=PP 
HelperPP 
.PP 
JsonPP #
.PP# $
	SerializePP$ -
(PP- .
newPP. 1
{QQ 
DataTypeRR 
=RR 
$numRR 
,RR 
StartSS 
=SS 
lastDataTimeSS $
.SS$ %
ValueSS% *
.SS* +
ToUniversalTimeSS+ :
(SS: ;
)SS; <
,SS< =
EndTT 
=TT 
DateTimeTT 
.TT 
NowTT "
.TT" #
ToUniversalTimeTT# 2
(TT2 3
)TT3 4
}UU 
)UU 
;UU 
returnVV *
GetDeviceListFromTitanServicesVV 1
<VV1 2
DeviceResultListVV2 B
>VVB C
(VVC D 
ConfigurationManagerVVD X
.VVX Y
AppSettingsVVY d
[VVd e
$str	VVe Ö
]
VVÖ Ü
.
VVÜ á
ToString
VVá è
(
VVè ê
)
VVê ë
,
VVë í
query
VVì ò
)
VVò ô
;
VVô ö
}WW 	
privateYY 
ResultStatusYY *
GetDeviceListFromTitanServicesYY ;
<YY; <
TYY< =
>YY= >
(YY> ?
stringYY? E
uriYYF I
,YYI J
stringYYK Q
queryYYR W
=YYX Y
nullYYZ ^
)YY^ _
{ZZ 	
try[[ 
{\\ 
ServicePointManager^^ #
.^^# $
Expect100Continue^^$ 5
=^^6 7
true^^8 <
;^^< =
ServicePointManager__ #
.__# $
SecurityProtocol__$ 4
=__5 6 
SecurityProtocolType__7 K
.__K L
Tls__L O
|``  
SecurityProtocolType`` -
.``- .
Tls11``. 3
|aa  
SecurityProtocolTypeaa -
.aa- .
Tls12aa. 3
|bb  
SecurityProtocolTypebb -
.bb- .
Ssl3bb. 2
;bb2 3
HttpWebRequestdd 
requestdd &
=dd' (
(dd) *
HttpWebRequestdd* 8
)dd8 9

WebRequestdd9 C
.ddC D
CreateddD J
(ddJ K
HostddK O
+ddP Q
uriddR U
)ddU V
;ddV W
requestee 
.ee 
ContentTypeee #
=ee$ %
$stree& 8
;ee8 9
requestff 
.ff 
Methodff 
=ff  
$strff! &
;ff& '
vargg 
typegg 
=gg 
requestgg "
.gg" #
GetTypegg# *
(gg* +
)gg+ ,
;gg, -
varii 
currentMethodii !
=ii" #
typeii$ (
.ii( )
GetPropertyii) 4
(ii4 5
$strii5 D
,iiD E
BindingFlagsiiF R
.iiR S
	NonPubliciiS \
|ii] ^
BindingFlagsii_ k
.iik l
Instanceiil t
)iit u
.iiu v
GetValueiiv ~
(ii~ 
request	ii Ü
)
iiÜ á
;
iiá à
varjj 

methodTypejj 
=jj  
currentMethodjj! .
.jj. /
GetTypejj/ 6
(jj6 7
)jj7 8
;jj8 9

methodTypekk 
.kk 
GetFieldkk #
(kk# $
$strkk$ ;
,kk; <
BindingFlagskk= I
.kkI J
	NonPublickkJ S
|kkT U
BindingFlagskkV b
.kkb c
Instancekkc k
)kkk l
.kkl m
SetValuekkm u
(kku v
currentMethod	kkv É
,
kkÉ Ñ
false
kkÖ ä
)
kkä ã
;
kkã å
usingll 
(ll 
varll 
streamWriterll '
=ll( )
newll* -
StreamWriterll. :
(ll: ;
requestll; B
.llB C
GetRequestStreamllC S
(llS T
)llT U
)llU V
)llV W
{mm 
streamWriternn  
.nn  !
Writenn! &
(nn& '
querynn' ,
)nn, -
;nn- .
}oo 
varss 
responsess 
=ss 
(ss  
HttpWebResponsess  /
)ss/ 0
(ss0 1
requestss1 8
.ss8 9
GetResponsess9 D
(ssD E
)ssE F
)ssF G
;ssG H
usingtt 
(tt 
vartt 
readertt !
=tt" #
newtt$ '
StreamReadertt( 4
(tt4 5
responsett5 =
.tt= >
GetResponseStreamtt> O
(ttO P
)ttP Q
,ttQ R
ASCIIEncodingttS `
.tt` a
ASCIItta f
)ttf g
)ttg h
{uu 
returnvv 
newvv 
ResultStatusvv +
{ww 
resultxx 
=xx  
truexx! %
,xx% &
messageyy 
=yy  !
$stryy" 2
,yy2 3
objectszz 
=zz  !
JsonConvertzz" -
.zz- .
DeserializeObjectzz. ?
<zz? @
Tzz@ A
>zzA B
(zzB C
readerzzC I
.zzI J
	ReadToEndzzJ S
(zzS T
)zzT U
)zzU V
}{{ 
;{{ 
}|| 
}~~ 
catch 
( 
	Exception 
ex 
)  
{
ÄÄ 
Log
ÅÅ 
.
ÅÅ 
Error
ÅÅ 
(
ÅÅ 
$str
ÅÅ B
,
ÅÅB C
ex
ÅÅD F
.
ÅÅF G
Message
ÅÅG N
)
ÅÅN O
;
ÅÅO P
return
ÉÉ 
new
ÉÉ 
ResultStatus
ÉÉ '
{
ÑÑ 
result
ÖÖ 
=
ÖÖ 
false
ÖÖ "
,
ÖÖ" #
message
ÜÜ 
=
ÜÜ 
ex
ÜÜ  
.
ÜÜ  !
Message
ÜÜ! (
,
ÜÜ( )
objects
áá 
=
áá 
null
áá "
}
àà 
;
àà 
}
ââ 
}
ää 	
}
ãã 
}åå Ö
ÄD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\TitanEntegration\Models\DeviceData.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
TitanEntegration& 6
.6 7
Models7 =
{ 
public 

class 

DeviceData 
{ 
public 
string 
Board 
{ 
get !
;! "
set# &
;& '
}( )
public		 
string		 
Brand		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
public

 
string

 

DeviceName

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
string 
Hardware 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Manufacturer "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Model 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
Product 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Serial 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
IMEI1 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
IMEI2 
{ 
get !
;! "
set# &
;& '
}( )
public 
DateTime 
Created 
{  !
get" %
;% &
set' *
;* +
}, -
public 
object 
Modified 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
DeviceId 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ›
ÇD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\TitanEntegration\Models\DeviceResult.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
TitanEntegration& 6
.6 7
Models7 =
{ 
public 

class 
DeviceResultList !
{ 
public 
List 
< 

DeviceData 
> 
Data  $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
bool 
Success 
{ 
get !
;! "
set# &
;& '
}( )
public		 
List		 
<		 
string		 
>		 
Messages		 $
{		% &
get		' *
;		* +
set		, /
;		/ 0
}		1 2
}

 
} ¿
ÜD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\TitanEntegration\ProcessTitanEntegration.cs
	namespace 	
Infoline
 
. 
OmixEntegrationApp %
.% &
TitanEntegration& 6
{		 
public

 

class

 #
ProcessTitanEntegration

 (
:

) *
IDisposable

+ 6
{ 
TitanService 
TitanService !
=" #
new$ '
TitanService( 4
(4 5
)5 6
;6 7
public #
ProcessTitanEntegration &
(& '
)' (
{ 	
Log 
. 
Info 
( 
$str 7
)7 8
;8 9
} 	
public 
Task 
Run 
( 
) 
{ 	
while 
( 
true 
) 
{ 
TitanService 
. '
CompensateFromTitanServices 8
(8 9
)9 :
;: ;
Task 
. 
Delay 
( 
new 
TimeSpan '
(' (
$num( )
,) *
$num+ ,
,, -
$num. /
)/ 0
)0 1
.1 2
Wait2 6
(6 7
)7 8
;8 9
} 
} 	
public 
void 
Dispose 
( 
) 
{ 	
} 	
} 
}   Ÿõ
tD:\PROJELER\Infoline-Bilgi-Teknolojileri\WorkOfTime-Web-Server\Infoline.OmixEntegrationApp\Utils\ServiceInstaller.cs
	namespace 	
ServiceInstaller
 
{ 
[ 
Flags 

]
 
public		 

enum		  
ServiceManagerRights		 $
{

 
Connect 
= 
$num 
, 
CreateService 
= 
$num 
, 
EnumerateService 
= 
$num !
,! "
Lock 
= 
$num 
, 
QueryLockStatus 
= 
$num  
,  !
ModifyBootConfig"" 
="" 
$num"" !
,""! ""
StandardRightsRequired&& 
=&&  
$num&&! (
,&&( )
	AllAccess** 
=** 
(** "
StandardRightsRequired** +
|**, -
Connect**. 5
|**6 7
CreateService**8 E
|**F G
EnumerateService++ 
|++ 
Lock++ 
|++  !
QueryLockStatus++" 1
|++2 3
ModifyBootConfig++4 D
)++D E
},, 
[11 
Flags11 

]11
 
public22 

enum22 
ServiceRights22 
{33 
QueryConfig77 
=77 
$num77 
,77 
ChangeConfig;; 
=;; 
$num;; 
,;; 
QueryStatus?? 
=?? 
$num?? 
,?? 
EnumerateDependantsCC 
=CC 
$numCC !
,CC! "
StartGG 
=GG 
$numGG 
,GG 
StopKK 
=KK 
$numKK 
,KK 
PauseContinueOO 
=OO 
$numOO 
,OO 
InterrogateSS 
=SS 
$numSS 
,SS 
UserDefinedControlWW 
=WW 
$numWW "
,WW" #
Delete[[ 
=[[ 
$num[[ 
,[[ "
StandardRightsRequired__ 
=__  
$num__! (
,__( )
	AllAccesscc 
=cc 
(cc "
StandardRightsRequiredcc +
|cc, -
QueryConfigcc. 9
|cc: ;
ChangeConfigcc< H
|ccI J
QueryStatusdd 
|dd 
EnumerateDependantsdd )
|dd* +
Startdd, 1
|dd2 3
Stopdd4 8
|dd9 :
PauseContinuedd; H
|ddI J
Interrogateee 
|ee 
UserDefinedControlee (
)ee( )
}ff 
publickk 

enumkk 
ServiceBootFlagkk 
{ll 
Startpp 
=pp 
$numpp 
,pp 
SystemStarttt 
=tt 
$numtt  
,tt  !
	AutoStartxx 
=xx 
$numxx 
,xx 
DemandStart|| 
=|| 
$num||  
,||  !
Disabled
ÄÄ 
=
ÄÄ 
$num
ÄÄ 
}
ÅÅ 
public
ÜÜ 

enum
ÜÜ 
ServiceState
ÜÜ 
{
áá 
Unknown
ãã 
=
ãã 
-
ãã 
$num
ãã 
,
ãã 
NotFound
èè 
=
èè 
$num
èè 
,
èè 
Stop
ìì 
=
ìì 
$num
ìì 
,
ìì 
Run
óó 
=
óó 
$num
óó 
,
óó 
Stopping
õõ 
=
õõ 
$num
õõ 
,
õõ 
Starting
üü 
=
üü 
$num
üü 
,
üü 
}
†† 
public
•• 

enum
•• 
ServiceControl
•• 
{
¶¶ 
Stop
™™ 
=
™™ 
$num
™™ 
,
™™ 
Pause
ÆÆ 
=
ÆÆ 
$num
ÆÆ 
,
ÆÆ 
Continue
≤≤ 
=
≤≤ 
$num
≤≤ 
,
≤≤ 
Interrogate
∂∂ 
=
∂∂ 
$num
∂∂  
,
∂∂  !
Shutdown
∫∫ 
=
∫∫ 
$num
∫∫ 
,
∫∫ 
ParamChange
ææ 
=
ææ 
$num
ææ  
,
ææ  !

NetBindAdd
¬¬ 
=
¬¬ 
$num
¬¬ 
,
¬¬  
NetBindRemove
∆∆ 
=
∆∆ 
$num
∆∆ "
,
∆∆" #
NetBindEnable
   
=
   
$num
   "
,
  " #
NetBindDisable
ŒŒ 
=
ŒŒ 
$num
ŒŒ #
}
œœ 
public
‘‘ 

enum
‘‘ 
ServiceError
‘‘ 
{
’’ 
Ignore
ŸŸ 
=
ŸŸ 
$num
ŸŸ 
,
ŸŸ 
Normal
›› 
=
›› 
$num
›› 
,
›› 
Severe
·· 
=
·· 
$num
·· 
,
·· 
Critical
ÂÂ 
=
ÂÂ 
$num
ÂÂ 
}
ÊÊ 
public
ÎÎ 

class
ÎÎ 
SvcInstaller
ÎÎ 
{
ÏÏ 
private
ÓÓ 
const
ÓÓ 
int
ÓÓ &
STANDARD_RIGHTS_REQUIRED
ÓÓ 2
=
ÓÓ3 4
$num
ÓÓ5 <
;
ÓÓ< =
private
ÔÔ 
const
ÔÔ 
int
ÔÔ '
SERVICE_WIN32_OWN_PROCESS
ÔÔ 3
=
ÔÔ4 5
$num
ÔÔ6 @
;
ÔÔ@ A
[
ÒÒ 	
StructLayout
ÒÒ	 
(
ÒÒ 

LayoutKind
ÒÒ  
.
ÒÒ  !

Sequential
ÒÒ! +
)
ÒÒ+ ,
]
ÒÒ, -
private
ÚÚ 
class
ÚÚ 
SERVICE_STATUS
ÚÚ $
{
ÛÛ 	
public
ÙÙ 
int
ÙÙ 
dwServiceType
ÙÙ $
=
ÙÙ% &
$num
ÙÙ' (
;
ÙÙ( )
public
ıı 
ServiceState
ıı 
dwCurrentState
ıı  .
=
ıı/ 0
$num
ıı1 2
;
ıı2 3
public
ˆˆ 
int
ˆˆ  
dwControlsAccepted
ˆˆ )
=
ˆˆ* +
$num
ˆˆ, -
;
ˆˆ- .
public
˜˜ 
int
˜˜ 
dwWin32ExitCode
˜˜ &
=
˜˜' (
$num
˜˜) *
;
˜˜* +
public
¯¯ 
int
¯¯ '
dwServiceSpecificExitCode
¯¯ 0
=
¯¯1 2
$num
¯¯3 4
;
¯¯4 5
public
˘˘ 
int
˘˘ 
dwCheckPoint
˘˘ #
=
˘˘$ %
$num
˘˘& '
;
˘˘' (
public
˙˙ 
int
˙˙ 

dwWaitHint
˙˙ !
=
˙˙" #
$num
˙˙$ %
;
˙˙% &
}
˚˚ 	
[
˝˝ 	
	DllImport
˝˝	 
(
˝˝ 
$str
˝˝ !
,
˝˝! "

EntryPoint
˝˝# -
=
˝˝. /
$str
˝˝0 @
)
˝˝@ A
]
˝˝A B
private
˛˛ 
static
˛˛ 
extern
˛˛ 
IntPtr
˛˛ $
OpenSCManager
˛˛% 2
(
˛˛2 3
string
˛˛3 9
lpMachineName
˛˛: G
,
˛˛G H
string
˛˛I O
lpDatabaseName
˛˛P ^
,
˛˛^ _"
ServiceManagerRights
˛˛` t
dwDesiredAccess˛˛u Ñ
)˛˛Ñ Ö
;˛˛Ö Ü
[
ÄÄ 	
	DllImport
ÄÄ	 
(
ÄÄ 
$str
ÄÄ !
,
ÄÄ! "

EntryPoint
ÄÄ# -
=
ÄÄ. /
$str
ÄÄ0 >
,
ÄÄ> ?
CharSet
ÅÅ 
=
ÅÅ 
CharSet
ÅÅ 
.
ÅÅ 
Ansi
ÅÅ 
)
ÅÅ 
]
ÅÅ  
private
ÉÉ 
static
ÉÉ 
extern
ÉÉ 
IntPtr
ÉÉ $
OpenService
ÉÉ% 0
(
ÉÉ0 1
IntPtr
ÉÉ1 7

hSCManager
ÉÉ8 B
,
ÉÉB C
string
ÉÉD J
lpServiceName
ÑÑ 
,
ÑÑ 
ServiceRights
ÑÑ $
dwDesiredAccess
ÑÑ% 4
)
ÑÑ4 5
;
ÑÑ5 6
[
ÜÜ 	
	DllImport
ÜÜ	 
(
ÜÜ 
$str
ÜÜ !
,
ÜÜ! "

EntryPoint
ÜÜ# -
=
ÜÜ. /
$str
ÜÜ0 @
)
ÜÜ@ A
]
ÜÜA B
private
áá 
static
áá 
extern
áá 
IntPtr
áá $
CreateService
áá% 2
(
áá2 3
IntPtr
áá3 9

hSCManager
áá: D
,
ááD E
string
ááF L
lpServiceName
àà 
,
àà 
string
àà 
lpDisplayName
àà +
,
àà+ ,
ServiceRights
àà- :
dwDesiredAccess
àà; J
,
ààJ K
int
ààL O
dwServiceType
ââ 
,
ââ 
ServiceBootFlag
ââ &
dwStartType
ââ' 2
,
ââ2 3
ServiceError
ââ4 @
dwErrorControl
ââA O
,
ââO P
string
ää 
lpBinaryPathName
ää 
,
ää  
string
ää! '
lpLoadOrderGroup
ää( 8
,
ää8 9
IntPtr
ää: @
	lpdwTagId
ääA J
,
ääJ K
string
ääL R
lpDependencies
ãã 
,
ãã 
string
ãã 
lp
ãã !
,
ãã! "
string
ãã# )

lpPassword
ãã* 4
)
ãã4 5
;
ãã5 6
[
éé 	
	DllImport
éé	 
(
éé 
$str
éé !
)
éé! "
]
éé" #
private
èè 
static
èè 
extern
èè 
int
èè ! 
CloseServiceHandle
èè" 4
(
èè4 5
IntPtr
èè5 ;
	hSCObject
èè< E
)
èèE F
;
èèF G
[
ëë 	
	DllImport
ëë	 
(
ëë 
$str
ëë !
)
ëë! "
]
ëë" #
private
íí 
static
íí 
extern
íí 
int
íí ! 
QueryServiceStatus
íí" 4
(
íí4 5
IntPtr
íí5 ;
hService
íí< D
,
ííD E
SERVICE_STATUS
ííF T
lpServiceStatus
ííU d
)
ííd e
;
ííe f
[
îî 	
	DllImport
îî	 
(
îî 
$str
îî !
,
îî! "
SetLastError
îî# /
=
îî0 1
true
îî2 6
)
îî6 7
]
îî7 8
private
ïï 
static
ïï 
extern
ïï 
int
ïï !
DeleteService
ïï" /
(
ïï/ 0
IntPtr
ïï0 6
hService
ïï7 ?
)
ïï? @
;
ïï@ A
[
óó 	
	DllImport
óó	 
(
óó 
$str
óó !
)
óó! "
]
óó" #
private
òò 
static
òò 
extern
òò 
int
òò !
ControlService
òò" 0
(
òò0 1
IntPtr
òò1 7
hService
òò8 @
,
òò@ A
ServiceControl
òòB P
	dwControl
òòQ Z
,
òòZ [
SERVICE_STATUS
òò\ j
lpServiceStatus
òòk z
)
òòz {
;
òò{ |
[
öö 	
	DllImport
öö	 
(
öö 
$str
öö !
,
öö! "

EntryPoint
öö# -
=
öö. /
$str
öö0 ?
)
öö? @
]
öö@ A
private
õõ 
static
õõ 
extern
õõ 
int
õõ !
StartService
õõ" .
(
õõ. /
IntPtr
õõ/ 5
hService
õõ6 >
,
õõ> ?
int
õõ@ C
dwNumServiceArgs
úú 
,
úú 
int
úú !
lpServiceArgVectors
úú 1
)
úú1 2
;
úú2 3
public
°° 
SvcInstaller
°° 
(
°° 
)
°° 
{
¢¢ 	
}
££ 	
public
©© 
static
©© 
void
©© 
	Uninstall
©© $
(
©©$ %
string
©©% +
ServiceName
©©, 7
)
©©7 8
{
™™ 	
IntPtr
´´ 
scman
´´ 
=
´´ 
OpenSCManager
´´ (
(
´´( )"
ServiceManagerRights
´´) =
.
´´= >
Connect
´´> E
)
´´E F
;
´´F G
try
¨¨ 
{
≠≠ 
IntPtr
ÆÆ 
service
ÆÆ 
=
ÆÆ  
OpenService
ÆÆ! ,
(
ÆÆ, -
scman
ÆÆ- 2
,
ÆÆ2 3
ServiceName
ÆÆ4 ?
,
ÆÆ? @
ServiceRights
ØØ 
.
ØØ $
StandardRightsRequired
ØØ 4
|
ØØ5 6
ServiceRights
ØØ7 D
.
ØØD E
Stop
ØØE I
|
ØØJ K
ServiceRights
∞∞ 
.
∞∞ 
QueryStatus
∞∞ )
)
∞∞) *
;
∞∞* +
if
±± 
(
±± 
service
±± 
==
±± 
IntPtr
±± %
.
±±% &
Zero
±±& *
)
±±* +
{
≤≤ 
throw
≥≥ 
new
≥≥ "
ApplicationException
≥≥ 2
(
≥≥2 3
$str
≥≥3 R
)
≥≥R S
;
≥≥S T
}
¥¥ 
try
µµ 
{
∂∂ 
StopService
∑∑ 
(
∑∑  
service
∑∑  '
)
∑∑' (
;
∑∑( )
int
∏∏ 
ret
∏∏ 
=
∏∏ 
DeleteService
∏∏ +
(
∏∏+ ,
service
∏∏, 3
)
∏∏3 4
;
∏∏4 5
if
ππ 
(
ππ 
ret
ππ 
==
ππ 
$num
ππ  
)
ππ  !
{
∫∫ 
int
ªª 
error
ªª !
=
ªª" #
Marshal
ªª$ +
.
ªª+ ,
GetLastWin32Error
ªª, =
(
ªª= >
)
ªª> ?
;
ªª? @
throw
ºº 
new
ºº !"
ApplicationException
ºº" 6
(
ºº6 7
$str
ºº7 U
+
ººV W
error
ººX ]
)
ºº] ^
;
ºº^ _
}
ΩΩ 
}
ææ 
finally
øø 
{
¿¿  
CloseServiceHandle
¡¡ &
(
¡¡& '
service
¡¡' .
)
¡¡. /
;
¡¡/ 0
}
¬¬ 
}
√√ 
finally
ƒƒ 
{
≈≈  
CloseServiceHandle
∆∆ "
(
∆∆" #
scman
∆∆# (
)
∆∆( )
;
∆∆) *
}
«« 
}
»» 	
public
œœ 
static
œœ 
bool
œœ  
ServiceIsInstalled
œœ -
(
œœ- .
string
œœ. 4
ServiceName
œœ5 @
)
œœ@ A
{
–– 	
IntPtr
—— 
scman
—— 
=
—— 
OpenSCManager
—— (
(
——( )"
ServiceManagerRights
——) =
.
——= >
Connect
——> E
)
——E F
;
——F G
try
““ 
{
”” 
IntPtr
‘‘ 
service
‘‘ 
=
‘‘  
OpenService
‘‘! ,
(
‘‘, -
scman
‘‘- 2
,
‘‘2 3
ServiceName
‘‘4 ?
,
‘‘? @
ServiceRights
’’ 
.
’’ 
QueryStatus
’’ )
)
’’) *
;
’’* +
if
÷÷ 
(
÷÷ 
service
÷÷ 
==
÷÷ 
IntPtr
÷÷ %
.
÷÷% &
Zero
÷÷& *
)
÷÷* +
return
÷÷, 2
false
÷÷3 8
;
÷÷8 9 
CloseServiceHandle
◊◊ "
(
◊◊" #
service
◊◊# *
)
◊◊* +
;
◊◊+ ,
return
ÿÿ 
true
ÿÿ 
;
ÿÿ 
}
ŸŸ 
finally
⁄⁄ 
{
€€  
CloseServiceHandle
‹‹ "
(
‹‹" #
scman
‹‹# (
)
‹‹( )
;
‹‹) *
}
›› 
}
ﬁﬁ 	
public
ÊÊ 
static
ÊÊ 
void
ÊÊ 
Install
ÊÊ "
(
ÊÊ" #
string
ÊÊ# )
ServiceName
ÊÊ* 5
,
ÊÊ5 6
string
ÊÊ7 =
DisplayName
ÊÊ> I
,
ÊÊI J
string
ÁÁ 
FileName
ÁÁ 
,
ÁÁ 
bool
ÁÁ 
start
ÁÁ #
)
ÁÁ# $
{
ËË 	
IntPtr
ÈÈ 
scman
ÈÈ 
=
ÈÈ 
OpenSCManager
ÈÈ (
(
ÈÈ( )"
ServiceManagerRights
ÈÈ) =
.
ÈÈ= >
Connect
ÈÈ> E
|
ÈÈF G"
ServiceManagerRights
ÍÍ  
.
ÍÍ  !
CreateService
ÍÍ! .
)
ÍÍ. /
;
ÍÍ/ 0
try
ÎÎ 
{
ÏÏ 
IntPtr
ÌÌ 
service
ÌÌ 
=
ÌÌ  
OpenService
ÌÌ! ,
(
ÌÌ, -
scman
ÌÌ- 2
,
ÌÌ2 3
ServiceName
ÌÌ4 ?
,
ÌÌ? @
ServiceRights
ÓÓ 
.
ÓÓ 
QueryStatus
ÓÓ )
|
ÓÓ* +
ServiceRights
ÓÓ, 9
.
ÓÓ9 :
Start
ÓÓ: ?
)
ÓÓ? @
;
ÓÓ@ A
if
ÔÔ 
(
ÔÔ 
service
ÔÔ 
==
ÔÔ 
IntPtr
ÔÔ %
.
ÔÔ% &
Zero
ÔÔ& *
)
ÔÔ* +
{
 
service
ÒÒ 
=
ÒÒ 
CreateService
ÒÒ +
(
ÒÒ+ ,
scman
ÒÒ, 1
,
ÒÒ1 2
ServiceName
ÒÒ3 >
,
ÒÒ> ?
DisplayName
ÒÒ@ K
,
ÒÒK L
ServiceRights
ÚÚ !
.
ÚÚ! "
QueryStatus
ÚÚ" -
|
ÚÚ. /
ServiceRights
ÚÚ0 =
.
ÚÚ= >
Start
ÚÚ> C
,
ÚÚC D'
SERVICE_WIN32_OWN_PROCESS
ÚÚE ^
,
ÚÚ^ _
ServiceBootFlag
ÛÛ #
.
ÛÛ# $
	AutoStart
ÛÛ$ -
,
ÛÛ- .
ServiceError
ÛÛ/ ;
.
ÛÛ; <
Normal
ÛÛ< B
,
ÛÛB C
FileName
ÛÛD L
,
ÛÛL M
null
ÛÛN R
,
ÛÛR S
IntPtr
ÛÛT Z
.
ÛÛZ [
Zero
ÛÛ[ _
,
ÛÛ_ `
null
ÙÙ 
,
ÙÙ 
null
ÙÙ 
,
ÙÙ 
null
ÙÙ  $
)
ÙÙ$ %
;
ÙÙ% &
}
ıı 
if
ˆˆ 
(
ˆˆ 
service
ˆˆ 
==
ˆˆ 
IntPtr
ˆˆ %
.
ˆˆ% &
Zero
ˆˆ& *
)
ˆˆ* +
{
˜˜ 
throw
¯¯ 
new
¯¯ "
ApplicationException
¯¯ 2
(
¯¯2 3
$str
¯¯3 Y
)
¯¯Y Z
;
¯¯Z [
}
˘˘ 
if
˙˙ 
(
˙˙ 
start
˙˙ 
)
˙˙ 
{
˚˚ 
try
¸¸ 
{
˝˝ 
StartService
˛˛ $
(
˛˛$ %
service
˛˛% ,
)
˛˛, -
;
˛˛- .
}
ˇˇ 
finally
ÄÄ 
{
ÅÅ  
CloseServiceHandle
ÇÇ *
(
ÇÇ* +
service
ÇÇ+ 2
)
ÇÇ2 3
;
ÇÇ3 4
}
ÉÉ 
}
ÑÑ 
}
ÖÖ 
finally
ÜÜ 
{
áá  
CloseServiceHandle
àà "
(
àà" #
scman
àà# (
)
àà( )
;
àà) *
}
ââ 
}
ää 	
public
ëë 
static
ëë 
void
ëë 
StartService
ëë '
(
ëë' (
string
ëë( .
Name
ëë/ 3
)
ëë3 4
{
íí 	
IntPtr
ìì 
scman
ìì 
=
ìì 
OpenSCManager
ìì (
(
ìì( )"
ServiceManagerRights
ìì) =
.
ìì= >
Connect
ìì> E
)
ììE F
;
ììF G
try
îî 
{
ïï 
IntPtr
ññ 
hService
ññ 
=
ññ  !
OpenService
ññ" -
(
ññ- .
scman
ññ. 3
,
ññ3 4
Name
ññ5 9
,
ññ9 :
ServiceRights
ññ; H
.
ññH I
QueryStatus
ññI T
|
ññU V
ServiceRights
óó 
.
óó 
Start
óó #
)
óó# $
;
óó$ %
if
òò 
(
òò 
hService
òò 
==
òò 
IntPtr
òò  &
.
òò& '
Zero
òò' +
)
òò+ ,
{
ôô 
throw
öö 
new
öö "
ApplicationException
öö 2
(
öö2 3
$str
öö3 L
)
ööL M
;
ööM N
}
õõ 
try
úú 
{
ùù 
StartService
ûû  
(
ûû  !
hService
ûû! )
)
ûû) *
;
ûû* +
}
üü 
finally
†† 
{
°°  
CloseServiceHandle
¢¢ &
(
¢¢& '
hService
¢¢' /
)
¢¢/ 0
;
¢¢0 1
}
££ 
}
§§ 
finally
•• 
{
¶¶  
CloseServiceHandle
ßß "
(
ßß" #
scman
ßß# (
)
ßß( )
;
ßß) *
}
®® 
}
©© 	
public
ØØ 
static
ØØ 
void
ØØ 
StopService
ØØ &
(
ØØ& '
string
ØØ' -
Name
ØØ. 2
)
ØØ2 3
{
∞∞ 	
IntPtr
±± 
scman
±± 
=
±± 
OpenSCManager
±± (
(
±±( )"
ServiceManagerRights
±±) =
.
±±= >
Connect
±±> E
)
±±E F
;
±±F G
try
≤≤ 
{
≥≥ 
IntPtr
¥¥ 
hService
¥¥ 
=
¥¥  !
OpenService
¥¥" -
(
¥¥- .
scman
¥¥. 3
,
¥¥3 4
Name
¥¥5 9
,
¥¥9 :
ServiceRights
¥¥; H
.
¥¥H I
QueryStatus
¥¥I T
|
¥¥U V
ServiceRights
µµ 
.
µµ 
Stop
µµ "
)
µµ" #
;
µµ# $
if
∂∂ 
(
∂∂ 
hService
∂∂ 
==
∂∂ 
IntPtr
∂∂  &
.
∂∂& '
Zero
∂∂' +
)
∂∂+ ,
{
∑∑ 
throw
∏∏ 
new
∏∏ "
ApplicationException
∏∏ 2
(
∏∏2 3
$str
∏∏3 L
)
∏∏L M
;
∏∏M N
}
ππ 
try
∫∫ 
{
ªª 
StopService
ºº 
(
ºº  
hService
ºº  (
)
ºº( )
;
ºº) *
}
ΩΩ 
finally
ææ 
{
øø  
CloseServiceHandle
¿¿ &
(
¿¿& '
hService
¿¿' /
)
¿¿/ 0
;
¿¿0 1
}
¡¡ 
}
¬¬ 
finally
√√ 
{
ƒƒ  
CloseServiceHandle
≈≈ "
(
≈≈" #
scman
≈≈# (
)
≈≈( )
;
≈≈) *
}
∆∆ 
}
«« 	
private
ÕÕ 
static
ÕÕ 
void
ÕÕ 
StartService
ÕÕ (
(
ÕÕ( )
IntPtr
ÕÕ) /
hService
ÕÕ0 8
)
ÕÕ8 9
{
ŒŒ 	
SERVICE_STATUS
œœ 
status
œœ !
=
œœ" #
new
œœ$ '
SERVICE_STATUS
œœ( 6
(
œœ6 7
)
œœ7 8
;
œœ8 9
StartService
–– 
(
–– 
hService
–– !
,
––! "
$num
––# $
,
––$ %
$num
––& '
)
––' (
;
––( )"
WaitForServiceStatus
——  
(
——  !
hService
——! )
,
——) *
ServiceState
——+ 7
.
——7 8
Starting
——8 @
,
——@ A
ServiceState
——B N
.
——N O
Run
——O R
)
——R S
;
——S T
}
““ 	
private
ÿÿ 
static
ÿÿ 
void
ÿÿ 
StopService
ÿÿ '
(
ÿÿ' (
IntPtr
ÿÿ( .
hService
ÿÿ/ 7
)
ÿÿ7 8
{
ŸŸ 	
SERVICE_STATUS
⁄⁄ 
status
⁄⁄ !
=
⁄⁄" #
new
⁄⁄$ '
SERVICE_STATUS
⁄⁄( 6
(
⁄⁄6 7
)
⁄⁄7 8
;
⁄⁄8 9
ControlService
€€ 
(
€€ 
hService
€€ #
,
€€# $
ServiceControl
€€% 3
.
€€3 4
Stop
€€4 8
,
€€8 9
status
€€: @
)
€€@ A
;
€€A B"
WaitForServiceStatus
‹‹  
(
‹‹  !
hService
‹‹! )
,
‹‹) *
ServiceState
‹‹+ 7
.
‹‹7 8
Stopping
‹‹8 @
,
‹‹@ A
ServiceState
‹‹B N
.
‹‹N O
Stop
‹‹O S
)
‹‹S T
;
‹‹T U
}
›› 	
public
‰‰ 
static
‰‰ 
ServiceState
‰‰ "
GetServiceStatus
‰‰# 3
(
‰‰3 4
string
‰‰4 :
ServiceName
‰‰; F
)
‰‰F G
{
ÂÂ 	
IntPtr
ÊÊ 
scman
ÊÊ 
=
ÊÊ 
OpenSCManager
ÊÊ (
(
ÊÊ( )"
ServiceManagerRights
ÊÊ) =
.
ÊÊ= >
Connect
ÊÊ> E
)
ÊÊE F
;
ÊÊF G
try
ÁÁ 
{
ËË 
IntPtr
ÈÈ 
hService
ÈÈ 
=
ÈÈ  !
OpenService
ÈÈ" -
(
ÈÈ- .
scman
ÈÈ. 3
,
ÈÈ3 4
ServiceName
ÈÈ5 @
,
ÈÈ@ A
ServiceRights
ÍÍ 
.
ÍÍ 
QueryStatus
ÍÍ )
)
ÍÍ) *
;
ÍÍ* +
if
ÎÎ 
(
ÎÎ 
hService
ÎÎ 
==
ÎÎ 
IntPtr
ÎÎ  &
.
ÎÎ& '
Zero
ÎÎ' +
)
ÎÎ+ ,
{
ÏÏ 
return
ÌÌ 
ServiceState
ÌÌ '
.
ÌÌ' (
NotFound
ÌÌ( 0
;
ÌÌ0 1
}
ÓÓ 
try
ÔÔ 
{
 
return
ÒÒ 
GetServiceStatus
ÒÒ +
(
ÒÒ+ ,
hService
ÒÒ, 4
)
ÒÒ4 5
;
ÒÒ5 6
}
ÚÚ 
finally
ÛÛ 
{
ÙÙ  
CloseServiceHandle
ıı &
(
ıı& '
scman
ıı' ,
)
ıı, -
;
ıı- .
}
ˆˆ 
}
˜˜ 
finally
¯¯ 
{
˘˘  
CloseServiceHandle
˙˙ "
(
˙˙" #
scman
˙˙# (
)
˙˙( )
;
˙˙) *
}
˚˚ 
}
¸¸ 	
private
ÉÉ 
static
ÉÉ 
ServiceState
ÉÉ #
GetServiceStatus
ÉÉ$ 4
(
ÉÉ4 5
IntPtr
ÉÉ5 ;
hService
ÉÉ< D
)
ÉÉD E
{
ÑÑ 	
SERVICE_STATUS
ÖÖ 
ssStatus
ÖÖ #
=
ÖÖ$ %
new
ÖÖ& )
SERVICE_STATUS
ÖÖ* 8
(
ÖÖ8 9
)
ÖÖ9 :
;
ÖÖ: ;
if
ÜÜ 
(
ÜÜ  
QueryServiceStatus
ÜÜ "
(
ÜÜ" #
hService
ÜÜ# +
,
ÜÜ+ ,
ssStatus
ÜÜ- 5
)
ÜÜ5 6
==
ÜÜ7 9
$num
ÜÜ: ;
)
ÜÜ; <
{
áá 
throw
àà 
new
àà "
ApplicationException
àà .
(
àà. /
$str
àà/ Q
)
ààQ R
;
ààR S
}
ââ 
return
ää 
ssStatus
ää 
.
ää 
dwCurrentState
ää *
;
ää* +
}
ãã 	
private
ïï 
static
ïï 
bool
ïï "
WaitForServiceStatus
ïï 0
(
ïï0 1
IntPtr
ïï1 7
hService
ïï8 @
,
ïï@ A
ServiceState
ïïB N

WaitStatus
ññ 
,
ññ 
ServiceState
ññ  
DesiredStatus
ññ! .
)
ññ. /
{
óó 	
SERVICE_STATUS
òò 
ssStatus
òò #
=
òò$ %
new
òò& )
SERVICE_STATUS
òò* 8
(
òò8 9
)
òò9 :
;
òò: ;
int
ôô 
dwOldCheckPoint
ôô 
;
ôô  
int
öö 
dwStartTickCount
öö  
;
öö  ! 
QueryServiceStatus
úú 
(
úú 
hService
úú '
,
úú' (
ssStatus
úú) 1
)
úú1 2
;
úú2 3
if
ùù 
(
ùù 
ssStatus
ùù 
.
ùù 
dwCurrentState
ùù '
==
ùù( *
DesiredStatus
ùù+ 8
)
ùù8 9
return
ùù: @
true
ùùA E
;
ùùE F
dwStartTickCount
ûû 
=
ûû 
Environment
ûû *
.
ûû* +
	TickCount
ûû+ 4
;
ûû4 5
dwOldCheckPoint
üü 
=
üü 
ssStatus
üü &
.
üü& '
dwCheckPoint
üü' 3
;
üü3 4
while
°° 
(
°° 
ssStatus
°° 
.
°° 
dwCurrentState
°° *
==
°°+ -

WaitStatus
°°. 8
)
°°8 9
{
¢¢ 
int
ßß 

dwWaitTime
ßß 
=
ßß  
ssStatus
ßß! )
.
ßß) *

dwWaitHint
ßß* 4
/
ßß5 6
$num
ßß7 9
;
ßß9 :
if
©© 
(
©© 

dwWaitTime
©© 
<
©©  
$num
©©! %
)
©©% &

dwWaitTime
©©' 1
=
©©2 3
$num
©©4 8
;
©©8 9
else
™™ 
if
™™ 
(
™™ 

dwWaitTime
™™ #
>
™™$ %
$num
™™& +
)
™™+ ,

dwWaitTime
™™- 7
=
™™8 9
$num
™™: ?
;
™™? @
System
¨¨ 
.
¨¨ 
	Threading
¨¨  
.
¨¨  !
Thread
¨¨! '
.
¨¨' (
Sleep
¨¨( -
(
¨¨- .

dwWaitTime
¨¨. 8
)
¨¨8 9
;
¨¨9 :
if
∞∞ 
(
∞∞  
QueryServiceStatus
∞∞ &
(
∞∞& '
hService
∞∞' /
,
∞∞/ 0
ssStatus
∞∞1 9
)
∞∞9 :
==
∞∞; =
$num
∞∞> ?
)
∞∞? @
break
∞∞A F
;
∞∞F G
if
≤≤ 
(
≤≤ 
ssStatus
≤≤ 
.
≤≤ 
dwCheckPoint
≤≤ )
>
≤≤* +
dwOldCheckPoint
≤≤, ;
)
≤≤; <
{
≥≥ 
dwStartTickCount
µµ $
=
µµ% &
Environment
µµ' 2
.
µµ2 3
	TickCount
µµ3 <
;
µµ< =
dwOldCheckPoint
∂∂ #
=
∂∂$ %
ssStatus
∂∂& .
.
∂∂. /
dwCheckPoint
∂∂/ ;
;
∂∂; <
}
∑∑ 
else
∏∏ 
{
ππ 
if
∫∫ 
(
∫∫ 
Environment
∫∫ #
.
∫∫# $
	TickCount
∫∫$ -
-
∫∫. /
dwStartTickCount
∫∫0 @
>
∫∫A B
ssStatus
∫∫C K
.
∫∫K L

dwWaitHint
∫∫L V
)
∫∫V W
{
ªª 
break
ΩΩ 
;
ΩΩ 
}
ææ 
}
øø 
}
¿¿ 
return
¡¡ 
(
¡¡ 
ssStatus
¡¡ 
.
¡¡ 
dwCurrentState
¡¡ +
==
¡¡, .
DesiredStatus
¡¡/ <
)
¡¡< =
;
¡¡= >
}
¬¬ 	
private
…… 
static
…… 
IntPtr
…… 
OpenSCManager
…… +
(
……+ ,"
ServiceManagerRights
……, @
Rights
……A G
)
……G H
{
   	
IntPtr
ÀÀ 
scman
ÀÀ 
=
ÀÀ 
OpenSCManager
ÀÀ (
(
ÀÀ( )
null
ÀÀ) -
,
ÀÀ- .
null
ÀÀ/ 3
,
ÀÀ3 4
Rights
ÀÀ5 ;
)
ÀÀ; <
;
ÀÀ< =
if
ÃÃ 
(
ÃÃ 
scman
ÃÃ 
==
ÃÃ 
IntPtr
ÃÃ 
.
ÃÃ  
Zero
ÃÃ  $
)
ÃÃ$ %
{
ÕÕ 
throw
ŒŒ 
new
ŒŒ "
ApplicationException
ŒŒ .
(
ŒŒ. /
$str
ŒŒ/ T
)
ŒŒT U
;
ŒŒU V
}
œœ 
return
–– 
scman
–– 
;
–– 
}
—— 	
[
““ 	
	DllImport
““	 
(
““ 
$str
““ 
)
““ 
]
““  
static
”” 
extern
”” 
int
”” &
CoWaitForMultipleHandles
”” 2
(
””2 3
uint
””3 7
dwFlags
””8 ?
,
””? @
uint
””A E
	dwTimeout
””F O
,
””O P
uint
‘‘ 
cHandles
‘‘ 
,
‘‘ 
IntPtr
‘‘  
[
‘‘  !
]
‘‘! "
pHandles
‘‘# +
,
‘‘+ ,
out
‘‘- 0
uint
‘‘1 5
	lpdwindex
‘‘6 ?
)
‘‘? @
;
‘‘@ A
public
÷÷ 
static
÷÷ 
void
÷÷ 
ServisInstall
÷÷ (
(
÷÷( )
String
÷÷) /
ServiceName
÷÷0 ;
,
÷÷; <
bool
÷÷= A
	ReInstall
÷÷B K
,
÷÷K L
bool
÷÷M Q
Start
÷÷R W
,
÷÷W X
string
÷÷Y _
path
÷÷` d
)
÷÷d e
{
◊◊ 	
if
ÿÿ 
(
ÿÿ 
	ReInstall
ÿÿ 
)
ÿÿ 
{
ŸŸ 
ServisUnInstall
⁄⁄ 
(
⁄⁄  
ServiceName
⁄⁄  +
)
⁄⁄+ ,
;
⁄⁄, -
SvcInstaller
€€ 
.
€€ 
Install
€€ $
(
€€$ %
ServiceName
€€% 0
,
€€0 1
ServiceName
€€2 =
,
€€= >
path
€€? C
,
€€C D
true
€€E I
)
€€I J
;
€€J K
}
‹‹ 
else
›› 
{
ﬁﬁ 
var
ﬂﬂ 
s
ﬂﬂ 
=
ﬂﬂ 
SvcInstaller
ﬂﬂ $
.
ﬂﬂ$ %
GetServiceStatus
ﬂﬂ% 5
(
ﬂﬂ5 6
ServiceName
ﬂﬂ6 A
)
ﬂﬂA B
;
ﬂﬂB C
if
‡‡ 
(
‡‡ 
s
‡‡ 
==
‡‡ 
ServiceState
‡‡ %
.
‡‡% &
NotFound
‡‡& .
)
‡‡. /
SvcInstaller
··  
.
··  !
Install
··! (
(
··( )
ServiceName
··) 4
,
··4 5
ServiceName
··6 A
,
··A B
path
··C G
,
··G H
true
··I M
)
··M N
;
··N O
}
‚‚ 
if
„„ 
(
„„ 
Start
„„ 
)
„„ 
ServisStart
‰‰ 
(
‰‰ 
ServiceName
‰‰ '
,
‰‰' (
false
‰‰) .
,
‰‰. /
$str
‰‰0 2
)
‰‰2 3
;
‰‰3 4
}
ÂÂ 	
public
ÁÁ 
static
ÁÁ 
void
ÁÁ 
ServisUnInstall
ÁÁ *
(
ÁÁ* +
String
ÁÁ+ 1
ServiceName
ÁÁ2 =
)
ÁÁ= >
{
ËË 	
var
ÈÈ 
s
ÈÈ 
=
ÈÈ 
SvcInstaller
ÈÈ  
.
ÈÈ  !
GetServiceStatus
ÈÈ! 1
(
ÈÈ1 2
ServiceName
ÈÈ2 =
)
ÈÈ= >
;
ÈÈ> ?
if
ÍÍ 
(
ÍÍ 
s
ÍÍ 
!=
ÍÍ 
ServiceState
ÍÍ !
.
ÍÍ! "
NotFound
ÍÍ" *
)
ÍÍ* +
{
ÎÎ 
if
ÏÏ 
(
ÏÏ 
s
ÏÏ 
==
ÏÏ 
ServiceState
ÏÏ %
.
ÏÏ% &
Run
ÏÏ& )
)
ÏÏ) *
SvcInstaller
ÌÌ  
.
ÌÌ  !
StopService
ÌÌ! ,
(
ÌÌ, -
ServiceName
ÌÌ- 8
)
ÌÌ8 9
;
ÌÌ9 :
SvcInstaller
ÓÓ 
.
ÓÓ 
	Uninstall
ÓÓ &
(
ÓÓ& '
ServiceName
ÓÓ' 2
)
ÓÓ2 3
;
ÓÓ3 4
}
ÔÔ 
}
 	
public
ÚÚ 
static
ÚÚ 
void
ÚÚ 
ServisStart
ÚÚ &
(
ÚÚ& '
String
ÚÚ' -
ServiceName
ÚÚ. 9
,
ÚÚ9 :
bool
ÚÚ; ?
Install
ÚÚ@ G
,
ÚÚG H
string
ÚÚI O
path
ÚÚP T
)
ÚÚT U
{
ÛÛ 	
if
ÙÙ 
(
ÙÙ 
Install
ÙÙ 
)
ÙÙ 
ServisInstall
ıı 
(
ıı 
ServiceName
ıı )
,
ıı) *
false
ıı+ 0
,
ıı0 1
true
ıı2 6
,
ıı6 7
path
ıı8 <
)
ıı< =
;
ıı= >
else
ˆˆ 
{
˜˜ 
var
¯¯ 
s
¯¯ 
=
¯¯ 
SvcInstaller
¯¯ $
.
¯¯$ %
GetServiceStatus
¯¯% 5
(
¯¯5 6
ServiceName
¯¯6 A
)
¯¯A B
;
¯¯B C
{
˙˙ 
if
˚˚ 
(
˚˚ 
s
˚˚ 
==
˚˚ 
ServiceState
˚˚ )
.
˚˚) *
Stop
˚˚* .
)
˚˚. /
SvcInstaller
¸¸ $
.
¸¸$ %
StartService
¸¸% 1
(
¸¸1 2
ServiceName
¸¸2 =
)
¸¸= >
;
¸¸> ?
}
˝˝ 
}
˛˛ 
}
ˇˇ 	
public
ÅÅ 
static
ÅÅ 
void
ÅÅ 

ServisStop
ÅÅ %
(
ÅÅ% &
String
ÅÅ& ,
ServiceName
ÅÅ- 8
)
ÅÅ8 9
{
ÇÇ 	
var
ÉÉ 
s
ÉÉ 
=
ÉÉ 
SvcInstaller
ÉÉ  
.
ÉÉ  !
GetServiceStatus
ÉÉ! 1
(
ÉÉ1 2
ServiceName
ÉÉ2 =
)
ÉÉ= >
;
ÉÉ> ?
{
ÖÖ 
if
ÜÜ 
(
ÜÜ 
s
ÜÜ 
==
ÜÜ 
ServiceState
ÜÜ %
.
ÜÜ% &
Starting
ÜÜ& .
||
ÜÜ/ 1
s
ÜÜ2 3
==
ÜÜ4 6
ServiceState
ÜÜ7 C
.
ÜÜC D
Run
ÜÜD G
)
ÜÜG H
SvcInstaller
áá  
.
áá  !
StopService
áá! ,
(
áá, -
ServiceName
áá- 8
)
áá8 9
;
áá9 :
}
àà 
}
ââ 	
static
ãã 
void
ãã 
ServisReStart
ãã !
(
ãã! "
String
ãã" (
ServiceName
ãã) 4
,
ãã4 5
string
ãã6 <
path
ãã= A
)
ããA B
{
åå 	

ServisStop
çç 
(
çç 
ServiceName
çç "
)
çç" #
;
çç# $
ServisStart
éé 
(
éé 
ServiceName
éé #
,
éé# $
true
éé% )
,
éé) *
path
éé+ /
)
éé/ 0
;
éé0 1
}
èè 	
}
êê 
}ìì 