@model Infoline.WorkOfTime.BusinessAccess.Business.Product.PRD_EntegrastionActionSellerReport
@{
    ViewBag.Title = "Bayi Aktivasyon Raporu";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var distributionId = Model.DistributorId.HasValue ? Model.DistributorId.Value : Guid.NewGuid();
}
<style type="text/css">
    .filterButtonActive {
        background-color: #2f96b4;
        border-color: #2f96b4;
        color: white;
    }

    .filterButtonPassive {
        background-color: #49afcd;
        border-color: #2f96b4;
        color: white;
    }

    ul, li {
        list-style-type: none;
    }

    .active {
        color: black !important;
    }

    .btn-group .btn + .btn {
        margin-left: -9px !important;
    }
</style>


<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="ibox-custom ">
        <div>
            <form action="/PRD/VWPRD_EntegrationAction/SellerReport" method="GET">
                <div class="row">
                    <div class="col-md-6">
                        <div class="col-sm-12">
                            <div class="widget style1 yellow-bg">
                                <div class="row">
                                    <div class="col-xs-4">
                                        <i class="icon-basket-2 fa-4x"></i>
                                    </div>
                                    <div class="col-xs-8 text-right" style="margin-top: 25px;">
                                        <h2 style="display:inline-block;"> Toplam Satılan Miktar </h2>
                                        <h2 style="display:inline-block;" id="total" class="font-bold">0</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="col-sm-12">
                            <div class="widget style1 navy-bg">
                                <div class="row">
                                    <div class="col-xs-4">
                                        <i class="fa fa-check fa-5x"></i>
                                    </div>
                                    <div class="col-xs-8 text-right" style="margin-top: 25px;">
                                        <h2 style="display:inline-block;"> Toplam Aktive Olan Cihaz Sayısı </h2>
                                        <h2 style="display:inline-block;" id="activeTotal" class="font-bold">0</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12" style="padding: 33px; padding-bottom: 0; padding-top: 0;">
                        <div class="form-group" style="width:30%; display:inline-block;">
                            <label class="">Cari Seçimi</label>
                            @(
									 Html.Akilli()
									 .DropDownListFor(model => model.DistributorId)
									 .OptionLabel("Lütfen Cari Seçiniz..")
									 .DataValueField("id")
									 .DataTextField("fullName")
									 .Template("#=TemplateEngine('companyTemplate',data)#")
									 .Action(b => b.Action("DataSourceDropDown", "VWCMP_Company", new { area = "CMP" }))
									 .Sort(x => x.Add("fullName").Ascending())
									 //.Events(x=> { x.Change("onChange"); x.DataBound("onChange"); })
									 .Execute()
								   )
                        </div>
                        <div class="form-group row pull-right" style="width:70%; display:inline-block;">
                            <div class="col-sm-5">
                                <label class="">Başlangıç Tarihi</label>
                                @Html.Akilli().DatePicker("startDate").Value(Model.startDate).Max(DateTime.Now)
                            </div>
                            <div class="col-sm-5">
                                <label class="">Bitiş Tarihi</label>
                                @Html.Akilli().DatePicker("endDate").Value(Model.endDate).Max(DateTime.Now)
                            </div>
                            <div class="col-sm-2">
                                <button id="query" style="margin-top:27px; width:100%;" class="btn btn-primary" type="submit">Sorgula</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <br />
</div>

<div class="col-sm-12">
    <div class="ibox">
        <div class="ibox-title">
            <div class="col-md-10 pull-left">
                <h4>Bayi Bazlı Toplam Kanal Sell-Out Raporu</h4>
            </div>
        </div>
        <div class="ibox-content clearfix" style="min-height: 350px; max-height: 500px; overflow: scroll">
            @*<ul class="folder-list m-b-md" style="padding: 0; font-size: 14px;" id="sellOutDist">
                </ul>*@
            <div class="folder-list m-b-md" style="padding: 0; font-size: 14px;" id="sellOutDist">

            </div>
        </div>
    </div>
</div>


<div class="col-md-12">
    <div class="ibox ">
        <div class="ibox-title">
            <h5>Bayi Aktivasyon Raporu</h5>
        </div>
        <div class="ibox-content">

            @(Html.Akilli()
					.Grid<Infoline.WorkOfTime.BusinessData.VWPRD_EntegrationAction>("VWPRD_EntegrationAction")
					.DataSource(x => x.Ajax().Read(r => r.Action("DataSource", "VWPRD_EntegrationAction", new { area = "PRD" }))
					.Filter(a=> a.DistributorId == distributionId && a.ActivationDate >= Model.startDate && a.ActivationDate <= Model.endDate)
					.PageSize(25))
					.Columns(x =>
					{
						x.Bound(y => y.Invoice_Address).Title("Fatura Tarihi").Width(200).Format(Extensions.DateFormatShort(true));
						x.Bound(y => y.InvoiceNumber).Title("Fatura Numarası").Width(200);
						x.Bound(y => y.CustomerOperatorCode).Title("Bayi Kodu").Width(200);
						x.Bound(y => y.CustomerOperatorName).Title("Bayi Adı").Width(200);
						x.Bound(y => y.CustomerOperatorStorageCity).Title("İl").Width(200);
						x.Bound(y => y.CustomerOperatorStorageTown).Title("İlçe").Width(200);
						x.Bound(y => y.ConsolidationCode).Title("Cihaz Kodu").Width(200);
						x.Bound(y => y.ConsolidationName).Title("Cihaz Adı").Width(200);
						x.Bound(y => y.Imei).Title("Imei").Width(200);
						x.Bound(y => y.Quantity).Title("Adet").Width(200);
						x.Bound(y => y.ActivationDate).Title("Aktivasyon Tarihi").Width(200).Format(Extensions.DateFormatShort(true));
					})
					.Selectable(x => x.Mode(GridSelectionMode.Single))
					.Scrollable(a => a.Height(630))
					.ToolBar(x =>
					{
						//x.Custom().Text("<i data-original-title='Ürün Kopyala' class='fa fa-copy'></i>").HtmlAttributes(new Dictionary<string, object>() { { "data-show", "single" }, { "data-method", "GET" } }).Url(Url.Action("Insert", "VWPRD_Product", new { area = "PRD" }));
						//x.Custom().Text("<i data-original-title='Ürün Düzenle' class='fa fa-edit'></i>").HtmlAttributes(new Dictionary<string, object>() { { "data-show", "single" }, { "data-method", "GET" } }).Url(Url.Action("Update", "VWPRD_Product", new { area = "PRD" }));
						//x.Custom().Text("<i data-original-title='Ürün Detay' class='fa fa-info-circle'></i>").HtmlAttributes(new Dictionary<string, object>() { { "data-show", "single" }, { "data-default", "" }, { "data-modal", "false" } }).Url(Url.Action("Detail", "VWPRD_Product", new { area = "PRD" }));
						//x.Custom().Text("<i data-original-title='Ürün Sil' class='fa fa-trash'></i>").HtmlAttributes(new Dictionary<string, object>() { { "data-ask", "" }, { "data-show", "single" } }).Url(Url.Action("Delete", "VWPRD_Product", new { area = "PRD" }));
					}))

        </div>
    </div>
</div>


<script>

    var page = {
        randomColorNumber: -1,
        colorArray: ["badge-primary", "badge-danger", "badge-warning", "badge-info"],
        getRandomColor: function () {
            if (page.randomColorNumber >= page.colorArray.length - 1) {
                page.randomColorNumber = 0;
                return page.colorArray[page.randomColorNumber];
            }
            page.randomColorNumber++;
            return page.colorArray[page.randomColorNumber];
        },
        setIndexData: function () {
            GetJsonDataFromUrl("/PRD/VWPRD_TitanDeviceActivated/GetIndexData", {}, function (data) {
                $("#total").text(data.All);
                $("#today").text(data.Today);
                $("#seven").text(data.Seven);
                $("#thirty").text(data.Month);
            });
        },
        removeAllLis: function () {
            $("#sellOutProduct li").remove();
            $("#sellOutDist li").remove();
        },
        setDataSourceForProductSellOut: function (startDate, endDate) {
            GetJsonDataFromUrl("/PRD/VWPRD_TitanDeviceActivated/GetProductSellOut", { startDate: startDate, endDate: endDate }, function (data) {
                var count = 0;
                $("#sellOutProduct li").remove();
                $.each(data.objects, function (i, item) {
                    count = count + parseInt(item.Count);
                    $("#sellOutProduct").append(
                        '<li class= "clearfix">' +
                        '<span class="pull-left" data-category="0">' +
                        '<i class="fa fa-mobile-phone" style="color:gray"></i>' + item.Name +
                        '</span>' +
                        '<span id="allTasks" class="badge ' + page.getRandomColor() + ' text-white pull-right m-l-md  m-t-xs" >' + item.Count + '</span>' +
                        '</li>'
                    );
                });
                $("#sellOutProduct").append(
                    '<li class= "clearfix">' +
                    '<span class="pull-left" data-category="0">' +
                    '<i class="fa fa-plus" style="color:gray"></i>Toplam' +
                    '</span>' +
                    '<span id="allTasks" class="badge ' + page.getRandomColor() + ' text-white pull-right m-l-md  m-t-xs" ">' + count + '</span>' +
                    '</li>'
                );
            });
        },
        setDataSourceForDistSellOut: function (distributionId) {
            var startDate = $("#startDate").val();
            var endDate = $("#endDate").val();
            GetJsonDataFromUrl("/PRD/VWPRD_TitanDeviceActivated/GetSellerReportWithDates", { distId: distributionId, startDate: startDate, endDate: endDate }, function (data) {

                var count = 0;
                var countSelling = 0;


                $("#sellOutDist").kendoGrid({
                    toolbar: ["excel"],
                    excel: {
                        fileName: "Bayi Bazlı Toplam Kanal Sell-Out Raporu.xlsx",
                        proxyURL: "https://demos.telerik.com/kendo-ui/service/export",
                        filterable: true
                    },
                    dataSource: {
                        data: data,
                        pageSize: 25
                    },
                    sortable: true,
                    pageable: true,
                    filterable: true,
                    columnMenu: true,
                    reorderable: true,
                    resizable: true,
                    columns: [
                        { field: "Name", title: "Bayi İsmi" },
                        { field: "SellingCount", title: "Satılan", width: 250 },
                        { field: "Count", title: "Aktive Olan", width: 250 }
                    ],
                });

                var icon = $("#sellOutDist .k-i-excel");
                $("#sellOutDist .k-grid-excel").text("");
                $("#sellOutDist .k-grid-excel").append(icon);
                $.each(data, function (i, item) {
                	if (item == null) {
                		return;
                	}
                	count = count + parseInt(item.Count);
                    countSelling += parseInt(item.SellingCount);
                });

                $("#activeTotal").text(countSelling);
                $("#total").text(count);
            });
        },
        createProductChart(startDate, endDate) {
            GetJsonDataFromUrl("/PRD/VWPRD_TitanDeviceActivated/GetProductSellOutProductChartData", { startDate: startDate, endDate: endDate }, function (data) {
                var obj = data.objects;
                $("#chart").kendoChart({
                    title: {
                        text: "Ürün Bazlı SellOut Grafiği"
                    },
                    legend: {
                        position: "bottom"
                    },
                    chartArea: {
                        background: ""
                    },
                    seriesDefaults: {
                        type: "line",
                        style: "smooth"
                    },
                    series: obj.data.Series,
                    valueAxis: {
                        labels: {
                            format: "{0}"
                        },
                        line: {
                            visible: false
                        },
                        axisCrossingValue: -10
                    },
                    categoryAxis: {
                        categories: obj.data.Dates,
                        majorGridLines: {
                            visible: false
                        },
                        labels: {
                            rotation: "auto"
                        }
                    },
                    pannable: {
                        lock: "y"
                    },
                    zoomable: {
                        mousewheel: {
                            lock: "y"
                        },
                        selection: {
                            lock: "y"
                        }
                    },
                    tooltip: {
                        visible: true,
                        format: "{0}%",
                        template: "#= series.name #: #= value #"
                    }
                });
            });
        },
        createDistChart(startDate, endDate) {
            GetJsonDataFromUrl("/PRD/VWPRD_TitanDeviceActivated/GetProductSellOutDistChartData", { startDate: startDate, endDate: endDate }, function (data) {
                var obj = data.objects;
                $("#chart1").kendoChart({
                    title: {
                        text: "Distribütör Bazlı SellOut Grafiği"
                    },
                    legend: {
                        position: "bottom"
                    },
                    chartArea: {
                        background: ""
                    },
                    seriesDefaults: {
                        type: "line",
                        style: "smooth"
                    },
                    series: obj.data.Series,
                    valueAxis: {
                        labels: {
                            format: "{0}"
                        },
                        line: {
                            visible: false
                        },
                        axisCrossingValue: -10
                    },
                    categoryAxis: {
                        categories: obj.data.Dates,
                        majorGridLines: {
                            visible: false
                        },
                        labels: {
                            rotation: "auto"
                        }
                    },
                    pannable: {
                        lock: "y"
                    },
                    zoomable: {
                        mousewheel: {
                            lock: "y"
                        },
                        selection: {
                            lock: "y"
                        }
                    },
                    tooltip: {
                        visible: true,
                        format: "{0}%",
                        template: "#= series.name #: #= value  # Adet"
                    }
                });
            });
        }
    }

    page.setDataSourceForDistSellOut('@Html.Raw(Model.DistributorId)');

</script>
